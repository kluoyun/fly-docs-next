"use strict";(self.webpackChunkklipper_docs=self.webpackChunkklipper_docs||[]).push([["52781"],{48297:function(e,n,s){s.r(n),s.d(n,{metadata:()=>r,contentTitle:()=>o,default:()=>u,assets:()=>a,toc:()=>c,frontMatter:()=>t});var r=JSON.parse('{"id":"ProductDoc/ExtensionBoard/BDsensor-m/kliper","title":"Installation de **BDsensor-m**","description":"Connecter le c\xe2ble du capteur \xe0 l\'interface EXP1 de la carte m\xe8re","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/ProductDoc/ExtensionBoard/BDsensor-m/kliper.mdx","sourceDirName":"ProductDoc/ExtensionBoard/BDsensor-m","slug":"/ProductDoc/ExtensionBoard/BDsensor-m/kliper","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/kliper","draft":false,"unlisted":false,"editUrl":"https://github.com/kluoyun/fly-docs-next/tree/master/docs/ProductDoc/ExtensionBoard/BDsensor-m/kliper.mdx","tags":[],"version":"current","lastUpdatedBy":"xishangxi","lastUpdatedAt":1734947943000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Utilisation de Klipper"},"sidebar":"tutorialSidebar","previous":{"title":"Guide d\'installation","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/line"},"next":{"title":"Utilisation de Marlin","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/marlin"}}'),i=s("52676"),l=s("79938");let t={sidebar_position:3,sidebar_label:"Utilisation de Klipper"},o="Installation de BDsensor-m",a={},c=[{value:"Connecter le c\xe2ble du capteur \xe0 l&#39;interface EXP1 de la carte m\xe8re",id:"connecter-le-c\xe2ble-du-capteur-\xe0-linterface-exp1-de-la-carte-m\xe8re",level:2},{value:"Installation du patch dans le firmware Klipper",id:"installation-du-patch-dans-le-firmware-klipper",level:2},{value:"Si votre imprimante fonctionne avec Moonraker, ajoutez la section suivante \xe0 moonraker.conf, puis vous pourrez mettre \xe0 jour le BDsensor en un clic via une page web ou klipperscreen.",id:"si-votre-imprimante-fonctionne-avec-moonraker-ajoutez-la-section-suivante-\xe0-moonrakerconf-puis-vous-pourrez-mettre-\xe0-jour-le-bdsensor-en-un-clic-via-une-page-web-ou-klipperscreen",level:2},{value:"\xc9dition de printer.cfg",id:"\xe9dition-de-printercfg",level:2},{value:"Apr\xe8s l&#39;installation, v\xe9rifiez en envoyant les commandes G-code suivantes",id:"apr\xe8s-linstallation-v\xe9rifiez-en-envoyant-les-commandes-g-code-suivantes",level:2},{value:"V\xe9rification de la connexion",id:"v\xe9rification-de-la-connexion",level:2},{value:"\xc9talonnage",id:"\xe9talonnage",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components},{ImageView:r}=n;return!r&&function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ImageView",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"installation-de-bdsensor-m",children:["Installation de ",(0,i.jsx)(n.strong,{children:"BDsensor-m"})]})}),"\n",(0,i.jsx)(n.h2,{id:"connecter-le-c\xe2ble-du-capteur-\xe0-linterface-exp1-de-la-carte-m\xe8re",children:"Connecter le c\xe2ble du capteur \xe0 l'interface EXP1 de la carte m\xe8re"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si le c\xe2ble du capteur est trop court, vous pouvez utiliser le c\xe2ble d'extension fourni dans l'emballage."}),"\n",(0,i.jsx)(n.li,{children:"Les fils CKL et SDA du BDsensor-m peuvent \xeatre connect\xe9s \xe0 n'importe quel GPIO de la carte. Vous pouvez \xe9galement connecter directement le c\xe2ble du capteur BD au port Bltouch, par exemple :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"BLtouch    |    BDsensor-m\n5V       --\x3e     5V\nGND      --\x3e     GND\nS        --\x3e     CLK/SCL    (Entr\xe9e)\nGND      --\x3e     GND\nZmin     --\x3e     SDA    (Entr\xe9e/Sortie) \n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["En raison du fait que certains broches du connecteur de la carte m\xe8re peuvent ne pas \xeatre directement connect\xe9es aux GPIO de l'UC (par exemple, elles peuvent avoir des condensateurs de filtrage ou \xeatre isol\xe9es par des MOSFET, des diodes ou des optocoupleurs, mais si elles sont isol\xe9es par des r\xe9sistances ou des r\xe9sistances de pull-up/pull-down, elles peuvent \xeatre utilis\xe9es), elles ne peuvent pas \xeatre utilis\xe9es avec le ",(0,i.jsx)(n.code,{children:"BDsensor-m"}),". Et le firmware signalera une erreur de connexion. Par exemple :"]}),"\n",(0,i.jsx)(n.li,{children:"Les connecteurs des ventilateurs et des radiateurs sont isol\xe9s par des MOSFET,"}),"\n",(0,i.jsx)(n.li,{children:"Les connecteurs utilis\xe9s pour les thermistances de temp\xe9rature et les fins de course/les sondes sur certaines cartes sont g\xe9n\xe9ralement connect\xe9s \xe0 la masse via des condensateurs de filtrage."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Installez le capteur BD \xe0 proximit\xe9 de l'extr\xe9mit\xe9 chaude comme illustr\xe9 ci-dessous. ",(0,i.jsx)(n.a,{href:"https://www.thingiverse.com/thing:6098131",children:"STL du support"}),", ",(0,i.jsx)(n.a,{href:"https://discord.com/channels/829828765512106054/1163237892957671424",children:"STL_mount_VzBot_Goliath court"})]}),"\n",(0,i.jsx)(r,{image:s(47663).Z,size:"100%",align:"left"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation-du-patch-dans-le-firmware-klipper",children:"Installation du patch dans le firmware Klipper"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Abandonnez les fichiers Klipper modifi\xe9s pr\xe9c\xe9demment et mettez \xe0 jour Klipper"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd\ncd ~/klipper\ngit checkout .\ngit pull\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Clonez le dernier code du capteur BD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd && git clone https://github.com/markniu/Bed_Distance_sensor.git\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd  ~/Bed_Distance_sensor/klipper/\n./install_BDsensor.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compilation du firmware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/klipper/\nmake menuconfig\nmake clean\nmake\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Flashez le firmware sur la carte m\xe8re \xe0 laquelle le capteur BD est connect\xe9"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"si-votre-imprimante-fonctionne-avec-moonraker-ajoutez-la-section-suivante-\xe0-moonrakerconf-puis-vous-pourrez-mettre-\xe0-jour-le-bdsensor-en-un-clic-via-une-page-web-ou-klipperscreen",children:"Si votre imprimante fonctionne avec Moonraker, ajoutez la section suivante \xe0 moonraker.conf, puis vous pourrez mettre \xe0 jour le BDsensor en un clic via une page web ou klipperscreen."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[update_manager BDsensor]\ntype: git_repo\nprimary_branch: new\nchannel: dev\npath: ~/Bed_Distance_sensor\norigin: https://github.com/markniu/Bed_Distance_sensor.git\ninstall_script: ./klipper/install_BDsensor.sh\nis_system_service: False\nmanaged_services: klipper\ninfo_tags:\ndesc=Capteur de distance du lit\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\xe9dition-de-printercfg",children:"\xc9dition de printer.cfg"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Copiez cette section dans votre ",(0,i.jsx)(n.strong,{children:"printer.cfg"})," et modifiez ",(0,i.jsx)(n.code,{children:"sda_pin"})," et ",(0,i.jsx)(n.code,{children:"scl_pin"})," de ",(0,i.jsx)(n.code,{children:"[BDsensor]"}),", n'oubliez pas de d\xe9sactiver les autres sections de sonde, comme ",(0,i.jsx)(n.strong,{children:"BLtouch"}),". Vous pouvez connecter le capteur BD \xe0 la carte m\xe8re ou au module CAN de la t\xeate d'outil."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Dans ",(0,i.jsx)(n.code,{children:"[BDsensor]"}),", modifiez ",(0,i.jsx)(n.code,{children:"speed"})," \xe0 0.8. Cela ne s'applique qu'aux commandes Z_TILT et PROBE_ACCURACY. Plus la valeur est petite, plus la pr\xe9cision est \xe9lev\xe9e lors de la d\xe9tection, car l'UC lit le capteur BD dans le circuit principal lors du retour \xe0 l'origine, ce qui n'est pas aussi en temps r\xe9el qu'un fin de course normal. ",(0,i.jsx)(n.code,{children:"[BDsensor]"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pour utiliser le capteur BD comme fin de course lors du retour \xe0 l'origine de l'axe Z, changez ",(0,i.jsx)(n.code,{children:"endstop_pin"})," dans ",(0,i.jsx)(n.code,{children:"[stepper_z]"})," \xe0 ",(0,i.jsx)(n.code,{children:"endstop_pin: probe:z_virtual_endstop"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Assurez-vous que ",(0,i.jsx)(n.code,{children:"[safe_z_home]"})," est pr\xe9sent dans ",(0,i.jsx)(n.strong,{children:"printer.cfg"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Modifiez la valeur de ",(0,i.jsx)(n.code,{children:"[bed_mesh]"})," et ",(0,i.jsx)(n.code,{children:"[z_tilt]"})," ou ",(0,i.jsx)(n.code,{children:"[quad_gantry_level]"})," \xe0 1 (recommand\xe9 entre 0.7-1.0 mm), la valeur par d\xe9faut de Klipper est de 5 mm, sinon cela pourrait d\xe9passer la port\xe9e du capteur."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["L'ajustement de la hauteur de la buse doit se faire uniquement dans ",(0,i.jsx)(n.code,{children:"z_adjust:"}),", un nombre positif rapproche la buse du lit, un nombre n\xe9gatif l'\xe9loigne. Toute autre m\xe9thode d'ajustement de la hauteur de la buse peut entra\xeener des bugs."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pour activer le balayage rapide du lit, supprimez le # devant ",(0,i.jsx)(n.code,{children:"no_stop_probe:true"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Voici un exemple de configuration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cfg",children:"[BDsensor] \nscl_pin:PC6  # Port du signal du servo\nsda_pin:PC3  # Port du signal de fin de course\ndelay: 20 # 20us par impulsion, cette valeur doit \xeatre >=20 mais doit \xeatre inf\xe9rieure \xe0 50\nz_offset:0 # ce `z_offset` doit \xeatre d\xe9fini \xe0 0. \nz_adjust:0.0 # Ajustement de l'axe Z, remplace la fonction z_offset. entre -0.3 et 0.3mm\nx_offset: -34\ny_offset: 0\n#no_stop_probe:true # activez ceci pour une sonde rapide, la t\xeate d'outil ne s'arr\xeatera pas au point de sonde.\nposition_endstop: 0.8 # L'axe Z s'arr\xeatera \xe0 cette position (mm) lors du retour \xe0 l'origine, valeur recommand\xe9e entre 0.4 et 1.0\n#speed:0.8 # cette vitesse ne fonctionne que pour la commande Z_TILT et PROBE_ACCURACY.\n\n[stepper_z]\nendstop_pin: probe:z_virtual_endstop \n#position_endstop: 0.5\nhoming_speed: 5\nsecond_homing_speed: 0.8\n\n[bed_mesh]\nspeed: 200\nhorizontal_move_z:1\nalgorithm: bicubic\n\n[quad_gantry_level]\nhorizontal_move_z:1\n\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"apr\xe8s-linstallation-v\xe9rifiez-en-envoyant-les-commandes-g-code-suivantes",children:"Apr\xe8s l'installation, v\xe9rifiez en envoyant les commandes G-code suivantes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"M102   S-1     # Lire les informations du capteur\nM102   S-2     # Lire une valeur de distance\n"})}),"\n",(0,i.jsx)(n.h2,{id:"v\xe9rification-de-la-connexion",children:"V\xe9rification de la connexion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Envoyez ",(0,i.jsx)(n.code,{children:"M102 S-1"})," via la ",(0,i.jsx)(n.strong,{children:"console"}),", voici un exemple de message de retour, si le retour est vide ou contient d'autres cha\xeenes, v\xe9rifiez la connexion et l'ordre des fils."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Send: M102 S-1\nRecv: V1.0 pandapi3d.com\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\xe9talonnage",children:"\xc9talonnage"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nettoyez la buse, puis d\xe9placez l'axe Z via la console jusqu'\xe0 ce que la buse touche juste le lit (le BDsensor-m utilisera cette position comme position z\xe9ro, donc pas besoin de ",(0,i.jsx)(n.code,{children:"z_offset"}),", c'est pourquoi la valeur dans la section [BDsensor-m] est 0)"]}),"\n",(0,i.jsxs)(n.li,{children:["Envoyez la commande G-code ",(0,i.jsx)(n.code,{children:"M102 S-6"})," via la ",(0,i.jsx)(n.strong,{children:"console"}),", l'imprimante d\xe9placera lentement l'axe Z vers le haut de 0.1mm \xe0 chaque fois jusqu'\xe0 atteindre 4mm. Ne lancez pas M102 S-6 avant d'avoir install\xe9 le capteur, et n'\xe9teignez pas l'imprimante pendant l'\xe9talonnage, sinon les anciennes donn\xe9es d'\xe9talonnage seront effac\xe9es. Dans ce cas, recalibrez simplement."]}),"\n",(0,i.jsxs)(n.li,{children:["Ensuite, vous pouvez v\xe9rifier si le capteur BD a \xe9t\xe9 correctement \xe9talonn\xe9 avec ",(0,i.jsx)(n.code,{children:"M102 S-5"}),", qui retournera les donn\xe9es d'\xe9talonnage brutes stock\xe9es dans le capteur BD."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarques"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"La vitesse de retour \xe0 l'origine de l'axe Z doit \xeatre de pr\xe9f\xe9rence de 5."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Si la premi\xe8re donn\xe9e brute d'\xe9talonnage retourn\xe9e par M102 S-5 est sup\xe9rieure \xe0 400, cela signifie que le capteur est install\xe9 trop haut et doit \xeatre repositionn\xe9 plus pr\xe8s du lit, la valeur recommand\xe9e pour la premi\xe8re donn\xe9e est de 100. Assurez-vous \xe9galement que la deuxi\xe8me valeur est sup\xe9rieure \xe0 la premi\xe8re de plus de 10."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"FAQ : Si les donn\xe9es d'\xe9talonnage commencent par 1, la deuxi\xe8me valeur est 9 et la troisi\xe8me valeur est 24, qu'est-ce que cela signifie ?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Cela signifie que la r\xe9solution entre 0-0.1 mm est seulement de 9, tandis que la r\xe9solution de 0.1-0.2 mm est de 15. Il est donc recommand\xe9 de recalibrer pour que la premi\xe8re r\xe9solution de 0-0.1 mm soit sup\xe9rieure \xe0 10."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["N'oubliez pas d'ajuster la hauteur de l'axe Z apr\xe8s l'ex\xe9cution de G28 ou pour les commandes ",(0,i.jsx)(n.code,{children:"Z_tilt"})," et ",(0,i.jsx)(n.code,{children:"quad_gantry_level"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["La partie du nom doit \xeatre correctement en majuscules et minuscules, sinon Klipper signalera ",(0,i.jsx)(n.code,{children:"Unknown pin chip name 'probe'"})]}),"\n"]}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},47663:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/bd-4d1080107145fed7d8a6ac8c4e5d9536.webp"},79938:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return t}});var r=s(75271);let i={},l=r.createContext(i);function t(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);