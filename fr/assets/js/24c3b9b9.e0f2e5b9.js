"use strict";(self.webpackChunkklipper_docs=self.webpackChunkklipper_docs||[]).push([["52781"],{48297:function(e,n,r){r.r(n),r.d(n,{metadata:()=>s,contentTitle:()=>a,default:()=>u,assets:()=>o,toc:()=>c,frontMatter:()=>t});var s=JSON.parse('{"id":"ProductDoc/ExtensionBoard/BDsensor-m/kliper","title":"Installation de **BDsensor-m**","description":"Connecter le c\xe2ble du capteur \xe0 l\'interface EXP1 de la carte m\xe8re","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/ProductDoc/ExtensionBoard/BDsensor-m/kliper.mdx","sourceDirName":"ProductDoc/ExtensionBoard/BDsensor-m","slug":"/ProductDoc/ExtensionBoard/BDsensor-m/kliper","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/kliper","draft":false,"unlisted":false,"editUrl":"https://github.com/kluoyun/fly-docs-next/tree/master/docs/ProductDoc/ExtensionBoard/BDsensor-m/kliper.mdx","tags":[],"version":"current","lastUpdatedBy":"xishangxi","lastUpdatedAt":1735546887000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Utilisation de Klipper"},"sidebar":"tutorialSidebar","previous":{"title":"Guide d\'installation","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/line"},"next":{"title":"Utilisation de Marlin","permalink":"/fly-docs-next/fr/docs/ProductDoc/ExtensionBoard/BDsensor-m/marlin"}}'),i=r("52676"),l=r("79938");let t={sidebar_position:3,sidebar_label:"Utilisation de Klipper"},a="Installation de BDsensor-m",o={},c=[{value:"Connecter le c\xe2ble du capteur \xe0 l&#39;interface EXP1 de la carte m\xe8re",id:"connecter-le-c\xe2ble-du-capteur-\xe0-linterface-exp1-de-la-carte-m\xe8re",level:2},{value:"Installer le patch dans le firmware Klipper",id:"installer-le-patch-dans-le-firmware-klipper",level:2},{value:"Ici, compilez le firmware <code>si le message d&#39;incoh\xe9rence entre le firmware de l&#39;h\xf4te et celui de la carte</code> appara\xeet, alors compilez un nouveau firmware Klipper",id:"ici-compilez-le-firmware-si-le-message-dincoh\xe9rence-entre-le-firmware-de-lh\xf4te-et-celui-de-la-carte-appara\xeet-alors-compilez-un-nouveau-firmware-klipper",level:3},{value:"Si votre imprimante utilise Moonraker, ajoutez la section suivante \xe0 moonraker.conf, puis vous pourrez mettre \xe0 jour BDsensor en un clic via une page web ou l&#39;\xe9cran de Klipper.",id:"si-votre-imprimante-utilise-moonraker-ajoutez-la-section-suivante-\xe0-moonrakerconf-puis-vous-pourrez-mettre-\xe0-jour-bdsensor-en-un-clic-via-une-page-web-ou-l\xe9cran-de-klipper",level:2},{value:"\xc9diter printer.cfg",id:"\xe9diter-printercfg",level:2},{value:"Apr\xe8s l&#39;installation, v\xe9rifiez en envoyant les commandes gcode suivantes",id:"apr\xe8s-linstallation-v\xe9rifiez-en-envoyant-les-commandes-gcode-suivantes",level:2},{value:"V\xe9rification de la connexion",id:"v\xe9rification-de-la-connexion",level:2},{value:"Calibration",id:"calibration",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components},{ImageView:s}=n;return!s&&function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ImageView",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"installation-de-bdsensor-m",children:["Installation de ",(0,i.jsx)(n.strong,{children:"BDsensor-m"})]})}),"\n",(0,i.jsx)(n.h2,{id:"connecter-le-c\xe2ble-du-capteur-\xe0-linterface-exp1-de-la-carte-m\xe8re",children:"Connecter le c\xe2ble du capteur \xe0 l'interface EXP1 de la carte m\xe8re"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si le c\xe2ble du capteur est trop court, vous pouvez utiliser la rallonge fournie dans l'emballage"}),"\n",(0,i.jsx)(n.li,{children:"Les lignes CKL et SDA du BDsensor-m peuvent \xeatre connect\xe9es \xe0 n'importe quelle broche GPIO de la carte. Vous pouvez \xe9galement connecter directement le c\xe2ble du capteur BD au port Bltouch, par exemple :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"BLtouch    |    BDsensor-m\n5V       --\x3e     5V\nGND      --\x3e     GND\nS        --\x3e     CLK/SCL    (Entr\xe9e)\nGND      --\x3e     GND\nZmin     --\x3e     SDA    (Entr\xe9e/Sortie) \n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["En raison du fait que certaines broches des connecteurs de la carte m\xe8re peuvent ne pas \xeatre directement connect\xe9es aux gpios du MCU (par exemple, elles peuvent avoir des condensateurs de filtrage ou \xeatre isol\xe9es par MOSFET, diode ou coupleur optique, mais si elles sont isol\xe9es par r\xe9sistance ou r\xe9sistance pull-up/pull-down, cela peut fonctionner), elles ne peuvent pas \xeatre utilis\xe9es avec ",(0,i.jsx)(n.code,{children:"BDsensor-m"}),". Le firmware signalera une erreur de connexion. Par exemple :"]}),"\n",(0,i.jsx)(n.li,{children:"Les connecteurs des ventilateurs et des chauffages sont isol\xe9s par MOSFET,"}),"\n",(0,i.jsx)(n.li,{children:"Certains connecteurs de cartes utilis\xe9s pour les thermistances de temp\xe9rature et les fins de course/les sondes sont g\xe9n\xe9ralement connect\xe9s \xe0 la GND via des condensateurs de filtrage."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Comme illustr\xe9 ci-dessous, installez le capteur BD pr\xe8s de l'extr\xe9mit\xe9 chaude. ",(0,i.jsx)(n.a,{href:"https://www.thingiverse.com/thing:6098131",children:"STL du support"}),", ",(0,i.jsx)(n.a,{href:"https://discord.com/channels/829828765512106054/1163237892957671424",children:"STL_mount_VzBot_Goliath_court"})]}),"\n",(0,i.jsx)(s,{image:r(82273).Z,size:"100%",align:"left"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installer-le-patch-dans-le-firmware-klipper",children:"Installer le patch dans le firmware Klipper"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ne faites que ce qui est mentionn\xe9 dans le tutoriel"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Abandonnez les modifications pr\xe9c\xe9dentes des fichiers Klipper et mettez \xe0 jour Klipper"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd\ncd ~/klipper\ngit checkout .\ngit pull\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Dans le r\xe9pertoire de l'utilisateur, ex\xe9cutez la commande git suivante pour cloner le dernier code du capteur BD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd && git clone https://github.com/markniu/Bed_Distance_sensor.git\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ensuite, ex\xe9cutez la commande suivante pour l'installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd  ~/Bed_Distance_sensor/klipper/\n./install_BDsensor.sh\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"ici-compilez-le-firmware-si-le-message-dincoh\xe9rence-entre-le-firmware-de-lh\xf4te-et-celui-de-la-carte-appara\xeet-alors-compilez-un-nouveau-firmware-klipper",children:["Ici, compilez le firmware ",(0,i.jsx)(n.code,{children:"si le message d'incoh\xe9rence entre le firmware de l'h\xf4te et celui de la carte"})," appara\xeet, alors compilez un nouveau firmware Klipper"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compilez le firmware en suivant le tutoriel de compilation de votre firmware"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compilation du firmware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/klipper/  # Allez dans le r\xe9pertoire de Klipper\nmake menuconfig  # Commande pour entrer dans l'interface de compilation de Klipper\nmake clean  # Commande de nettoyage\nmake   # Commande de compilation\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Flashez le firmware sur la carte m\xe8re \xe0 laquelle le capteur BD est connect\xe9"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"si-votre-imprimante-utilise-moonraker-ajoutez-la-section-suivante-\xe0-moonrakerconf-puis-vous-pourrez-mettre-\xe0-jour-bdsensor-en-un-clic-via-une-page-web-ou-l\xe9cran-de-klipper",children:"Si votre imprimante utilise Moonraker, ajoutez la section suivante \xe0 moonraker.conf, puis vous pourrez mettre \xe0 jour BDsensor en un clic via une page web ou l'\xe9cran de Klipper."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[update_manager BDsensor]\ntype: git_repo\nprimary_branch: new\nchannel: dev\npath: ~/Bed_Distance_sensor\norigin: https://github.com/markniu/Bed_Distance_sensor.git\ninstall_script: ./klipper/install_BDsensor.sh\nis_system_service: False\nmanaged_services: klipper\ninfo_tags:\ndesc=Bed Distance Sensor\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\xe9diter-printercfg",children:"\xc9diter printer.cfg"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Copiez cette section dans votre ",(0,i.jsx)(n.strong,{children:"printer.cfg"})," et modifiez ",(0,i.jsx)(n.code,{children:"sda_pin"})," et ",(0,i.jsx)(n.code,{children:"scl_pin"})," de ",(0,i.jsx)(n.code,{children:"[BDsensor]"}),", et n'oubliez pas de d\xe9sactiver les autres sections de sondes comme ",(0,i.jsx)(n.strong,{children:"BLtouch"}),". Vous pouvez connecter le capteur BD \xe0 la carte m\xe8re ou au module CAN de la t\xeate d'outil,"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Dans ",(0,i.jsx)(n.code,{children:"[BDsensor]"}),", modifiez ",(0,i.jsx)(n.code,{children:"speed"})," \xe0 0.8. Cela ne s'applique qu'aux commandes de Z-tilt et PROBE_ACCURACY. Plus la valeur est petite, plus la pr\xe9cision est \xe9lev\xe9e lors de la sonde, car le MCU lit le capteur BD dans le circuit principal lors de la mise \xe0 z\xe9ro, et ce n'est pas aussi rapide qu'un fin de course normal. ",(0,i.jsx)(n.code,{children:"[BDsensor]"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pour utiliser le capteur BD comme fin de course lors de la mise \xe0 z\xe9ro de l'axe Z, changez ",(0,i.jsx)(n.code,{children:"endstop_pin"})," dans ",(0,i.jsx)(n.code,{children:"[stepper_z]"})," pour ",(0,i.jsx)(n.code,{children:"endstop_pin: probe:z_virtual_endstop"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Assurez-vous que ",(0,i.jsx)(n.strong,{children:"printer.cfg"})," contient ",(0,i.jsx)(n.code,{children:"[safe_z_home]"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Modifiez la valeur de ",(0,i.jsx)(n.code,{children:"position_endstop"})," dans ",(0,i.jsx)(n.code,{children:"[bed_mesh]"})," et ",(0,i.jsx)(n.code,{children:"[z_tilt]"})," ou ",(0,i.jsx)(n.code,{children:"[quad_gantry_level]"})," \xe0 1 (recommand\xe9 entre 0.7 et 1.0mm). La valeur par d\xe9faut de Klipper est de 5mm, sinon cela pourrait d\xe9passer la plage du capteur"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["L'ajustement de la hauteur de la buse ne doit \xeatre effectu\xe9 que dans ",(0,i.jsx)(n.code,{children:"z_adjust:"}),". Un nombre positif rapproche la buse du lit, un nombre n\xe9gatif l'\xe9loigne. Toute autre configuration pour ajuster la hauteur de la buse pourrait causer des bugs"]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pour activer la sonde rapide, supprimez le # avant ",(0,i.jsx)(n.code,{children:"no_stop_probe:true"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Voici un exemple de configuration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cfg",children:"[BDsensor] \nscl_pin:PC6  # Port de signal du servo\nsda_pin:PC3  # Port de signal de fin de course\ndelay: 20 # 20us par impulsion, cette valeur doit \xeatre >=20 mais doit \xeatre inf\xe9rieure \xe0 50\nz_offset:0 # cette `z_offset` doit \xeatre r\xe9gl\xe9e \xe0 0. \nz_adjust:0.0 # ajustement de l'axe Z, remplace la fonction z_offset. entre -0.3 et 0.3mm\nx_offset: -34\ny_offset: 0\n#no_stop_probe:true # activez cela pour une sonde rapide, la t\xeate d'outil ne s'arr\xeatera pas au point de sonde.\nposition_endstop: 0.8 # l'axe Z s'arr\xeatera \xe0 cette position (mm) lors de la mise \xe0 z\xe9ro de z, valeur recommand\xe9e entre 0.4 et 1.0\n#speed:0.8 # cette vitesse ne fonctionne que pour la commande de tilt z et PROBE_ACCURACY.\n\n[stepper_z]\nendstop_pin: probe:z_virtual_endstop \n#position_endstop: 0.5\nhoming_speed: 5\nsecond_homing_speed: 0.8\n\n[bed_mesh]\nspeed: 200\nhorizontal_move_z:1\nalgorithm: bicubic\n\n[quad_gantry_level]\nhorizontal_move_z:1\n\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"apr\xe8s-linstallation-v\xe9rifiez-en-envoyant-les-commandes-gcode-suivantes",children:"Apr\xe8s l'installation, v\xe9rifiez en envoyant les commandes gcode suivantes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"M102   S-1     # Lire les informations du capteur\nM102   S-2     # Lire une valeur de distance\n"})}),"\n",(0,i.jsx)(n.h2,{id:"v\xe9rification-de-la-connexion",children:"V\xe9rification de la connexion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Via la ",(0,i.jsx)(n.strong,{children:"console"}),", envoyez ",(0,i.jsx)(n.code,{children:"M102 S-1"}),", voici un exemple de message retourn\xe9, si vous recevez une r\xe9ponse vide ou une autre cha\xeene, v\xe9rifiez la connexion et l'ordre des fils"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Send: M102 S-1\nRecv: V1.0 pandapi3d.com\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"calibration",children:"Calibration"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nettoyez la buse, puis d\xe9placez l'axe Z via la console jusqu'\xe0 ce que la buse touche juste le lit (le BDsensor-m utilisera cette position comme position z\xe9ro, donc pas besoin de ",(0,i.jsx)(n.code,{children:"z_offset"}),", c'est pourquoi la valeur est 0 dans la section [BDsensor-m])"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Console"})," : envoyez la commande gcode ",(0,i.jsx)(n.code,{children:"M102 S-6"}),", l'imprimante d\xe9placera lentement l'axe Z vers le haut de 0.1mm \xe0 chaque fois jusqu'\xe0 atteindre 4mm. Ne lancez pas M102 S-6 avant d'avoir install\xe9 le capteur, et ne coupez pas l'alimentation de l'imprimante pendant la calibration, sinon les anciennes donn\xe9es de calibration seront perdues. Dans ce cas, recalibrez simplement"]}),"\n",(0,i.jsxs)(n.li,{children:["Ensuite, vous pouvez v\xe9rifier si le capteur BD a \xe9t\xe9 correctement calibr\xe9 avec ",(0,i.jsx)(n.code,{children:"M102 S-5"}),", ce qui retournera les donn\xe9es de calibration brutes stock\xe9es dans le capteur BD."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Notes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"La vitesse de mise \xe0 z\xe9ro de l'axe Z est pr\xe9f\xe9rable \xe0 5"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Si le premier chiffre des donn\xe9es de calibration retourn\xe9es par M102 S-5 est sup\xe9rieur \xe0 400, cela signifie que le capteur est install\xe9 trop haut et doit \xeatre r\xe9install\xe9 plus pr\xe8s du lit, la valeur recommand\xe9e pour le premier chiffre est de 100. Assurez-vous \xe9galement que la deuxi\xe8me valeur est sup\xe9rieure de plus de 10 \xe0 la premi\xe8re."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"FAQ : Que signifie si les donn\xe9es de calibration commencent par 1, la deuxi\xe8me valeur est 9 et la troisi\xe8me est 24 ?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Cela signifie que la r\xe9solution entre 0 et 0.1mm est seulement de 9, tandis que celle entre 0.1 et 0.2mm est de 15. Il est donc recommand\xe9 de recalibrer pour obtenir une r\xe9solution initiale 0-0.1mm sup\xe9rieure \xe0 10."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["N'oubliez pas d'ajuster la hauteur de l'axe Z apr\xe8s avoir ex\xe9cut\xe9 G28 ou pour les commandes ",(0,i.jsx)(n.code,{children:"Z_tilt"})," et ",(0,i.jsx)(n.code,{children:"quad_gantry_level"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["La partie du nom doit \xeatre correctement en majuscules et minuscules, sinon Klipper signalera ",(0,i.jsx)(n.code,{children:"Unknown pin chip name 'probe'"})]}),"\n"]}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},82273:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/jxcs_webp-e90fb83e26a5605607e720e487bc6f3a.webp"},79938:function(e,n,r){r.d(n,{Z:function(){return a},a:function(){return t}});var s=r(75271);let i={},l=s.createContext(i);function t(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);