---
sidebar_position: 3
sidebar_label: USB固件烧录
---


import MakeOperate from "/docs/General/flyos-fast/_firmware_make_operate.mdx";
import USB from '@site/docs/General/dfu-flash/_firmware/723/_usb.mdx';
import GetUsbID from '@site/docs/General/get-id/_get-usbid-flyosfast.mdx';




# USB 固件编译


## 检查拨码

    :::danger 须知
    - 正常使用时，请将`拨码向上拨`
    - 拨码时，请向`上拨到底`，否则可能无法连接下位机！！！
    :::
        <ImageView image={require('@site/docs/ProductDoc/MainBoard/fly-c/fly-c5/flash/img/dip_switch.webp').default} size="60%" align="center" />


## SSH连接到上位机

    :::danger 警告
    - 固件编译前需要使用`wifi连接到上位机SSH`
    :::

 * 首先请：<Button variant="contained" disableElevation component="a" rel="noopener" href="/docs/ProductDoc/MainBoard/fly-c/fly-c5/ssh#使用wifi连接到上位机ssh">使用wifi连接到上位机ssh</Button>  
 ---
 <br/>

    <Tabs>
    <TabItem value="usb" label="USB固件烧录" default>
    ### USB固件烧录
        :::tip 提示
        - FLYOS-FAST系统中已提前编译好一份USB固件，无需再手动编译固件，执行下方命令即可烧录
        - 也可选择`手动编译USB固件`，自行编译固件
        :::

        * 通过SSH连接上位机输入下方指令即可
        ```bash
        fly-flash -d c5 -h -f /usr/lib/firmware/klipper-h723-128k-usb.bin
        ```
        <ImageView image={require('@site/docs/ProductDoc/MainBoard/fly-c/fly-c5/flash/img/usb.webp').default} size="80%" align="center" />
    
    
## 填写USB ID

    1. 打开上位机的WEB界面，在左侧边栏的配置选项里找到：

    <table>
      <tr>
        <td>
          - fluidd为: `{…}` ，点击进去，即可找到 `printer.cfg`
          <ImageView image={require('@site/docs/General/get-id/img/fluidd-cfg.webp').default} size="100%" align="center" />
        </td>
        <td>
          - mainsail为：`机器`，点击进去，即可找到 `printer.cfg`
          <ImageView image={require('@site/docs/General/get-id/img/mainsail-cfg.webp').default} size="100%" align="center" />
        </td>
      </tr>
    </table>


    2. 将蓝色的ID复制，在`printer.cfg` 文件中找到 `[mcu]` 选项，在下方的 `serial: `后填写查询到的`ID`，保存重启后即可连上主板。
    :::tip
    * 下方配置的ID的ID替换MCU配置中

    ```
    [mcu]
    serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_12345-if00
    ```
    :::

    <ImageView image={require('@site/docs/General/get-id/img/723id.webp').default} size="100%" align="center" />
    
    3. 若Klipper提示 `ADC out of range` 此为正常现象，将热床和热敏连接到主板，并配置好喷头、热床的热敏引脚，再保存重启即可。

    </TabItem>

    <TabItem value="can" label="手动编译USB固件">
    ## 手动编译USB固件

        <MakeOperate/>
    
        <USB />
    
        * 按 `Q` 键，出现 `Save configuration`，这时再按 `Y` 键
        <ImageView image={require('@site/docs/General/dfu-flash/img/configuration.webp').default} size="40%" align="center" />
    
        * 现在应该保存了配置,并且退出到了命令行界面
    
        * 输入 `make -j4` 开始编译，时间有点长
        <ImageView image={require('@site/docs/General/flyos-fast/img/firmware_build1.webp').default} size="60%" align="center" />
    
        * 最后输出下面的内容则编译成功
        <ImageView image={require('@site/docs/General/flyos-fast/img/firmware_build2.webp').default} size="60%" align="center" />
        ---
        
        ### 固件烧录
        
        :::tip
        执行下面的命令来烧录固件
        :::
        
            ```bash
            fly-flash -d c5 -h -f ~/klipper/out/klipper.bin
            ```
        <ImageView image={require('@site/docs/ProductDoc/MainBoard/fly-c/fly-c5/flash/img/can.webp').default} size="80%" align="center" />

        <GetUsbID />

    </TabItem>
</Tabs>
---

<br/>

