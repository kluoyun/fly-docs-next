"use strict";(self.webpackChunkklipper_docs=self.webpackChunkklipper_docs||[]).push([["68828"],{12926:function(e,t,i){let r,a,s,n,o;i.r(t),i.d(t,{MaxResolution:()=>n0,playerSoftwareName:()=>_P,MediaError:()=>nK,default:()=>_U,RenditionOrder:()=>n2,generatePlayerInitTime:()=>ll,playerSoftwareVersion:()=>_N,MinResolution:()=>n1});var l=i("67294"),d=Object.create,u=Object.defineProperty,h=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,m=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,f=function(e,t){return function(){return e&&(t=e(e=0)),t}},g=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},E=function(e,t,i,r){if(t&&"object"==typeof t||"function"==typeof t)for(var a,s=c(t),n=0,o=s.length;n<o;n++)a=s[n],p.call(e,a)||a===i||u(e,a,{get:(function(e){return t[e]}).bind(null,a),enumerable:!(r=h(t,a))||r.enumerable});return e},b=function(e,t,i){return i=null!=e?d(m(e)):{},E(!t&&e&&e.__esModule?i:u(i,"default",{value:e,enumerable:!0}),e)},y=g(function(e,t){var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self?i=self:i={},t.exports=i});function T(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):T(e,t)}var _=f(function(){_()});function A(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}var S=f(function(){}),k=g(function(e,t){var i=Array.prototype.slice;t.exports=function(e,t){for(("length"in e)||(e=[e]),e=i.call(e);e.length;){var r=e.shift(),a=t(r);if(a)return a;r.childNodes&&r.childNodes.length&&(e=i.call(r.childNodes).concat(e))}}}),R=g(function(e,t){function i(e,t){if(!T(this,i))return new i(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}_(),t.exports=i,i.prototype.nodeType=8,i.prototype.nodeName="#comment",i.prototype.toString=function(){return"[object Comment]"}}),I=g(function(e,t){function i(e,t){if(!T(this,i))return new i(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}_(),t.exports=i,i.prototype.type="DOMTextNode",i.prototype.nodeType=3,i.prototype.nodeName="#text",i.prototype.toString=function(){return this.data},i.prototype.replaceData=function(e,t,i){var r=this.data,a=r.substring(0,e),s=r.substring(e+t,r.length);this.data=a+i+s,this.length=this.data.length}}),L=g(function(e,t){t.exports=function(e){var t=this,i=e.type;e.target||(e.target=t),t.listeners||(t.listeners={});var r=t.listeners[i];if(r)return r.forEach(function(i){e.currentTarget=t,"function"==typeof i?i(e):i.handleEvent(e)});t.parentNode&&t.parentNode.dispatchEvent(e)}}),w=g(function(e,t){t.exports=function(e,t){this.listeners||(this.listeners={}),this.listeners[e]||(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)}}),D=g(function(e,t){t.exports=function(e,t){if(this.listeners&&this.listeners[e]){var i=this.listeners[e],r=i.indexOf(t);-1!==r&&i.splice(r,1)}}}),C=g(function(e,t){S(),t.exports=function e(t){switch(t.nodeType){case 3:return a(t.data);case 8:return"\x3c!--"+t.data+"--\x3e";default:var s,n,o;return n=[],o=(s=t).tagName,"http://www.w3.org/1999/xhtml"===s.namespaceURI&&(o=o.toLowerCase()),n.push("<"+o+function(e){var t=[];for(var i in e)(function(e,t){var i=A(e[t]);return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===i||"boolean"===i||"number"===i)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t})(e,i)&&t.push({name:i,value:e[i]});for(var a in e._attributes)for(var s in e._attributes[a]){var n=e._attributes[a][s],o=(n.prefix?n.prefix+":":"")+s;t.push({name:o,value:n.value})}return e.className&&t.push({name:"class",value:e.className}),t.length?r(t):""}(s)+function(e){var t=e.dataset,i=[];for(var a in t)i.push({name:"data-"+a,value:t[a]});return i.length?r(i):""}(s)),i.indexOf(o)>-1?n.push(" />"):(n.push(">"),s.childNodes.length?n.push.apply(n,s.childNodes.map(e)):s.textContent||s.innerText?n.push(a(s.textContent||s.innerText)):s.innerHTML&&n.push(s.innerHTML),n.push("</"+o+">")),n.join("")}};var i=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function r(e){var t=[];return e.forEach(function(e){var i=e.name,r=e.value;"style"===i&&(r=function(e){if("string"==typeof e)return e;var t="";return Object.keys(e).forEach(function(i){var r=e[i];i=i.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),t+=i+":"+r+";"}),t}(r)),t.push(i+'="'+a(r).replace(/"/g,"&quot;")+'"')}),t.length?" "+t.join(" "):""}function a(e){var t="";return"string"==typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}),x=g(function(e,t){_();var i=k(),r=L(),a=w(),s=D(),n=C(),o="http://www.w3.org/1999/xhtml";function l(e,t,i){if(!T(this,l))return new l(e);var r=void 0===i?o:i||null;this.tagName=r===o?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}t.exports=l,l.prototype.type="DOMElement",l.prototype.nodeType=1,l.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},l.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[i]=e,e.parentNode=this,t},l.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},l.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=null==t?-1:this.childNodes.indexOf(t);return i>-1?this.childNodes.splice(i,0,e):this.childNodes.push(e),e.parentNode=this,e},l.prototype.setAttributeNS=function(e,t,i){var r=null,a=t,s=t.indexOf(":");(s>-1&&(r=t.substr(0,s),a=t.substr(s+1)),"INPUT"===this.tagName&&"type"===t)?this.type=i:(this._attributes[e]||(this._attributes[e]={}))[a]={value:i,prefix:r}},l.prototype.getAttributeNS=function(e,t){var i=this._attributes[e],r=i&&i[t]&&i[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!=typeof r?null:r},l.prototype.removeAttributeNS=function(e,t){var i=this._attributes[e];i&&delete i[t]},l.prototype.hasAttributeNS=function(e,t){var i=this._attributes[e];return!!i&&t in i},l.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},l.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},l.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},l.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},l.prototype.removeEventListener=s,l.prototype.addEventListener=a,l.prototype.dispatchEvent=r,l.prototype.focus=function(){},l.prototype.toString=function(){return n(this)},l.prototype.getElementsByClassName=function(e){var t=e.split(" "),r=[];return i(this,function(e){if(1===e.nodeType){var i=(e.className||"").split(" ");t.every(function(e){return -1!==i.indexOf(e)})&&r.push(e)}}),r},l.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return i(this.childNodes,function(i){1===i.nodeType&&("*"===e||i.tagName.toLowerCase()===e)&&t.push(i)}),t},l.prototype.contains=function(e){return i(this,function(t){return e===t})||!1}}),M=g(function(e,t){_();var i=x();function r(e){if(!T(this,r))return new r;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}t.exports=r,r.prototype.type="DocumentFragment",r.prototype.nodeType=11,r.prototype.nodeName="#document-fragment",r.prototype.appendChild=i.prototype.appendChild,r.prototype.replaceChild=i.prototype.replaceChild,r.prototype.removeChild=i.prototype.removeChild,r.prototype.toString=function(){return this.childNodes.map(function(e){return String(e)}).join("")}}),O=g(function(e,t){function i(e){}t.exports=i,i.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i},i.prototype.preventDefault=function(){}}),N=g(function(e,t){_();var i=k(),r=R(),a=I(),s=x(),n=M(),o=O(),l=L(),d=w(),u=D();function h(){if(!T(this,h))return new h;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}t.exports=h;var c=h.prototype;c.createTextNode=function(e){return new a(e,this)},c.createElementNS=function(e,t){return new s(t,this,null===e?null:String(e))},c.createElement=function(e){return new s(e,this)},c.createDocumentFragment=function(){return new n(this)},c.createEvent=function(e){return new o(e)},c.createComment=function(e){return new r(e,this)},c.getElementById=function(e){return e=String(e),i(this.childNodes,function(t){if(String(t.id)===e)return t})||null},c.getElementsByClassName=s.prototype.getElementsByClassName,c.getElementsByTagName=s.prototype.getElementsByTagName,c.contains=s.prototype.contains,c.removeEventListener=u,c.addEventListener=d,c.dispatchEvent=l}),P=g(function(e,t){var i=N();t.exports=new i}),U=g(function(e,t){var i,r="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},a=P();"undefined"!=typeof document?i=document:(i=r["__GLOBAL_DOCUMENT_CACHE@4"])||(i=r["__GLOBAL_DOCUMENT_CACHE@4"]=a),t.exports=i});function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function B(e,t){if(e){if("string"==typeof e)return F(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return F(e,t)}}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,s=[],n=!0,o=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(s.push(r.value),!(t&&s.length===t));n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return s}}(e,t)||B(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var G=b(y()),H=b(y()),V=b(y()),K={now:function(){var e=V.default.performance,t=e&&e.timing,i=t&&t.navigationStart;return Math.round("number"==typeof i&&"function"==typeof e.now?i+e.now():Date.now())}},W=function(){if("function"==typeof(null===(e=H.default.crypto)||void 0===e?void 0:e.getRandomValues)){i=new Uint8Array(32),H.default.crypto.getRandomValues(i);for(var e,t,i,r=0;r<32;r++)i[r]=i[r]%16}else{i=[];for(var a=0;a<32;a++)i[a]=16*Math.random()|0}var s=0;t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t="x"===e?i[s]:3&i[s]|8;return s++,t.toString(16)});var n=K.now(),o=null==n?void 0:n.toString(16).substring(3);return o?t.substring(0,28)+o:t},Y=function(){return("000000"+(0x81bf1000*Math.random()<<0).toString(36)).slice(-6)},q=function(e){var t;if(e&&void 0!==e.nodeName)return e.muxId||(e.muxId=Y()),e.muxId;try{t=document.querySelector(e)}catch(e){}return t&&!t.muxId&&(t.muxId=e),(null==t?void 0:t.muxId)||e},j=function(e){e&&void 0!==e.nodeName?e=q(t=e):t=document.querySelector(e);var t,i=t&&t.nodeName?t.nodeName.toLowerCase():"";return[t,e,i]};function z(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var X={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},Q=function(e){var t,i,r,a,s,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=e?[console,e]:[console],l=(t=console.trace).bind.apply(t,z(o)),d=(i=console.info).bind.apply(i,z(o)),u=(r=console.debug).bind.apply(r,z(o)),h=(a=console.warn).bind.apply(a,z(o)),c=(s=console.error).bind.apply(s,z(o)),m=n;return{trace:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>X.TRACE))return l.apply(void 0,z(t))},debug:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>X.DEBUG))return u.apply(void 0,z(t))},info:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>X.INFO))return d.apply(void 0,z(t))},warn:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>X.WARN))return h.apply(void 0,z(t))},error:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>X.ERROR))return c.apply(void 0,z(t))},get level(){return m},set level(v){v!==this.level&&(m=null!=v?v:n)}}}("[mux]"),Z=b(y());function J(){return"1"===(Z.default.doNotTrack||Z.default.navigator&&Z.default.navigator.doNotTrack)}function ee(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function et(e,t){if(!T(e,t))throw TypeError("Cannot call a class as a function")}function ei(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function er(e,t,i){return t&&ei(e.prototype,t),i&&ei(e,i),e}function ea(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function es(e){return(es=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function en(e,t,i){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=es(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(i||e):a.value}})(e,t,i||e)}function eo(e,t){return(eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}_(),S();var el=function(e){return ed(e)[0]},ed=function(e){if("string"!=typeof e||""===e)return["localhost"];var t,i=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return i&&(t=(i.match(/[^\.]+\.[^\.]+$/)||[])[0]),[i,t]},eu=b(y()),eh={exists:function(){var e=eu.default.performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=eu.default.performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=eu.default.performance,t=e&&e.timing;return t&&t.navigationStart}};function ec(e,t,i){i=void 0===i?1:i,e[t]=e[t]||0,e[t]+=i}function em(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),r.forEach(function(t){ea(e,t,i[t])})}return e}function ep(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i.push.apply(i,r)}return i})(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}),e}var ef=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],eg=["x-cdn","content-type"].concat(ef);function ev(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach(function(e){if(e){var i=e.split(": "),r=i.shift();r&&(eg.indexOf(r.toLowerCase())>=0||0===r.toLowerCase().indexOf("x-litix-"))&&(t[r]=i.join(": "))}}),t}function eE(e){if(e){var t=ef.find(function(t){return void 0!==e[t]});return t?e[t]:void 0}}var eb=function(e){var t={};for(var i in e){var r=e[i];-1!==r["DATA-ID"].search("io.litix.data.")&&(t[r["DATA-ID"].replace("io.litix.data.","")]=r.VALUE)}return t},ey=function(e){if(!e)return{};var t=eh.navigationStart(),i=e.loading,r=i?i.start:e.trequest,a=i?i.first:e.tfirst,s=i?i.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+r),responseStart:Math.round(t+a),responseEnd:Math.round(t+s)}},eT=function(e){if(!(!e||"function"!=typeof e.getAllResponseHeaders))return ev(e.getAllResponseHeaders())},e_=function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=arguments.length>4?arguments[4]:void 0,a=e.log,s=e.utils.secondsToMs,n=function(e){var t,i=parseInt(r.version);return 1===i&&null!==e.programDateTime&&(t=e.programDateTime),0===i&&null!==e.pdt&&(t=e.pdt),t};if(!eh.exists()){a.warn("performance timing not supported. Not tracking HLS.js.");return}var o=function(i,r){return e.emit(t,i,r)},l=function(e,t){var i=t.levels,r=t.audioTracks,a=t.url,s=t.stats,n=t.networkDetails,l=t.sessionData,d={},u={};i.forEach(function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}}),r.forEach(function(e,t){u[t]={name:e.name,language:e.lang,bitrate:e.bitrate}});var h=ey(s),c=h.bytesLoaded,m=h.requestStart,p=h.responseStart,f=h.responseEnd;o("requestcompleted",ep(em({},eb(l)),{request_event_type:e,request_bytes_loaded:c,request_start:m,request_response_start:p,request_response_end:f,request_type:"manifest",request_hostname:el(a),request_response_headers:eT(n),request_rendition_lists:{media:d,audio:u,video:{}}}))};i.on(r.Events.MANIFEST_LOADED,l);var d=function(e,t){var i=t.details,r=t.level,a=t.networkDetails,l=ey(t.stats),d=l.bytesLoaded,u=l.requestStart,h=l.responseStart,c=l.responseEnd,m=i.fragments[i.fragments.length-1],p=n(m)+s(m.duration);o("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:u,request_response_start:h,request_response_end:c,request_current_level:r,request_type:"manifest",request_hostname:el(i.url),request_response_headers:eT(a),video_holdback:i.holdBack&&s(i.holdBack),video_part_holdback:i.partHoldBack&&s(i.partHoldBack),video_part_target_duration:i.partTarget&&s(i.partTarget),video_target_duration:i.targetduration&&s(i.targetduration),video_source_is_live:i.live,player_manifest_newest_program_time:isNaN(p)?void 0:p})};i.on(r.Events.LEVEL_LOADED,d);var u=function(e,t){var i=t.details,r=t.networkDetails,a=ey(t.stats);o("requestcompleted",{request_event_type:e,request_bytes_loaded:a.bytesLoaded,request_start:a.requestStart,request_response_start:a.responseStart,request_response_end:a.responseEnd,request_type:"manifest",request_hostname:el(i.url),request_response_headers:eT(r)})};i.on(r.Events.AUDIO_TRACK_LOADED,u);var h=function(e,t){var r=t.stats,a=t.networkDetails,s=t.frag,n=ey(r=r||s.stats),l=n.bytesLoaded,d=n.requestStart,u=n.responseStart,h=n.responseEnd,c=a?eT(a):void 0,m={request_event_type:e,request_bytes_loaded:l,request_start:d,request_response_start:u,request_response_end:h,request_hostname:a?el(a.responseURL):void 0,request_id:c?eE(c):void 0,request_response_headers:c,request_media_duration:s.duration,request_url:null==a?void 0:a.responseURL};"main"===s.type?(m.request_type="media",m.request_current_level=s.level,m.request_video_width=(i.levels[s.level]||{}).width,m.request_video_height=(i.levels[s.level]||{}).height,m.request_labeled_bitrate=(i.levels[s.level]||{}).bitrate):m.request_type=s.type,o("requestcompleted",m)};i.on(r.Events.FRAG_LOADED,h);var c=function(e,t){var i=t.frag,r=i.start;o("fragmentchange",{currentFragmentPDT:n(i),currentFragmentStart:s(r)})};i.on(r.Events.FRAG_CHANGED,c);var m=function(e,t){var i,a=t.type,s=t.details,n=t.response,l=t.fatal,d=t.frag,u=t.networkDetails,h=(null==d?void 0:d.url)||t.url||"",c=u?eT(u):void 0;(s===r.ErrorDetails.MANIFEST_LOAD_ERROR||s===r.ErrorDetails.MANIFEST_LOAD_TIMEOUT||s===r.ErrorDetails.FRAG_LOAD_ERROR||s===r.ErrorDetails.FRAG_LOAD_TIMEOUT||s===r.ErrorDetails.LEVEL_LOAD_ERROR||s===r.ErrorDetails.LEVEL_LOAD_TIMEOUT||s===r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||s===r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT||s===r.ErrorDetails.SUBTITLE_LOAD_ERROR||s===r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT||s===r.ErrorDetails.KEY_LOAD_ERROR||s===r.ErrorDetails.KEY_LOAD_TIMEOUT)&&o("requestfailed",{request_error:s,request_url:h,request_hostname:el(h),request_id:c?eE(c):void 0,request_type:s===r.ErrorDetails.FRAG_LOAD_ERROR||s===r.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":s===r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||s===r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":s===r.ErrorDetails.SUBTITLE_LOAD_ERROR||s===r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":s===r.ErrorDetails.KEY_LOAD_ERROR||s===r.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:null==n?void 0:n.code,request_error_text:null==n?void 0:n.text}),l&&o("error",{player_error_code:a,player_error_message:s,player_error_context:"".concat(h?"url: ".concat(h,"\n"):"")+"".concat(n&&(n.code||n.text)?"response: ".concat(n.code,", ").concat(n.text,"\n"):"")+"".concat(t.reason?"failure reason: ".concat(t.reason,"\n"):"")+"".concat(t.level?"level: ".concat(t.level,"\n"):"")+"".concat(t.parent?"parent stream controller: ".concat(t.parent,"\n"):"")+"".concat(t.buffer?"buffer length: ".concat(t.buffer,"\n"):"")+"".concat(t.error?"error: ".concat(t.error,"\n"):"")+"".concat(t.event?"event: ".concat(t.event,"\n"):"")+"".concat(t.err?"error message: ".concat(null===(i=t.err)||void 0===i?void 0:i.message,"\n"):"")})};i.on(r.Events.ERROR,m);var p=function(e,t){var i=t.frag,r=i&&i._url||"";o("requestcanceled",{request_event_type:e,request_url:r,request_type:"media",request_hostname:el(r)})};i.on(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,p);var f=function(e,t){var r=t.level,s=i.levels[r];if(s&&s.attrs&&s.attrs.BANDWIDTH){var n,l=s.attrs.BANDWIDTH,d=parseFloat(s.attrs["FRAME-RATE"]);isNaN(d)||(n=d),l?o("renditionchange",{video_source_fps:n,video_source_bitrate:l,video_source_width:s.width,video_source_height:s.height,video_source_rendition_name:s.name,video_source_codec:null==s?void 0:s.videoCodec}):a.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};i.on(r.Events.LEVEL_SWITCHED,f),i._stopMuxMonitor=function(){i.off(r.Events.MANIFEST_LOADED,l),i.off(r.Events.LEVEL_LOADED,d),i.off(r.Events.AUDIO_TRACK_LOADED,u),i.off(r.Events.FRAG_LOADED,h),i.off(r.Events.FRAG_CHANGED,c),i.off(r.Events.ERROR,m),i.off(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,p),i.off(r.Events.LEVEL_SWITCHED,f),i.off(r.Events.DESTROYING,i._stopMuxMonitor),delete i._stopMuxMonitor},i.on(r.Events.DESTROYING,i._stopMuxMonitor)},eA=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()},eS=function(e,t){if(!e||!e.requestEndDate)return{};var i,r=el(e.url),a=e.url,s=e.bytesLoaded,n=new Date(e.requestStartDate).getTime(),o=new Date(e.firstByteDate).getTime(),l=new Date(e.requestEndDate).getTime(),d=isNaN(e.duration)?0:e.duration,u="function"==typeof t.getMetricsFor?t.getMetricsFor(e.mediaType).HttpList:t.getDashMetrics().getHttpRequests(e.mediaType);u.length>0&&(i=ev(u[u.length-1]._responseHeaders||""));var h=i?eE(i):void 0;return{requestStart:n,requestResponseStart:o,requestResponseEnd:l,requestBytesLoaded:s,requestResponseHeaders:i,requestMediaDuration:d,requestHostname:r,requestUrl:a,requestId:h}},ek=function(e,t){var i=t.getQualityFor(e),r=t.getCurrentTrackFor(e).bitrateList;return r?{currentLevel:i,renditionWidth:r[i].width||null,renditionHeight:r[i].height||null,renditionBitrate:r[i].bandwidth}:{}},eR=function(e){var t;return null===(t=e.match(/.*codecs\*?="(.*)"/))||void 0===t?void 0:t[1]},eI=function(e){try{var t,i;return null===(i=e.getVersion)||void 0===i||null===(t=i.call(e))||void 0===t?void 0:t.split(".").map(function(e){return parseInt(e)})[0]}catch(e){return!1}},eL=function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=e.log;if(!i||!i.on){r.warn("Invalid dash.js player reference. Monitoring blocked.");return}var a=eI(i),s=function(i,r){return e.emit(t,i,r)},n=function(e){var t=e.type,i=(e.data||{}).url;s("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:el(i),request_url:i})};i.on("manifestLoaded",n);var o={},l=function(e){if("function"!=typeof e.getRequests)return null;var t=e.getRequests({state:"executed"});return 0===t.length?null:t[t.length-1]},d=function(e){var t=e.type,r=e.chunk,a=e.request,n=(r||{}).mediaInfo||{},l=n.type,d=n.bitrateList,u={};(d=d||[]).forEach(function(e,t){u[t]={},u[t].width=e.width,u[t].height=e.height,u[t].bitrate=e.bandwidth,u[t].attrs={}}),"video"===l?o.video=u:"audio"===l?o.audio=u:o.media=u;var h=eS(a,i),c=h.requestStart,m=h.requestResponseStart,p=h.requestResponseEnd,f=h.requestResponseHeaders,g=h.requestMediaDuration,E=h.requestHostname,b=h.requestUrl;s("requestcompleted",{request_event_type:t,request_start:c,request_response_start:m,request_response_end:p,request_bytes_loaded:-1,request_type:l+"_init",request_response_headers:f,request_hostname:E,request_id:h.requestId,request_url:b,request_media_duration:g,request_rendition_lists:o})};a>=4?i.on("initFragmentLoaded",d):i.on("initFragmentLoaded",function(e){var t=e.type,i=e.fragmentModel,r=e.chunk;d({type:t,request:l(i),chunk:r})});var u=function(e){var t=e.type,r=e.chunk,a=e.request,n=r||{},o=n.mediaInfo,l=n.start,d=(o||{}).type,u=eS(a,i),h=u.requestStart,c=u.requestResponseStart,m=u.requestResponseEnd,p=u.requestBytesLoaded,f=u.requestResponseHeaders,g=u.requestMediaDuration,E=u.requestHostname,b=u.requestUrl,y=u.requestId,T=ek(d,i),_=T.currentLevel,A=T.renditionWidth,S=T.renditionHeight;s("requestcompleted",{request_event_type:t,request_start:h,request_response_start:c,request_response_end:m,request_bytes_loaded:p,request_type:d,request_response_headers:f,request_hostname:E,request_id:y,request_url:b,request_media_start_time:l,request_media_duration:g,request_current_level:_,request_labeled_bitrate:T.renditionBitrate,request_video_width:A,request_video_height:S})};a>=4?i.on("mediaFragmentLoaded",u):i.on("mediaFragmentLoaded",function(e){var t=e.type,i=e.fragmentModel,r=e.chunk;u({type:t,request:l(i),chunk:r})});var h={video:void 0,audio:void 0,totalBitrate:void 0},c=function(){if(h.video&&"number"==typeof h.video.bitrate){if(!(h.video.width&&h.video.height)){r.warn("have bitrate info for video but missing width/height");return}var e=h.video.bitrate;if(h.audio&&"number"==typeof h.audio.bitrate&&(e+=h.audio.bitrate),e!==h.totalBitrate)return h.totalBitrate=e,{video_source_bitrate:e,video_source_height:h.video.height,video_source_width:h.video.width,video_source_codec:eR(h.video.codec)}}},m=function(e,t,a){if("number"!=typeof e.newQuality){r.warn("missing evt.newQuality in qualityChangeRendered event",e);return}var n=e.mediaType;if("audio"===n||"video"===n){var o=i.getBitrateInfoListFor(n).find(function(t){return t.qualityIndex===e.newQuality});if(!(o&&"number"==typeof o.bitrate)){r.warn("missing bitrate info for ".concat(n));return}h[n]=ep(em({},o),{codec:i.getCurrentTrackFor(n).codec});var l=c();l&&s("renditionchange",l)}};i.on("qualityChangeRendered",m);var p=function(e){var t=e.request,i=e.mediaType;s("requestcanceled",{request_event_type:(t=t||{}).type+"_"+t.action,request_url:t.url,request_type:i,request_hostname:el(t.url)})};i.on("fragmentLoadingAbandoned",p);var f=function(e){var t,i,r=e.error,a=(null==r||null===(t=r.data)||void 0===t?void 0:t.request)||{},n=(null==r||null===(i=r.data)||void 0===i?void 0:i.response)||{};(null==r?void 0:r.code)===27&&s("requestfailed",{request_error:a.type+"_"+a.action,request_url:a.url,request_hostname:el(a.url),request_type:a.mediaType,request_error_code:n.status,request_error_text:n.statusText});var o="".concat(null!=a&&a.url?"url: ".concat(a.url,"\n"):"")+"".concat(null!=n&&n.status||null!=n&&n.statusText?"response: ".concat(null==n?void 0:n.status,", ").concat(null==n?void 0:n.statusText,"\n"):"");s("error",{player_error_code:null==r?void 0:r.code,player_error_message:null==r?void 0:r.message,player_error_context:o})};i.on("error",f),i._stopMuxMonitor=function(){i.off("manifestLoaded",n),i.off("initFragmentLoaded",d),i.off("mediaFragmentLoaded",u),i.off("qualityChangeRendered",m),i.off("error",f),i.off("fragmentLoadingAbandoned",p),delete i._stopMuxMonitor}},ew=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()},eD=0,eC=function(){function e(){et(this,e),ea(this,"_listeners",void 0)}return er(e,[{key:"on",value:function(e,t,i){return t._eventEmitterGuid=t._eventEmitterGuid||++eD,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],i&&(t=t.bind(i)),this._listeners[e].push(t),t}},{key:"off",value:function(e,t){var i=this._listeners&&this._listeners[e];i&&i.forEach(function(e,r){e._eventEmitterGuid===t._eventEmitterGuid&&i.splice(r,1)})}},{key:"one",value:function(e,t,i){var r=this;t._eventEmitterGuid=t._eventEmitterGuid||++eD;var a=function(){r.off(e,a),t.apply(i||this,arguments)};a._eventEmitterGuid=t._eventEmitterGuid,this.on(e,a)}},{key:"emit",value:function(e,t){var i=this;if(this._listeners){t=t||{};var r=this._listeners["before*"]||[],a=this._listeners[e]||[],s=this._listeners["after"+e]||[],n=function(t,r){(t=t.slice()).forEach(function(t){t.call(i,{type:e},r)})};n(r,t),n(a,t),n(s,t)}}}]),e}(),ex=b(y()),eM=function(){function e(t){var i=this;et(this,e),ea(this,"_playbackHeartbeatInterval",void 0),ea(this,"_playheadShouldBeProgressing",void 0),ea(this,"pm",void 0),this.pm=t,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,t.on("playing",function(){i._playheadShouldBeProgressing=!0}),t.on("play",this._startPlaybackHeartbeatInterval.bind(this)),t.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),t.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),t.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("seeked",function(){t.data.player_is_paused?i._stopPlaybackHeartbeatInterval():i._startPlaybackHeartbeatInterval()}),t.on("timeupdate",function(){null!==i._playbackHeartbeatInterval&&t.emit("playbackheartbeat")}),t.on("devicesleep",function(e,r){null!==i._playbackHeartbeatInterval&&(ex.default.clearInterval(i._playbackHeartbeatInterval),t.emit("playbackheartbeatend",{viewer_time:r.viewer_time}),i._playbackHeartbeatInterval=null)})}return er(e,[{key:"_startPlaybackHeartbeatInterval",value:function(){var e=this;null===this._playbackHeartbeatInterval&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=ex.default.setInterval(function(){e.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(ex.default.clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}]),e}(),eO=function e(t){var i=this;et(this,e),ea(this,"viewErrored",void 0),t.on("viewinit",function(){i.viewErrored=!1}),t.on("error",function(e,r){try{var a=t.errorTranslator({player_error_code:r.player_error_code,player_error_message:r.player_error_message,player_error_context:r.player_error_context,player_error_severity:r.player_error_severity,player_error_business_exception:r.player_error_business_exception});a&&(t.data.player_error_code=a.player_error_code||r.player_error_code,t.data.player_error_message=a.player_error_message||r.player_error_message,t.data.player_error_context=a.player_error_context||r.player_error_context,t.data.player_error_severity=a.player_error_severity||r.player_error_severity,t.data.player_error_business_exception=a.player_error_business_exception||r.player_error_business_exception,i.viewErrored=!0)}catch(e){t.mux.log.warn("Exception in error translator callback.",e),i.viewErrored=!0}}),t.on("aftererror",function(){var e,i,r,a,s;null===(e=t.data)||void 0===e||delete e.player_error_code,null===(i=t.data)||void 0===i||delete i.player_error_message,null===(r=t.data)||void 0===r||delete r.player_error_context,null===(a=t.data)||void 0===a||delete a.player_error_severity,null===(s=t.data)||void 0===s||delete s.player_error_business_exception})},eN=function(){function e(t){et(this,e),ea(this,"_watchTimeTrackerLastCheckedTime",void 0),ea(this,"pm",void 0),this.pm=t,this._watchTimeTrackerLastCheckedTime=null,t.on("playbackheartbeat",this._updateWatchTime.bind(this)),t.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}return er(e,[{key:"_updateWatchTime",value:function(e,t){var i=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=i),ec(this.pm.data,"view_watch_time",i-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=i}},{key:"_clearWatchTimeState",value:function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null}}]),e}(),eP=function(){function e(t){var i=this;et(this,e),ea(this,"_playbackTimeTrackerLastPlayheadPosition",void 0),ea(this,"_lastTime",void 0),ea(this,"_isAdPlaying",void 0),ea(this,"_callbackUpdatePlaybackTime",void 0),ea(this,"pm",void 0),this.pm=t,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=K.now(),this._isAdPlaying=!1,this._callbackUpdatePlaybackTime=null;var r=this._startPlaybackTimeTracking.bind(this);t.on("playing",r),t.on("adplaying",r),t.on("seeked",r);var a=this._stopPlaybackTimeTracking.bind(this);t.on("playbackheartbeatend",a),t.on("seeking",a),t.on("adplaying",function(){i._isAdPlaying=!0}),t.on("adended",function(){i._isAdPlaying=!1}),t.on("adpause",function(){i._isAdPlaying=!1}),t.on("adbreakstart",function(){i._isAdPlaying=!1}),t.on("adbreakend",function(){i._isAdPlaying=!1}),t.on("adplay",function(){i._isAdPlaying=!1}),t.on("viewinit",function(){i._playbackTimeTrackerLastPlayheadPosition=-1,i._lastTime=K.now(),i._isAdPlaying=!1,i._callbackUpdatePlaybackTime=null})}return er(e,[{key:"_startPlaybackTimeTracking",value:function(){null===this._callbackUpdatePlaybackTime&&(this._callbackUpdatePlaybackTime=this._updatePlaybackTime.bind(this),this._playbackTimeTrackerLastPlayheadPosition=this.pm.data.player_playhead_time,this.pm.on("playbackheartbeat",this._callbackUpdatePlaybackTime))}},{key:"_stopPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime&&(this._updatePlaybackTime(),this.pm.off("playbackheartbeat",this._callbackUpdatePlaybackTime),this._callbackUpdatePlaybackTime=null,this._playbackTimeTrackerLastPlayheadPosition=-1)}},{key:"_updatePlaybackTime",value:function(){var e=this.pm.data.player_playhead_time,t=K.now(),i=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition?i=e-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(i=t-this._lastTime),i>0&&i<=1e3&&ec(this.pm.data,"view_content_playback_time",i),this._playbackTimeTrackerLastPlayheadPosition=e,this._lastTime=t}}]),e}(),eU=function(){function e(t){et(this,e),ea(this,"pm",void 0),this.pm=t;var i=this._updatePlayheadTime.bind(this);t.on("playbackheartbeat",i),t.on("playbackheartbeatend",i),t.on("timeupdate",i),t.on("destroy",function(){t.off("timeupdate",i)})}return er(e,[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=void 0===this.pm.data.view_max_playhead_position?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(e,t){var i=this,r=function(){i.pm.currentFragmentPDT&&i.pm.currentFragmentStart&&(i.pm.data.player_program_time=i.pm.currentFragmentPDT+i.pm.data.player_playhead_time-i.pm.currentFragmentStart)};if(t&&t.player_playhead_time)this.pm.data.player_playhead_time=t.player_playhead_time,r(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var a=this.pm.getPlayheadTime();void 0!==a&&(this.pm.data.player_playhead_time=a,r(),this._updateMaxPlayheadPosition())}}}]),e}(),eF=function e(t){if(et(this,e),!t.disableRebufferTracking){var i,r=function(e,t){a(t),i=void 0},a=function(e){if(i){var r=e.viewer_time-i;ec(t.data,"view_rebuffer_duration",r),i=e.viewer_time,t.data.view_rebuffer_duration>3e5&&(t.emit("viewend"),t.send("viewend"),t.mux.log.warn("Ending view after rebuffering for longer than ".concat(3e5,"ms, future events will be ignored unless a programchange or videochange occurs.")))}t.data.view_watch_time>=0&&t.data.view_rebuffer_count>0&&(t.data.view_rebuffer_frequency=t.data.view_rebuffer_count/t.data.view_watch_time,t.data.view_rebuffer_percentage=t.data.view_rebuffer_duration/t.data.view_watch_time)};t.on("playbackheartbeat",function(e,t){return a(t)}),t.on("rebufferstart",function(e,a){i||(ec(t.data,"view_rebuffer_count",1),i=a.viewer_time,t.one("rebufferend",r))}),t.on("viewinit",function(){i=void 0,t.off("rebufferend",r)})}},eB=function(){function e(t){var i=this;et(this,e),ea(this,"_lastCheckedTime",void 0),ea(this,"_lastPlayheadTime",void 0),ea(this,"_lastPlayheadTimeUpdatedTime",void 0),ea(this,"_rebuffering",void 0),ea(this,"pm",void 0),this.pm=t,t.disableRebufferTracking||t.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,t.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),t.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),t.on("seeking",function(){i._cleanupRebufferTracker(null,{viewer_time:K.now()})}))}return er(e,[{key:"_checkIfRebuffering",value:function(e,t){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing){this._cleanupRebufferTracker(e,t);return}if(null===this._lastCheckedTime){this._prepareRebufferTrackerState(t.viewer_time);return}if(this._lastPlayheadTime!==this.pm.data.player_playhead_time){this._cleanupRebufferTracker(e,t,!0);return}var i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.sustainedRebufferThreshold&&i>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=t.viewer_time}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e}},{key:"_cleanupRebufferTracker",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return;var r=this.pm.data.player_playhead_time-this._lastPlayheadTime,a=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.minimumRebufferDuration&&r>0&&a-r>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+a-r}))}i?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}}]),e}(),e$=function(){function e(t){var i=this;et(this,e),ea(this,"NAVIGATION_START",void 0),ea(this,"pm",void 0),this.pm=t,t.on("viewinit",function(){var e=t.data,r=e.view_id;if(!e.view_program_changed){var a=function(e,a){var s=a.viewer_time;"playing"===e.type&&void 0===t.data.view_time_to_first_frame?i.calculateTimeToFirstFrame(s||K.now(),r):"adplaying"===e.type&&(void 0===t.data.view_time_to_first_frame||i._inPrerollPosition())&&i.calculateTimeToFirstFrame(s||K.now(),r)};t.one("playing",a),t.one("adplaying",a),t.one("viewend",function(){t.off("playing",a),t.off("adplaying",a)})}})}return er(e,[{key:"_inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(e,t){t===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:e}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}]),e}(),eG=function e(t){var i=this;et(this,e),ea(this,"_lastPlayerHeight",void 0),ea(this,"_lastPlayerWidth",void 0),ea(this,"_lastPlayheadPosition",void 0),ea(this,"_lastSourceHeight",void 0),ea(this,"_lastSourceWidth",void 0),t.on("viewinit",function(){i._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb","renditionchange","orientationchange","viewend"].forEach(function(e){t.on(e,function(){if(i._lastPlayheadPosition>=0&&t.data.player_playhead_time>=0&&i._lastPlayerWidth>=0&&i._lastSourceWidth>0&&i._lastPlayerHeight>=0&&i._lastSourceHeight>0){var e=t.data.player_playhead_time-i._lastPlayheadPosition;if(e<0){i._lastPlayheadPosition=-1;return}var r=Math.min(i._lastPlayerWidth/i._lastSourceWidth,i._lastPlayerHeight/i._lastSourceHeight),a=Math.max(0,r-1),s=Math.max(0,1-r);t.data.view_max_upscale_percentage=Math.max(t.data.view_max_upscale_percentage||0,a),t.data.view_max_downscale_percentage=Math.max(t.data.view_max_downscale_percentage||0,s),ec(t.data,"view_total_content_playback_time",e),ec(t.data,"view_total_upscaling",a*e),ec(t.data,"view_total_downscaling",s*e)}i._lastPlayheadPosition=-1})}),["playing","hb","renditionchange","orientationchange"].forEach(function(e){t.on(e,function(){i._lastPlayheadPosition=t.data.player_playhead_time,i._lastPlayerWidth=t.data.player_width,i._lastPlayerHeight=t.data.player_height,i._lastSourceWidth=t.data.video_source_width,i._lastSourceHeight=t.data.video_source_height})})},eH=function e(t){var i=this;et(this,e),ea(this,"isSeeking",void 0),this.isSeeking=!1;var r=-1,a=function(){var e=K.now(),a=(t.data.viewer_time||e)-(r||e);ec(t.data,"view_seek_duration",a),t.data.view_max_seek_time=Math.max(t.data.view_max_seek_time||0,a),i.isSeeking=!1,r=-1};t.on("seeking",function(e,s){if(Object.assign(t.data,s),i.isSeeking&&s.viewer_time-r<=2e3){r=s.viewer_time;return}i.isSeeking&&a(),i.isSeeking=!0,r=s.viewer_time,ec(t.data,"view_seek_count",1),t.send("seeking")}),t.on("seeked",function(){a()}),t.on("viewend",function(){i.isSeeking&&(a(),t.send("seeked")),i.isSeeking=!1,r=-1})},eV=function(e,t){e.push(t),e.sort(function(e,t){return e.viewer_time-t.viewer_time})},eK=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror","adclicked","adskipped"],eW=function(){function e(t){var i=this;et(this,e),ea(this,"_adHasPlayed",void 0),ea(this,"_adRequests",void 0),ea(this,"_adResponses",void 0),ea(this,"_currentAdRequestNumber",void 0),ea(this,"_currentAdResponseNumber",void 0),ea(this,"_prerollPlayTime",void 0),ea(this,"_wouldBeNewAdPlay",void 0),ea(this,"isAdBreak",void 0),ea(this,"pm",void 0),this.pm=t,t.on("viewinit",function(){i.isAdBreak=!1,i._currentAdRequestNumber=0,i._currentAdResponseNumber=0,i._adRequests=[],i._adResponses=[],i._adHasPlayed=!1,i._wouldBeNewAdPlay=!0,i._prerollPlayTime=void 0}),eK.forEach(function(e){return t.on(e,i._updateAdData.bind(i))});var r=function(){i.isAdBreak=!1};t.on("adbreakstart",function(){i.isAdBreak=!0}),t.on("play",r),t.on("playing",r),t.on("viewend",r),t.on("adrequest",function(e,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdRequestNumber++},r),eV(i._adRequests,r),ec(t.data,"view_ad_request_count"),i.inPrerollPosition()&&(t.data.view_preroll_requested=!0,i._adHasPlayed||ec(t.data,"view_preroll_request_count"))}),t.on("adresponse",function(e,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdResponseNumber++},r),eV(i._adResponses,r);var a=i.findAdRequest(r.ad_request_id);a&&ec(t.data,"view_ad_request_time",Math.max(0,r.viewer_time-a.viewer_time))}),t.on("adplay",function(e,r){i._adHasPlayed=!0,i._wouldBeNewAdPlay&&(i._wouldBeNewAdPlay=!1,ec(t.data,"view_ad_played_count")),i.inPrerollPosition()&&!t.data.view_preroll_played&&(t.data.view_preroll_played=!0,i._adRequests.length>0&&(t.data.view_preroll_request_time=Math.max(0,r.viewer_time-i._adRequests[0].viewer_time)),t.data.view_start&&(t.data.view_startup_preroll_request_time=Math.max(0,r.viewer_time-t.data.view_start)),i._prerollPlayTime=r.viewer_time)}),t.on("adplaying",function(e,r){i.inPrerollPosition()&&void 0===t.data.view_preroll_load_time&&void 0!==i._prerollPlayTime&&(t.data.view_preroll_load_time=r.viewer_time-i._prerollPlayTime,t.data.view_startup_preroll_load_time=r.viewer_time-i._prerollPlayTime)}),t.on("adclicked",function(e,r){i._wouldBeNewAdPlay||ec(t.data,"view_ad_clicked_count")}),t.on("adskipped",function(e,r){i._wouldBeNewAdPlay||ec(t.data,"view_ad_skipped_count")}),t.on("adended",function(){i._wouldBeNewAdPlay=!0}),t.on("aderror",function(){i._wouldBeNewAdPlay=!0})}return er(e,[{key:"inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]}},{key:"_updateAdData",value:function(e,t){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var i=$(ed(t.ad_tag_url),2),r=i[0],a=i[1];this.pm.data.view_preroll_ad_tag_domain=a,this.pm.data.view_preroll_ad_tag_hostname=r}if(!this.pm.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var s=$(ed(t.ad_asset_url),2),n=s[0],o=s[1];this.pm.data.view_preroll_ad_asset_domain=o,this.pm.data.view_preroll_ad_asset_hostname=n}}this.pm.data.ad_asset_url=null==t?void 0:t.ad_asset_url,this.pm.data.ad_tag_url=null==t?void 0:t.ad_tag_url,this.pm.data.ad_creative_id=null==t?void 0:t.ad_creative_id,this.pm.data.ad_id=null==t?void 0:t.ad_id,this.pm.data.ad_universal_id=null==t?void 0:t.ad_universal_id}}]),e}(),eY=b(y()),eq=function e(t){et(this,e);var i,r,a=function(){t.disableRebufferTracking||(ec(t.data,"view_waiting_rebuffer_count",1),i=K.now(),r=eY.default.setInterval(function(){if(i){var e=K.now();ec(t.data,"view_waiting_rebuffer_duration",e-i),i=e}},250))},s=function(){t.disableRebufferTracking||i&&(ec(t.data,"view_waiting_rebuffer_duration",K.now()-i),i=!1,eY.default.clearInterval(r))},n=!1,o=function(){n=!0},l=function(){n=!1,s()};t.on("waiting",function(){n&&a()}),t.on("playing",function(){s(),o()}),t.on("pause",l),t.on("seeking",l)},ej=function e(t){var i=this;et(this,e),ea(this,"lastWallClockTime",void 0);var r=function(){i.lastWallClockTime=K.now(),t.on("before*",a)},a=function(e){var r=K.now(),a=i.lastWallClockTime;i.lastWallClockTime=r,r-a>3e4&&(t.emit("devicesleep",{viewer_time:a}),Object.assign(t.data,{viewer_time:a}),t.send("devicesleep"),t.emit("devicewake",{viewer_time:r}),Object.assign(t.data,{viewer_time:r}),t.send("devicewake"))};t.one("playbackheartbeat",r),t.on("playbackheartbeatend",function(){t.off("before*",a),t.one("playbackheartbeat",r)})},ez=b(y()),eX=(ta=function(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var r in i)t[r]=i[r]}return t},function e(t){function i(e,r,a){var s;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(a=ta({path:"/"},i.defaults,a)).expires){var n=new Date;n.setMilliseconds(n.getMilliseconds()+864e5*a.expires),a.expires=n}try{s=JSON.stringify(r),/^[\{\[]/.test(s)&&(r=s)}catch(e){}return r=t.write?t.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[e,"=",r,a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}e||(s={});for(var o=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,d=0;d<o.length;d++){var u=o[d].split("="),h=u.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{var c=u[0].replace(l,decodeURIComponent);if(h=t.read?t.read(h,c):t(h,c)||h.replace(l,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(e===c){s=h;break}e||(s[c]=h)}catch(e){}}return s}}return i.set=i,i.get=function(e){return i.call(i,e)},i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(e,t){i(e,"",ta(t,{expires:-1}))},i.withConverter=e,i}(function(){})),eQ="muxData",eZ=function(){var e;try{e=(eX.get(eQ)||"").split("&").reduce(function(e,t){var i=$(t.split("="),2),r=i[0],a=i[1],s=+a;return e[r]=a&&s==a?s:a,e},{})}catch(t){e={}}return e},eJ=function(e){try{eX.set(eQ,Object.entries(e).map(function(e){var t=$(e,2),i=t[0],r=t[1];return"".concat(i,"=").concat(r)}).join("&"),{expires:365})}catch(e){}},e0=function(){var e=eZ();return e.mux_viewer_id=e.mux_viewer_id||W(),e.msn=e.msn||Math.random(),eJ(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},e1=function(){var e=eZ(),t=K.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=W(),e.sst=t),e.sex=t+15e5,eJ(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}},e2=b(y()),e3=function(){var e;switch(e4()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e},e4=function(){var e=e2.default.navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};e3.getConnectionFromAPI=e4;var e5=e9({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),e8=e9({ad:"ad",af:"affiliate",ag:"aggregate",ap:"api",al:"application",ao:"audio",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",bn:"brand",br:"break",bw:"browser",by:"bytes",bz:"business",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",ci:"client",ck:"clicked",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cq:"creator",cr:"creative",cs:"captions",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",dy:"dynamic",eb:"enabled",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",ep:"experiments",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ez:"exception",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",or:"origin",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pp:"pip",pr:"preload",ps:"position",pt:"part",py:"property",px:"pop",pz:"plan",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rg:"range",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",sd:"skipped",se:"session",sh:"shift",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",ss:"status",st:"start",su:"startup",sv:"server",sw:"software",sy:"severity",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function e9(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function e6(e){var t={},i={};return Object.keys(e).forEach(function(r){var a=!1;if(e.hasOwnProperty(r)&&void 0!==e[r]){var s=r.split("_"),n=s[0],o=e5[n];o||(Q.info("Data key word `"+s[0]+"` not expected in "+r),o=n+"_"),s.splice(1).forEach(function(e){"url"===e&&(a=!0),e8[e]?o+=e8[e]:Number.isInteger(Number(e))?o+=e:(Q.info("Data key word `"+e+"` not expected in "+r),o+="_"+e+"_")}),a?i[o]=e[r]:t[o]=e[r]}}),Object.assign(t,i)}var e7=b(y()),te=b(U()),tt={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},ti=["hb","requestcompleted","requestfailed","requestcanceled"],tr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._resendAfterPost=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},tt,t)};tr.prototype.queueEvent=function(e,t){var i=Object.assign({},t);return(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(i),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},tr.prototype.flushEvents=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e&&1===this._eventQueue.length){this._eventQueue.pop();return}this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()},tr.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),e7.default.clearTimeout(this._sendTimeout)},tr.prototype._clearBeaconQueue=function(){var e=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,t=this._eventQueue.slice(e);e>0&&Object.assign(t[t.length-1],e6({mux_view_message:"event queue truncated"}));var i=this._createPayload(t);to(this._beaconUrl,i,!0,function(){})},tr.prototype._sendBeaconQueue=function(){var e=this;if(this._postInFlight){this._resendAfterPost=!0;return}var t=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var i=this._createPayload(t),r=K.now();to(this._beaconUrl,i,!1,function(i,a){a?(e._eventQueue=t.concat(e._eventQueue),e._failureCount+=1,Q.info("Error sending beacon: "+a)):e._failureCount=0,e._roundTripTime=K.now()-r,e._postInFlight=!1,e._resendAfterPost&&(e._resendAfterPost=!1,e._eventQueue.length>0&&e._sendBeaconQueue())})},tr.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},tr.prototype._startBeaconSending=function(){var e=this;e7.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=e7.default.setTimeout(function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()},this._getNextBeaconTime()))},tr.prototype._createPayload=function(e){var t=this,i={transmission_timestamp:Math.round(K.now())};this._roundTripTime&&(i.rtt_ms=Math.round(this._roundTripTime));var r,a,s,n=function(){s=(r=JSON.stringify({metadata:i,events:a||e})).length/1024},o=function(){return s<=t._options.maxPayloadKBSize};return n(),o()||(Q.info("Payload size is too big ("+s+" kb). Removing unnecessary events."),a=e.filter(function(e){return -1===ti.indexOf(e.e)}),n()),o()||(Q.info("Payload size still too big ("+s+" kb). Cropping fields.."),a.forEach(function(e){for(var t in e){var i=e[t];"string"==typeof i&&i.length>51200&&(e[t]=i.substring(0,51200))}}),n()),r};var ta,ts,tn="function"==typeof te.default.exitPictureInPicture?function(e){return e.length<=57344}:function(e){return!1},to=function(e,t,i,r){if(i&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(e,t)){r();return}if(e7.default.fetch){e7.default.fetch(e,{method:"POST",body:t,headers:{"Content-Type":"text/plain"},keepalive:tn(t)}).then(function(e){return r(null,e.ok?null:"Error")}).catch(function(e){return r(null,e)});return}if(e7.default.XMLHttpRequest){var a=new e7.default.XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)return r(null,200!==a.status?"error":void 0)},a.open("POST",e),a.setRequestHeader("Content-Type","text/plain"),a.send(t);return}r()},tl=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id","player_error_code","player_error_message","player_error_context","player_error_severity","player_error_business_exception"],td=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],tu=["ad_id","ad_creative_id","ad_universal_id"],th=["viewstart","error","ended","viewend"],tc=function(){function e(t,i){var r,a,s,n,o,l,d,u,h,c,m,p,f,g,E,b,y,T,_,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};et(this,e),ea(this,"mux",void 0),ea(this,"envKey",void 0),ea(this,"options",void 0),ea(this,"eventQueue",void 0),ea(this,"sampleRate",void 0),ea(this,"disableCookies",void 0),ea(this,"respectDoNotTrack",void 0),ea(this,"previousBeaconData",void 0),ea(this,"lastEventTime",void 0),ea(this,"rateLimited",void 0),ea(this,"pageLevelData",void 0),ea(this,"viewerData",void 0),this.mux=t,this.envKey=i,this.options=A,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.eventQueue=new tr((r=this.envKey,s=(a=this.options).beaconCollectionDomain,n=a.beaconDomain,s?"https://"+s:(r=r||"inferred").match(/^[a-z0-9]+$/)?"https://"+r+"."+(n||"litix.io"):"https://img.litix.io/a.gif")),this.sampleRate=null!==(y=this.options.sampleRate)&&void 0!==y?y:1,this.disableCookies=null!==(T=this.options.disableCookies)&&void 0!==T&&T,this.respectDoNotTrack=null!==(_=this.options.respectDoNotTrack)&&void 0!==_&&_,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:null===(o=this.options.platform)||void 0===o?void 0:o.name,viewer_application_version:null===(l=this.options.platform)||void 0===l?void 0:l.version,viewer_application_engine:null===(d=this.options.platform)||void 0===d?void 0:d.layout,viewer_device_name:null===(u=this.options.platform)||void 0===u?void 0:u.product,viewer_device_category:"",viewer_device_manufacturer:null===(h=this.options.platform)||void 0===h?void 0:h.manufacturer,viewer_os_family:null===(m=this.options.platform)||void 0===m||null===(c=m.os)||void 0===c?void 0:c.family,viewer_os_architecture:null===(f=this.options.platform)||void 0===f||null===(p=f.os)||void 0===p?void 0:p.architecture,viewer_os_version:null===(E=this.options.platform)||void 0===E||null===(g=E.os)||void 0===g?void 0:g.version,viewer_connection_type:e3(),page_url:null===ez.default||void 0===ez.default||null===(b=ez.default.location)||void 0===b?void 0:b.href},this.viewerData=this.disableCookies?{}:e0()}return er(e,[{key:"send",value:function(e,t){if(!(!e||!(null!=t&&t.view_id))){if(this.respectDoNotTrack&&J())return Q.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!=typeof t)return Q.error("A data object was expected in send() but was not provided");var i=this.disableCookies?{}:e1(),r=ep(em({},this.pageLevelData,t,i,this.viewerData),{event:e,env_key:this.envKey});r.user_id&&(r.viewer_user_id=r.user_id,delete r.user_id);var a,s=(null!==(a=r.mux_sample_number)&&void 0!==a?a:0)>=this.sampleRate,n=e6(this._deduplicateBeaconData(e,r));if(this.lastEventTime=this.mux.utils.now(),s)return Q.info("Not sending event due to sample rate restriction",e,r,n);if(this.envKey||Q.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",e,r,n),!this.rateLimited){if(Q.info("Sending event",e,r,n),this.rateLimited=!this.eventQueue.queueEvent(e,n),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&"hb"===e?this.eventQueue.flushEvents(!0):th.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return r.event="eventrateexceeded",n=e6(r),this.eventQueue.queueEvent(r.event,n),Q.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(e,t){var i=this,r={},a=t.view_id;if("-1"===a||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)r=em({},t),a&&(this.previousBeaconData=r),a&&"viewend"===e&&(this.previousBeaconData=null);else{var s=0===e.indexOf("request");Object.entries(t).forEach(function(t){var a=$(t,2),n=a[0],o=a[1];i.previousBeaconData&&(o!==i.previousBeaconData[n]||tl.indexOf(n)>-1||i.objectHasChanged(s,n,o,i.previousBeaconData[n])||i.eventRequiresKey(e,n))&&(r[n]=o,i.previousBeaconData[n]=o)})}return r}},{key:"objectHasChanged",value:function(e,t,i,r){return!!e&&0===t.indexOf("request_")&&("request_response_headers"===t||"object"!=typeof i||"object"!=typeof r||Object.keys(i||{}).length!==Object.keys(r||{}).length)}},{key:"eventRequiresKey",value:function(e,t){return!!("renditionchange"===e&&0===t.indexOf("video_source_")||tu.includes(t)&&td.includes(e))}}]),e}(),tm=function e(t){et(this,e);var i=0,r=0,a=0,s=0,n=0,o=0,l=0;t.on("requestcompleted",function(e,o){var l,d,u=o.request_start,h=o.request_response_start,c=o.request_response_end,m=o.request_bytes_loaded;if(s++,h?(l=h-(null!=u?u:0),d=(null!=c?c:0)-h):d=(null!=c?c:0)-(null!=u?u:0),d>0&&m&&m>0){var p=m/d*8e3;n++,r+=m,a+=d,t.data.view_min_request_throughput=Math.min(t.data.view_min_request_throughput||1/0,p),t.data.view_average_request_throughput=r/a*8e3,t.data.view_request_count=s,l>0&&(i+=l,t.data.view_max_request_latency=Math.max(t.data.view_max_request_latency||0,l),t.data.view_average_request_latency=i/n)}}),t.on("requestfailed",function(e,i){s++,o++,t.data.view_request_count=s,t.data.view_request_failed_count=o}),t.on("requestcanceled",function(e,i){s++,l++,t.data.view_request_count=s,t.data.view_request_canceled_count=l})},tp=function e(t){var i=this;et(this,e),ea(this,"_lastEventTime",void 0),t.on("before*",function(e,r){var a=r.viewer_time,s=K.now(),n=i._lastEventTime;if(i._lastEventTime=s,n&&s-n>36e5){var o=Object.keys(t.data).reduce(function(e,i){return 0===i.indexOf("video_")?Object.assign(e,ea({},i,t.data[i])):e},{});t.mux.log.info("Received event after at least an hour inactivity, creating a new view");var l=t.playbackHeartbeat._playheadShouldBeProgressing;t._resetView(Object.assign({viewer_time:a},o)),t.playbackHeartbeat._playheadShouldBeProgressing=l,t.playbackHeartbeat._playheadShouldBeProgressing&&"play"!==e.type&&"adbreakstart"!==e.type&&(t.emit("play",{viewer_time:a}),"playing"!==e.type&&t.emit("playing",{viewer_time:a}))}})},tf=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],tg=new Set(["requestcompleted","requestfailed","requestcanceled"]),tv=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eo(e,t)}(r,e);var t,i=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=es(r);return e=t?Reflect.construct(i,arguments,es(this).constructor):i.apply(this,arguments),e&&("object"===A(e)||"function"==typeof e)?e:ee(this)});function r(e,t,a){et(this,r),ea(ee(s=i.call(this)),"DOM_CONTENT_LOADED_EVENT_END",void 0),ea(ee(s),"NAVIGATION_START",void 0),ea(ee(s),"_destroyed",void 0),ea(ee(s),"_heartBeatTimeout",void 0),ea(ee(s),"adTracker",void 0),ea(ee(s),"dashjs",void 0),ea(ee(s),"data",void 0),ea(ee(s),"disablePlayheadRebufferTracking",void 0),ea(ee(s),"disableRebufferTracking",void 0),ea(ee(s),"errorTracker",void 0),ea(ee(s),"errorTranslator",void 0),ea(ee(s),"emitTranslator",void 0),ea(ee(s),"getAdData",void 0),ea(ee(s),"getPlayheadTime",void 0),ea(ee(s),"getStateData",void 0),ea(ee(s),"stateDataTranslator",void 0),ea(ee(s),"hlsjs",void 0),ea(ee(s),"id",void 0),ea(ee(s),"longResumeTracker",void 0),ea(ee(s),"minimumRebufferDuration",void 0),ea(ee(s),"mux",void 0),ea(ee(s),"playbackEventDispatcher",void 0),ea(ee(s),"playbackHeartbeat",void 0),ea(ee(s),"playbackHeartbeatTime",void 0),ea(ee(s),"playheadTime",void 0),ea(ee(s),"seekingTracker",void 0),ea(ee(s),"sustainedRebufferThreshold",void 0),ea(ee(s),"watchTimeTracker",void 0),ea(ee(s),"currentFragmentPDT",void 0),ea(ee(s),"currentFragmentStart",void 0),s.DOM_CONTENT_LOADED_EVENT_END=eh.domContentLoadedEventEnd(),s.NAVIGATION_START=eh.navigationStart(),s.mux=e,s.id=t,null!=a&&a.beaconDomain&&s.mux.log.warn("The `beaconDomain` setting has been deprecated in favor of `beaconCollectionDomain`. Please change your integration to use `beaconCollectionDomain` instead of `beaconDomain`."),(a=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(e){return e},emitTranslator:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t},stateDataTranslator:function(e){return e}},a)).data=a.data||{},a.data.property_key&&(a.data.env_key=a.data.property_key,delete a.data.property_key),Q.level=a.debug?X.DEBUG:X.WARN,s.getPlayheadTime=a.getPlayheadTime,s.getStateData=a.getStateData||function(){return{}},s.getAdData=a.getAdData||function(){},s.minimumRebufferDuration=a.minimumRebufferDuration,s.sustainedRebufferThreshold=a.sustainedRebufferThreshold,s.playbackHeartbeatTime=a.playbackHeartbeatTime,s.disableRebufferTracking=a.disableRebufferTracking,s.disableRebufferTracking&&s.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),s.disablePlayheadRebufferTracking=a.disablePlayheadRebufferTracking,s.errorTranslator=a.errorTranslator,s.emitTranslator=a.emitTranslator,s.stateDataTranslator=a.stateDataTranslator,s.playbackEventDispatcher=new tc(e,a.data.env_key,a),s.data={player_instance_id:W(),mux_sample_rate:a.sampleRate,beacon_domain:a.beaconCollectionDomain||a.beaconDomain},s.data.view_sequence_number=1,s.data.player_sequence_number=1;var s,n=(function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}).bind(ee(s));if(s.on("viewinit",function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,t),this._initializeViewData(),this.one("play",n),this.one("adbreakstart",n)}),s.on("videochange",function(e,t){this._resetView(t)}),s.on("programchange",function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),this._resetView(Object.assign(t,{view_program_changed:!0})),n(),this.emit("play"),this.emit("playing")}),s.on("fragmentchange",function(e,t){this.currentFragmentPDT=t.currentFragmentPDT,this.currentFragmentStart=t.currentFragmentStart}),s.on("destroy",s.destroy),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof window.removeEventListener){var o=function(){var e=void 0!==s.data.view_start;s.mux.WINDOW_HIDDEN="hidden"===document.visibilityState,e&&s.mux.WINDOW_HIDDEN&&(s.data.player_is_paused||s.emit("hb"))};window.addEventListener("visibilitychange",o,!1);var l=function(e){e.persisted||s.destroy()};window.addEventListener("pagehide",l,!1),s.on("destroy",function(){window.removeEventListener("visibilitychange",o),window.removeEventListener("pagehide",l)})}return s.on("playerready",function(e,t){Object.assign(this.data,t)}),tf.forEach(function(e){s.on(e,function(t,i){0!==e.indexOf("ad")&&this._updateStateData(),Object.assign(this.data,i),this._sanitizeData()}),s.on("after"+e,function(){("error"!==e||this.errorTracker.viewErrored)&&this.send(e)})}),s.on("viewend",function(e,t){Object.assign(s.data,t)}),s.one("playerready",function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),s.longResumeTracker=new tp(ee(s)),s.errorTracker=new eO(ee(s)),new ej(ee(s)),s.seekingTracker=new eH(ee(s)),s.playheadTime=new eU(ee(s)),s.playbackHeartbeat=new eM(ee(s)),new eG(ee(s)),s.watchTimeTracker=new eN(ee(s)),new eP(ee(s)),s.adTracker=new eW(ee(s)),new eB(ee(s)),new eF(ee(s)),new e$(ee(s)),new eq(ee(s)),new tm(ee(s)),a.hlsjs&&s.addHLSJS(a),a.dashjs&&s.addDashJS(a),s.emit("viewinit",a.data),s}return er(r,[{key:"emit",value:function(e,t){var i,a=Object.assign({viewer_time:this.mux.utils.now()},t),s=[e,a];if(this.emitTranslator)try{s=this.emitTranslator(e,a)}catch(e){this.mux.log.warn("Exception in emit translator callback.",e)}null!=s&&s.length&&(i=en(es(r.prototype),"emit",this)).call.apply(i,[this].concat(z(s)))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(e){if(this.data.view_id){var t=Object.assign({},this.data);if(void 0===t.video_source_is_live&&(t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1)),t.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(e){t[e]=void 0}),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var i=$(ed(t.video_source_url),2),r=i[0],a=i[1];t.video_source_domain=a,t.video_source_hostname=r}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,tg.has(e)||this._restartHeartBeat(),"viewend"===e&&delete this.data.view_id}}},{key:"_resetView",value:function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}},{key:"_updateStateData",value:function(){var e=this.getStateData();if("function"==typeof this.stateDataTranslator)try{e=this.stateDataTranslator(e)}catch(e){this.mux.log.warn("Exception in stateDataTranslator translator callback.",e)}Object.assign(this.data,e),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(t){var i=parseInt(e.data[t],10);e.data[t]=isNaN(i)?void 0:i}),["player_source_url","video_source_url"].forEach(function(t){if(e.data[t]){var i=e.data[t].toLowerCase();(0===i.indexOf("data:")||0===i.indexOf("blob:"))&&(e.data[t]="MSE style URL")}})}},{key:"_resetVideoData",value:function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("video_")&&delete e.data[t]})}},{key:"_resetViewData",value:function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("view_")&&delete e.data[t]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(){delete this.data.player_error_code,delete this.data.player_error_message,delete this.data.player_error_context,delete this.data.player_error_severity,delete this.data.player_error_business_exception}},{key:"_initializeViewData",value:function(){var e=this,t=this.data.view_id=W(),i=function(){t===e.data.view_id&&ec(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",i):i()}},{key:"_restartHeartBeat",value:function(){var e=this;window.clearTimeout(this._heartBeatTimeout),this._heartBeatTimeout=window.setTimeout(function(){e.data.player_is_paused||e.emit("hb")},1e4)}},{key:"addHLSJS",value:function(e){if(!e.hlsjs){this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.");return}if(this.hlsjs){this.mux.log.warn("An instance of HLS.js is already being monitored for this player.");return}this.hlsjs=e.hlsjs,e_(this.mux,this.id,e.hlsjs,{},e.Hls||window.Hls)}},{key:"removeHLSJS",value:function(){this.hlsjs&&(eA(this.hlsjs),this.hlsjs=void 0)}},{key:"addDashJS",value:function(e){if(!e.dashjs){this.mux.log.warn("You must pass a valid dashjs instance in order to track it.");return}if(this.dashjs){this.mux.log.warn("An instance of Dash.js is already being monitored for this player.");return}this.dashjs=e.dashjs,eL(this.mux,this.id,e.dashjs)}},{key:"removeDashJS",value:function(){this.dashjs&&(ew(this.dashjs),this.dashjs=void 0)}}]),r}(eC),tE=b(U()),tb=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],ty={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},tT=b(y());tT.default&&tT.default.WeakMap&&(ts=new WeakMap);var t_={TARGET_DURATION:"#EXT-X-TARGETDURATION",PART_INF:"#EXT-X-PART-INF",SERVER_CONTROL:"#EXT-X-SERVER-CONTROL",INF:"#EXTINF",PROGRAM_DATE_TIME:"#EXT-X-PROGRAM-DATE-TIME",VERSION:"#EXT-X-VERSION",SESSION_DATA:"#EXT-X-SESSION-DATA"},tA=function(e){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(e),this.manifest};tA.prototype.process=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.processLine(this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},tA.prototype.processLine=function(e){var t=e.indexOf(":"),i=tD(e,t),r=i[0],a=2===i.length?tR(i[1]):void 0;if("#"!==r[0])this.currentUri.uri=r,this.manifest.segments.push(this.currentUri),!this.manifest.targetDuration||"duration"in this.currentUri||(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(r){case t_.TARGET_DURATION:if(!isFinite(a)||a<0)return;this.manifest.targetDuration=a,this.setHoldBack();break;case t_.PART_INF:tS(this.manifest,i),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case t_.SERVER_CONTROL:tS(this.manifest,i),this.setHoldBack();break;case t_.INF:0===a?this.currentUri.duration=.01:a>0&&(this.currentUri.duration=a);break;case t_.PROGRAM_DATE_TIME:var s=new Date(a);this.manifest.dateTimeString||(this.manifest.dateTimeString=a,this.manifest.dateTimeObject=s),this.currentUri.dateTimeString=a,this.currentUri.dateTimeObject=s;break;case t_.VERSION:tS(this.manifest,i);break;case t_.SESSION_DATA:var n=eb(tC(i[1]));Object.assign(this.manifest.sessionData,n)}},tA.prototype.setHoldBack=function(){var e=this.manifest,t=e.serverControl,i=e.targetDuration,r=e.partTargetDuration;if(t){var a="holdBack",s="partHoldBack",n=i&&3*i,o=r&&2*r;i&&!t.hasOwnProperty(a)&&(t[a]=n),n&&t[a]<n&&(t[a]=n),r&&!t.hasOwnProperty(s)&&(t[s]=3*r),r&&t[s]<o&&(t[s]=o)}};var tS=function(e,t){var i,r=tk(t[0].replace("#EXT-X-",""));tw(t[1])?(i={},i=Object.assign(tL(t[1]),i)):i=tR(t[1]),e[r]=i},tk=function(e){return e.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()})},tR=function(e){if("yes"===e.toLowerCase()||"no"===e.toLowerCase())return"yes"===e.toLowerCase();var t=-1!==e.indexOf(":")?e:parseFloat(e);return isNaN(t)?e:t},tI=function(e){var t={},i=e.split("=");return i.length>1&&(t[tk(i[0])]=tR(i[1])),t},tL=function(e){for(var t=e.split(","),i={},r=0;t.length>r;r++)i=Object.assign(tI(t[r]),i);return i},tw=function(e){return e.indexOf("=")>-1},tD=function(e,t){return -1===t?[e]:[e.substring(0,t),e.substring(t+1)]},tC=function(e){var t={};if(e){var i=e.search(",");return[e.slice(0,i),e.slice(i+1)].forEach(function(e,i){for(var r=e.replace(/['"]+/g,"").split("="),a=0;a<r.length;a++)"DATA-ID"===r[a]&&(t["DATA-ID"]=r[1-a]),"VALUE"===r[a]&&(t.VALUE=r[1-a])}),{data:t}}},tx={safeCall:function(e,t,i,r){var a=r;if(e&&"function"==typeof e[t])try{a=e[t].apply(e,i)}catch(e){Q.info("safeCall error",e)}return a},safeIncrement:ec,getComputedStyle:function(e,t){var i;return e&&t&&tT.default&&"function"==typeof tT.default.getComputedStyle?(ts&&ts.has(e)&&(i=ts.get(e)),i||(i=tT.default.getComputedStyle(e,null),ts&&ts.set(e,i)),i.getPropertyValue(t)):""},secondsToMs:function(e){return Math.floor(1e3*e)},assign:Object.assign,headersStringToObject:ev,cdnHeadersToRequestId:eE,extractHostnameAndDomain:ed,extractHostname:el,manifestParser:tA,generateShortID:Y,generateUUID:W,now:K.now,findMediaElement:j},tM={},tO=function(e){var t=arguments;"string"==typeof e?tO.hasOwnProperty(e)?G.default.setTimeout(function(){t=Array.prototype.splice.call(t,1),tO[e].apply(null,t)},0):Q.warn("`"+e+"` is an unknown task"):"function"==typeof e?G.default.setTimeout(function(){e(tO)},0):Q.warn("`"+e+"` is invalid.")},tN={loaded:K.now(),NAME:"mux-embed",VERSION:"5.9.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(e,t){return function(e,t,i){var r=$(j(t),3),a=r[0],s=r[1],n=r[2],o=e.log,l=e.utils.getComputedStyle,d=e.utils.secondsToMs;if(!a)return o.error("No element was found with the `"+s+"` query selector.");if("video"!==n&&"audio"!==n)return o.error("The element of `"+s+"` was not a media element.");a.mux&&(a.mux.destroy(),delete a.mux,o.warn("Already monitoring this video element, replacing existing event listeners")),(i=Object.assign({automaticErrorTracking:!0},i,{getPlayheadTime:function(){return d(a.currentTime)},getStateData:function(){var e,t,i=(null===(e=this.getPlayheadTime)||void 0===e?void 0:e.call(this))||d(a.currentTime),r=this.hlsjs&&this.hlsjs.url,s=this.dashjs&&"function"==typeof this.dashjs.getSource&&this.dashjs.getSource(),n={player_is_paused:a.paused,player_width:parseInt(l(a,"width")),player_height:parseInt(l(a,"height")),player_autoplay_on:a.autoplay,player_preload_on:a.preload,player_language_code:a.lang,player_is_fullscreen:tE.default&&!!(tE.default.fullscreenElement||tE.default.webkitFullscreenElement||tE.default.mozFullScreenElement||tE.default.msFullscreenElement),video_poster_url:a.poster,video_source_url:r||s||a.currentSrc,video_source_duration:d(a.duration),video_source_height:a.videoHeight,video_source_width:a.videoWidth,view_dropped_frame_count:null==a||null===(t=a.getVideoPlaybackQuality)||void 0===t?void 0:t.call(a).droppedVideoFrames};if(a.getStartDate&&i>0){var o=a.getStartDate();if(o&&"function"==typeof o.getTime&&o.getTime()){var u=o.getTime();if(n.player_program_time=u+i,a.seekable.length>0){var h=u+a.seekable.end(a.seekable.length-1);n.player_live_edge_program_time=h}}}return n}})).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:e.VERSION},i.data),a.mux=a.mux||{},a.mux.deleted=!1,a.mux.emit=function(t,i){e.emit(s,t,i)},a.mux.updateData=function(e){a.mux.emit("hb",e)};var u=function(){o.error("The monitor for this video element has already been destroyed.")};a.mux.destroy=function(){Object.keys(a.mux.listeners).forEach(function(e){a.removeEventListener(e,a.mux.listeners[e],!1)}),delete a.mux.listeners,a.mux.destroy=u,a.mux.swapElement=u,a.mux.emit=u,a.mux.addHLSJS=u,a.mux.addDashJS=u,a.mux.removeHLSJS=u,a.mux.removeDashJS=u,a.mux.updateData=u,a.mux.setEmitTranslator=u,a.mux.setStateDataTranslator=u,a.mux.setGetPlayheadTime=u,a.mux.deleted=!0,e.emit(s,"destroy")},a.mux.swapElement=function(t){var i=$(j(t),3),r=i[0],s=i[1],n=i[2];return r?"video"!==n&&"audio"!==n?e.log.error("The element of `"+s+"` was not a media element."):void(r.muxId=a.muxId,delete a.muxId,r.mux=r.mux||{},r.mux.listeners=Object.assign({},a.mux.listeners),delete a.mux.listeners,Object.keys(r.mux.listeners).forEach(function(e){a.removeEventListener(e,r.mux.listeners[e],!1),r.addEventListener(e,r.mux.listeners[e],!1)}),r.mux.swapElement=a.mux.swapElement,r.mux.destroy=a.mux.destroy,delete a.mux,a=r):e.log.error("No element was found with the `"+s+"` query selector.")},a.mux.addHLSJS=function(t){e.addHLSJS(s,t)},a.mux.addDashJS=function(t){e.addDashJS(s,t)},a.mux.removeHLSJS=function(){e.removeHLSJS(s)},a.mux.removeDashJS=function(){e.removeDashJS(s)},a.mux.setEmitTranslator=function(t){e.setEmitTranslator(s,t)},a.mux.setStateDataTranslator=function(t){e.setStateDataTranslator(s,t)},a.mux.setGetPlayheadTime=function(t){t||(t=i.getPlayheadTime),e.setGetPlayheadTime(s,t)},e.init(s,i),e.emit(s,"playerready"),a.paused||(e.emit(s,"play"),a.readyState>2&&e.emit(s,"playing")),a.mux.listeners={},tb.forEach(function(t){("error"!==t||i.automaticErrorTracking)&&(a.mux.listeners[t]=function(){var i={};if("error"===t){if(!a.error||1===a.error.code)return;i.player_error_code=a.error.code,i.player_error_message=ty[a.error.code]||a.error.message}e.emit(s,t,i)},a.addEventListener(t,a.mux.listeners[t],!1))})}(tO,e,t)},destroyMonitor:function(e){var t=$(j(e),1)[0];t&&t.mux&&"function"==typeof t.mux.destroy?t.mux.destroy():Q.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(e,t){var i=q(e);tM[i]?tM[i].addHLSJS(t):Q.error("A monitor for `"+i+"` has not been initialized.")},addDashJS:function(e,t){var i=q(e);tM[i]?tM[i].addDashJS(t):Q.error("A monitor for `"+i+"` has not been initialized.")},removeHLSJS:function(e){var t=q(e);tM[t]?tM[t].removeHLSJS():Q.error("A monitor for `"+t+"` has not been initialized.")},removeDashJS:function(e){var t=q(e);tM[t]?tM[t].removeDashJS():Q.error("A monitor for `"+t+"` has not been initialized.")},init:function(e,t){J()&&t&&t.respectDoNotTrack&&Q.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var i=q(e);tM[i]=new tv(tO,i,t)},emit:function(e,t,i){var r=q(e);tM[r]?(tM[r].emit(t,i),"destroy"===t&&delete tM[r]):Q.error("A monitor for `"+r+"` has not been initialized.")},updateData:function(e,t){var i=q(e);tM[i]?tM[i].emit("hb",t):Q.error("A monitor for `"+i+"` has not been initialized.")},setEmitTranslator:function(e,t){var i=q(e);tM[i]?tM[i].emitTranslator=t:Q.error("A monitor for `"+i+"` has not been initialized.")},setStateDataTranslator:function(e,t){var i=q(e);tM[i]?tM[i].stateDataTranslator=t:Q.error("A monitor for `"+i+"` has not been initialized.")},setGetPlayheadTime:function(e,t){var i=q(e);tM[i]?tM[i].getPlayheadTime=t:Q.error("A monitor for `"+i+"` has not been initialized.")},checkDoNotTrack:J,log:Q,utils:tx,events:{PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled",HEARTBEAT:"hb",DESTROY:"destroy"},WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(tO,tN),void 0!==G.default&&"function"==typeof G.default.addEventListener&&G.default.addEventListener("pagehide",function(e){e.persisted||(tO.WINDOW_UNLOADING=!0)},!1);var tP={exports:{}};oP=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,oU=/^(?=([^\/?#]*))\1([^]*)$/,oF=/(?:\/|^)\.(?=\/)/g,oB=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o$={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=o$.parseURL(e);if(!r)throw Error("Error trying to parse base URL.");return r.path=o$.normalizePath(r.path),o$.buildURLFromParts(r)}var a=o$.parseURL(t);if(!a)throw Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o$.normalizePath(a.path),o$.buildURLFromParts(a)):t;var s=o$.parseURL(e);if(!s)throw Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var n=oU.exec(s.path);s.netLoc=n[1],s.path=n[2]}s.netLoc&&!s.path&&(s.path="/");var o={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(o.netLoc=s.netLoc,"/"!==a.path[0])){if(a.path){var l=s.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;o.path=o$.normalizePath(d)}else o.path=s.path,a.params||(o.params=s.params,a.query||(o.query=s.query))}return null===o.path&&(o.path=i.alwaysNormalize?o$.normalizePath(a.path):a.path),o$.buildURLFromParts(o)},parseURL:function(e){var t=oP.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(oF,"");e.length!==(e=e.replace(oB,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},tP.exports=o$;var tU=tP.exports;function tF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function tB(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tF(Object(i),!0).forEach(function(t){!function(e,t,i){var r;(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tF(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function t$(){return(t$=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}let tG=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},tH=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=tV},tV=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,tK=((oG={}).MEDIA_ATTACHING="hlsMediaAttaching",oG.MEDIA_ATTACHED="hlsMediaAttached",oG.MEDIA_DETACHING="hlsMediaDetaching",oG.MEDIA_DETACHED="hlsMediaDetached",oG.BUFFER_RESET="hlsBufferReset",oG.BUFFER_CODECS="hlsBufferCodecs",oG.BUFFER_CREATED="hlsBufferCreated",oG.BUFFER_APPENDING="hlsBufferAppending",oG.BUFFER_APPENDED="hlsBufferAppended",oG.BUFFER_EOS="hlsBufferEos",oG.BUFFER_FLUSHING="hlsBufferFlushing",oG.BUFFER_FLUSHED="hlsBufferFlushed",oG.MANIFEST_LOADING="hlsManifestLoading",oG.MANIFEST_LOADED="hlsManifestLoaded",oG.MANIFEST_PARSED="hlsManifestParsed",oG.LEVEL_SWITCHING="hlsLevelSwitching",oG.LEVEL_SWITCHED="hlsLevelSwitched",oG.LEVEL_LOADING="hlsLevelLoading",oG.LEVEL_LOADED="hlsLevelLoaded",oG.LEVEL_UPDATED="hlsLevelUpdated",oG.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",oG.LEVELS_UPDATED="hlsLevelsUpdated",oG.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",oG.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",oG.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",oG.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",oG.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",oG.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",oG.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",oG.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",oG.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",oG.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",oG.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",oG.CUES_PARSED="hlsCuesParsed",oG.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",oG.INIT_PTS_FOUND="hlsInitPtsFound",oG.FRAG_LOADING="hlsFragLoading",oG.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",oG.FRAG_LOADED="hlsFragLoaded",oG.FRAG_DECRYPTED="hlsFragDecrypted",oG.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",oG.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",oG.FRAG_PARSING_METADATA="hlsFragParsingMetadata",oG.FRAG_PARSED="hlsFragParsed",oG.FRAG_BUFFERED="hlsFragBuffered",oG.FRAG_CHANGED="hlsFragChanged",oG.FPS_DROP="hlsFpsDrop",oG.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",oG.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",oG.ERROR="hlsError",oG.DESTROYING="hlsDestroying",oG.KEY_LOADING="hlsKeyLoading",oG.KEY_LOADED="hlsKeyLoaded",oG.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",oG.BACK_BUFFER_REACHED="hlsBackBufferReached",oG.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",oG),tW=((oH={}).NETWORK_ERROR="networkError",oH.MEDIA_ERROR="mediaError",oH.KEY_SYSTEM_ERROR="keySystemError",oH.MUX_ERROR="muxError",oH.OTHER_ERROR="otherError",oH),tY=((oV={}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",oV.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",oV.KEY_SYSTEM_NO_SESSION="keySystemNoSession",oV.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",oV.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",oV.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",oV.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",oV.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",oV.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",oV.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",oV.MANIFEST_LOAD_ERROR="manifestLoadError",oV.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",oV.MANIFEST_PARSING_ERROR="manifestParsingError",oV.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",oV.LEVEL_EMPTY_ERROR="levelEmptyError",oV.LEVEL_LOAD_ERROR="levelLoadError",oV.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",oV.LEVEL_PARSING_ERROR="levelParsingError",oV.LEVEL_SWITCH_ERROR="levelSwitchError",oV.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",oV.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",oV.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",oV.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",oV.FRAG_LOAD_ERROR="fragLoadError",oV.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",oV.FRAG_DECRYPT_ERROR="fragDecryptError",oV.FRAG_PARSING_ERROR="fragParsingError",oV.FRAG_GAP="fragGap",oV.REMUX_ALLOC_ERROR="remuxAllocError",oV.KEY_LOAD_ERROR="keyLoadError",oV.KEY_LOAD_TIMEOUT="keyLoadTimeOut",oV.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",oV.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",oV.BUFFER_APPEND_ERROR="bufferAppendError",oV.BUFFER_APPENDING_ERROR="bufferAppendingError",oV.BUFFER_STALLED_ERROR="bufferStalledError",oV.BUFFER_FULL_ERROR="bufferFullError",oV.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",oV.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",oV.INTERNAL_EXCEPTION="internalException",oV.INTERNAL_ABORTED="aborted",oV.UNKNOWN="unknown",oV),tq=function(){},tj={trace:tq,debug:tq,log:tq,warn:tq,info:tq,error:tq},tz=tj,tX=tz,tQ=/^(\d+)x(\d+)$/,tZ=/(.+?)=(".*?"|.*?)(?:,|$)/g;class tJ{constructor(e){"string"==typeof e&&(e=tJ.parseAttrList(e)),t$(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(!this[e])return null;{let t=(this[e]||"0x").slice(2),i=new Uint8Array((t=(1&t.length?"0":"")+t).length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){let t=tQ.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;let i={};for(tZ.lastIndex=0;null!==(t=tZ.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),i[t[1].trim()]=e}return i}}class t0{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){let i=t.attr;for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){tX.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=t$(new tJ({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let e=new Date(this.attr["END-DATE"]);tG(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;let e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(tG(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&tG(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class t1{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var t2={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class t3{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[t2.AUDIO]:null,[t2.VIDEO]:null,[t2.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){let i;let r=e.split("@",2);i=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=tU.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class t4 extends t3{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new t1,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{let e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime||!tG(this.programDateTime))return null;let e=tG(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){let e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,r,a,s=!1){let{elementaryStreams:n}=this,o=n[e];if(!o){n[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:a,partial:s};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,a)}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[t2.AUDIO]=null,e[t2.VIDEO]=null,e[t2.AUDIOVIDEO]=null}}class t5 extends t3{constructor(e,t,i,r,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new t1,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;let s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class t8{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&tG(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function t9(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function t6(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}let t7="undefined"!=typeof self?self:void 0;var ie={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},it={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ii(e){switch(e){case it.FAIRPLAY:return ie.FAIRPLAY;case it.PLAYREADY:return ie.PLAYREADY;case it.WIDEVINE:return ie.WIDEVINE;case it.CLEARKEY:return ie.CLEARKEY}}var ir={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function ia(e){return e===ir.WIDEVINE?ie.WIDEVINE:e===ir.PLAYREADY?ie.PLAYREADY:e===ir.CENC||e===ir.CLEARKEY?ie.CLEARKEY:void 0}function is(e){switch(e){case ie.FAIRPLAY:return it.FAIRPLAY;case ie.PLAYREADY:return it.PLAYREADY;case ie.WIDEVINE:return it.WIDEVINE;case ie.CLEARKEY:return it.CLEARKEY}}function io(e){let{drmSystems:t,widevineLicenseUrl:i}=e,r=t?[ie.FAIRPLAY,ie.WIDEVINE,ie.PLAYREADY,ie.CLEARKEY].filter(e=>!!t[e]):[];return!r[ie.WIDEVINE]&&i&&r.push(ie.WIDEVINE),r}let il=null!=t7&&null!=(oK=t7.navigator)&&oK.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function id(e){let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=String.fromCharCode.apply(null,Array.from(t)),r=i.substring(i.indexOf("<"),i.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){let e=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(e){let t=t9(e).subarray(0,16);return!function(e){let t=function(e,t,i){let r=e[t];e[t]=e[i],e[i]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}function iu(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}let ih=(e,t)=>!!(t+10<=e.length)&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&!!(e[t+3]<255)&&!!(e[t+4]<255)&&!!(e[t+6]<128)&&!!(e[t+7]<128)&&!!(e[t+8]<128)&&!!(e[t+9]<128),ic=(e,t)=>!!(t+10<=e.length)&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&!!(e[t+3]<255)&&!!(e[t+4]<255)&&!!(e[t+6]<128)&&!!(e[t+7]<128)&&!!(e[t+8]<128)&&!!(e[t+9]<128),im=(e,t)=>{let i=t,r=0;for(;ih(e,t);)r+=10,r+=ip(e,t+6),ic(e,t+10)&&(r+=10),t+=r;if(r>0)return e.subarray(i,i+r)},ip=(e,t)=>{let i=0;return(127&e[t])<<21|(127&e[t+1])<<14|(127&e[t+2])<<7|127&e[t+3]},ig=(e,t)=>ih(e,t)&&ip(e,t+6)+10<=e.length-t,iv=e=>{let t=iy(e);for(let e=0;e<t.length;e++){let i=t[e];if(iE(i))return ik(i)}},iE=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,ib=e=>{let t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=ip(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},iy=e=>{let t=0,i=[];for(;ih(e,t);){let r=ip(e,t+6),a=(t+=10)+r;for(;t+8<a;){let r=ib(e.subarray(t)),a=iT(r);a&&i.push(a),t+=r.size+10}ic(e,t)&&(t+=10)}return i},iT=e=>"PRIV"===e.type?i_(e):"W"===e.type[0]?iS(e):iA(e),i_=e=>{if(e.size<2)return;let t=iR(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}},iA=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1,i=iR(e.data.subarray(t),!0);t+=i.length+1;let r=iR(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=iR(e.data.subarray(1));return{key:e.type,data:t}},iS=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1,i=iR(e.data.subarray(t),!0);t+=i.length+1;let r=iR(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=iR(e.data);return{key:e.type,data:t}},ik=e=>{if(8===e.data.byteLength){let t=new Uint8Array(e.data),i=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},iR=(e,t=!1)=>{let i,a;let s=function(){if(!navigator.userAgent.includes("PlayStation 4"))return r||void 0===self.TextDecoder||(r=new self.TextDecoder("utf-8")),r}();if(s){let i=s.decode(e);if(t){let e=i.indexOf("\0");return -1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}let n=e.length,o="",l=0;for(;l<n&&(0!==(i=e[l++])||!t);)if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:o+=String.fromCharCode((31&i)<<6|63&(a=e[l++]));break;case 14:o+=String.fromCharCode((15&i)<<12|(63&(a=e[l++]))<<6|(63&e[l++])<<0)}return o},iI={hexDump:function(e){let t="";for(let i=0;i<e.length;i++){let r=e[i].toString(16);r.length<2&&(r="0"+r),t+=r}return t}},iL=[].push,iw={video:1,audio:2,id3:3,text:4};function iD(e){return String.fromCharCode.apply(null,e)}function iC(e,t){let i=e[t]<<8|e[t+1];return i<0?65536+i:i}function ix(e,t){let i=iO(e,t);return i<0?0x100000000+i:i}function iM(e,t){let i=ix(e,t);return i*=0x100000000,i+=ix(e,t+4)}function iO(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function iN(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function iP(e,t){let i=[];if(!t.length)return i;let r=e.byteLength;for(let a=0;a<r;){let s=ix(e,a),n=iD(e.subarray(a+4,a+8)),o=s>1?a+s:r;if(n===t[0]){if(1===t.length)i.push(e.subarray(a+8,o));else{let r=iP(e.subarray(a+8,o),t.slice(1));r.length&&iL.apply(i,r)}}a=o}return i}function iU(e){let t=[],i=iP(e,["moov","trak"]);for(let e=0;e<i.length;e++){let r=i[e],a=iP(r,["tkhd"])[0];if(a){let e=a[0],i=ix(a,0===e?12:20),s=iP(r,["mdia","mdhd"])[0];if(s){e=s[0];let a=ix(s,0===e?12:20),n=iP(r,["mdia","hdlr"])[0];if(n){let e=iD(n.subarray(8,12)),s={soun:t2.AUDIO,vide:t2.VIDEO}[e];if(s){let e=function(e){let t=e.subarray(8),i=t.subarray(86),r=iD(t.subarray(4,8)),a=r,s="enca"===r||"encv"===r;if(s){let e=iP(t,[r])[0].subarray("enca"===r?28:78);iP(e,["sinf"]).forEach(e=>{let t=iP(e,["schm"])[0];if(t){let i=iD(t.subarray(4,8));if("cbcs"===i||"cenc"===i){let t=iP(e,["frma"])[0];t&&(a=iD(t))}}})}switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{let e=iP(i,["avcC"])[0];a+="."+iB(e[1])+iB(e[2])+iB(e[3]);break}case"mp4a":{let e=iP(t,[r])[0],i=iP(e.subarray(28),["esds"])[0];if(i&&i.length>12){let e=4;if(3!==i[e++])break;e=iF(i,e)+2;let t=i[e++];if(128&t&&(e+=2),64&t&&(e+=i[e++]),4!==i[e++])break;e=iF(i,e);let r=i[e++];if(64===r)a+="."+iB(r);else break;if(e+=12,5!==i[e++])break;e=iF(i,e);let s=i[e++],n=(248&s)>>3;31===n&&(n+=1+((7&s)<<3)+((224&i[e])>>5)),a+="."+n}break}case"hvc1":case"hev1":{let e=iP(i,["hvcC"])[0],t=e[1],r=["","A","B","C"][t>>6],s=ix(e,2),n=e[12],o=e.subarray(6,12);a+="."+r+(31&t),a+="."+s.toString(16).toUpperCase(),a+="."+((32&t)>>5?"H":"L")+n;let l="";for(let e=o.length;e--;){let t=o[e];(t||l)&&(l="."+t.toString(16).toUpperCase()+l)}a+=l;break}case"dvh1":case"dvhe":{let e=iP(i,["dvcC"])[0],t=e[2]>>1&127,r=e[2]<<5&32|e[3]>>3&31;a+="."+i$(t)+"."+i$(r);break}case"vp09":{let e=iP(i,["vpcC"])[0],t=e[4],r=e[5],s=e[6]>>4&15;a+="."+i$(t)+"."+i$(r)+"."+i$(s);break}case"av01":{let e=iP(i,["av1C"])[0],t=e[1]>>>5,r=31&e[1],s=e[2]>>>7?"H":"M",n=(64&e[2])>>6,o=(32&e[2])>>5,l=(16&e[2])>>4,d=(8&e[2])>>3,u=(4&e[2])>>2,h=3&e[2];a+="."+t+"."+i$(r)+s+"."+i$(2===t&&n?o?12:10:n?10:8)+"."+l+"."+d+u+h+"."+i$(1)+"."+i$(1)+"."+i$(1)+".0"}}return{codec:a,encrypted:s}}(iP(r,["mdia","minf","stbl","stsd"])[0]);t[i]={timescale:a,type:s},t[s]=tB({timescale:a,id:i},e)}}}}}return iP(e,["moov","mvex","trex"]).forEach(e=>{let i=t[ix(e,4)];i&&(i.default={duration:ix(e,12),flags:ix(e,20)})}),t}function iF(e,t){let i=t+5;for(;128&e[t++]&&t<i;);return t}function iB(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function i$(e){return(e<10?"0":"")+e}function iG(e){let t=iP(e,["schm"])[0];if(t){let i=iD(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return iP(e,["schi","tenc"])[0]}return null}function iH(e,t){let i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function iV(e,t){let i=[],r=t.samples,a=t.timescale,s=t.id,n=!1;return iP(r,["moof"]).map(o=>{let l=o.byteOffset-8;iP(o,["traf"]).map(o=>{let d=iP(o,["tfdt"]).map(e=>{let t=e[0],i=ix(e,4);return 1===t&&(i*=0x100000000,i+=ix(e,8)),i/a})[0];return void 0!==d&&(e=d),iP(o,["tfhd"]).map(d=>{let u=ix(d,4),h=0xffffff&ix(d,0),c=0,m=0,p=8;u===s&&((1&h)!=0&&(p+=8),(2&h)!=0&&(p+=4),(8&h)!=0&&(c=ix(d,p),p+=4),(16&h)!=0&&(m=ix(d,p),p+=4),(32&h)!=0&&(p+=4),"video"===t.type&&(n=function(e){if(!e)return!1;let t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),iP(o,["trun"]).map(s=>{let o=s[0],d=0xffffff&ix(s,0),u=0,h=(256&d)!=0,p=0,f=(512&d)!=0,g=0,E=(1024&d)!=0,b=(2048&d)!=0,y=0,T=ix(s,4),_=8;(1&d)!=0&&(u=ix(s,_),_+=4),(4&d)!=0&&(_+=4);let A=u+l;for(let l=0;l<T;l++){if(h?(p=ix(s,_),_+=4):p=c,f?(g=ix(s,_),_+=4):g=m,E&&(_+=4),b&&(y=0===o?ix(s,_):iO(s,_),_+=4),t.type===t2.VIDEO){let t=0;for(;t<g;){let s=ix(r,A);A+=4,function(e,t){if(!e)return 6==(31&t);{let e=t>>1&63;return 39===e||40===e}}(n,r[A])&&iK(r.subarray(A,A+s),n?2:1,e+y/a,i),A+=s,t+=s+4}}e+=p/a}}))})})}),i}function iK(e,t,i,r){let a;let s=iW(e);a=0+t;let n=0,o=0,l=0;for(;a<s.length;){n=0;do{if(a>=s.length)break;n+=l=s[a++]}while(255===l);o=0;do{if(a>=s.length)break;o+=l=s[a++]}while(255===l);let e=s.length-a,t=a;if(o<e)a+=o;else if(o>e){tX.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===n){if(181===s[t++]){let e=iC(s,t);if(t+=2,49===e){let e=ix(s,t);if(t+=4,0x47413934===e){let e=s[t++];if(3===e){let a=s[t++],o=31&a,l=64&a,d=l?2+3*o:0,u=new Uint8Array(d);if(l){u[0]=a;for(let e=1;e<d;e++)u[e]=s[t++]}r.push({type:e,payloadType:n,pts:i,bytes:u})}}}}}else if(5===n&&o>16){let e=[];for(let i=0;i<16;i++){let r=s[t++].toString(16);e.push(1==r.length?"0"+r:r),(3===i||5===i||7===i||9===i)&&e.push("-")}let a=o-16,l=new Uint8Array(a);for(let e=0;e<a;e++)l[e]=s[t++];r.push({payloadType:n,pts:i,uuid:e.join(""),userData:iR(l),userDataBytes:l})}}}function iW(e){let t=e.byteLength,i=[],r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return e;let a=t-i.length,s=new Uint8Array(a),n=0;for(r=0;r<a;n++,r++)n===i[0]&&(n++,i.shift()),s[r]=e[n];return s}let iY={};class iq{static clearKeyUriToKeyIdMap(){iY={}}constructor(e,t,i,r=[1],a=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=a,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case it.FAIRPLAY:case it.WIDEVINE:case it.PLAYREADY:case it.CLEARKEY:return -1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||tX.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);let t=function(e){let t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e);return new iq(this.method,this.uri,"identity",this.keyFormatVersions,t)}let t=function(e){let t=e.split(":"),i=null;if("data"===t[0]&&2===t.length){let e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){let t="base64"===r[0],a=r[1];t?(e.splice(-1,1),i=t9(a)):i=function(e){let t=t6(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(a)}}return i}(this.uri);if(t)switch(this.keyFormat){case it.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case it.PLAYREADY:{let e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,i){let r,a;if(16!==e.byteLength)throw RangeError("Invalid system id");r=new Uint8Array,a=new Uint8Array;let s=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(s.buffer).setUint32(0,i.byteLength,!1),function(e,...t){let i=t.length,r=8,a=i;for(;a--;)r+=t[a].byteLength;let s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),a=0,r=8;a<i;a++)s.set(t[a],r),r+=t[a].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,r,s,i||new Uint8Array)}(e,null,t),this.keyId=id(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){let t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e}}if(!this.keyId||16!==this.keyId.byteLength){let e=iY[this.uri];if(!e){let t=Object.keys(iY).length%Number.MAX_SAFE_INTEGER;new DataView((e=new Uint8Array(16)).buffer,12,4).setUint32(0,t),iY[this.uri]=e}this.keyId=e}return this}}let ij=/\{\$([a-zA-Z0-9-_]+)\}/g;function iz(e,t,i){if(null!==e.variableList||e.hasVariableRefs)for(let r=i.length;r--;){let a=i[r],s=t[a];s&&(t[a]=iX(e,s))}}function iX(e,t){if(null!==e.variableList||e.hasVariableRefs){let i=e.variableList;return t.replace(ij,t=>{let r=t.substring(2,t.length-1),a=null==i?void 0:i[r];return void 0===a?(e.playlistParsingError||(e.playlistParsingError=Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),t):a})}return t}function iQ(e,t,i){let r,a,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{let e=new self.URL(i).searchParams;if(e.has(r))a=e.get(r);else throw Error(`"${r}" does not match any query parameter in URI: "${i}"`)}catch(t){e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else r=t.NAME,a=t.VALUE;r in s?e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function iZ(e=!0){if("undefined"!=typeof self)return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}let iJ={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function i0(e,t,i=!0){return!e.split(",").some(e=>!i1(e,t,i))}function i1(e,t,i=!0){var r;let a=iZ(i);return null!=(r=null==a?void 0:a.isTypeSupported(i2(e,t)))&&r}function i2(e,t){return`${t}/mp4;codecs="${e}"`}function i3(e){if(e){let t=e.substring(0,4);return iJ.video[t]}return 2}function i4(e){return e.split(",").reduce((e,t)=>{let i=iJ.video[t];return i?(2*i+e)/(e?3:2):(iJ.audio[t]+e)/(e?2:1)},0)}let i5={},i8=/flac|opus/i;function i9(e,t=!0){return e.replace(i8,e=>(function(e,t=!0){if(i5[e])return i5[e];let i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let r=0;r<i.length;r++)if(i1(i[r],"audio",t))return i5[e]=i[r],i[r];return e})(e.toLowerCase(),t))}function i6(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}let i7=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,re=/#EXT-X-MEDIA:(.*)/g,rt=/^#EXT(?:INF|-X-TARGETDURATION):/m,ri=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),rr=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ra{static findGroup(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.id===t)return r}}static resolve(e,t){return tU.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return rt.test(e)}static parseMasterPlaylist(e,t){var i;let r;let a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ij.test(e)},s=[];for(i7.lastIndex=0;null!=(r=i7.exec(e));)if(r[1]){let e=new tJ(r[1]);iz(a,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);let n=iX(a,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:ra.resolve(n,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),function(e,t){let i=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{let r=i.filter(t=>(function(e,t){let i=iJ[t];return!!i&&!!i[e.slice(0,4)]})(t,e));r.length&&(t[`${e}Codec`]=r.join(","),i=i.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=i}(e.CODECS,o),null!=(i=o.unknownCodecs)&&i.length||s.push(o),a.levels.push(o)}else if(r[3]){let e=r[3],i=r[4];switch(e){case"SESSION-DATA":{let e=new tJ(i);iz(a,e,["DATA-ID","LANGUAGE","VALUE","URI"]);let t=e["DATA-ID"];t&&(null===a.sessionData&&(a.sessionData={}),a.sessionData[t]=e);break}case"SESSION-KEY":{let e=rs(i,t,a);e.encrypted&&e.isSupported()?(null===a.sessionKeys&&(a.sessionKeys=[]),a.sessionKeys.push(e)):tX.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":{let e=new tJ(i);iz(a,e,["NAME","VALUE","QUERYPARAM"]),iQ(a,e,t)}break;case"CONTENT-STEERING":{let e=new tJ(i);iz(a,e,["SERVER-URI","PATHWAY-ID"]),a.contentSteering={uri:ra.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":a.startTimeOffset=rn(i)}}let n=s.length>0&&s.length<a.levels.length;return a.levels=n?s:a.levels,0===a.levels.length&&(a.playlistParsingError=Error("no levels found in manifest")),a}static parseMasterPlaylistMedia(e,t,i){let r;let a={},s=i.levels,n={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]},o=0;for(re.lastIndex=0;null!==(r=re.exec(e));){let e=new tJ(r[1]),s=e.TYPE;if(s){let r=n[s],l=a[s]||[];a[s]=l,iz(i,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);let d=e.LANGUAGE,u=e["ASSOC-LANGUAGE"],h=e.CHANNELS,c=e.CHARACTERISTICS,m=e["INSTREAM-ID"],p={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||d||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:d,url:e.URI?ra.resolve(e.URI,t):""};if(u&&(p.assocLang=u),h&&(p.channels=h),c&&(p.characteristics=c),m&&(p.instreamId=m),null!=r&&r.length){let e=ra.findGroup(r,p.groupId)||r[0];ro(p,e,"audioCodec"),ro(p,e,"textCodec")}l.push(p)}}return a}static parseLevelPlaylist(e,t,i,r,a,s){let n,o,l;let d=new t8(t),u=d.fragments,h=null,c=0,m=0,p=0,f=0,g=null,E=new t4(r,t),b=-1,y=!1,T=null;for(ri.lastIndex=0,d.m3u8=e,d.hasVariableRefs=ij.test(e);null!==(n=ri.exec(e));){y&&(y=!1,(E=new t4(r,t)).start=p,E.sn=c,E.cc=f,E.level=i,h&&(E.initSegment=h,E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,T&&(E.setByteRange(T),T=null)));let e=n[1];if(e){E.duration=parseFloat(e);let t=(" "+n[2]).slice(1);E.title=t||null,E.tagList.push(t?["INF",e,t]:["INF",e])}else if(n[3]){if(tG(E.duration)){E.start=p,l&&ru(E,l,d),E.sn=c,E.level=i,E.cc=f,u.push(E);let e=(" "+n[3]).slice(1);E.relurl=iX(d,e),rl(E,g),g=E,p+=E.duration,c++,m=0,y=!0}}else if(n[4]){let e=(" "+n[4]).slice(1);g?E.setByteRange(e,g):E.setByteRange(e)}else if(n[5])E.rawProgramDateTime=(" "+n[5]).slice(1),E.tagList.push(["PROGRAM-DATE-TIME",E.rawProgramDateTime]),-1===b&&(b=u.length);else{if(!(n=n[0].match(rr))){tX.warn("No matches on slow regex match for level playlist!");continue}for(o=1;o<n.length&&void 0===n[o];o++);let e=(" "+n[o]).slice(1),a=(" "+n[o+1]).slice(1),p=n[o+2]?(" "+n[o+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":d.type=a.toUpperCase();break;case"MEDIA-SEQUENCE":c=d.startSN=parseInt(a);break;case"SKIP":{let e=new tJ(a);iz(d,e,["RECENTLY-REMOVED-DATERANGES"]);let t=e.decimalInteger("SKIPPED-SEGMENTS");if(tG(t)){d.skippedSegments=t;for(let e=t;e--;)u.unshift(null);c+=t}let i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(d.recentlyRemovedDateranges=i.split("	"));break}case"TARGETDURATION":d.targetduration=Math.max(parseInt(a),1);break;case"VERSION":d.version=parseInt(a);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(a||p)&&E.tagList.push(p?[a,p]:[a]);break;case"DISCONTINUITY":f++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([e]);break;case"BITRATE":E.tagList.push([e,a]);break;case"DATERANGE":{let e=new tJ(a);iz(d,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),iz(d,e,e.clientAttrs);let t=new t0(e,d.dateRanges[e.ID]);t.isValid||d.skippedSegments?d.dateRanges[t.id]=t:tX.warn(`Ignoring invalid DATERANGE tag: "${a}"`),E.tagList.push(["EXT-X-DATERANGE",a]);break}case"DEFINE":{let e=new tJ(a);iz(d,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?function(e,t,i){let r=t.IMPORT;if(i&&r in i){let t=e.variableList;t||(e.variableList=t={}),t[r]=i[r]}else e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}(d,e,s):iQ(d,e,t)}break;case"DISCONTINUITY-SEQUENCE":f=parseInt(a);break;case"KEY":{let e=rs(a,t,d);if(e.isSupported()){if("NONE"===e.method){l=void 0;break}l||(l={}),l[e.keyFormat]&&(l=t$({},l)),l[e.keyFormat]=e}else tX.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${a}"`);break}case"START":d.startTimeOffset=rn(a);break;case"MAP":{let e=new tJ(a);if(iz(d,e,["BYTERANGE","URI"]),E.duration){let a=new t4(r,t);rd(a,e,i,l),h=a,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{let t=E.byteRangeEndOffset;if(t){let e=E.byteRangeStartOffset;T=`${t-e}@${e}`}else T=null;rd(E,e,i,l),h=E,y=!0}break}case"SERVER-CONTROL":{let e=new tJ(a);d.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),d.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{let e=new tJ(a);d.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=d.partList;e||(e=d.partList=[]);let i=m>0?e[e.length-1]:void 0,r=m++,s=new tJ(a);iz(d,s,["BYTERANGE","URI"]);let n=new t5(s,E,t,r,i);e.push(n),E.duration+=n.duration;break}case"PRELOAD-HINT":{let e=new tJ(a);iz(d,e,["URI"]),d.preloadHint=e;break}case"RENDITION-REPORT":{let e=new tJ(a);iz(d,e,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(e);break}default:tX.warn(`line parsed but not handled: ${n}`)}}}g&&!g.relurl?(u.pop(),p-=g.duration,d.partList&&(d.fragmentHint=g)):d.partList&&(rl(E,g),E.cc=f,d.fragmentHint=E,l&&ru(E,l,d));let _=u.length,A=u[0],S=u[_-1];if((p+=d.skippedSegments*d.targetduration)>0&&_&&S){d.averagetargetduration=p/_;let e=S.sn;d.endSN="initSegment"!==e?e:0,d.live||(S.endList=!0),A&&(d.startCC=A.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(p+=d.fragmentHint.duration),d.totalduration=p,d.endCC=f,b>0&&function(e,t){let i=e[t];for(let r=t;r--;){let t=e[r];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(u,b),d}}function rs(e,t,i){var r,a;let s=new tJ(e);iz(i,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);let n=null!=(r=s.METHOD)?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),d=s.KEYFORMATVERSIONS,u=null!=(a=s.KEYFORMAT)?a:"identity";return o&&s.IV&&!l&&tX.error(`Invalid IV: ${s.IV}`),new iq(n,o?ra.resolve(o,t):"",u,(d||"1").split("/").map(Number).filter(Number.isFinite),l)}function rn(e){let t=new tJ(e).decimalFloatingPoint("TIME-OFFSET");return tG(t)?t:null}function ro(e,t,i){let r=t[i];r&&(e[i]=r)}function rl(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),tG(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function rd(e,t,i,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function ru(e,t,i){e.levelkeys=t;let{encryptedFragments:r}=i;(!r.length||r[r.length-1].levelkeys!==t)&&Object.keys(t).some(e=>t[e].isCommonEncryption)&&r.push(e)}var rh={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},rc={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function rm(e){let{type:t}=e;switch(t){case rh.AUDIO_TRACK:return rc.AUDIO;case rh.SUBTITLE_TRACK:return rc.SUBTITLE;default:return rc.MAIN}}function rp(e,t){let i=e.url;return(void 0===i||0===i.indexOf("data:"))&&(i=t.url),i}class rf{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.LEVEL_LOADING,this.onLevelLoading,this),e.on(tK.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(tK.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){let{hls:e}=this;e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.LEVEL_LOADING,this.onLevelLoading,this),e.off(tK.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(tK.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,r=t.loader,a=new(i||r)(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:rh.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(e,t){let{id:i,level:r,pathwayId:a,url:s,deliveryDirectives:n}=t;this.load({id:i,level:r,pathwayId:a,responseType:"text",type:rh.LEVEL,url:s,deliveryDirectives:n})}onAudioTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:rh.AUDIO_TRACK,url:a,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:rh.SUBTITLE_TRACK,url:a,deliveryDirectives:s})}load(e){var t;let i;let r=this.hls.config,a=this.getInternalLoader(e);if(a){let t=a.context;if(t&&t.url===e.url&&t.level===e.level){tX.trace("[playlist-loader]: playlist request ongoing");return}tX.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}if(i=e.type===rh.MANIFEST?r.manifestLoadPolicy.default:t$({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),tG(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===rh.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===rh.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===rh.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){let e=t.partTarget,r=t.targetduration;if(e&&r){let t=1e3*Math.max(3*e,.8*r);i=t$({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}let s=i.errorRetry||i.timeoutRetry||{},n={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0};a.load(e,n,{onSuccess:(e,t,i,r)=>{let a=this.getInternalLoader(i);this.resetInternalLoader(i.type);let s=e.data;if(0!==s.indexOf("#EXTM3U")){this.handleManifestParsingError(e,i,Error("no EXTM3U delimiter"),r||null,t);return}t.parsing.start=performance.now(),ra.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,i,r||null,a):this.handleMasterPlaylist(e,t,i,r)},onError:(e,t,i,r)=>{this.handleNetworkError(t,i,!1,e,r)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}})}handleMasterPlaylist(e,t,i,r){let a=this.hls,s=e.data,n=rp(e,i),o=ra.parseMasterPlaylist(s,n);if(o.playlistParsingError){this.handleManifestParsingError(e,i,o.playlistParsingError,r,t);return}let{contentSteering:l,levels:d,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m}=o;this.variableList=m;let{AUDIO:p=[],SUBTITLES:f,"CLOSED-CAPTIONS":g}=ra.parseMasterPlaylistMedia(s,n,o);p.length&&!p.some(e=>!e.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(tX.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new tJ({}),bitrate:0,url:""})),a.trigger(tK.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:f,captions:g,contentSteering:l,url:n,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m})}handleTrackOrLevelPlaylist(e,t,i,r,a){let s=this.hls,{id:n,level:o,type:l}=i,d=rp(e,i),u=tG(o)?o:tG(n)?n:0,h=rm(i),c=ra.parseLevelPlaylist(e.data,d,u,h,0,this.variableList);if(l===rh.MANIFEST){let e={attrs:new tJ({}),bitrate:0,details:c,name:"",url:d};s.trigger(tK.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=c,this.handlePlaylistLoaded(c,e,t,i,r,a)}handleManifestParsingError(e,t,i,r,a){this.hls.trigger(tK.ERROR,{type:tW.NETWORK_ERROR,details:tY.MANIFEST_PARSING_ERROR,fatal:t.type===rh.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,i=!1,r,a){let s=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===rh.LEVEL?s+=`: ${e.level} id: ${e.id}`:(e.type===rh.AUDIO_TRACK||e.type===rh.SUBTITLE_TRACK)&&(s+=` id: ${e.id} group-id: "${e.groupId}"`);let n=Error(s);tX.warn(`[playlist-loader]: ${s}`);let o=tY.UNKNOWN,l=!1,d=this.getInternalLoader(e);switch(e.type){case rh.MANIFEST:o=i?tY.MANIFEST_LOAD_TIMEOUT:tY.MANIFEST_LOAD_ERROR,l=!0;break;case rh.LEVEL:o=i?tY.LEVEL_LOAD_TIMEOUT:tY.LEVEL_LOAD_ERROR,l=!1;break;case rh.AUDIO_TRACK:o=i?tY.AUDIO_TRACK_LOAD_TIMEOUT:tY.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case rh.SUBTITLE_TRACK:o=i?tY.SUBTITLE_TRACK_LOAD_TIMEOUT:tY.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);let u={type:tW.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:d,context:e,error:n,networkDetails:t,stats:a};if(r){let i=(null==t?void 0:t.url)||e.url;u.response=tB({url:i,data:void 0},r)}this.hls.trigger(tK.ERROR,u)}handlePlaylistLoaded(e,t,i,r,a,s){let n=this.hls,{type:o,level:l,id:d,groupId:u,deliveryDirectives:h}=r,c=rp(t,r),m=rm(r),p="number"==typeof r.level&&m===rc.MAIN?l:void 0;if(!e.fragments.length){let e=Error("No Segments found in Playlist");n.trigger(tK.ERROR,{type:tW.NETWORK_ERROR,details:tY.LEVEL_EMPTY_ERROR,fatal:!1,url:c,error:e,reason:e.message,response:t,context:r,level:p,parent:m,networkDetails:a,stats:i});return}e.targetduration||(e.playlistParsingError=Error("Missing Target Duration"));let f=e.playlistParsingError;if(f){n.trigger(tK.ERROR,{type:tW.NETWORK_ERROR,details:tY.LEVEL_PARSING_ERROR,fatal:!1,url:c,error:f,reason:f.message,response:t,context:r,level:p,parent:m,networkDetails:a,stats:i});return}switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),(!s.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case rh.MANIFEST:case rh.LEVEL:n.trigger(tK.LEVEL_LOADED,{details:e,level:p||0,id:d||0,stats:i,networkDetails:a,deliveryDirectives:h});break;case rh.AUDIO_TRACK:n.trigger(tK.AUDIO_TRACK_LOADED,{details:e,id:d||0,groupId:u||"",stats:i,networkDetails:a,deliveryDirectives:h});break;case rh.SUBTITLE_TRACK:n.trigger(tK.SUBTITLE_TRACK_LOADED,{details:e,id:d||0,groupId:u||"",stats:i,networkDetails:a,deliveryDirectives:h})}}}function rg(e,t){let i;try{i=new Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function rv(e,t){let i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw Error(`addCue is failed for: ${t}`)}catch(i){tX.debug(`[texttrack-utils]: ${i}`);try{let i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(e){tX.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===i&&(e.mode=i)}function rE(e){let t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);"disabled"===t&&(e.mode=t)}function rb(e,t,i,r){let a=e.mode;if("disabled"===a&&(e.mode="hidden"),e.cues&&e.cues.length>0){let a=function(e,t,i){let r=[],a=function(e,t){if(t<e[0].startTime)return 0;let i=e.length-1;if(t>e[i].endTime)return -1;let r=0,a=i;for(;r<=a;){let s=Math.floor((a+r)/2);if(t<e[s].startTime)a=s-1;else{if(!(t>e[s].startTime)||!(r<i))return s;r=s+1}}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(a>-1)for(let s=a,n=e.length;s<n;s++){let a=e[s];if(a.startTime>=t&&a.endTime<=i)r.push(a);else if(a.startTime>i)break}return r}(e.cues,t,i);for(let t=0;t<a.length;t++)(!r||r(a[t]))&&e.removeCue(a[t])}"disabled"===a&&(e.mode=a)}function ry(e){let t=[];for(let i=0;i<e.length;i++){let r=e[i];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&t.push(e[i])}return t}var rT={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};function r_(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function rA(e,t,i,r,a){let s=new e(t,i,"");try{s.value=r,a&&(s.type=a)}catch(n){s=new e(t,i,JSON.stringify(a?tB({type:a},r):r))}return s}let rS=(()=>{let e=r_();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function rk(e,t){return e.getTime()/1e3-t}class rR{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tK.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tK.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(rE(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if("metadata"===i.kind&&"id3"===i.label)return rg(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;let{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;let{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let s=r_();if(s)for(let e=0;e<a.length;e++){let t=a[e].type;if(t===rT.emsg&&!i||!r)continue;let n=iy(a[e].data);if(n){let i=a[e].pts,r=i+a[e].duration;r>rS&&(r=rS),r-i<=0&&(r=i+.25);for(let e=0;e<n.length;e++){let a=n[e];if(!iE(a)){this.updateId3CueEnds(i,t);let e=rA(s,i,r,a,t);e&&this.id3Track.addCue(e)}}}}}updateId3CueEnds(e,t){var i;let r=null==(i=this.id3Track)?void 0:i.cues;if(r)for(let i=r.length;i--;){let a=r[i];a.type===t&&a.startTime<e&&a.endTime===rS&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){let{id3Track:a,hls:s}=this;if(!s)return;let{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}=s;if(a&&(n||o)){let e;rb(a,t,i,"audio"===r?e=>e.type===rT.audioId3&&o:"video"===r?e=>e.type===rT.emsg&&n:e=>e.type===rT.audioId3&&o||e.type===rT.emsg&&n)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;let{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:a}=t,s=Object.keys(a);if(r){let e=Object.keys(i).filter(e=>!s.includes(e));for(let t=e.length;t--;){let a=e[t];Object.keys(i[a].cues).forEach(e=>{r.removeCue(i[a].cues[e])}),delete i[a]}}let n=t.fragments[t.fragments.length-1];if(0===s.length||!tG(null==n?void 0:n.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));let o=n.programDateTime/1e3-n.start,l=r_();for(let e=0;e<s.length;e++){let t=s[e],r=a[t],n=rk(r.startDate,o),u=i[t],h=(null==u?void 0:u.cues)||{},c=(null==u?void 0:u.durationKnown)||!1,m=rS,p=r.endDate;if(p)m=rk(p,o),c=!0;else if(r.endOnNext&&!c){let e=s.reduce((e,t)=>{if(t!==r.id){let i=a[t];if(i.class===r.class&&i.startDate>r.startDate&&(!e||r.startDate<e.startDate))return i}return e},null);e&&(m=rk(e.startDate,o),c=!0)}let f=Object.keys(r.attr);for(let e=0;e<f.length;e++){var d;let i=f[e];if(!("ID"!==i&&"CLASS"!==i&&"START-DATE"!==i&&"DURATION"!==i&&"END-DATE"!==i&&"END-ON-NEXT"!==i))continue;let a=h[i];if(a)c&&!u.durationKnown&&(a.endTime=m);else if(l){let e=r.attr[i];("SCTE35-OUT"===i||"SCTE35-IN"===i)&&(d=e,e=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);let a=rA(l,n,m,{key:i,data:e},rT.dateRange);a&&(a.id=t,this.id3Track.addCue(a),h[i]=a)}}i[t]={cues:h,dateRange:r,durationKnown:c}}}}class rI{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){let{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let{levelDetails:e}=this;if(null===e)return null;let{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:s,lowLatencyMode:n}=this.config,o=this.hls.userConfig,l=n&&i||t;return(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==a?a:s*r),l+Math.min(1*this.stallCount,r)}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;let r=i.edge,a=e-t-this.edgeStalled;return Math.min(Math.max(r-i.totalduration,a),r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration))}get drift(){let{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){let{levelDetails:e}=this;if(null===e)return 0;let t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e,levelDetails:t}=this;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(tK.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(tK.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(tK.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(tK.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===tY.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&tX.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){let{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;let i=this.computeLatency();if(null===i)return;this._latency=i;let{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||1===a||!t.live)return;let s=this.targetLatency;if(null===s)return;let n=i-s;if(n<Math.min(this.maxLatency,s+t.targetduration)&&n>.05&&this.forwardBufferLength>1){let t=Math.min(2,Math.max(1,a)),i=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,i))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){let{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}let rL=["NONE","TYPE-0","TYPE-1",null],rw=["SDR","PQ","HLG"];var rD={No:"",Yes:"YES",v2:"v2"};function rC(e){let{canSkipUntil:t,canSkipDateRanges:i,age:r}=e;return t&&r<t/2?i?rD.v2:rD.Yes:rD.No}class rx{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){let t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class rM{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return rO(this._audioGroups,e)}hasSubtitleGroup(e){return rO(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function rO(e,t){return!!t&&!!e&&-1!==e.indexOf(t)}function rN(e,t){let i=t.startPTS;if(tG(i)){let r,a=0;t.sn>e.sn?(a=i-e.start,r=e):(a=e.start-i,r=t),r.duration!==a&&(r.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function rP(e,t,i,r,a,s){let n;r-i<=0&&(tX.warn("Fragment should have a positive duration",t),r=i+t.duration,s=a+t.duration);let o=i,l=r,d=t.startPTS,u=t.endPTS;if(tG(d)){let e=Math.abs(d-i);tG(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(i,d),i=Math.min(i,d),a=Math.min(a,t.startDTS),l=Math.min(r,u),r=Math.max(r,u),s=Math.max(s,t.endDTS)}let h=i-t.start;0!==t.start&&(t.start=i),t.duration=r-t.start,t.startPTS=i,t.maxStartPTS=o,t.startDTS=a,t.endPTS=r,t.minEndPTS=l,t.endDTS=s;let c=t.sn;if(!e||c<e.startSN||c>e.endSN)return 0;let m=c-e.startSN,p=e.fragments;for(p[m]=t,n=m;n>0;n--)rN(p[n],p[n-1]);for(n=m;n<p.length-1;n++)rN(p[n],p[n+1]);return e.fragmentHint&&rN(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,h}function rU(e,t){let i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;!(i<0)&&!(i>=r.length)&&rF(t,r[i].start)}function rF(e,t){if(t){let i=e.fragments;for(let r=e.skippedSegments;r<i.length;r++)i[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function rB(e,t,i){var r;return null!=e&&e.details?r$(null==(r=e.details)?void 0:r.partList,t,i):null}function r$(e,t,i){if(e)for(let r=e.length;r--;){let a=e[r];if(a.index===i&&a.fragment.sn===t)return a}return null}function rG(e){e.forEach((e,t)=>{let{details:i}=e;null!=i&&i.fragments&&i.fragments.forEach(e=>{e.level=t})})}function rH(e){switch(e.details){case tY.FRAG_LOAD_TIMEOUT:case tY.KEY_LOAD_TIMEOUT:case tY.LEVEL_LOAD_TIMEOUT:case tY.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function rV(e,t){let i=rH(t);return e.default[`${i?"timeout":"error"}Retry`]}function rK(e,t){return Math.min(("linear"===e.backoff?1:Math.pow(2,t))*e.retryDelayMs,e.maxRetryDelayMs)}function rW(e){return tB(tB({},e),{errorRetry:null,timeoutRetry:null})}function rY(e,t,i,r){var a;if(!e)return!1;let s=null==r?void 0:r.code,n=t<e.maxNumRetry&&(0===(a=s)&&!1===navigator.onLine||!!a&&(a<400||a>499)||!!i);return e.shouldRetry?e.shouldRetry(e,t,i,r,n):n}let rq=function(e,t){let i=0,r=e.length-1,a=null,s=null;for(;i<=r;){let n=t(s=e[a=(i+r)/2|0]);if(n>0)i=a+1;else{if(!(n<0))return s;r=a-1}}return null};function rj(e,t,i=0,r=0,a=.005){let s=null;if(e){s=t[e.sn-t[0].sn+1]||null;let r=e.endDTS-i;r>0&&r<15e-7&&(i+=15e-7)}else 0===i&&0===t[0].start&&(s=t[0]);if(s&&((!e||e.level===s.level)&&0===rz(i,r,s)||function(e,t,i){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){let r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),i);return e.start<=r}return!1}(s,e,Math.min(a,r))))return s;let n=rq(t,rz.bind(null,i,r));return n&&(n!==e||!s)?n:s}function rz(e=0,t=0,i){if(i.start<=e&&i.start+i.duration>e)return 0;let r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}var rX={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},rQ={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class rZ{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=tX.log.bind(tX,`${t}:`),this.warn=tX.warn.bind(tX,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){let r=null==t?void 0:t.renditionReports;if(r){let a=-1;for(let i=0;i<r.length;i++){let s;let n=r[i];try{s=new self.URL(n.URI,t.url).href}catch(e){tX.warn(`Could not construct new URL for Rendition Report: ${e}`),s=n.URI||""}if(s===e){a=i;break}s===e.substring(0,s.length)&&(a=i)}if(-1!==a){let e=r[a],s=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn),n=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){let e=Math.min(t.age-t.partTarget,t.targetduration);n>=0&&e>t.partTarget&&(n+=1)}return new rx(s,n>=0?n:void 0,i&&rC(i))}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return -1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){let{details:r,stats:a}=t,s=self.performance.now(),n=a.loading.first?Math.max(0,s-a.loading.first):0;if(r.advancedDateTime=Date.now()-n,r.live||null!=i&&i.live){let n,o,l;if(r.reloaded(i),i&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),i&&r.fragments.length>0&&function(e,t){let i,r=null,a=e.fragments;for(let e=a.length-1;e>=0;e--){let t=a[e].initSegment;if(t){r=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,i){let r=t.skippedSegments,a=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,n=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let e=a;e<=s;e++){let a=l[n+e],s=o[e];r&&!s&&e<r&&(s=t.fragments[e]=a),a&&s&&i(a,s,e,o)}}(e,t,(e,a,s,n)=>{if(t.skippedSegments&&a.cc!==e.cc){let t=e.cc-a.cc;for(let e=s;e<n.length;e++)n[e].cc+=t}tG(e.startPTS)&&tG(e.endPTS)&&(a.start=a.startPTS=e.startPTS,a.startDTS=e.startDTS,a.maxStartPTS=e.maxStartPTS,a.endPTS=e.endPTS,a.endDTS=e.endDTS,a.minEndPTS=e.minEndPTS,a.duration=e.endPTS-e.startPTS,a.duration&&(i=a),t.PTSKnown=t.alignedSliding=!0),a.elementaryStreams=e.elementaryStreams,a.loader=e.loader,a.stats=e.stats,e.initSegment&&(a.initSegment=e.initSegment,r=e.initSegment)});let s=t.fragments;if(r&&(t.fragmentHint?s.concat(t.fragmentHint):s).forEach(e=>{var t;e&&(!e.initSegment||e.initSegment.relurl===(null==(t=r)?void 0:t.relurl))&&(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=s.some(e=>!e),t.deltaUpdateFailed){tX.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)s.shift();t.startSN=s[0].sn}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){let r=t$({},e);return i&&i.forEach(e=>{delete r[e]}),Object.keys(t).forEach(e=>{let i=new t0(t[e].attr,r[e]);i.isValid?r[e]=i:tX.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)}),r}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));t.startCC=t.fragments[0].cc,t.endCC=s[s.length-1].cc}(function(e,t,i){if(e&&t){let r=0;for(let a=0,s=e.length;a<=s;a++){let s=e[a],n=t[a+r];s&&n&&s.index===n.index&&s.fragment.sn===n.fragment.sn?i(s,n):r--}}})(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?rP(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):rU(e,t),s.length&&(t.totalduration=t.edge-s[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;let n=t.advancedDateTime;if(t.advanced&&n){let e=t.edge;t.driftStart||(t.driftStartTime=n,t.driftStart=e),t.driftEndTime=n,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}(i,r),!this.canLoad||!r.live)return;if(r.canBlockReload&&r.endSN&&r.advanced){let e=this.hls.config.lowLatencyMode,a=r.lastPartSn,s=r.endSN,d=r.lastPartIndex,u=a===s;-1!==d?(o=u?s+1:a,l=u?e?0:d:d+1):o=s+1;let h=r.age,c=Math.min(h+r.ageHeader-r.partTarget,1.5*r.targetduration);if(c>0){if(i&&c>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${c} with playlist age: ${r.age}`),c=0;else{let e=Math.floor(c/r.targetduration);o+=e,void 0!==l&&(l+=Math.round(c%r.targetduration/r.partTarget)),this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${c} skip sn ${e} to part ${l}`)}r.tuneInGoal=c}if(n=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l),e||!u){this.loadPlaylist(n);return}}else(r.canBlockReload||r.canSkipUntil)&&(n=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l));let d=this.hls.mainForwardBufferInfo,u=d?d.end-d.len:0,h=(r.edge-u)*1e3,c=function(e,t=1/0){let i=1e3*e.targetduration;if(e.updated){let r=e.fragments;if(r.length&&4*i>t){let e=1e3*r[r.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}(r,h);r.updated&&s>this.requestScheduled+c&&(this.requestScheduled=a.loading.start),void 0!==o&&r.canBlockReload?this.requestScheduled=a.loading.first+c-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+c<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=c);let m=this.requestScheduled-s;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(n),m)}else this.clearTimer()}getDeliveryDirectives(e,t,i,r){let a=rC(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,a=rD.No),new rx(i,r,a)}checkRetry(e){let t=e.details,i=rH(e),r=e.errorAction,{action:a,retryCount:s=0,retryConfig:n}=r||{},o=!!r&&!!n&&(a===rX.RetryRequest||!r.resolved&&a===rX.SendAlternateToPenaltyBox);if(o){var l;if(this.requestScheduled=-1,s>=n.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${n.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let e=rK(n,s);this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${s+1}/${n.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,r.resolved=!0}return o}}class rJ{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class r0{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new rJ(e),this.fast_=new rJ(t),this.defaultTTFB_=r,this.ttfb_=new rJ(e)}update(e,t){let{slow_:i,fast_:r,ttfb_:a}=this;i.halfLife!==e&&(this.slow_=new rJ(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new rJ(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new rJ(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){let i=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){let t=Math.sqrt(2)*Math.exp(-Math.pow(e/1e3,2)/2);this.ttfb_.sample(t,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}let r1={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},r2={};function r3(e,t){tX.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function r4(e,t,i){if("attrs"in e){let i=t.indexOf(e);if(-1!==i)return i}for(let r=0;r<t.length;r++)if(r5(e,t[r],i))return r;return -1}function r5(e,t,i){let{groupId:r,name:a,lang:s,assocLang:n,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===a||t.name===a)&&(void 0===s||t.lang===s)&&(void 0===s||t.assocLang===n)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){let i=e.split(","),r=t.split(",");return i.length===r.length&&!i.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===i||i(e,t))}function r8(e,t){let{audioCodec:i,channels:r}=e;return(void 0===i||(t.audioCodec||"").substring(0,4)===i.substring(0,4))&&(void 0===r||r===(t.channels||"2"))}function r9(e,t,i){for(let r=t;r>-1;r--)if(i(e[r]))return r;for(let r=t+1;r<e.length;r++)if(i(e[r]))return r;return -1}class r6{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var r7={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class ae{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(tK.BUFFER_APPENDED,this.onBufferAppended,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tK.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.BUFFER_APPENDED,this.onBufferAppended,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tK.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let t=i.length;t--;){let r=i[t];if(!r)break;let a=r.end;if(r.start<=e&&null!==a&&e<=a)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){let{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){let s=i[r[a]];if((null==s?void 0:s.body.type)===t&&s.buffered){let t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,r){this.timeRanges&&(this.timeRanges[e]=t);let a=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{let s=this.fragments[r];if(!s||a>=s.body.sn)return;if(!s.buffered&&!s.loaded){s.body.type===i&&this.removeFragment(s.body);return}let n=s.range[e];n&&n.time.some(e=>{let i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(s.body),i})})}detectPartialFragments(e){let t=this.timeRanges,{frag:i,part:r}=e;if(!t||"initSegment"===i.sn)return;let a=ai(i),s=this.fragments[a];if(!s||s.buffered&&i.gap)return;let n=!i.relurl;Object.keys(t).forEach(e=>{let a=i.elementaryStreams[e];if(!a)return;let o=t[e],l=n||!0===a.partial;s.range[e]=this.getBufferedTimes(i,r,l,o)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),at(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter(t=>t.fragment.sn>=e))}fragBuffered(e,t){let i=ai(e),r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){let a={time:[],partial:i},s=e.start,n=e.end,o=e.minEndPTS||n,l=e.maxStartPTS||s;for(let e=0;e<r.length;e++){let t=r.start(e)-this.bufferPadding,i=r.end(e)+this.bufferPadding;if(l>=t&&o<=i){a.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(n,r.end(e))});break}if(s<i&&n>t){let t=Math.max(s,r.start(e)),i=Math.min(n,r.end(e));i>t&&(a.partial=!0,a.time.push({startPTS:t,endPTS:i}))}else if(n<=t)break}return a}getPartialFragment(e){let t,i,r,a=null,s=0,{bufferPadding:n,fragments:o}=this;return Object.keys(o).forEach(l=>{let d=o[l];d&&at(d)&&(i=d.body.start-n,r=d.body.end+n,e>=i&&e<=r&&s<=(t=Math.min(e-i,r-e))&&(a=d.body,s=t))}),a}isEndListAppended(e){let t=this.endListFragments[e];return void 0!==t&&(t.buffered||at(t))}getState(e){let t=ai(e),i=this.fragments[t];return i?i.buffered?at(i)?r7.PARTIAL:r7.OK:r7.APPENDING:r7.NOT_LOADED}isTimeBuffered(e,t,i){let r,a;for(let s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,a=i.end(s)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)break}return!1}onFragLoaded(e,t){let{frag:i,part:r}=t;if("initSegment"===i.sn||i.bitrateTest)return;let a=ai(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r?null:t,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:r,timeRanges:a}=t;if("initSegment"===i.sn)return;let s=i.type;if(r){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(r)}this.timeRanges=a,Object.keys(a).forEach(e=>{let t=a[e];this.detectEvictedFragments(e,t,s,r)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=ai(e);return!!this.fragments[t]}hasParts(e){var t;return!!(null!=(t=this.activePartLists[e])&&t.length)}removeFragmentsInRange(e,t,i,r,a){(!r||this.hasGaps)&&Object.keys(this.fragments).forEach(s=>{let n=this.fragments[s];if(!n)return;let o=n.body;o.type===i&&(!r||o.gap)&&o.start<t&&o.end>e&&(n.buffered||a)&&this.removeFragment(o)})}removeFragment(e){let t=ai(e);e.stats.loaded=0,e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let t=e.sn;this.activePartLists[e.type]=i.filter(e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function at(e){var t,i,r;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(r=e.range.audiovideo)?void 0:r.partial))}function ai(e){return`${e.type}_${e.level}_${e.sn}`}let ar={length:0,start:()=>0,end:()=>0};class aa{static isBuffered(e,t){try{if(e){let i=aa.getBuffered(e);for(let e=0;e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,i){try{if(e){let r;let a=aa.getBuffered(e),s=[];for(r=0;r<a.length;r++)s.push({start:a.start(r),end:a.end(r)});return this.bufferedInfo(s,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){let r;t=Math.max(0,t),e.sort(function(e,t){let i=e.start-t.start;return i||t.end-e.end});let a=[];if(i)for(let t=0;t<e.length;t++){let r=a.length;if(r){let s=a[r-1].end;e[t].start-s<i?e[t].end>s&&(a[r-1].end=e[t].end):a.push(e[t])}else a.push(e[t])}else a=e;let s=0,n=t,o=t;for(let e=0;e<a.length;e++){let l=a[e].start,d=a[e].end;if(t+i>=l&&t<d)n=l,s=(o=d)-t;else if(t+i<l){r=l;break}}return{len:s,start:n||0,end:o||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(e){return tX.log("failed to get media.buffered",e),ar}}}class as{constructor(e,t,i,r=0,a=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=an(),this.buffering={audio:an(),video:an(),audiovideo:an()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=a,this.partial=s}}function an(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ao(e,t){for(let r=0,a=e.length;r<a;r++){var i;if((null==(i=e[r])?void 0:i.cc)===t)return e[r]}return null}function al(e,t){if(e){let i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function ad(e,t){let i=t.fragments;for(let t=0,r=i.length;t<r;t++)al(i[t],e);t.fragmentHint&&al(t.fragmentHint,e),t.alignedSliding=!0}function au(e,t){let i,r;if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;let a=e.fragments,s=t.fragments;if(!a.length||!s.length)return;let n=Math.min(t.endCC,e.endCC);t.startCC<n&&e.startCC<n&&(i=ao(s,n),r=ao(a,n)),i&&r||(r=ao(a,(i=s[Math.floor(s.length/2)]).cc)||a[Math.floor(a.length/2)]);let o=i.programDateTime,l=r.programDateTime;o&&l&&ad((l-o)/1e3-(r.start-i.start),e)}class ah{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new ap({type:tW.NETWORK_ERROR,details:tY.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();let r=this.config,a=r.fLoader,s=r.loader;return new Promise((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0])){o(am(e));return}e.gap=!1}let l=this.loader=e.loader=a?new a(r):new s(r),d=ac(e),u=rW(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:131072};e.stats=l.stats,l.load(d,h,{onSuccess:(t,i,r,a)=>{this.resetLoader(e,l);let s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),n({frag:e,part:null,payload:s,networkDetails:a})},onError:(t,r,a,s)=>{this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:tB({url:i,data:void 0},t),error:Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:a,stats:s}))},onAbort:(t,i,r)=>{this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.INTERNAL_ABORTED,fatal:!1,frag:e,error:Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,i,r)=>{this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:t}))},onProgress:(i,r,a,s)=>{t&&t({frag:e,part:null,payload:a,networkDetails:s})}})})}loadPart(e,t,i){this.abort();let r=this.config,a=r.fLoader,s=r.loader;return new Promise((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){o(am(e,t));return}let l=this.loader=e.loader=a?new a(r):new s(r),d=ac(e,t),u=rW(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:131072};t.stats=l.stats,l.load(d,h,{onSuccess:(r,a,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);let d={frag:e,part:t,payload:r.data,networkDetails:o};i(d),n(d)},onError:(i,r,a,s)=>{this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:tB({url:d.url,data:void 0},i),error:Error(`HTTP Error ${i.code} ${i.text}`),networkDetails:a,stats:s}))},onAbort:(i,r,a)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:Error("Aborted"),networkDetails:a,stats:i}))},onTimeout:(i,r,a)=>{this.resetLoader(e,l),o(new ap({type:tW.NETWORK_ERROR,details:tY.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:Error(`Timeout after ${h.timeout}ms`),networkDetails:a,stats:i}))}})})}updateStatsFromPart(e,t){let i=e.stats,r=t.stats,a=r.total;if(i.loaded+=r.loaded,a){let r=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/a),r),n=(r-s)*Math.round(i.loaded/s);i.total=i.loaded+n}else i.total=Math.max(i.loaded,i.total);let s=i.loading,n=r.loading;s.start?s.first+=n.first-n.start:(s.start=n.start,s.first=n.first),s.end=n.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ac(e,t=null){let i=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},a=i.byteRangeStartOffset,s=i.byteRangeEndOffset;if(tG(a)&&tG(s)){var n;let t=a,i=s;if("initSegment"===e.sn&&(null==(n=e.decryptdata)?void 0:n.method)==="AES-128"){let e=s-a;e%16&&(i=s+(16-e%16)),0!==a&&(r.resetIV=!0,t=a-16)}r.rangeStart=t,r.rangeEnd=i}return r}function am(e,t){let i=Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:tW.MEDIA_ERROR,details:tY.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new ap(r)}class ap extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class af{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class ag{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class av{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let e=0;e<4;e++)i[e]=t.getUint32(4*e);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],a=i[1],s=i[2],n=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],h=o[3],c=new Uint32Array(256),m=0,p=0,f=0;for(f=0;f<256;f++)f<128?c[f]=f<<1:c[f]=f<<1^283;for(f=0;f<256;f++){let i=p^p<<1^p<<2^p<<3^p<<4;i=i>>>8^255&i^99,e[m]=i,t[i]=m;let o=c[m],f=c[o],g=c[f],E=257*c[i]^0x1010100*i;r[m]=E<<24|E>>>8,a[m]=E<<16|E>>>16,s[m]=E<<8|E>>>24,n[m]=E,E=0x1010101*g^65537*f^257*o^0x1010100*m,l[i]=E<<24|E>>>8,d[i]=E<<16|E>>>16,u[i]=E<<8|E>>>24,h[i]=E,m?(m=o^c[c[c[g^o]]],p^=c[c[p]]):m=p=1}}expandKey(e){let t,i,r,a;let s=this.uint8ArrayToUint32Array_(e),n=!0,o=0;for(;o<s.length&&n;)n=s[o]===this.key[o],o++;if(n)return;this.key=s;let l=this.keySize=s.length;if(4!==l&&6!==l&&8!==l)throw Error("Invalid aes key size="+l);let d=this.ksRows=(l+6+1)*4,u=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),c=this.sBox,m=this.rcon,p=this.invSubMix,f=p[0],g=p[1],E=p[2],b=p[3];for(t=0;t<d;t++){if(t<l){r=u[t]=s[t];continue}a=r,t%l==0?a=(c[(a=a<<8|a>>>24)>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a])^m[t/l|0]<<24:l>6&&t%l==4&&(a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a]),u[t]=r=(u[t-l]^a)>>>0}for(i=0;i<d;i++)t=d-i,a=3&i?u[t]:u[t-4],i<4||t<=4?h[i]=a:h[i]=f[c[a>>>24]]^g[c[a>>>16&255]]^E[c[a>>>8&255]]^b[c[255&a]],h[i]=h[i]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(0xff0000&e)>>8|e>>>24}decrypt(e,t,i){let r,a,s,n,o,l,d,u,h,c,m,p,f,g;let E=this.keySize+6,b=this.invKeySchedule,y=this.invSBox,T=this.invSubMix,_=T[0],A=T[1],S=T[2],k=T[3],R=this.uint8ArrayToUint32Array_(i),I=R[0],L=R[1],w=R[2],D=R[3],C=new Int32Array(e),x=new Int32Array(C.length),M=this.networkToHostOrderSwap;for(;t<C.length;){for(g=1,h=M(C[t]),c=M(C[t+1]),m=M(C[t+2]),p=M(C[t+3]),o=h^b[0],l=p^b[1],d=m^b[2],u=c^b[3],f=4;g<E;g++)r=_[o>>>24]^A[l>>16&255]^S[d>>8&255]^k[255&u]^b[f],a=_[l>>>24]^A[d>>16&255]^S[u>>8&255]^k[255&o]^b[f+1],s=_[d>>>24]^A[u>>16&255]^S[o>>8&255]^k[255&l]^b[f+2],n=_[u>>>24]^A[o>>16&255]^S[l>>8&255]^k[255&d]^b[f+3],o=r,l=a,d=s,u=n,f+=4;r=y[o>>>24]<<24^y[l>>16&255]<<16^y[d>>8&255]<<8^y[255&u]^b[f],a=y[l>>>24]<<24^y[d>>16&255]<<16^y[u>>8&255]<<8^y[255&o]^b[f+1],s=y[d>>>24]<<24^y[u>>16&255]<<16^y[o>>8&255]<<8^y[255&l]^b[f+2],n=y[u>>>24]<<24^y[o>>16&255]<<16^y[l>>8&255]<<8^y[255&d]^b[f+3],x[t]=M(r^I),x[t+1]=M(n^L),x[t+2]=M(s^w),x[t+3]=M(a^D),I=h,L=c,w=m,D=p,t+=4}return x.buffer}}class aE{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);return(this.reset(),this.removePKCS7Padding)?function(e){let t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?iu(e,0,t-i):e}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise((r,a)=>{this.softwareDecrypt(new Uint8Array(e),t,i);let s=this.flush();s?r(s.buffer):a(Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){let{currentIV:r,currentResult:a,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=iH(s,e),this.remainderData=null);let n=this.getValidChunk(e);if(!n.length)return null;r&&(i=r);let o=this.softwareDecrypter;return(o||(o=this.softwareDecrypter=new av),o.expandKey(t),this.currentResult=o.decrypt(n.buffer,0,i),this.currentIV=iu(n,-16).buffer,a)?a:null}webCryptoDecrypt(e,t,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i));this.key=t,this.fastAesKey=new ag(this.subtle,t)}return this.fastAesKey.expandKey().then(t=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new af(this.subtle,new Uint8Array(i)).decrypt(e.buffer,t)):Promise.reject(Error("web crypto not initialized"))).catch(r=>(tX.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i)))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);let r=this.flush();if(r)return r.buffer;throw Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%16;return i!==e.length&&(t=iu(e,0,i),this.remainderData=iu(e,i)),t}logOnce(e){this.logEnabled&&(tX.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}let ab={toString:function(e){let t="",i=e.length;for(let r=0;r<i;r++)t+=`[${e.start(r).toFixed(3)}-${e.end(r).toFixed(3)}]`;return t}},ay={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class aT extends r6{constructor(e,t,i,r,a){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ay.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=a,this.logPrefix=r,this.log=tX.log.bind(tX,`${r}:`),this.warn=tX.warn.bind(tX,`${r}:`),this.hls=e,this.fragmentLoader=new ah(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new aE(e.config),e.on(tK.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ay.STOPPED}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;let i=t.partList;if(null!=i&&i.length){let e=i[i.length-1];return aa.isBuffered(this.media,e.start+e.duration/2)}let r=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded){var e;return null==(e=this.levelLastLoaded)?void 0:e.details}}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);let r=this.config;this.levels&&r.autoStartLoad&&this.state===ay.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){let e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){let{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:a}=this,s=i?i.currentTime:0,n=aa.bufferInfo(r||i,s,e.maxBufferHole);if(this.log(`media seeking to ${tG(s)?s.toFixed(3):s}, state: ${a}`),this.state===ay.ENDED)this.resetLoadingState();else if(t){let i=e.maxFragLookUpTolerance,r=t.start-i,a=t.start+t.duration+i;if(!n.len||a<n.start||r>n.end){let e=s>a;(s<r||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||n.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(tK.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=ay.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){this._doFragLoad(e,t,i,t=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(t)}).then(t=>{if(!t)return;let i=this.state;if(this.fragContextChanged(e)){i!==ay.FRAG_LOADING&&(this.fragCurrent||i!==ay.PARSING)||(this.fragmentTracker.removeFragment(e),this.state=ay.IDLE);return}"payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(tK.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t)}).catch(t=>{this.state!==ay.STOPPED&&this.state!==ay.ERROR&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this;if(i.getState(e)===r7.APPENDING){let t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),a=Math.max(e.duration,r?r.len:this.config.maxBufferLength),s=this.backtrackFragment;(1==(s?e.sn-s.sn:0)||this.reduceMaxBufferLength(a,e.duration))&&i.removeFragment(e)}else(null==(t=this.mediaBuffer)?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===r7.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){e-t&&this.hls.trigger(tK.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:i})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw Error("init load aborted");return t}).then(t=>{let{hls:i}=this,{payload:r}=t,a=e.decryptdata;if(r&&r.byteLength>0&&null!=a&&a.key&&a.iv&&"AES-128"===a.method){let s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer).catch(t=>{throw i.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(r=>{let a=self.performance.now();return i.trigger(tK.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:s,tdecrypt:a}}),t.payload=r,this.completeInitSegmentLoad(t)})}return this.completeInitSegmentLoad(t)}).catch(t=>{this.state!==ay.STOPPED&&this.state!==ay.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw Error("init load aborted, missing levels");let i=e.frag.stats;this.state=ay.IDLE,e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var i,r,a,s,n;let o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===rc.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(i=e.startPTS)?i:NaN).toFixed(3)}-${(null!=(r=e.endPTS)?r:NaN).toFixed(3)}] > buffer:${o?ab.toString(aa.getBuffered(o)):"(detached)"})`),"initSegment"!==e.sn){if(e.type!==rc.SUBTITLE){let t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e])){this.state=ay.IDLE;return}}let t=null==(n=this.levels)?void 0:n[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=ay.IDLE,o&&(!this.loadedmetadata&&e.type==rc.MAIN&&o.buffered.length&&(null==(a=this.fragCurrent)?void 0:a.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:r,partsLoaded:a}=e,s=!a||0===a.length||a.some(e=>!e),n=new as(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!s);t.flush(n)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var a;let s;let n=null==t?void 0:t.details;if(!this.levels||!n)throw Error(`frag load aborted, missing level${n?"":" detail"}s`);let o=null;if(e.encrypted&&!(null!=(a=e.decryptdata)&&a.key)?(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=ay.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(tK.KEY_LOADED,e),this.state===ay.KEY_LOADING&&(this.state=ay.IDLE),e}),this.hls.trigger(tK.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){let a=n.partList;if(a&&r){i>e.end&&n.fragmentHint&&(e=n.fragmentHint);let s=this.getNextPart(a,e,i);if(s>-1){let l;let d=a[s];return(this.log(`Loading part sn: ${e.sn} p: ${d.index} cc: ${e.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${s}-${a.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=d.start+d.duration,this.state=ay.FRAG_LOADING,l=o?o.then(i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,d,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,d,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(tK.FRAG_LOADING,{frag:e,part:d,targetBufferTime:i}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING parts")):l}if(!e.url||this.loadedEndOfParts(a,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),tG(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ay.FRAG_LOADING;let l=this.config.progressive;return(s=l&&o?o.then(t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,l?r:void 0),o]).then(([e])=>(!l&&e&&r&&r(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(tK.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING")):s}doFragPartsLoad(e,t,i,r){return new Promise((a,s)=>{var n;let o=[],l=null==(n=i.details)?void 0:n.partList,d=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;let s=r.part;this.hls.trigger(tK.FRAG_LOADED,r);let n=rB(i,e.sn,t.index+1)||r$(l,e.sn,t.index+1);if(!n)return a({frag:e,part:s,partsLoaded:o});d(n)}).catch(s)};d(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;e.data&&t.details===tY.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(tK.ERROR,t)}else this.hls.trigger(tK.ERROR,{type:tW.OTHER_ERROR,details:tY.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==ay.PARSING){this.fragCurrent||this.state===ay.STOPPED||this.state===ay.ERROR||(this.state=ay.IDLE);return}let{frag:i,part:r,level:a}=t,s=self.performance.now();i.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(i,r,a,e.partial)}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:r,sn:a,part:s}=e;if(!(null!=t&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of level ${r}. The current chunk will not be buffered.`),null;let n=t[r],o=s>-1?rB(n,a,s):null,l=o?o.fragment:function(e,t,i){if(!(null!=e&&e.details))return null;let r=e.details,a=r.fragments[t-r.startSN];return a||(a=r.fragmentHint)&&a.sn===t?a:t<r.startSN&&i&&i.sn===t?i:null}(n,a,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:n}):null}bufferFragmentData(e,t,i,r,a){var s;if(!e||this.state!==ay.PARSING)return;let{data1:n,data2:o}=e,l=n;if(n&&o&&(l=iH(n,o)),!(null!=(s=l)&&s.length))return;let d={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:l};if(this.hls.trigger(tK.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!aa.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let i=t.currentTime,r=aa.bufferInfo(t,i,0),a=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*a),n=Math.max(Math.min(e.start-s,r.end-s),i+s);e.start-n>s&&this.flushMainBuffer(n,e.start)}getFwdBufferInfo(e,t){let i=this.getLoadPosition();return tG(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){let{config:{maxBufferHole:r}}=this,a=aa.bufferInfo(e,t,r);if(0===a.len&&void 0!==a.nextStart){let s=this.fragmentTracker.getBufferedFrag(t,i);if(s&&a.nextStart<s.end)return aa.bufferInfo(e,t,Math.max(a.nextStart,r))}return a}getMaxBufferLength(e){let t;let{config:i}=this;return Math.min(e?Math.max(8*i.maxBufferSize/e,i.maxBufferLength):i.maxBufferLength,i.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),a=Math.max(e-3*t,i.maxMaxBufferLength/2,r);return a>=r&&(i.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0)}getAppendedFrag(e,t=rc.MAIN){let i=this.fragmentTracker.getAppendedFrag(e,rc.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){let i;let r=t.fragments,a=r.length;if(!a)return null;let{config:s}=this,n=r[0].start;if(t.live){let o=s.initialLiveManifestSize;if(a<o)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${o})`),null;(t.PTSKnown||this.startFragRequested||-1!==this.startPosition)&&!(e<n)||(i=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=n&&(i=r[0]);if(!i){let r=s.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(i)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===r7.OK||i===r7.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,a){let s=e.gap,n=this.getNextFragment(this.nextLoadPosition,t);if(null===n)return n;if(e=n,s&&e&&!e.gap&&i.nextStart){let t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(null!==t&&i.len+t.len>=a)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let r=-1,a=!1,s=!0;for(let n=0,o=e.length;n<o;n++){let o=e[n];if(s=s&&!o.independent,r>-1&&i<o.start)break;let l=o.loaded;l?r=-1:(a||o.independent||s)&&o.fragment===t&&(r=n),a=l}return r}loadedEndOfParts(e,t){let i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){let i=this.fragPrevious,r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!tG(t)||t<(e[0].programDateTime||0)||t>=(e[e.length-1].endProgramDateTime||0))return null;i=i||0;for(let r=0;r<e.length;++r){let a=e[r];if(function(e,t,i){let r=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-r>e}(t,i,a))return a}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){let s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){let a=t[s-e.startSN];i.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}if(!r){var a;a=i.cc,(r=rq(t,e=>e.cc<a?1:e.cc>a?-1:0))&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`)}}}else{let t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){let r;let{config:a}=this,{fragPrevious:s}=this,{fragments:n,endSN:o}=i,{fragmentHint:l}=i,{maxFragLookUpTolerance:d}=a,u=i.partList,h=!!(a.lowLatencyMode&&null!=u&&u.length&&l);if(h&&l&&!this.bitrateTest&&(n=n.concat(l),o=l.sn),r=e<t?rj(s,n,e,e>t-d?0:d):n[n.length-1]){let e=r.sn-i.startSN,t=this.fragmentTracker.getState(r);if((t===r7.OK||t===r7.PARTIAL&&r.gap)&&(s=r),s&&r.sn===s.sn&&(!h||u[0].fragment.sn>r.sn)&&s&&r.level===s.level){let t=n[e+1];r=r.sn<o&&this.fragmentTracker.getState(t)!==r7.OK?t:null}}return r}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let r=this.hls.liveSyncPosition,a=i.currentTime,s=e.fragments[0].start,n=e.edge,o=a>=s-t.maxFragLookUpTolerance&&a<=n;if(null!==r&&i.duration>r&&(a<r||!o)){let s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||a<n-s)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${n}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(e,t,i){let r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;let a=e.fragments[0].start,s=!t,n=e.alignedSliding&&tG(a);if(s||!n&&!a){var o,l,d;let{fragPrevious:a}=this;o=a,l=i,d=e,l&&(function(e,t,i){if(i&&(t.endCC>t.startCC||e&&e.cc<t.startCC)){let e=function(e,t){let i=e.fragments,r=t.fragments;if(!r.length||!i.length){tX.log("No fragments to align");return}let a=ao(i,r[0].cc);if(!a||a&&!a.startPTS){tX.log("No frag in previous level to align on");return}return a}(i,t);e&&tG(e.start)&&(tX.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),ad(e.start,t))}}(o,d,l),!d.alignedSliding&&l&&au(d,l),d.alignedSliding||!l||d.skippedSegments||rU(l,d));let s=e.fragments[0].start;return this.log(`Live playlist sliding: ${s.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${a?a.sn:"na"} fragments: ${r}`),s}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){let r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&tG(a)?(i=t+a,a<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${a} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){let{media:e}=this,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===ay.FRAG_LOADING_WAITING_RETRY)||(this.state=ay.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){let e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}let i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${null==(r=this.fragCurrent)?void 0:r.url}`);return}let a=t.details===tY.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);let s=t.errorAction,{action:n,retryCount:o=0,retryConfig:l}=s||{};if(s&&n===rX.RetryRequest&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);let r=rK(l,o);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${r}ms`),s.resolved=!0,this.retryDate=self.performance.now()+r,this.state=ay.FRAG_LOADING_WAITING_RETRY}else if(l&&s){if(this.resetFragmentErrors(e),o<l.maxNumRetry)a||n===rX.RemoveAlternatePermanently||(s.resolved=!0);else{tX.warn(`${t.details} reached or exceeded max retry (${o})`);return}}else(null==s?void 0:s.action)===rX.SendAlternateToPenaltyBox?this.state=ay.WAITING_LEVEL:this.state=ay.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ay.PARSING||this.state===ay.PARSED){let t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);let s=!a;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===rc.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ay.STOPPED&&(this.state=ay.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let r=aa.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===ay.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=ay.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;let t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){var a;let s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((t,a)=>{let n=e.elementaryStreams[a];if(n){let o=n.endPTS-n.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;let l=r?0:rP(s,e,n.startPTS,n.endPTS,n.startDTS,n.endDTS);return this.hls.trigger(tK.LEVEL_PTS_UPDATED,{details:s,level:i,drift:l,type:a,frag:e,start:n.startPTS,end:n.endPTS}),!0}return t},!1)&&(null==(a=this.transmuxer)?void 0:a.error)===null){let t=Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===i.fragmentError&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=ay.PARSED,this.hls.trigger(tK.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class a_{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let e;let{chunks:t,dataLength:i}=this;return t.length?(e=1===t.length?t[0]:function(e,t){let i=new Uint8Array(t),r=0;for(let t=0;t<e.length;t++){let a=e[t];i.set(a,r),r+=a.length}return i}(t,i),this.reset(),e):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function aA(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class aS{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){let i;this.cachedData&&(e=iH(this.cachedData,e),this.cachedData=null);let r=im(e,0),a=r?r.length:0,s=this._audioTrack,n=this._id3Track,o=r?iv(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&tG(o))&&(this.basePTS=ak(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:rT.audioId3,duration:Number.POSITIVE_INFINITY});a<l;){if(this.canParse(e,a)){let t=this.appendFrame(s,e,a);t?(this.frameIndex++,this.lastPTS=t.sample.pts,a+=t.length,i=a):a=l}else ig(e,a)?(r=im(e,a),n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:rT.audioId3,duration:Number.POSITIVE_INFINITY}),a+=r.length,i=a):a++;if(a===l&&i!==l){let t=iu(e,i);this.cachedData?this.cachedData=iH(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:aA(),id3Track:n,textTrack:aA()}}demuxSampleAes(e,t,i){return Promise.reject(Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:aA(),id3Track:this._id3Track,textTrack:aA()}}destroy(){}}let ak=(e,t,i)=>tG(e)?90*e:9e4*t+(i?9e4*i.baseTime/i.timescale:0);function aR(e,t){return 255===e[t]&&(246&e[t+1])==240}function aI(e,t){return 1&e[t+1]?7:9}function aL(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function aw(e,t){return t+1<e.length&&aR(e,t)}function aD(e,t,i,r,a){if(!e.samplerate){let s=function(e,t,i,r){let a,s,n,o;let l=navigator.userAgent.toLowerCase(),d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((192&t[i+2])>>>6)+1;let u=(60&t[i+2])>>>2;if(u>d.length-1){let t=Error(`invalid ADTS sampling index:${u}`);e.emit(tK.ERROR,tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message});return}return n=(1&t[i+2])<<2|(192&t[i+3])>>>6,tX.log(`manifest codec:${r}, ADTS type:${a}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(a=5,o=[,,,,],s=u-3):(a=2,o=[,,],s=u):-1!==l.indexOf("android")?(a=2,o=[,,],s=u):(a=5,o=[,,,,],r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&u>=6?s=u-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(u>=6&&1===n||/vivaldi/i.test(l))||!r&&1===n)&&(a=2,o=[,,]),s=u)),o[0]=a<<3,o[0]|=(14&u)>>1,o[1]|=(1&u)<<7,o[1]|=n<<3,5===a&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[u],channelCount:n,codec:"mp4a.40."+a,manifestCodec:r}}(t,i,r,a);s&&(e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,tX.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`))}}function aC(e,t,i,r,a){let s;let n=r+a*(9216e4/e.samplerate),o=function(e,t){let i=aI(e,t);if(t+i<=e.length){let r=aL(e,t)-i;if(r>0)return{headerLength:i,frameLength:r}}}(t,i);if(o){let{frameLength:r,headerLength:a}=o,l=a+r,d=Math.max(0,i+l-t.length);d?(s=new Uint8Array(l-a)).set(t.subarray(i+a,t.length),0):s=t.subarray(i+a,i+l);let u={unit:s,pts:n};return d||e.samples.push(u),{sample:u,length:l,missing:d}}let l=t.length-i;return(s=new Uint8Array(l)).set(t.subarray(i,t.length),0),{sample:{unit:s,pts:n},length:l,missing:-1}}let ax=null,aM=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],aO=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],aN=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],aP=[0,1,1,4];function aU(e,t,i,r,a){if(i+24>t.length)return;let s=aF(t,i);if(s&&i+s.frameLength<=t.length){let n=r+a*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(i,i+s.frameLength),pts:n,dts:n};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function aF(e,t){let i=e[t+1]>>3&3,r=e[t+1]>>1&3,a=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==i&&0!==a&&15!==a&&3!==s){let n=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*aM[14*(3===i?3-r:3===r?3:4)+a-1],d=aO[3*(3===i?0:2===i?1:2)+s],u=aN[i][r],h=aP[r],c=Math.floor(u*l/d+n)*h;if(null===ax){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ax=e?parseInt(e[1]):0}return ax&&ax<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:3===o?1:2,frameLength:c,samplesPerFrame:8*u*h}}}function aB(e,t){return 255===e[t]&&(224&e[t+1])==224&&(6&e[t+1])!=0}function a$(e,t){return t+1<e.length&&aB(e,t)}function aG(e,t){if(t+1<e.length&&aB(e,t)){let i=aF(e,t),r=4;null!=i&&i.frameLength&&(r=i.frameLength);let a=t+r;return a===e.length||a$(e,a)}return!1}let aH=/\/emsg[-/]ID3/i,aV=(e,t)=>{let i=0,r=5;t+=5;let a=new Uint32Array(1),s=new Uint32Array(1),n=new Uint8Array(1);for(;r>0;){n[0]=e[t];let o=Math.min(r,8),l=8-o;s[0]=0xff000000>>>24+l<<l,a[0]=(n[0]&s[0])>>l,i=i?i<<o|a[0]:a[0],t+=1,r-=o}return i};function aK(e,t,i,r,a){if(i+8>t.length||11!==t[i]||119!==t[i+1])return -1;let s=t[i+4]>>6;if(s>=3)return -1;let n=[48e3,44100,32e3][s],o=63&t[i+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(i+l>t.length)return -1;let d=t[i+6]>>5,u=0;2===d?u+=2:(1&d&&1!==d&&(u+=2),4&d&&(u+=2));let h=(t[i+6]<<8|t[i+7])>>12-u&1,c=[2,1,2,3,3,4,4,5][d]+h,m=t[i+5]>>3,p=7&t[i+5],f=new Uint8Array([s<<6|m<<1|p>>2,(3&p)<<6|d<<3|h<<2|o>>4,o<<4&224]),g=t.subarray(i,i+l);return e.config=f,e.channelCount=c,e.samplerate=n,e.samples.push({unit:g,pts:r+1536/n*9e4*a}),l}class aW{constructor(){this.VideoSample=null}createVideoSample(e,t,i,r){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:r,length:0}}getLastNalUnit(e){var t;let i;let r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){let e=r.units;i=e[e.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){let i=t.samples,r=i.length;if(r){let t=i[r-1];e.pts=t.pts,e.dts=t.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&tX.log(e.pts+"/"+e.dts+":"+e.debug)}}class aY{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw Error("no bytes available");r.set(e.subarray(i,i+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&tX.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw Error("no bits available");return(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&0x80000000>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,i=8;for(let r=0;r<e;r++)0!==i&&(i=(t+this.readEG()+256)%256),t=0===i?t:i}readSPS(){let e,t,i,r=0,a=0,s=0,n=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),c=this.skipEG.bind(this),m=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();let f=o();if(l(5),h(3),o(),m(),100===f||110===f||122===f||244===f||44===f||83===f||86===f||118===f||128===f){let e=d();if(3===e&&h(1),m(),m(),h(1),u())for(i=0,t=3!==e?8:12;i<t;i++)u()&&p(i<6?16:64)}m();let g=d();if(0===g)d();else if(1===g)for(h(1),c(),c(),e=d(),i=0;i<e;i++)c();m(),h(1);let E=d(),b=d(),y=l(1);0===y&&h(1),h(1),u()&&(r=d(),a=d(),s=d(),n=d());let T=[1,1];if(u()&&u())switch(o()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil((E+1)*16-2*r-2*a),height:(2-y)*(b+1)*16-(y?2:4)*(s+n),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class aq extends aW{parseAVCPES(e,t,i,r,a){let s;let n=this.parseAVCNALu(e,i.data),o=this.VideoSample,l=!1;i.data=null,o&&n.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"")),n.forEach(r=>{var n,d,u,h;switch(r.type){case 1:{let t=!1;s=!0;let a=r.data;if(l&&a.length>4){let e=new aY(a).readSliceType();(2===e||4===e||7===e||9===e)&&(t=!0)}t&&null!=(d=o)&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),o.frame=!0,o.key=t;break}case 5:s=!0,null!=(n=o)&&n.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:s=!0,iK(r.data,1,i.pts,t.samples);break;case 7:{s=!0,l=!0;let t=r.data,i=new aY(t).readSPS();if(!e.sps||e.width!==i.width||e.height!==i.height||(null==(u=e.pixelRatio)?void 0:u[0])!==i.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==i.pixelRatio[1]){e.width=i.width,e.height=i.height,e.pixelRatio=i.pixelRatio,e.sps=[t],e.duration=a;let r=t.subarray(1,4),s="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break}case 8:s=!0,e.pps=[r.data];break;case 9:s=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"");break;case 12:s=!0;break;default:s=!1,o&&(o.debug+="unknown NAL "+r.type+" ")}o&&s&&o.units.push(r)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,t){let i,r,a;let s=t.byteLength,n=e.naluState||0,o=n,l=[],d=0,u=-1,h=0;for(-1===n&&(u=0,h=31&t[0],n=0,d=1);d<s;){if(i=t[d++],!n){n=i?0:1;continue}if(1===n){n=i?0:2;continue}if(i){if(1===i){if(r=d-n-1,u>=0){let e={data:t.subarray(u,r),type:h};l.push(e)}else{let i=this.getLastNalUnit(e.samples);i&&(o&&d<=4-o&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-o)),r>0&&(i.data=iH(i.data,t.subarray(0,r)),i.state=0))}d<s?(a=31&t[d],u=d,h=a,n=0):n=-1}else n=0}else n=3}if(u>=0&&n>=0){let e={data:t.subarray(u,s),type:h,state:n};l.push(e)}if(0===l.length){let i=this.getLastNalUnit(e.samples);i&&(i.data=iH(i.data,t))}return e.naluState=n,l}}class aj{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new aE(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){let r=e[t].unit;if(r.length<=16)return;let a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then(a=>{let s=new Uint8Array(a);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=new Int8Array(16*Math.floor((e.length-48)/160)+16),i=0;for(let r=32;r<e.length-16;r+=160,i+=16)t.set(e.subarray(r,r+16),i);return t}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),r=0;for(let t=32;t<e.length-16;t+=160,r+=16)e.set(i.subarray(r,r+16),t);return e}decryptAvcSample(e,t,i,r,a){let s=iW(a.data),n=this.getAvcEncryptedData(s);this.decryptBuffer(n.buffer).then(n=>{a.data=this.getAvcDecryptedUnit(s,n),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}let a=e[t].units;for(;!(i>=a.length);i++){let s=a[i];if(!(s.data.length<=48)&&(1===s.type||5===s.type)&&(this.decryptAvcSample(e,t,i,r,s),!this.decrypter.isSync()))return}}}}class az{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.videoParser=new aq}static probe(e){let t=az.syncOffset(e);return t>0&&tX.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){let t=e.length,i=Math.min(940,t-188)+1,r=0;for(;r<i;){let a=!1,s=-1,n=0;for(let o=r;o<t;o+=188)if(71===e[o]&&(t-o==188||71===e[o+188])){if(n++,-1===s&&0!==(s=o)&&(i=Math.min(s+18612,e.length-188)+1),a||(a=0===aX(e,o)),a&&n>1&&(0===s&&n>2||o+188>i))return s}else if(n)return -1;else break;r++}return -1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:iw[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=az.createTrack("video"),this._audioTrack=az.createTrack("audio",r),this._id3Track=az.createTrack("id3"),this._txtTrack=az.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){let a;i||(this.sampleAes=null);let s=this._videoTrack,n=this._audioTrack,o=this._id3Track,l=this._txtTrack,d=s.pid,u=s.pesData,h=n.pid,c=o.pid,m=n.pesData,p=o.pesData,f=null,g=this.pmtParsed,E=this._pmtId,b=e.length;if(this.remainderData&&(b=(e=iH(this.remainderData,e)).length,this.remainderData=null),b<188&&!r)return this.remainderData=e,{audioTrack:n,videoTrack:s,id3Track:o,textTrack:l};let y=Math.max(0,az.syncOffset(e));(b-=(b-y)%188)<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let T=0;for(let t=y;t<b;t+=188)if(71===e[t]){let r;let b=!!(64&e[t+1]),T=aX(e,t);if((48&e[t+3])>>4>1){if((r=t+5+e[t+4])===t+188)continue}else r=t+4;switch(T){case d:b&&(u&&(a=aJ(u))&&this.videoParser.parseAVCPES(s,l,a,!1,this._duration),u={data:[],size:0}),u&&(u.data.push(e.subarray(r,t+188)),u.size+=t+188-r);break;case h:if(b){if(m&&(a=aJ(m)))switch(n.segmentCodec){case"aac":this.parseAACPES(n,a);break;case"mp3":this.parseMPEGPES(n,a);break;case"ac3":this.parseAC3PES(n,a)}m={data:[],size:0}}m&&(m.data.push(e.subarray(r,t+188)),m.size+=t+188-r);break;case c:b&&(p&&(a=aJ(p))&&this.parseID3PES(o,a),p={data:[],size:0}),p&&(p.data.push(e.subarray(r,t+188)),p.size+=t+188-r);break;case 0:var _,A;b&&(r+=e[r]+1),E=this._pmtId=(31&(_=e)[(A=r)+10])<<8|_[A+11];break;case E:{b&&(r+=e[r]+1);let a=function(e,t,i,r,a){let s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},n=(15&e[t+1])<<8|e[t+2],o=t+3+n-4,l=(15&e[t+10])<<8|e[t+11];for(t+=12+l;t<o;){let n=aX(e,t),o=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){aZ("ADTS AAC");break}case 15:-1===s.audioPid&&(s.audioPid=n);break;case 21:-1===s.id3Pid&&(s.id3Pid=n);break;case 219:if(!r){aZ("H.264");break}case 27:-1===s.videoPid&&(s.videoPid=n,s.segmentVideoCodec="avc");break;case 3:case 4:i.mpeg||i.mp3?-1===s.audioPid&&(s.audioPid=n,s.segmentAudioCodec="mp3"):tX.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){aZ("AC-3");break}case 129:i.ac3?-1===s.audioPid&&(s.audioPid=n,s.segmentAudioCodec="ac3"):tX.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&o>0){let r=t+5,a=o;for(;a>2;){106===e[r]&&(!0!==i.ac3?tX.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=n,s.segmentAudioCodec="ac3"));let t=e[r+1]+2;r+=t,a-=t}}break;case 194:case 135:return aQ(a,Error("Unsupported EC-3 in M2TS found")),s;case 36:return aQ(a,Error("Unsupported HEVC in M2TS found")),s}t+=o+5}return s}(e,r,this.typeSupported,i,this.observer);(d=a.videoPid)>0&&(s.pid=d,s.segmentCodec=a.segmentVideoCodec),(h=a.audioPid)>0&&(n.pid=h,n.segmentCodec=a.segmentAudioCodec),(c=a.id3Pid)>0&&(o.pid=c),null===f||g||(tX.warn(`MPEG-TS PMT found at ${t} after unknown PID '${f}'. Backtracking to sync byte @${y} to parse all TS packets.`),f=null,t=y-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:f=T}}else T++;T>0&&aQ(this.observer,Error(`Found ${T} TS packet/s that do not start with 0x47`)),s.pesData=u,n.pesData=m,o.pesData=p;let S={audioTrack:n,videoTrack:s,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(S),S}flush(){let e;let{remainderData:t}=this;return(this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes)?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(e){let t;let{audioTrack:i,videoTrack:r,id3Track:a,textTrack:s}=e,n=r.pesData,o=i.pesData,l=a.pesData;if(n&&(t=aJ(n))?(this.videoParser.parseAVCPES(r,s,t,!0,this._duration),r.pesData=null):r.pesData=n,o&&(t=aJ(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t);break;case"ac3":this.parseAC3PES(i,t)}i.pesData=null}else null!=o&&o.size&&tX.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(t=aJ(l))?(this.parseID3PES(a,t),a.pesData=null):a.pesData=l}demuxSampleAes(e,t,i){let r=this.demux(e,i,!0,!this.config.progressive),a=this.sampleAes=new aj(this.observer,this.config,t);return this.decrypt(r,a)}decrypt(e,t){return new Promise(i=>{let{audioTrack:r,videoTrack:a}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{i(e)}):i(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{i(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let i,r,a,s,n=0,o=this.aacOverFlow,l=t.data;if(o){this.aacOverFlow=null;let t=o.missing,i=o.sample.unit.byteLength;-1===t?l=iH(o.sample.unit,l):(o.sample.unit.set(l.subarray(0,t),i-t),e.samples.push(o.sample),n=o.missing)}for(i=n,r=l.length;i<r-1&&!aw(l,i);i++);if(i!==n){let e;let t=i<r-1;if(e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES",aQ(this.observer,Error(e),t),!t)return}if(aD(e,this.observer,l,i,this.audioCodec),void 0!==t.pts)a=t.pts;else if(o){let t=9216e4/e.samplerate;a=o.sample.pts+t}else{tX.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0;for(;i<r;){if(s=aC(e,l,i,a,d),i+=s.length,s.missing){this.aacOverFlow=s;break}for(d++;i<r-1&&!aw(l,i);i++);}}parseMPEGPES(e,t){let i=t.data,r=i.length,a=0,s=0,n=t.pts;if(void 0===n){tX.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;s<r;)if(a$(i,s)){let t=aU(e,i,s,n,a);if(t)s+=t.length,a++;else break}else s++}parseAC3PES(e,t){{let i;let r=t.data,a=t.pts;if(void 0===a){tX.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let s=r.length,n=0,o=0;for(;o<s&&(i=aK(e,r,o,a,n++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts){tX.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let i=t$({},t,{type:this._videoTrack?rT.emsg:rT.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function aX(e,t){return((31&e[t+1])<<8)+e[t+2]}function aQ(e,t,i){tX.warn(`parsing error: ${t.message}`),e.emit(tK.ERROR,tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_PARSING_ERROR,fatal:!1,levelRetry:i,error:t,reason:t.message})}function aZ(e){tX.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function aJ(e){let t,i,r,a,s,n=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;)o[0]=iH(o[0],o[1]),o.splice(1,1);if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((i=(t[4]<<8)+t[5])&&i>e.size-6)return null;let l=t[7];192&l&&(a=(14&t[9])*0x20000000+(255&t[10])*4194304+(254&t[11])*16384+(255&t[12])*128+(254&t[13])/2,64&l?a-(s=(14&t[14])*0x20000000+(255&t[15])*4194304+(254&t[16])*16384+(255&t[17])*128+(254&t[18])/2)>54e5&&(tX.warn(`${Math.round((a-s)/9e4)}s delta between PTS and DTS, align them`),a=s):s=a);let d=(r=t[8])+9;if(e.size<=d)return null;e.size-=d;let u=new Uint8Array(e.size);for(let e=0,i=o.length;e<i;e++){let i=(t=o[e]).byteLength;if(d){if(d>i){d-=i;continue}t=t.subarray(d),i-=d,d=0}u.set(t,n),n+=i}return i&&(i-=r+3),{data:u,pts:a,dts:s,len:i}}return null}class a0{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}class a1{static init(){let e;for(e in a1.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a1.types)a1.types.hasOwnProperty(e)&&(a1.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);let t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a1.HDLR_TYPES={video:t,audio:i};let r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);a1.STTS=a1.STSC=a1.STCO=a,a1.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a1.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a1.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a1.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let s=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);a1.FTYP=a1.box(a1.types.ftyp,s,o,s,n),a1.DINF=a1.box(a1.types.dinf,a1.box(a1.types.dref,r))}static box(e,...t){let i=8,r=t.length,a=r;for(;r--;)i+=t[r].byteLength;let s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4),r=0,i=8;r<a;r++)s.set(t[r],i),i+=t[r].byteLength;return s}static hdlr(e){return a1.box(a1.types.hdlr,a1.HDLR_TYPES[e])}static mdat(e){return a1.box(a1.types.mdat,e)}static mdhd(e,t){let i=Math.floor((t*=e)/0x100000000),r=Math.floor(t%0x100000000);return a1.box(a1.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return a1.box(a1.types.mdia,a1.mdhd(e.timescale,e.duration),a1.hdlr(e.type),a1.minf(e))}static mfhd(e){return a1.box(a1.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?a1.box(a1.types.minf,a1.box(a1.types.smhd,a1.SMHD),a1.DINF,a1.stbl(e)):a1.box(a1.types.minf,a1.box(a1.types.vmhd,a1.VMHD),a1.DINF,a1.stbl(e))}static moof(e,t,i){return a1.box(a1.types.moof,a1.mfhd(e),a1.traf(i,t))}static moov(e){let t=e.length,i=[];for(;t--;)i[t]=a1.trak(e[t]);return a1.box.apply(null,[a1.types.moov,a1.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(a1.mvex(e)))}static mvex(e){let t=e.length,i=[];for(;t--;)i[t]=a1.trex(e[t]);return a1.box.apply(null,[a1.types.mvex,...i])}static mvhd(e,t){let i=Math.floor((t*=e)/0x100000000),r=Math.floor(t%0x100000000),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a1.box(a1.types.mvhd,a)}static sdtp(e){let t,i;let r=e.samples||[],a=new Uint8Array(4+r.length);for(t=0;t<r.length;t++)i=r[t].flags,a[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return a1.box(a1.types.sdtp,a)}static stbl(e){return a1.box(a1.types.stbl,a1.stsd(e),a1.box(a1.types.stts,a1.STTS),a1.box(a1.types.stsc,a1.STSC),a1.box(a1.types.stsz,a1.STSZ),a1.box(a1.types.stco,a1.STCO))}static avc1(e){let t,i,r,a=[],s=[];for(t=0;t<e.sps.length;t++)r=(i=e.sps[t]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)r=(i=e.pps[t]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));let n=a1.box(a1.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,d=e.pixelRatio[0],u=e.pixelRatio[1];return a1.box(a1.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n,a1.box(a1.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a1.box(a1.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){let t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){let t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return a1.box(a1.types.mp4a,a1.audioStsd(e),a1.box(a1.types.esds,a1.esds(e)))}static mp3(e){return a1.box(a1.types[".mp3"],a1.audioStsd(e))}static ac3(e){return a1.box(a1.types["ac-3"],a1.audioStsd(e),a1.box(a1.types.dac3,e.config))}static stsd(e){return"audio"!==e.type?a1.box(a1.types.stsd,a1.STSD,a1.avc1(e)):"mp3"===e.segmentCodec&&"mp3"===e.codec?a1.box(a1.types.stsd,a1.STSD,a1.mp3(e)):"ac3"===e.segmentCodec?a1.box(a1.types.stsd,a1.STSD,a1.ac3(e)):a1.box(a1.types.stsd,a1.STSD,a1.mp4a(e))}static tkhd(e){let t=e.id,i=e.duration*e.timescale,r=e.width,a=e.height,s=Math.floor(i/0x100000000),n=Math.floor(i%0x100000000);return a1.box(a1.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}static traf(e,t){let i=a1.sdtp(e),r=e.id,a=Math.floor(t/0x100000000),s=Math.floor(t%0x100000000);return a1.box(a1.types.traf,a1.box(a1.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),a1.box(a1.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),a1.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||0xffffffff,a1.box(a1.types.trak,a1.tkhd(e),a1.mdia(e))}static trex(e){let t=e.id;return a1.box(a1.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let i,r,a,s,n,o;let l=e.samples||[],d=l.length,u=12+16*d,h=new Uint8Array(u);for(t+=8+u,h.set(["video"===e.type?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<d;i++)a=(r=l[i]).duration,s=r.size,n=r.flags,o=r.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.paddingValue<<1|n.isNonSync,61440&n.degradPrio,15&n.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return a1.box(a1.types.trun,h)}static initSegment(e){a1.types||a1.init();let t=a1.moov(e);return iH(a1.FTYP,t)}}function a2(e,t,i=1,r=!1){let a=e*t*i;return r?Math.round(a):a}function a3(e,t=!1){return a2(e,1e3,11111111111111112e-21,t)}a1.types=void 0,a1.HDLR_TYPES=void 0,a1.STTS=void 0,a1.STSC=void 0,a1.STCO=void 0,a1.STSZ=void 0,a1.VMHD=void 0,a1.SMHD=void 0,a1.STSD=void 0,a1.FTYP=void 0,a1.DINF=void 0;let a4=null,a5=null;class a8{constructor(e,t,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===a4){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);a4=e?parseInt(e[1]):0}if(null===a5){let e=navigator.userAgent.match(/Safari\/(\d+)/i);a5=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){tX.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){tX.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){tX.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,i=e[0].pts,r=e.reduce((e,r)=>{let a=r.pts,s=a-e;return(s<-0x100000000&&(t=!0,s=(a=a9(a,i))-e),s>0)?e:a},i);return t&&tX.debug("PTS rollover detected"),r}remux(e,t,i,r,a,s,n,o){let l,d,u,h,c,m;let p=a,f=a,g=e.pid>-1,E=t.pid>-1,b=t.samples.length,y=e.samples.length>0,T=n&&b>0||b>1;if((!g||y)&&(!E||T)||this.ISGenerated||n){let i;if(this.ISGenerated){var _,A,S,k;let e=this.videoTrackConfig;e&&(t.width!==e.width||t.height!==e.height||(null==(_=t.pixelRatio)?void 0:_[0])!==(null==(A=e.pixelRatio)?void 0:A[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(k=e.pixelRatio)?void 0:k[1]))&&this.resetInitSegment()}else u=this.generateIS(e,t,a,s);let r=this.isVideoContiguous,n=-1;if(T&&(n=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return -1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity)){if(m=!0,n>0){tX.warn(`[mp4-remuxer]: Dropped ${n} out of ${b} video samples due to a missing keyframe`);let e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(n),t.dropped+=n,f+=(t.samples[0].pts-e)/t.inputTimeScale,i=f}else -1===n&&(tX.warn(`[mp4-remuxer]: No keyframe found out of ${b} video samples`),m=!1)}if(this.ISGenerated){if(y&&T){let i=this.getVideoStartPts(t.samples),r=(a9(e.samples[0].pts,i)-i)/t.inputTimeScale;p+=Math.max(0,r),f+=Math.max(0,-r)}if(y){if(e.samplerate||(tX.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,t,a,s)),d=this.remuxAudio(e,p,this.isAudioContiguous,s,E||T||o===rc.AUDIO?f:void 0),T){let i=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(tX.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,t,a,s)),l=this.remuxVideo(t,f,r,i)}}else T&&(l=this.remuxVideo(t,f,r,0));l&&(l.firstKeyFrame=n,l.independent=-1!==n,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(c=a6(i,a,this._initPTS,this._initDTS)),r.samples.length&&(h=a7(r,a,this._initPTS))),{audio:d,video:l,initSegment:u,independent:m,text:h,id3:c}}generateIS(e,t,i,r){let a,s,n;let o=e.samples,l=t.samples,d=this.typeSupported,u={},h=this._initPTS,c=!h||r,m="audio/mp4";if(c&&(a=s=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(m="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}u.audio={id:"audio",container:m,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&d.mpeg?new Uint8Array(0):a1.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(n=e.inputTimeScale,h&&n===h.timescale?c=!1:a=s=o[0].pts-Math.round(n*i))}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:a1.initSegment([t]),metadata:{width:t.width,height:t.height}},c){if(n=t.inputTimeScale,h&&n===h.timescale)c=!1;else{let e=this.getVideoStartPts(l),t=Math.round(n*i);s=Math.min(s,a9(l[0].dts,e)-t),a=Math.min(a,e-t)}}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:a,timescale:n},this._initDTS={baseTime:s,timescale:n}):a=n=void 0,{tracks:u,initPTS:a,timescale:n}}remuxVideo(e,t,i,r){let a,s,n;let o=e.inputTimeScale,l=e.samples,d=[],u=l.length,h=this._initPTS,c=this.nextAvcDts,m=8,p=this.videoSampleDuration,f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,E=!1;if(!i||null===c){let e=t*o,r=l[0].pts-a9(l[0].dts,l[0].pts);a4&&null!==c&&15e3>Math.abs(e-r-c)?i=!0:c=e-r}let b=h.baseTime*o/h.timescale;for(let e=0;e<u;e++){let t=l[e];t.pts=a9(t.pts-b,c),t.dts=a9(t.dts-b,c),t.dts<l[e>0?e-1:e].dts&&(E=!0)}E&&l.sort(function(e,t){let i=e.dts-t.dts,r=e.pts-t.pts;return i||r}),a=l[0].dts;let y=(s=l[l.length-1].dts)-a,T=y?Math.round(y/(u-1)):p||e.inputTimeScale/30;if(i){let e=a-c,i=e>T,r=e<-1;if((i||r)&&(i?tX.warn(`AVC: ${a3(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):tX.warn(`AVC: ${a3(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||c>=l[0].pts||a4)){a=c;let t=l[0].pts-e;if(i)l[0].dts=a,l[0].pts=t;else for(let i=0;i<l.length&&!(l[i].dts>t);i++)l[i].dts-=e,l[i].pts-=e;tX.log(`Video: Initial PTS/DTS adjusted: ${a3(t,!0)}/${a3(a,!0)}, delta: ${a3(e,!0)} ms`)}}let _=0,A=0,S=a=Math.max(0,a);for(let e=0;e<u;e++){let t=l[e],i=t.units,r=i.length,a=0;for(let e=0;e<r;e++)a+=i[e].data.length;A+=a,_+=r,t.length=a,t.dts<S?(t.dts=S,S+=T/4|0||1):S=t.dts,f=Math.min(t.pts,f),g=Math.max(t.pts,g)}s=l[u-1].dts;let k=A+4*_+8;try{n=new Uint8Array(k)}catch(e){this.observer.emit(tK.ERROR,tK.ERROR,{type:tW.MUX_ERROR,details:tY.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:k,reason:`fail allocating video mdat ${k}`});return}let R=new DataView(n.buffer);R.setUint32(0,k),n.set(a1.types.mdat,4);let I=!1,L=Number.POSITIVE_INFINITY,w=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(let e=0;e<u;e++){let t;let i=l[e],a=i.units,s=0;for(let e=0,t=a.length;e<t;e++){let t=a[e],i=t.data,r=t.data.byteLength;R.setUint32(m,r),m+=4,n.set(i,m),m+=r,s+=4+r}if(e<u-1)p=l[e+1].dts-i.dts,t=l[e+1].pts-i.pts;else{let a=this.config,s=e>0?i.dts-l[e-1].dts:T;if(t=e>0?i.pts-l[e-1].pts:T,a.stretchShortVideoTrack&&null!==this.nextAudioPts){let e=Math.floor(a.maxBufferHole*o),t=(r?f+r*o:this.nextAudioPts)-i.pts;t>e?((p=t-s)<0?p=s:I=!0,tX.log(`[mp4-remuxer]: It is approximately ${t/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=s}else p=s}let h=Math.round(i.pts-i.dts);L=Math.min(L,p),D=Math.max(D,p),w=Math.min(w,t),C=Math.max(C,t),d.push(new se(i.key,p,s,h))}if(d.length){if(a4){if(a4<70){let e=d[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(a5&&C-w<D-L&&T/D<.025&&0===d[0].cts){tX.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=a;for(let t=0,i=d.length;t<i;t++){let r=e+d[t].duration,a=e+d[t].cts;if(t<i-1){let e=r+d[t+1].cts;d[t].duration=e-a}else d[t].duration=t?d[t-1].duration:T;d[t].cts=0,e=r}}}p=I||!p?T:p,this.nextAvcDts=c=s+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;let x={data1:a1.moof(e.sequenceNumber++,a,t$({},e,{samples:d})),data2:n,startPTS:f/o,endPTS:(g+p)/o,startDTS:a/o,endDTS:c/o,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,x}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,i,r,a){let s;let n=e.inputTimeScale,o=e.samplerate?e.samplerate:n,l=n/o,d=this.getSamplesPerFrame(e),u=d*l,h=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,m=[],p=void 0!==a,f=e.samples,g=c?0:8,E=this.nextAudioPts||-1,b=t*n,y=h.baseTime*n/h.timescale;if(this.isAudioContiguous=i=i||f.length&&E>0&&(r&&9e3>Math.abs(b-E)||Math.abs(a9(f[0].pts-y,b)-E)<20*u),f.forEach(function(e){e.pts=a9(e.pts-y,b)}),!i||E<0){if(!(f=f.filter(e=>e.pts>=0)).length)return;E=0===a?0:r&&!p?Math.max(0,b):f[0].pts}if("aac"===e.segmentCodec){let t=this.config.maxAudioFramesDrift;for(let i=0,r=E;i<f.length;i++){let a=f[i],s=a.pts,o=s-r,l=Math.abs(1e3*o/n);if(o<=-t*u&&p)0===i&&(tX.warn(`Audio frame @ ${(s/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=E=r=s);else if(o>=t*u&&l<1e4&&p){let t=Math.round(o/u);(r=s-t*u)<0&&(t--,r+=u),0===i&&(this.nextAudioPts=E=r),tX.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(r/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let s=0;s<t;s++){let t=Math.max(r,0),s=a0.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(tX.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=a.unit.subarray()),f.splice(i,0,{unit:s,pts:t}),r+=u,i++}}a.pts=r,r+=u}}let T=null,_=null,A=0,S=f.length;for(;S--;)A+=f[S].unit.byteLength;for(let t=0,r=f.length;t<r;t++){let r=f[t],a=r.unit,n=r.pts;if(null!==_)m[t-1].duration=Math.round((n-_)/l);else{if(i&&"aac"===e.segmentCodec&&(n=E),T=n,!(A>0))return;A+=g;try{s=new Uint8Array(A)}catch(e){this.observer.emit(tK.ERROR,tK.ERROR,{type:tW.MUX_ERROR,details:tY.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:A,reason:`fail allocating audio mdat ${A}`});return}c||(new DataView(s.buffer).setUint32(0,A),s.set(a1.types.mdat,4))}s.set(a,g);let o=a.byteLength;g+=o,m.push(new se(!0,d,o,0)),_=n}let k=m.length;if(!k)return;let R=m[m.length-1];this.nextAudioPts=E=_+l*R.duration;let I=c?new Uint8Array(0):a1.moof(e.sequenceNumber++,T/l,t$({},e,{samples:m}));e.samples=[];let L=T/n,w=E/n,D={data1:I,data2:s,startPTS:L,endPTS:w,startDTS:L,endDTS:w,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.isAudioContiguous=!0,D}remuxEmptyAudio(e,t,i,r){let a=e.inputTimeScale,s=e.samplerate?e.samplerate:a,n=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,d=(null!==n?n:r.startDTS*a)+l,u=r.endDTS*a+l,h=a/s*1024,c=Math.ceil((u-d)/h),m=a0.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(tX.warn("[mp4-remuxer]: remux empty Audio"),!m){tX.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}let p=[];for(let e=0;e<c;e++){let t=d+e*h;p.push({unit:m,pts:t,dts:t})}return e.samples=p,this.remuxAudio(e,t,i,!1)}}function a9(e,t){let i;if(null===t)return e;for(i=t<e?-0x200000000:0x200000000;Math.abs(e-t)>0x100000000;)e+=i;return e}function a6(e,t,i,r){let a=e.samples.length;if(!a)return;let s=e.inputTimeScale;for(let n=0;n<a;n++){let a=e.samples[n];a.pts=a9(a.pts-i.baseTime*s/i.timescale,t*s)/s,a.dts=a9(a.dts-r.baseTime*s/r.timescale,t*s)/s}let n=e.samples;return e.samples=[],{samples:n}}function a7(e,t,i){let r=e.samples.length;if(!r)return;let a=e.inputTimeScale;for(let s=0;s<r;s++){let r=e.samples[s];r.pts=a9(r.pts-i.baseTime*a/i.timescale,t*a)/a}e.samples.sort((e,t)=>e.pts-t.pts);let s=e.samples;return e.samples=[],{samples:s}}class se{constructor(e,t,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=r,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}function st(e,t){let i=null==e?void 0:e.codec;if(i&&i.length>4)return i;if(t===t2.AUDIO){if("ec-3"===i||"ac-3"===i||"alac"===i)return i;if("fLaC"===i||"Opus"===i)return i9(i,!1);let e="mp4a.40.5";return tX.info(`Parsed audio codec "${i}" or audio object type not handled. Using "${e}"`),e}return(tX.warn(`Unhandled video codec "${i}"`),"hvc1"===i||"hev1"===i)?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1.42e01e"}try{a=self.performance.now.bind(self.performance)}catch(e){tX.debug("Unable to use Performance API on this environment"),a=null==t7?void 0:t7.Date.now}let si=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){let a=this.videoTrack=aA("video",1),s=this.audioTrack=aA("audio",1),n=this.txtTrack=aA("text",1);if(this.id3Track=aA("id3",1),this.timeOffset=0,!(null!=e&&e.byteLength))return;let o=iU(e);if(o.video){let{id:e,timescale:t,codec:i}=o.video;a.id=e,a.timescale=n.timescale=t,a.codec=i}if(o.audio){let{id:e,timescale:t,codec:i}=o.audio;s.id=e,s.timescale=t,s.codec=i}n.id=iw.text,a.sampleDuration=0,a.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return function(e){let t=e.byteLength;for(let i=0;i<t;){let r=ix(e,i);if(r>8&&109===e[i+4]&&111===e[i+5]&&111===e[i+6]&&102===e[i+7])return!0;i=r>1?i+r:t}return!1}(e)}demux(e,t){this.timeOffset=t;let i=e,r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=iH(this.remainderData,e));let t=function(e){let t={valid:null,remainder:null},i=iP(e,["moof"]);if(i.length<2)return t.remainder=e,t;let r=i[i.length-1];return t.valid=iu(e,0,r.byteOffset-8),t.remainder=iu(e,r.byteOffset-8),t}(i);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=i;let s=this.extractID3Track(r,t);return a.samples=iV(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let r=this.extractID3Track(t,this.timeOffset);return i.samples=iV(e,t),{videoTrack:t,audioTrack:aA(),id3Track:r,textTrack:aA()}}extractID3Track(e,t){let i=this.id3Track;if(e.samples.length){let r=iP(e.samples,["emsg"]);r&&r.forEach(e=>{let r=function(e){let t=e[0],i="",r="",a=0,s=0,n=0,o=0,l=0,d=0;if(0===t){for(;"\0"!==iD(e.subarray(d,d+1));)i+=iD(e.subarray(d,d+1)),d+=1;for(i+=iD(e.subarray(d,d+1)),d+=1;"\0"!==iD(e.subarray(d,d+1));)r+=iD(e.subarray(d,d+1)),d+=1;r+=iD(e.subarray(d,d+1)),d+=1,a=ix(e,12),s=ix(e,16),o=ix(e,20),l=ix(e,24),d=28}else if(1===t){d+=4,a=ix(e,d);let t=ix(e,d+=4),s=ix(e,d+=4);for(d+=4,tH(n=0x100000000*t+s)||(n=Number.MAX_SAFE_INTEGER,tX.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ix(e,d),d+=4,l=ix(e,d),d+=4;"\0"!==iD(e.subarray(d,d+1));)i+=iD(e.subarray(d,d+1)),d+=1;for(i+=iD(e.subarray(d,d+1)),d+=1;"\0"!==iD(e.subarray(d,d+1));)r+=iD(e.subarray(d,d+1)),d+=1;r+=iD(e.subarray(d,d+1)),d+=1}return{schemeIdUri:i,value:r,timeScale:a,presentationTime:n,presentationTimeDelta:s,eventDuration:o,id:l,payload:e.subarray(d,e.byteLength)}}(e);if(aH.test(r.schemeIdUri)){let e=tG(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale,a=0xffffffff===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);let s=r.payload;i.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:rT.emsg,duration:a})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(function(e,t){if(!e||!t)return e;let i=t.keyId;return i&&t.isCommonEncryption&&iP(e,["moov","trak"]).forEach(e=>{let t=iP(e,["mdia","minf","stbl","stsd"])[0].subarray(8),r=iP(t,["enca"]),a=r.length>0;a||(r=iP(t,["encv"])),r.forEach(e=>{iP(a?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{let t=iG(e);if(t){let e=t.subarray(8,24);e.some(e=>0!==e)||(tX.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${iI.hexDump(e)} -> ${iI.hexDump(i)}`),t.set(i,8))}})})}),e}(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(null!=e&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let r=this.initData=iU(e);r.audio&&(t=st(r.audio,t2.AUDIO)),r.video&&(i=st(r.video,t2.VIDEO));let a={};r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:r.audio?a.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?a.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:tX.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,i,r,a,s){var n,o,l;let{initPTS:d,lastEndTime:u}=this,h={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};tG(u)||(u=this.lastEndTime=a||0);let c=t.samples;if(!(null!=c&&c.length))return h;let m={initPTS:void 0,timescale:1},p=this.initData;if(null!=(n=p)&&n.length||(this.generateInitSegment(c),p=this.initData),!(null!=(o=p)&&o.length))return tX.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);let f=function(e,t){let i=0,r=0,a=0,s=iP(e,["moof","traf"]);for(let e=0;e<s.length;e++){let n=s[e],o=iP(n,["tfhd"])[0],l=t[ix(o,4)];if(!l)continue;let d=l.default,u=ix(o,0)|(null==d?void 0:d.flags),h=null==d?void 0:d.duration;8&u&&(h=2&u?ix(o,12):ix(o,8));let c=l.timescale||9e4,m=iP(n,["trun"]);for(let e=0;e<m.length;e++)(i=function(e){let t=ix(e,0),i=8;1&t&&(i+=4),4&t&&(i+=4);let r=0,a=ix(e,4);for(let s=0;s<a;s++)256&t&&(r+=ix(e,i),i+=4),512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4);return r}(m[e]))||!h||(i=h*ix(m[e],4)),l.type===t2.VIDEO?r+=i/c:l.type===t2.AUDIO&&(a+=i/c)}if(0===r&&0===a){let t=1/0,i=0,r=0,a=iP(e,["sidx"]);for(let e=0;e<a.length;e++){let s=function(e){let t=[],i=e[0],r=8,a=ix(e,8);r+=4;let s=0,n=0;0===i?(s=ix(e,r),n=ix(e,r+4),r+=8):(s=iM(e,r),n=iM(e,r+8),r+=16),r+=2;let o=e.length+n,l=iC(e,r);r+=2;for(let i=0;i<l;i++){let i=r,s=ix(e,i);i+=4;let n=0x7fffffff&s;if(1==(0x80000000&s)>>>31)return tX.warn("SIDX has hierarchical references (not supported)"),null;let l=ix(e,i);i+=4,t.push({referenceSize:n,subsegmentDuration:l,info:{duration:l/a,start:o,end:o+n-1}}),o+=n,i+=4,r=i}return{earliestPresentationTime:s,timescale:a,version:i,referencesCount:l,references:t}}(a[e]);null!=s&&s.references&&(t=Math.min(t,s.earliestPresentationTime/s.timescale),r=(i=Math.max(i,s.references.reduce((e,t)=>e+t.info.duration||0,0)+s.earliestPresentationTime/s.timescale))-t)}if(r&&tG(r))return r}return r||a}(c,p),g=(l=p,iP(c,["moof","traf"]).reduce((e,t)=>{let i=iP(t,["tfdt"])[0],r=i[0],a=iP(t,["tfhd"]).reduce((e,t)=>{let a=l[ix(t,4)];if(a){let t=ix(i,4);if(1===r){if(0xffffffff===t)return tX.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),e;t*=0x100000000,t+=ix(i,8)}let s=t/(a.timescale||9e4);if(tG(s)&&(null===e||s<e))return s}return e},null);return null!==a&&tG(a)&&(null===e||a<e)?a:e},null)),E=null===g?a:g;((function(e,t,i,r){if(null===e)return!0;let a=Math.max(r,1);return Math.abs(t-e.baseTime/e.timescale-i)>a})(d,E,a,f)||m.timescale!==d.timescale&&s)&&(m.initPTS=E-a,d&&1===d.timescale&&tX.warn(`Adjusting initPTS by ${m.initPTS-d.baseTime}`),this.initPTS=d={baseTime:m.initPTS,timescale:1});let b=e?E-d.baseTime/d.timescale:u,y=b+f;!function(e,t,i){iP(t,["moof","traf"]).forEach(t=>{iP(t,["tfhd"]).forEach(r=>{let a=e[ix(r,4)];if(!a)return;let s=a.timescale||9e4;iP(t,["tfdt"]).forEach(e=>{let t=e[0],r=i*s;if(r){let i=ix(e,4);if(0===t)i-=r,iN(e,4,i=Math.max(i,0));else{i*=0x100000000,i+=ix(e,8),i-=r;let t=Math.floor((i=Math.max(i,0))/0x100000000),a=Math.floor(i%0x100000000);iN(e,4,t),iN(e,8,a)}}})})})}(p,c,d.baseTime/d.timescale),f>0?this.lastEndTime=y:(tX.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let T=!!p.audio,_=!!p.video,A="";T&&(A+="audio"),_&&(A+="video");let S={data1:c,startPTS:b,startDTS:b,endPTS:y,endDTS:y,type:A,hasAudio:T,hasVideo:_,nb:1,dropped:0};return h.audio="audio"===S.type?S:void 0,h.video="audio"!==S.type?S:void 0,h.initSegment=m,h.id3=a6(i,a,d,d),r.samples.length&&(h.text=a7(r,a,d)),h}}},{demux:az,remux:a8},{demux:class extends aS{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=im(e,0),i=(null==t?void 0:t.length)||0;if(aG(e,i))return!1;for(let t=e.length;i<t;i++)if(function(e,t){if(aw(e,t)){let i=aI(e,t);if(t+i>=e.length)return!1;let r=aL(e,t);if(r<=i)return!1;let a=t+r;return a===e.length||aw(e,a)}return!1}(e,i))return tX.log("ADTS sync word found !"),!0;return!1}canParse(e,t){var i,r;return i=e,(r=t)+5<i.length&&aR(i,r)&&aL(i,r)<=i.length-r}appendFrame(e,t,i){aD(e,this.observer,t,i,e.manifestCodec);let r=aC(e,t,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:a8},{demux:class extends aS{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=im(e,0),i=(null==t?void 0:t.length)||0;if(t&&11===e[i]&&119===e[i+1]&&void 0!==iv(t)&&16>=aV(e,i))return!1;for(let t=e.length;i<t;i++)if(aG(e,i))return tX.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return aB(e,t)&&4<=e.length-t}appendFrame(e,t,i){if(null!==this.basePTS)return aU(e,t,i,this.basePTS,this.frameIndex)}},remux:a8}];si.splice(2,0,{demux:class extends aS{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){let r=aK(e,t,i,this.basePTS,this.frameIndex);if(-1!==r)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;let t=im(e,0);if(!t)return!1;let i=t.length;return!!(11===e[i]&&119===e[i+1]&&void 0!==iv(t)&&16>aV(e,i))}},remux:a8});class sr{constructor(e,t,i,r,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r,this.id=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){var s,n;let o,l=i.transmuxing;l.executeStart=a();let d=new Uint8Array(e),{currentTransmuxState:u,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);let{contiguous:c,discontinuity:m,trackSwitch:p,accurateTimeOffset:f,timeOffset:g,initSegmentChange:E}=r||u,{audioCodec:b,videoCodec:y,defaultInitPts:T,duration:_,initSegmentData:A}=h,S=(s=d,n=t,o=null,s.byteLength>0&&(null==n?void 0:n.key)!=null&&null!==n.iv&&null!=n.method&&(o=n),o);if(S&&"AES-128"===S.method){let e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(d,S.key.buffer,S.iv.buffer).then(e=>{let t=this.push(e,null,i);return this.decryptionPromise=null,t}),this.decryptionPromise;{let t=e.softwareDecrypt(d,S.key.buffer,S.iv.buffer);if(i.part>-1&&(t=e.flush()),!t)return l.executeEnd=a(),sa(i);d=new Uint8Array(t)}}let k=this.needsProbing(m,p);if(k){let e=this.configureTransmuxer(d);if(e)return tX.warn(`[transmuxer] ${e.message}`),this.observer.emit(tK.ERROR,tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),l.executeEnd=a(),sa(i)}(m||p||E||k)&&this.resetInitSegment(A,b,y,_,t),(m||E||k)&&this.resetInitialTimestamp(T),c||this.resetContiguity();let R=this.transmux(d,S,g,f,i),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,l.executeEnd=a(),R}flush(e){let t=e.transmuxing;t.executeStart=a();let{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));let n=[],{timeOffset:o}=r;if(i){let t=i.flush();t&&n.push(this.push(t,null,e))}let{demuxer:l,remuxer:d}=this;if(!l||!d)return t.executeEnd=a(),[sa(e)];let u=l.flush(o);return ss(u)?u.then(t=>(this.flushRemux(n,t,e),n)):(this.flushRemux(n,u,e),n)}flushRemux(e,t,i){let{audioTrack:r,videoTrack:s,id3Track:n,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:d}=this.currentTransmuxState;tX.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);let u=this.remuxer.remux(r,s,n,o,d,l,!0,this.id);e.push({remuxResult:u,chunkMeta:i}),i.transmuxing.executeEnd=a()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,a){let{demuxer:s,remuxer:n}=this;s&&n&&(s.resetInitSegment(e,t,i,r),n.resetInitSegment(e,t,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,a){let s;return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,r,a):this.transmuxUnencrypted(e,i,r,a)}transmuxUnencrypted(e,t,i,r){let{audioTrack:a,videoTrack:s,id3Track:n,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,s,n,o,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,a){return this.demuxer.demuxSampleAes(e,t,i).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){let t;let{config:i,observer:r,typeSupported:a,vendor:s}=this;for(let i=0,r=si.length;i<r;i++){var n;if(null!=(n=si[i].demux)&&n.probe(e)){t=si[i];break}}if(!t)return Error("Failed to find demuxer by probing fragment data");let o=this.demuxer,l=this.remuxer,d=t.remux,u=t.demux;l&&l instanceof d||(this.remuxer=new d(r,i,a,s)),o&&o instanceof u||(this.demuxer=new u(r,i,a),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new aE(this.config)),e}}let sa=e=>({remuxResult:{},chunkMeta:e});function ss(e){return"then"in e&&e.then instanceof Function}class sn{constructor(e,t,i,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=a||null}}class so{constructor(e,t,i,r,a,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=s}}var sl={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,r,s,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,s||e,n),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,n=Array(s);a<s;a++)n[a]=r[a].fn;return n},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,s,n){var o=i?i+e:e;if(!this._events[o])return!1;var l,d,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,s),!0;case 6:return u.fn.call(u.context,t,r,a,s,n),!0}for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var c,m=u.length;for(d=0;d<m;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),h){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,r);break;case 4:u[d].fn.call(u[d].context,t,r,a);break;default:if(!l)for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u[d].fn.apply(u[d].context,l)}}return!0},o.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,a){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return n(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||n(this,s);else{for(var l=0,d=[],u=o.length;l<u;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&d.push(o[l]);d.length?this._events[s]=1===d.length?d[0]:d:n(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&n(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(sl);var sd=(oW=sl.exports)&&oW.__esModule&&Object.prototype.hasOwnProperty.call(oW,"default")?oW.default:oW;class su{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;let a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;let s=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===tK.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new sd,this.observer.on(tK.FRAG_DECRYPTED,s),this.observer.on(tK.ERROR,s);let n=iZ(a.preferManagedMediaSource)||{isTypeSupported:()=>!1},o={mpeg:n.isTypeSupported("audio/mpeg"),mp3:n.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:n.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker&&(a.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__)){try{a.workerPath?(tX.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=function(e){let t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(a.workerPath)):(tX.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);let{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{let i=Error(`${e.message}  (${e.filename}:${e.lineno})`);a.enableWorker=!1,tX.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(tK.ERROR,{type:tW.OTHER_ERROR,details:tY.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},e.postMessage({cmd:"init",typeSupported:o,vendor:"",id:t,config:JSON.stringify(a)})}catch(e){tX.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new sr(this.observer,o,a,"",t)}return}this.transmuxer=new sr(this.observer,o,a,"",t)}resetWorker(){if(this.workerContext){let{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{let e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,r,a,s,n,o,l,d){var u,h;l.transmuxing.start=self.performance.now();let{transmuxer:c}=this,m=s?s.start:a.start,p=a.decryptdata,f=this.frag,g=!(f&&a.cc===f.cc),E=!(f&&l.level===f.level),b=f?l.sn-f.sn:-1,y=this.part?l.part-this.part.index:-1,T=0===b&&l.id>1&&l.id===(null==f?void 0:f.stats.chunkCount),_=!E&&(1===b||0===b&&(1===y||T&&y<=0)),A=self.performance.now();(E||b||0===a.stats.parsing.start)&&(a.stats.parsing.start=A),s&&(y||!_)&&(s.stats.parsing.start=A);let S=!(f&&(null==(u=a.initSegment)?void 0:u.url)===(null==(h=f.initSegment)?void 0:h.url)),k=new so(g,_,o,E,m,S);if(!_||g||S){tX.log(`[transmuxer-interface, ${a.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}
        discontinuity: ${g}
        trackSwitch: ${E}
        contiguous: ${_}
        accurateTimeOffset: ${o}
        timeOffset: ${m}
        initSegmentChange: ${S}`);let e=new sn(i,r,t,n,d);this.configureTransmuxer(e)}if(this.frag=a,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:k},e instanceof ArrayBuffer?[e]:[]);else if(c){let t=c.push(e,p,l,k);ss(t)?(c.async=!0,t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):(c.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();let{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);ss(i)||t.async?(ss(i)||(i=Promise.resolve(i)),i.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}onWorkerMessage(e){let t=e.data;if(!(null!=t&&t.event)){tX.warn(`worker message received with no ${t?"event name":"data"}`);return}let i=this.hls;if(this.hls)switch(t.event){case"init":{var r;let e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":tX[t.data.logType]&&tX[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}configureTransmuxer(e){let{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function sh(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!sc(e[i].attrs,t[i].attrs))return!1;return!0}function sc(e,t,i){let r=e["STABLE-RENDITION-ID"];return r&&!i?r===t["STABLE-RENDITION-ID"]:!(i||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>e[i]!==t[i])}function sm(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class sp{constructor(e){this.buffered=void 0;let t=(t,i,r)=>{if((i>>>=0)>r-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][t]};this.buffered={get length(){return e.length},end:i=>t("end",i,e.length),start:i=>t("start",i,e.length)}}}class sf{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,i){let r=this.queues[t];r.push(e),1!==r.length||i||this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;let i=new Promise(e=>{t=e}),r={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),i}executeNext(e){let t=this.queues[e];if(t.length){let i=t[0];try{i.execute()}catch(r){tX.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${r}`),i.onError(r);let t=this.buffers[e];null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}let sg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function sv(e){let t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}let sE={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},sb=e=>String.fromCharCode(sE[e]||e),sy={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},sT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s_={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sA={25:2,26:4,29:6,30:8,31:10,27:13,28:15},sS=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class sk{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let i="function"==typeof t?t():t;tX.log(`${this.time} [${e}] ${i}`)}}}let sR=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class sI{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class sL{constructor(){this.uchar=" ",this.penState=new sI}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class sw{constructor(e){this.chars=[],this.pos=0,this.currPenState=new sI,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<100;e++)this.chars.push(new sL);this.logger=e}equals(e){for(let t=0;t<100;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<100;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}moveCursor(e){let t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=sb(e);if(this.pos>=100){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<100;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<100;i++){let r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class sD{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<15;t++)this.rows.push(new sw(e));this.logger=e}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<15;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<15;e++)this.rows[e].clear();let e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){let r=i.rows[e].cueStartTime,a=this.logger.time;if(null!==r&&null!==a&&r<a)for(let r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(i.rows[e+r])}}this.currRow=t;let i=this.rows[this.currRow];if(null!==e.indent){let t=Math.max(e.indent-1,0);i.setCursor(e.indent),e.color=i.chars[t].penState.foreground}let r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",r=-1;for(let i=0;i<15;i++){let a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class sC{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new sD(i),this.nonDisplayedMemory=new sD(i),this.lastOutputScreen=new sD(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{let i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}}class sx{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;let r=this.logger=new sk;this.channels=[null,new sC(e,t,r),new sC(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){var i,r,a,s,n,o,l,d,u,h,c,m;let p=127&t[e],f=127&t[e+1],g=!1,E=null;if(0===p&&0===f)continue;this.logger.log(3,()=>"["+sR([t[e],t[e+1]])+"] -> ("+sR([p,f])+")");let b=this.cmdHistory;if(p>=16&&p<=31){if(i=p,r=f,(a=b).a===i&&a.b===r){s=null,n=null,(o=b).a=null,o.b=null,this.logger.log(3,()=>"Repeated command ("+sR([p,f])+") is dropped");continue}l=p,d=f,(u=this.cmdHistory).a=l,u.b=d,(g=this.parseCmd(p,f))||(g=this.parseMidrow(p,f)),g||(g=this.parsePAC(p,f)),g||(g=this.parseBackgroundAttributes(p,f))}else{h=null,c=null,(m=b).a=null,m.b=null}if(!g&&(E=this.parseChars(p,f))){let e=this.currentChannel;e&&e>0?this.channels[e].insertChars(E):this.logger.log(2,"No channel found yet. TEXT-MODE?")}g||E||this.logger.log(2,()=>"Couldn't parse cleaned data "+sR([p,f])+" orig: "+sR([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;let i=20===e||21===e||23===e?1:2,r=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if((i=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let r=this.channels[i];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+sR([e,t])+")"),!0)}return!1}parsePAC(e,t){let i;let r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(16===e||24===e)&&t>=64&&t<=95;if(!(r||a))return!1;let s=e<=23?1:2;i=t>=64&&t<=95?1===s?sy[e]:s_[e]:1===s?sT[e]:sA[e];let n=this.channels[s];return!!n&&(n.setPAC(this.interpretPAC(i,t)),this.currentChannel=s,!0)}interpretPAC(e,t){let i;let r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,r.underline=(1&i)==1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(e,t){let i;let r=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){let e;e=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,()=>"Special char '"+sb(e)+"' in channel "+i),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+sR(r).join(",")),r}parseBackgroundAttributes(e,t){let i;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let r={};return 16===e||24===e?(i=Math.floor((t-32)/2),r.background=sS[i],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),this.channels[e<=23?1:2].setBkgData(r),!0}reset(){var e,t,i;for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}e=null,t=null,(i=this.cmdHistory).a=null,i.b=null}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}}class sM{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var sO=function(){if(null!=t7&&t7.VTTCue)return self.VTTCue;let e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;let i=t.toLowerCase();return!!~e.indexOf(i)&&i}function r(e,...t){let i=1;for(;i<arguments.length;i++){let t=arguments[i];for(let i in t)e[i]=t[i]}return e}function a(a,s,n){let o={enumerable:!0};this.hasBeenReset=!1;let l="",d=!1,u=a,h=s,c=n,m=null,p="",f=!0,g="auto",E="start",b=50,y="middle",T=50,_="middle";Object.defineProperty(this,"id",r({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(this,"pauseOnExit",r({},o,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(this,"startTime",r({},o,{get:function(){return u},set:function(e){if("number"!=typeof e)throw TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"endTime",r({},o,{get:function(){return h},set:function(e){if("number"!=typeof e)throw TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"text",r({},o,{get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}})),Object.defineProperty(this,"region",r({},o,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"vertical",r({},o,{get:function(){return p},set:function(t){let r=i(e,t);if(!1===r)throw SyntaxError("An invalid or illegal string was specified.");p=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"snapToLines",r({},o,{get:function(){return f},set:function(e){f=!!e,this.hasBeenReset=!0}})),Object.defineProperty(this,"line",r({},o,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"lineAlign",r({},o,{get:function(){return E},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");E=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"position",r({},o,{get:function(){return b},set:function(e){if(e<0||e>100)throw Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"positionAlign",r({},o,{get:function(){return y},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");y=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"size",r({},o,{get:function(){return T},set:function(e){if(e<0||e>100)throw Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"align",r({},o,{get:function(){return _},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");_=r,this.hasBeenReset=!0}})),this.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class sN{decode(e,t){if(!e)return"";if("string"!=typeof e)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function sP(e){function t(e,t,i,r){return(0|e)*3600+(0|t)*60+(0|i)+parseFloat(r||0)}let i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class sU{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function sF(e,t,i,r){let a=r?e.split(r):[e];for(let e in a){if("string"!=typeof a[e])continue;let r=a[e].split(i);if(2===r.length)t(r[0],r[1])}}let sB=new sO(0,0,""),s$="middle"===sB.align?"middle":"center";function sG(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class sH{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new sN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;function i(){let e=t.buffer,i=0;for(e=sG(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;let r=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;let r=(e=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(null!=r&&r[0]))throw Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer&&/\r\n|\n/.test(t.buffer);)switch(a?a=!1:e=i(),t.state){case"HEADER":if(/:/.test(e)){var r;r=e,sF(r,function(e,t){},/:/)}else e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new sO(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{!function(e,t,i){let r=e;function a(){let t=sP(e);if(null===t)throw Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=a(),s(),"--\x3e"!==e.slice(0,3))throw Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),s(),t.endTime=a(),s(),function(e,t){let r=new sU;sF(e,function(e,t){let a;switch(e){case"region":for(let a=i.length-1;a>=0;a--)if(i[a].id===t){r.set(e,i[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":a=t.split(","),r.integer(e,a[0]),r.percent(e,a[0])&&r.set("snapToLines",!1),r.alt(e,a[0],["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",s$,"end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",s$,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",s$,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let a=r.get("line","auto");"auto"===a&&-1===sB.line&&(a=-1),t.line=a,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",s$);let s=r.get("position","auto");"auto"===s&&50===sB.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let i=-1!==e.indexOf("--\x3e");if(!e||i&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}}let sV=/\r\n|\n\r|\n|\r/g,sK=function(e,t,i=0){return e.slice(i,i+t.length)===t},sW=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!tG(t)||!tG(i)||!tG(r)||!tG(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=6e4*r,t+=36e5*a},sY=function(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function sq(e,t,i){return sY(e.toString())+sY(t.toString())+sY(i)}let sj=function(e,t,i){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;null!=(s=a)&&s.new;){var s;e.ccOffset+=r.start-a.start,r.new=!1,a=e[(r=a).prevCC]}e.presentationOffset=i},sz="stpp.ttml.im1t",sX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,sQ=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,sZ={left:"start",center:"center",right:"end",start:"start",end:"end"};function sJ(e,t,i,r){let a=iP(new Uint8Array(e),["mdat"]);if(0===a.length){r(Error("Could not parse IMSC1 mdat"));return}let s=a.map(e=>iR(e)),n=function(e,t,i=1,r=!1){return a2(e,1,1/i,r)}(t.baseTime,0,t.timescale);try{s.forEach(e=>i(function(e,t){let i=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!i)throw Error("Invalid ttml");let r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e),{}),s="preserve"!==i.getAttribute("xml:space"),n=s1(s0(i,"styling","style")),o=s1(s0(i,"layout","region")),l=s0(i,"body","[begin]");return[].map.call(l,e=>{let i=function e(t,i){return[].slice.call(t.childNodes).reduce((t,r,a)=>{var s;return"br"===r.nodeName&&a?t+"\n":null!=(s=r.childNodes)&&s.length?e(r,i):i?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}(e,s);if(!i||!e.hasAttribute("begin"))return null;let r=s4(e.getAttribute("begin"),a),l=s4(e.getAttribute("dur"),a),d=s4(e.getAttribute("end"),a);if(null===r)throw s3(e);if(null===d){if(null===l)throw s3(e);d=r+l}let u=new sO(r-t,d-t,i);u.id=sq(u.startTime,u.endTime,u.text);let h=o[e.getAttribute("region")],c=function(e,t,i){let r="http://www.w3.org/ns/ttml#styling",a=null,s=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return s&&i.hasOwnProperty(s)&&(a=i[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((i,s)=>{let n=s2(t,r,s)||s2(e,r,s)||s2(a,r,s);return n&&(i[s]=n),i},{})}(h,n[e.getAttribute("style")],n),{textAlign:m}=c;if(m){let e=sZ[m];e&&(u.lineAlign=e),u.align=m}return t$(u,c),u}).filter(e=>null!==e)}(e,n)))}catch(e){r(e)}}function s0(e,t,i){let r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function s1(e){return e.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function s2(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function s3(e){return Error(`Could not parse ttml timestamp ${e}`)}function s4(e,t){if(!e)return null;let i=sP(e);return null===i&&(sX.test(e)?i=function(e,t){let i=sX.exec(e),r=(0|i[4])+(0|i[5])/t.subFrameRate;return(0|i[1])*3600+(0|i[2])*60+(0|i[3])+r/t.frameRate}(e,t):sQ.test(e)&&(i=function(e,t){let i=sQ.exec(e),r=Number(i[1]);switch(i[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),i}function s5(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function s8(e,t){return!!e&&e.kind===s5(t)&&sm(t,e)}function s9(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class s6{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(tK.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tK.BUFFER_CODECS,this.onBufferCodecs,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(tK.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tK.BUFFER_CODECS,this.onBufferCodecs,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&tG(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&tX.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return -1;let i=t.filter((t,i)=>this.isLevelAllowed(t)&&i<=e);return this.clientRect=null,s6.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){!this.timer&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,i){if(!(null!=e&&e.length))return -1;let r=(e,t)=>!t||e.width!==t.width||e.height!==t.height,a=e.length-1,s=Math.max(t,i);for(let t=0;t<e.length;t+=1){let i=e[t];if((i.width>=s||i.height>=s)&&r(i,e[t+1])){a=t;break}}return a}}let s7="[eme]";class ne{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ne.CDMCleanupPromise?[ne.CDMCleanupPromise]:[],this.debug=tX.debug.bind(tX,s7),this.log=tX.log.bind(tX,s7),this.warn=tX.warn.bind(tX,s7),this.error=tX.error.bind(tX,s7),this.onMediaEncrypted=e=>{let{initDataType:t,initData:i}=e,r=`"${e.type}" event: init data type: "${t}"`;if(this.debug(r),null!==i){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=io(this.config));let t=e.map(is).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(a=>{let s,n;let o=ii(a);if("sinf"===t){if(o!==ie.FAIRPLAY){this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${o}`);return}let a=iD(new Uint8Array(i));try{let e=t9(JSON.parse(a).sinf),t=iG(e);if(!t)throw Error("'schm' box missing or not cbcs/cenc with schi > tenc");s=t.subarray(8,24),n=ie.FAIRPLAY}catch(e){this.warn(`${r} Failed to parse sinf: ${e}`);return}}else{if(o!==ie.WIDEVINE&&o!==ie.PLAYREADY){this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${o}`);return}let a=function(e){let t=[];if(e instanceof ArrayBuffer){let i=e.byteLength,r=0;for(;r+32<i;){let i=function(e){let t=e.getUint32(0),i=e.byteOffset,r=e.byteLength;if(r<t)return{offset:i,size:r};if(0x70737368!==e.getUint32(4))return{offset:i,size:t};let a=e.getUint32(8)>>>24;if(0!==a&&1!==a)return{offset:i,size:t};let s=e.buffer,n=iI.hexDump(new Uint8Array(s,i+12,16)),o=e.getUint32(28),l=null,d=null;if(0===a){if(t-32<o||o<22)return{offset:i,size:t};d=new Uint8Array(s,i+32,o)}else if(1===a){if(!o||r<i+32+16*o+16)return{offset:i,size:t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(s,i+32+16*e,16))}return{version:a,systemId:n,kids:l,data:d,offset:i,size:t}}(new DataView(e,r));t.push(i),r+=i.size}}return t}(i),l=a.filter(e=>!!e.systemId&&ia(e.systemId)===o);l.length>1&&this.warn(`${r} Using first of ${l.length} pssh found for selected key-system ${o}`);let d=l[0];if(!d){0===a.length||a.some(e=>!e.systemId)?this.warn(`${r} contains incomplete or invalid pssh data`):this.log(`ignoring ${r} for ${a.map(e=>ia(e.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(n=ia(d.systemId),0===d.version&&d.data){if(n===ie.WIDEVINE){let e=d.data.length-22;s=d.data.subarray(e,e+16)}else n===ie.PLAYREADY&&(s=id(d.data))}}if(!n||!s){this.log(`Unable to handle ${r} with key-system ${o}`);return}let l=iI.hexDump(s),{keyIdToKeySessionPromise:d,mediaKeySessions:u}=this,h=d[l];for(let e=0;e<u.length;e++){let r=u[e],a=r.decryptdata;if(!a.keyId)continue;let n=iI.hexDump(a.keyId);if(l===n||-1!==a.uri.replace(/-/g,"").indexOf(l)){if(h=d[n],a.pssh)break;delete d[n],a.pssh=new Uint8Array(i),a.keyId=s,(h=d[l]=h.then(()=>this.generateRequestWithPreferredKeySession(r,t,i,"encrypted-event-key-match"))).catch(e=>this.handleError(e));break}}if(!h){if(n!==o){this.log(`Ignoring "${r}" with ${n} init data for selected key-system ${o}`);return}(h=d[l]=this.getKeySystemSelectionPromise([n]).then(({keySystem:e,mediaKeys:r})=>{var a;this.throwIfDestroyed();let n=new iq("ISO-23001-7",l,null!=(a=is(e))?a:"");return n.pssh=new Uint8Array(i),n.keyId=s,this.attemptSetMediaKeys(e,r).then(()=>{this.throwIfDestroyed();let a=this.createMediaKeySessionContext({decryptdata:n,keySystem:e,mediaKeys:r});return this.generateRequestWithPreferredKeySession(a,t,i,"encrypted-event-no-match")})})).catch(e=>this.handleError(e))}})}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();let e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(tK.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(tK.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(tK.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(tK.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){let{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];return r?r.licenseUrl:e===ie.WIDEVINE&&i?i:void 0}getLicenseServerUrlOrThrow(e){let t=this.getLicenseServerUrl(e);if(void 0===t)throw Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){let{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){let t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(i),a=t.map(e=>e.videoCodec).filter(i);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((t,i)=>{let s=e=>{let n=e.shift();this.getMediaKeysPromise(n,r,a).then(e=>t({keySystem:n,mediaKeys:e})).catch(t=>{e.length?s(e):t instanceof nt?i(t):i(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){let{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===il&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){let r=function(e,t,i,r){var a,s,n,o;let l;switch(e){case ie.FAIRPLAY:l=["cenc","sinf"];break;case ie.WIDEVINE:case ie.PLAYREADY:l=["cenc"];break;case ie.CLEARKEY:l=["cenc","keyids"];break;default:throw Error(`Unknown key-system: ${e}`)}return a=l,s=t,n=i,[{initDataTypes:a,persistentState:(o=r).persistentState||"optional",distinctiveIdentifier:o.distinctiveIdentifier||"optional",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:s.map(e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:`video/mp4; codecs="${e}"`,robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}))}]}(e,t,i,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],s=null==a?void 0:a.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),s=this.requestMediaKeySystemAccess(e,r);let t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),s.then(i=>{this.log(`Access for key-system "${i.keySystem}" obtained`);let r=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=i.createMediaKeys().then(t=>(this.log(`Media-keys created for "${e}"`),r.then(i=>i?this.setMediaKeysServerCertificate(t,e,i):t))),t.mediaKeys.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),t.mediaKeys})}return s.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${iI.hexDump(e.keyId||[])}`);let r=i.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){let t=e.decryptdata;if(t.pssh){let i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t);this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw Error("keyId is null");return iI.hexDump(e.keyId)}updateKeySession(e,t){var i;let r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${iI.hexDump((null==(i=e.decryptdata)?void 0:i.keyId)||[])}
      } (data length: ${t?t.byteLength:t})`),r.update(t)}selectKeySystemFormat(e){let t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{let r=io(this.config),a=e.map(ii).filter(e=>!!e&&-1!==r.indexOf(e));return this.getKeySystemSelectionPromise(a).then(({keySystem:e})=>{let r=is(e);r?t(r):i(Error(`Unable to find format for key-system "${e}"`))}).catch(i)})}loadKey(e){let t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let a=this.keyIdToKeySessionPromise[i];return a||(a=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then(({keySystem:i,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(i,a).then(()=>{this.throwIfDestroyed();let e=this.createMediaKeySessionContext({keySystem:i,mediaKeys:a,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")})))).catch(e=>this.handleError(e)),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof nt?this.hls.trigger(tK.ERROR,e.data):this.hls.trigger(tK.ERROR,{type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){let t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){let t=ii(e.keyFormat),i=t?[t]:io(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=io(this.config)),0===e.length)throw new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){let i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);let r=Promise.all(i).then(()=>{if(!this.media)throw Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===i.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,i,r){var a,s,n;let o=null==(a=this.config.drmSystems)?void 0:null==(s=a[e.keySystem])?void 0:s.generateRequest;if(o)try{let r=o.call(this.hls,t,i,e);if(!r)throw Error("Invalid response from configured generateRequest filter");t=r.initDataType,i=e.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(e){if(this.warn(e.message),null!=(n=this.hls)&&n.config.debug)throw e}if(null===i)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);let l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);let d=new sd,u=e._onmessage=t=>{let i=e.mediaKeysSession;if(!i){d.emit("error",Error("invalid state"));return}let{messageType:r,message:a}=t;this.log(`"${r}" message event for session "${i.sessionId}" message size: ${a.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(e,a).catch(e=>{this.handleError(e),d.emit("error",e)}):"license-release"===r?e.keySystem===ie.FAIRPLAY&&(this.updateKeySession(e,t6("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${r}"`)},h=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession){d.emit("error",Error("invalid state"));return}this.onKeyStatusChange(e);let i=e.keyStatus;d.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",u),e.mediaKeysSession.addEventListener("keystatuseschange",h);let c=new Promise((e,t)=>{d.on("error",t),d.on("keyStatus",i=>{i.startsWith("usable")?e():"output-restricted"===i?t(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${i}"`)):"expired"===i?t(Error("key expired while generating request")):this.warn(`unhandled key status change "${i}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)}).catch(e=>{throw new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)}).then(()=>c).catch(t=>{throw d.removeAllListeners(),this.removeSession(e),t}).then(()=>(d.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${iI.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${iI.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){let t=this.config,i=new t.loader(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,s)=>{let n={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};i.load(n,l,{onSuccess:(e,t,i,r)=>{a(e.data)},onError:(t,i,a,o)=>{s(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:tB({url:n.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,i,a)=>{s(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,i)=>{s(Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,a)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${null==i?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(e=>{a(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(e=>{throw new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}unpackPlayReadyKeyMessage(e,t){let i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;let r=new DOMParser().parseFromString(i,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let t;for(let i=0,r=a.length;i<r;i++){var s,n;let r=null==(s=(t=a[i]).querySelector("name"))?void 0:s.textContent,o=null==(n=t.querySelector("value"))?void 0:n.textContent;r&&o&&e.setRequestHeader(r,o)}}let o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw Error("Cannot find <Challenge> in key message");return t6(atob(l))}setupLicenseXHR(e,t,i,r){let a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw Error("Key removed");return a.call(this.hls,e,t,i,r)}).catch(s=>{if(!i.decryptdata)throw s;return e.open("POST",t,!0),a.call(this.hls,e,t,i,r)}).then(i=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:i||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){let i=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{let s=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${s}`);let n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(Error("invalid state"));if(4===n.readyState){if(200===n.status){this._requestLicenseFailureCount=0;let t=n.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);let i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,n,s,e)}catch(e){this.error(e)}r(t)}else{let o=i.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||n.status>=400&&n.status<500)a(new nt({type:tW.KEY_SYSTEM_ERROR,details:tY.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:s,data:void 0,code:n.status,text:n.statusText}},`License Request XHR failed (${s}). Status: ${n.status} (${n.statusText})`));else{let i=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${i} attempts left`),this.requestLicense(e,t).then(r,a)}}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=n,this.setupLicenseXHR(n,s,e,t).then(({xhr:t,licenseChallenge:i})=>{e.keySystem==ie.PLAYREADY&&(i=this.unpackPlayReadyKeyMessage(t,i)),t.send(i)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;let i=t.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){let e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},iq.clearKeyUriToKeyIdMap();let i=t.length;ne.CDMCleanupPromise=Promise.all(t.map(e=>this.removeSession(e)).concat(null==e?void 0:e.setMediaKeys(null).catch(e=>{this.log(`Could not clear media keys: ${e}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){let e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;let r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch(e=>{this.log(`Could not remove session: ${e}`)}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`)})}}}ne.CDMCleanupPromise=void 0;class nt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=Error(t)),this.data=e,e.err=e.error}}(oY=oz||(oz={})).MANIFEST="m",oY.AUDIO="a",oY.VIDEO="v",oY.MUXED="av",oY.INIT="i",oY.CAPTION="c",oY.TIMED_TEXT="tt",oY.KEY="k",oY.OTHER="o",(oq=oX||(oX={})).DASH="d",oq.HLS="h",oq.SMOOTH="s",oq.OTHER="o",(oj=oQ||(oQ={})).OBJECT="CMCD-Object",oj.REQUEST="CMCD-Request",oj.SESSION="CMCD-Session",oj.STATUS="CMCD-Status";let ni={[oQ.OBJECT]:["br","d","ot","tb"],[oQ.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[oQ.SESSION]:["cid","pr","sf","sid","st","v"],[oQ.STATUS]:["bs","rtp"]};class nr{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(e=>e instanceof nr?e:new nr(e))),this.value=e,this.params=t}}class na{constructor(e){this.description=void 0,this.description=e}}let ns="Bare Item",nn=/[\x00-\x1f\x7f]+/;function no(e,t,i){return Error(`failed to serialize "${Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"==typeof e?JSON.stringify(e):String(e)}" as ${t}`,{cause:i})}function nl(e){if(e<-0x38d7ea4c67fff||0x38d7ea4c67fff<e)throw no(e,"Integer");return e.toString()}function nd(e){let t=e.description||e.toString().slice(7,-1);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw no(t,"Token");return t}function nu(e){switch(typeof e){case"number":if(!tG(e))throw no(e,ns);if(Number.isInteger(e))return nl(e);return function(e){let t=function e(t,i){if(t<0)return-e(-t,i);let r=Math.pow(10,i);if(!(Math.abs(t*r%1-.5)<Number.EPSILON))return Math.round(t*r)/r;{let e=Math.floor(t*r);return(e%2==0?e:e+1)/r}}(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw no(e,"Decimal");let i=t.toString();return i.includes(".")?i:`${i}.0`}(e);case"string":return function(e){if(nn.test(e))throw no(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return nd(e);case"boolean":return function(e){if("boolean"!=typeof e)throw no(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return`@${nl(e.getTime()/1e3)}`;if(e instanceof Uint8Array)return function(e){if(!1===ArrayBuffer.isView(e))throw no(e,"Byte Sequence");return`:${btoa(String.fromCharCode(...e))}:`}(e);if(e instanceof na)return nd(e);default:throw no(e,ns)}}function nh(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw no(e,"Key");return e}function nc(e){return null==e?"":Object.entries(e).map(([e,t])=>!0===t?`;${nh(e)}`:`;${nh(e)}=${nu(t)}`).join("")}function nm(e){return e instanceof nr?`${nu(e.value)}${nc(e.params)}`:nu(e)}let np=e=>"ot"===e||"sf"===e||"st"===e,nf=e=>"number"==typeof e?tG(e):null!=e&&""!==e&&!1!==e,ng=e=>Math.round(e),nv=e=>100*ng(e/100),nE={br:ng,d:ng,bl:nv,dl:nv,mtp:nv,nor:(e,t)=>(null!=t&&t.baseUrl&&(e=function(e,t){let i=new URL(e),r=new URL(t);if(i.origin!==r.origin)return e;let a=i.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;a[0]===s[0];)a.shift(),s.shift();for(;s.length;)s.shift(),a.unshift("..");return a.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:nv,tb:ng};function nb(e,t={}){return e?function(e,t={whitespace:!0}){if("object"!=typeof e)throw no(e,"Dict");let i=e instanceof Map?e.entries():Object.entries(e),r=null!=t&&t.whitespace?" ":"";return Array.from(i).map(([e,t])=>{t instanceof nr==!1&&(t=new nr(t));let i=nh(e);if(!0===t.value)i+=nc(t.params);else if(i+="=",Array.isArray(t.value)){var r;i+=(r=t,`(${r.value.map(nm).join(" ")})${nc(r.params)}`)}else i+=nm(t);return i}).join(`,${r}`)}(function(e,t){let i={};if(null==e||"object"!=typeof e)return i;let r=Object.keys(e).sort(),a=t$({},nE,null==t?void 0:t.formatters),s=null==t?void 0:t.filter;return r.forEach(r=>{if(null!=s&&s(r))return;let n=e[r],o=a[r];o&&(n=o(n,t)),("v"!==r||1!==n)&&("pr"!=r||1!==n)&&nf(n)&&(np(r)&&"string"==typeof n&&(n=new na(n)),i[r]=n)}),i}(e,t),t$({whitespace:!1},t)):""}let ny=/CMCD=[^&#]+/;function nT(e,t,i,r){e&&Object.keys(t).forEach(a=>{let s=e.filter(e=>e.groupId===a).map(e=>{let s=t$({},e);return s.details=void 0,s.attrs=new tJ(s.attrs),s.url=s.attrs.URI=n_(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),s.groupId=s.attrs["GROUP-ID"]=t[a],s.attrs["PATHWAY-ID"]=r,s});e.push(...s)})}function n_(e,t,i,r){let a;let{HOST:s,PARAMS:n,[i]:o}=r;t&&(a=null==o?void 0:o[t])&&(e=a);let l=new self.URL(e);return s&&!a&&(l.host=s),n&&Object.keys(n).sort().forEach(e=>{e&&l.searchParams.set(e,n[e])}),l.href}let nA=/^age:\s*[\d.]+\s*$/im;class nS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new t1,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;let a=this.xhrSetup;a?Promise.resolve().then(()=>{if(this.loader===i&&!this.stats.aborted)return a(i,t.url)}).catch(e=>{if(this.loader===i&&!this.stats.aborted)return i.open("GET",t.url,!0),a(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(e=>{this.callbacks.onError({code:i.status,text:e.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:s}=i.loadPolicy;if(r)for(let t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&tG(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let r=t.readyState,a=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let r=t.status,s="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){let a=null!=s?s:t.response;if(null!=a){i.loading.end=Math.max(self.performance.now(),i.loading.first);let s="arraybuffer"===t.responseType?a.byteLength:a.length;if(i.loaded=i.total=s,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;let n=this.callbacks.onProgress;if(n&&n(i,e,a,t),!this.callbacks)return;let o={url:t.responseURL,data:a,code:r};this.callbacks.onSuccess(o,i,e,t);return}}let n=a.loadPolicy.errorRetry;rY(n,i.retry,!1,{url:e.url,data:void 0,code:r})?this.retry(n):(tX.error(`${r} while loading ${e.url}`),this.callbacks.onError({code:r,text:t.statusText},e,t,i))}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry;if(rY(e,this.stats.retry,!0))this.retry(e);else{var t;tX.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);let e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=rK(e,i.retry),i.retry++,tX.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&nA.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}let nk=/(\d+)-(\d+)\/(\d+)/;class nR{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||nI,this.controller=new self.AbortController,this.stats=new t1}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let r=this.stats;if(r.loading.start)throw Error("Loader can only be used once.");r.loading.start=self.performance.now();let a=function(e,t){let i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(t$({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}(e,this.controller.signal),s=i.onProgress,n="arraybuffer"===e.responseType,o=n?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=l&&tG(l)?l:d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},t.timeout),self.fetch(this.request).then(a=>{this.response=this.loader=a;let o=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},d-(o-r.loading.start)),!a.ok){let{status:e,statusText:t}=a;throw new nL(t||"fetch, bad network response",e,a)}return(r.loading.first=o,r.total=function(e){let t=e.get("Content-Range");if(t){let e=function(e){let t=nk.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(tG(e))return e}let i=e.get("Content-Length");if(i)return parseInt(i)}(a.headers)||r.total,s&&tG(t.highWaterMark))?this.loadProgressively(a,r,e,t.highWaterMark,s):n?a.arrayBuffer():"json"===e.responseType?a.json():a.text()}).then(a=>{let n=this.response;if(!n)throw Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);let l=a[o];l&&(r.loaded=r.total=l);let d={url:n.url,data:a,code:n.status};s&&!tG(t.highWaterMark)&&s(r,e,a,n),i.onSuccess(d,r,e,n)}).catch(t=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;let a=t&&t.code||0,s=t?t.message:null;i.onError({code:a,text:s},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,a){let s=new a_,n=e.body.getReader(),o=()=>n.read().then(n=>{if(n.done)return s.dataLength&&a(t,i,s.flush(),e),Promise.resolve(new ArrayBuffer(0));let l=n.value,d=l.length;return t.loaded+=d,d<r||s.dataLength?(s.push(l),s.dataLength>=r&&a(t,i,s.flush(),e)):a(t,i,l,e),o()}).catch(()=>Promise.reject());return o()}}function nI(e,t){return new self.Request(e.url,t)}class nL extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}let nw=/\s/,nD={newCue(e,t,i,r){let a,s,n,o,l;let d=[],u=self.VTTCue||self.TextTrackCue;for(let c=0;c<r.rows.length;c++)if(a=r.rows[c],n=!0,o=0,l="",!a.isEmpty()){var h;for(let e=0;e<a.chars.length;e++)nw.test(a.chars[e].uchar)&&n?o++:(l+=a.chars[e].uchar,n=!1);a.cueStartTime=t,t===i&&(i+=1e-4),o>=16?o--:o++;let r=sG(l.trim()),m=sq(t,i,r);null!=e&&null!=(h=e.cues)&&h.getCueById(m)||((s=new u(t,i,r)).id=m,s.line=c+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*o/32)),d.push(s))}return e&&d.length&&(d.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),d.forEach(t=>rv(e,t))),d}},nC=tB(tB({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:nS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{let e;let{fragCurrent:t,partCurrent:i,hls:r}=this,{autoLevelEnabled:a,media:s}=r;if(!t||!s)return;let n=performance.now(),o=i?i.stats:t.stats,l=i?i.duration:t.duration,d=n-o.loading.start,u=r.minAutoLevel;if(o.aborted||o.loaded&&o.loaded===o.total||t.level<=u){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a||s.paused||!s.playbackRate||!s.readyState)return;let h=r.mainForwardBufferInfo;if(null===h)return;let c=this.bwEstimator.getEstimateTTFB(),m=Math.abs(s.playbackRate);if(d<=Math.max(c,l/(2*m)*1e3))return;let p=h.len/m,f=o.loading.first?o.loading.first-o.loading.start:-1,g=o.loaded&&f>-1,E=this.getBwEstimate(),b=r.levels,y=b[t.level],T=o.total||Math.max(o.loaded,Math.round(l*y.averageBitrate/8)),_=g?d-f:d;_<1&&g&&(_=Math.min(d,8*o.loaded/E));let A=g?1e3*o.loaded/_:0,S=A?(T-o.loaded)/A:8*T/E+c/1e3;if(S<=p)return;let k=A?8*A:E,R=Number.POSITIVE_INFINITY;for(e=t.level-1;e>u;e--){let t=b[e].maxBitrate;if((R=this.getTimeToLoadFrag(c/1e3,k,l*t,!b[e].details))<p)break}if(R>=S||R>10*l)return;r.nextLoadLevel=r.nextAutoLevel=e,g?this.bwEstimator.sample(d-Math.min(c,f),o.loaded):this.bwEstimator.sampleTTFB(d);let I=b[e].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>I&&this.resetEstimator(I),this.clearTimer(),tX.warn(`[abr] Fragment ${t.sn}${i?" part "+i.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${p.toFixed(3)} s
      Estimated load time for current fragment: ${S.toFixed(3)} s
      Estimated load time for down switch fragment: ${R.toFixed(3)} s
      TTFB estimate: ${0|f} ms
      Current BW estimate: ${tG(E)?0|E:"Unknown"} bps
      New BW estimate: ${0|this.getBwEstimate()} bps
      Switching to level ${e} @ ${0|I} bps`),r.trigger(tK.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:o})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(tX.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new r0(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.FRAG_LOADING,this.onFragLoading,this),e.on(tK.FRAG_LOADED,this.onFragLoaded,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tK.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(tK.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.FRAG_LOADING,this.onFragLoading,this),e.off(tK.FRAG_LOADED,this.onFragLoaded,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tK.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(tK.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case tY.BUFFER_ADD_CODEC_ERROR:case tY.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case tY.FRAG_LOAD_TIMEOUT:{let e=t.frag,{fragCurrent:i,partCurrent:r}=this;if(e&&i&&e.sn===i.sn&&e.level===i.level){let t=performance.now(),i=r?r.stats:e.stats,a=t-i.loading.start,s=i.loading.first?i.loading.first-i.loading.start:-1;if(i.loaded&&s>-1){let e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(a-Math.min(e,s),i.loaded)}else this.bwEstimator.sampleTTFB(a)}}}}getTimeToLoadFrag(e,t,i,r){return e+i/t+(r?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){let i=this.hls.config,{loading:r}=t.stats,a=r.end-r.start;tG(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:i}){let r=i?i.stats:t.stats;if(t.type===rc.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let e=i?i.duration:t.duration,a=this.hls.levels[t.level],s=(a.loaded?a.loaded.bytes:0)+r.loaded,n=(a.loaded?a.loaded.duration:0)+e;a.loaded={bytes:s,duration:n},a.realBitrate=Math.round(8*s/n)}if(t.bitrateTest){let e={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(tK.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:i,part:r}=t,a=null!=r&&r.stats.loaded?r.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;let s=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,a.loaded),a.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==rc.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,t,e,0,r,1,1);if(a>-1)return a;let s=this.hls.firstLevel,n=Math.min(Math.max(s,t),e);return tX.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${n}`),n}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let r=t&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){let t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:r,config:a,minAutoLevel:s}=i,n=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay(),d=a.abrBandWidthFactor,u=a.abrBandWidthUpFactor;if(l){let e=this.findBestLevel(o,s,r,l,0,d,u);if(e>=0)return e}let h=n?Math.min(n,a.maxStarvationDelay):a.maxStarvationDelay;if(!l){let e=this.bitrateTestDelay;e&&(h=(n?Math.min(n,a.maxLoadingDelay):a.maxLoadingDelay)-e,tX.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),d=u=1)}let c=this.findBestLevel(o,s,r,l,h,d,u);if(tX.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${c}`),c>-1)return c;let m=i.levels[s],p=i.levels[i.loadLevel];return(null==m?void 0:m.bitrate)<(null==p?void 0:p.bitrate)?s:i.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let i=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,a,s,n){var o,l;let d;let u=r+a,h=this.lastLoadedFragLevel,c=-1===h?this.hls.firstLevel:h,{fragCurrent:m,partCurrent:p}=this,{levels:f,allAudioTracks:g,loadLevel:E,config:b}=this.hls;if(1===f.length)return 0;let y=f[c],T=!!(null!=y&&null!=(o=y.details)&&o.live),_=-1===E||-1===h,A="SDR",S=(null==y?void 0:y.frameRate)||0,{audioPreference:k,videoPreference:R}=b,I=this.audioTracksByGroup||(this.audioTracksByGroup=g.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);let r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}}));if(_){if(-1!==this.firstSelection)return this.firstSelection;let r=function(e,t,i,r,a){var s;let n,o;let l=Object.keys(e),d=null==r?void 0:r.channels,u=null==r?void 0:r.audioCodec,h=d&&2===parseInt(d),c=!0,m=!1,p=1/0,f=1/0,g=1/0,E=0,b=[],{preferHDR:y,allowedVideoRanges:T}=(n=!1,o=[],(s=t)&&(n="SDR"!==s,o=[s]),a&&(o=a.allowedVideoRanges||rw.slice(0),o=(n=void 0!==a.preferHDR?a.preferHDR:function(){if("function"==typeof matchMedia){let e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}())?o.filter(e=>"SDR"!==e):["SDR"]),{preferHDR:n,allowedVideoRanges:o});for(let t=l.length;t--;){let i=e[l[t]];c=i.channels[2]>0,p=Math.min(p,i.minHeight),f=Math.min(f,i.minFramerate),g=Math.min(g,i.minBitrate);let r=T.filter(e=>i.videoRanges[e]>0);r.length>0&&(m=!0,b=r)}p=tG(p)?p:0,f=tG(f)?f:0;let _=Math.max(1080,p),A=Math.max(30,f);return i=Math.max(g=tG(g)?g:i,i),m||(t=void 0,b=[]),{codecSet:l.reduce((t,r)=>{let a=e[r];if(r===t)return t;if(a.minBitrate>i)return r3(r,`min bitrate of ${a.minBitrate} > current estimate of ${i}`),t;if(!a.hasDefaultAudio)return r3(r,"no renditions with default or auto-select sound found"),t;if(u&&r.indexOf(u.substring(0,4))%5!=0)return r3(r,`audio codec preference "${u}" not found`),t;if(d&&!h){if(!a.channels[d])return r3(r,`no renditions with ${d} channel sound found (channels options: ${Object.keys(a.channels)})`),t}else if((!u||h)&&c&&0===a.channels["2"])return r3(r,"no renditions with stereo sound found"),t;return a.minHeight>_?(r3(r,`min resolution of ${a.minHeight} > maximum of ${_}`),t):a.minFramerate>A?(r3(r,`min framerate of ${a.minFramerate} > maximum of ${A}`),t):b.some(e=>a.videoRanges[e]>0)?a.maxScore<E?(r3(r,`max score of ${a.maxScore} < selected max of ${E}`),t):t&&(i4(r)>=i4(t)||a.fragmentError>e[t].fragmentError)?t:(E=a.maxScore,r):(r3(r,`no variants with VIDEO-RANGE of ${JSON.stringify(b)} found`),t)},void 0),videoRanges:b,preferHDR:y,minFramerate:f,minBitrate:g}}(this.codecTiers||(this.codecTiers=f.slice(t,i+1).reduce((e,t)=>{if(!t.codecSet)return e;let i=t.audioGroups,r=e[t.codecSet];r||(e[t.codecSet]=r={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),r.minBitrate=Math.min(r.minBitrate,t.bitrate);let a=Math.min(t.height,t.width);return r.minHeight=Math.min(r.minHeight,a),r.minFramerate=Math.min(r.minFramerate,t.frameRate),r.maxScore=Math.max(r.maxScore,t.score),r.fragmentError+=t.fragmentError,r.videoRanges[t.videoRange]=(r.videoRanges[t.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;let t=I.groups[e];t&&(r.hasDefaultAudio=r.hasDefaultAudio||I.hasDefaultAudio?t.hasDefault:t.hasAutoSelect||!I.hasDefaultAudio&&!I.hasAutoSelectAudio,Object.keys(t.channels).forEach(e=>{r.channels[e]=(r.channels[e]||0)+t.channels[e]}))}),e},{})),A,e,k,R),{codecSet:a,videoRanges:s,minFramerate:n,minBitrate:o,preferHDR:l}=r;d=a,A=l?s[s.length-1]:s[0],S=n,e=Math.max(e,o),tX.log(`[abr] picked start tier ${JSON.stringify(r)}`)}else d=null==y?void 0:y.codecSet,A=null==y?void 0:y.videoRange;let L=p?p.duration:m?m.duration:0,w=this.bwEstimator.getEstimateTTFB()/1e3,D=[];for(let o=i;o>=t;o--){let t;let m=f[o],g=o>c;if(!m)continue;if(b.useMediaCapabilities&&!m.supportedResult&&!m.supportedPromise){let t=navigator.mediaCapabilities;"function"==typeof(null==t?void 0:t.decodingInfo)&&function(e,t,i,r,a,s){let n=e.audioCodec?e.audioGroups:null,o=null==s?void 0:s.audioCodec,l=null==s?void 0:s.channels,d=l?parseInt(l):o?1/0:2,u=null;if(null!=n&&n.length)try{u=1===n.length&&n[0]?t.groups[n[0]].channels:n.reduce((e,i)=>{if(i){let r=t.groups[i];if(!r)throw Error(`Audio track group ${i} not found`);Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==i||e.bitrate>Math.max(a,8e6))||!!u&&tG(d)&&Object.keys(u).some(e=>parseInt(e)>d)}(m,I,A,S,e,k)?(m.supportedPromise=function(e,t,i){let r=e.videoCodec,a=e.audioCodec;if(!r||!a||!i)return Promise.resolve(r1);let s={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},n=e.videoRange;"SDR"!==n&&(s.transferFunction=n.toLowerCase());let o=r.split(",").map(e=>({type:"media-source",video:tB(tB({},s),{},{contentType:i2(e,"video")})}));return a&&e.audioGroups&&e.audioGroups.forEach(e=>{var i;e&&(null==(i=t.groups[e])||i.tracks.forEach(t=>{if(t.groupId===e){let e=parseFloat(t.channels||"");tG(e)&&e>2&&o.push.apply(o,a.split(",").map(t=>({type:"media-source",audio:{contentType:i2(t,"audio"),channels:""+e}})))}}))}),Promise.all(o.map(e=>{let t=function(e){let{audio:t,video:i}=e,r=i||t;if(r){let e=r.contentType.split('"')[1];if(i)return`r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${e}_${Math.ceil(i.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return r2[t]||(r2[t]=i.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:o,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:o,decodingInfoResults:[],error:e}))}(m,I,t),m.supportedPromise.then(e=>{if(!this.hls)return;m.supportedResult=e;let t=this.hls.levels,i=t.indexOf(m);e.error?tX.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${JSON.stringify(e)}`):!e.supported&&(tX.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${i} ${JSON.stringify(e)}`),i>-1&&t.length>1&&(tX.log(`[abr] Removing unsupported level ${i}`),this.hls.removeLevel(i)))})):m.supportedResult=r1}if(d&&m.codecSet!==d||A&&m.videoRange!==A||g&&S>m.frameRate||!g&&S>0&&S<m.frameRate||m.supportedResult&&!(null!=(l=m.supportedResult.decodingInfoResults)&&l[0].smooth)){D.push(o);continue}let R=m.details,C=(p?null==R?void 0:R.partTarget:null==R?void 0:R.averagetargetduration)||L;t=g?n*e:s*e;let x=L&&r>=2*L&&0===a?f[o].averageBitrate:f[o].maxBitrate,M=this.getTimeToLoadFrag(w,t,x*C,void 0===R);if(t>=x&&(o===h||0===m.loadError&&0===m.fragmentError)&&(M<=w||!tG(M)||T&&!this.bitrateTestDelay||M<u)){let e=this.forcedAutoLevel;return o!==E&&(-1===e||e!==E)&&(D.length&&tX.trace(`[abr] Skipped level(s) ${D.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${f[D[0]].codecs}" ${f[D[0]].videoRange}; not compatible with "${y.codecs}" ${A}`),tX.info(`[abr] switch candidate:${c}->${o} adjustedbw(${Math.round(t)})-bitrate=${Math.round(t-x)} ttfb:${w.toFixed(1)} avgDuration:${C.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${M.toFixed(1)} firstSelection:${_} codecSet:${d} videoRange:${A} hls.loadLevel:${E}`)),_&&(this.firstSelection=o),o}}return -1}set nextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:i}=this.hls,r=Math.min(Math.max(e,i),t);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}},bufferController:class{constructor(e){var t;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=e=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{let{media:e,mediaSource:t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(tK.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:e,_objectUrl:t}=this;e!==t&&tX.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e;let i="[buffer-controller]";this.appendSource=(t=iZ(e.config.preferManagedMediaSource),"undefined"!=typeof self&&t===self.ManagedMediaSource),this.log=tX.log.bind(tX,i),this.warn=tX.warn.bind(tX,i),this.error=tX.error.bind(tX,i),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.BUFFER_RESET,this.onBufferReset,this),e.on(tK.BUFFER_APPENDING,this.onBufferAppending,this),e.on(tK.BUFFER_CODECS,this.onBufferCodecs,this),e.on(tK.BUFFER_EOS,this.onBufferEos,this),e.on(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tK.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(tK.FRAG_PARSED,this.onFragParsed,this),e.on(tK.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.BUFFER_RESET,this.onBufferReset,this),e.off(tK.BUFFER_APPENDING,this.onBufferAppending,this),e.off(tK.BUFFER_CODECS,this.onBufferCodecs,this),e.off(tK.BUFFER_EOS,this.onBufferEos,this),e.off(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tK.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(tK.FRAG_PARSED,this.onFragParsed,this),e.off(tK.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new sf(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(!t.audio||t.video)&&t.altAudio||(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){let i=this.media=t.media,r=iZ(this.appendSource);if(i&&r){var a;let e=this.mediaSource=new r;this.log(`created media source: ${null==(a=e.constructor)?void 0:a.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming));let t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{i.removeAttribute("src");let r=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||r&&e instanceof r,sv(i),function(e,t){let i=self.document.createElement("source");i.type="video/mp4",i.src=t,e.appendChild(i)}(i,t),i.load()}catch(e){i.src=t}else i.src=t;i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){let{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(e.removeAttribute("src"),this.appendSource&&sv(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(tK.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer(),this.hls.resumeBuffering()}resetBuffer(e){let t=this.sourceBuffer[e];try{if(t){var i;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(t){this.warn(`onBufferReset ${e}`,t)}}onBufferCodecs(e,t){let i=this.getSourceBufferTypes().length,r=Object.keys(t);if(r.forEach(e=>{if(i){let i=this.tracks[e];if(i&&"function"==typeof i.buffer.changeType){var r;let{id:a,codec:s,levelCodec:n,container:o,metadata:l}=t[e],d=i6(i.codec,i.levelCodec),u=null==d?void 0:d.replace(sg,"$1"),h=i6(s,n),c=null==(r=h)?void 0:r.replace(sg,"$1");if(h&&u!==c){"audio"===e.slice(0,5)&&(h=i9(h,this.appendSource));let t=`${o};codecs=${h}`;this.appendChangeType(e,t),this.log(`switching codec ${d} to ${h}`),this.tracks[e]={buffer:i.buffer,codec:s,container:o,levelCodec:n,metadata:l,id:a}}}}else this.pendingTracks[e]=t[e]}),i)return;let a=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==a&&(this.log(`${a} bufferCodec event(s) expected ${r.join(",")}`),this.bufferCodecEventsExpected=a),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(e,t){let{operationQueue:i}=this;i.append({execute:()=>{let r=this.sourceBuffer[e];r&&(this.log(`changing ${e} sourceBuffer type to ${t}`),r.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}},e,!!this.pendingTracks[e])}onBufferAppending(e,t){let{hls:i,operationQueue:r,tracks:a}=this,{data:s,type:n,frag:o,part:l,chunkMeta:d}=t,u=d.buffering[n],h=self.performance.now();u.start=h;let c=o.stats.buffering,m=l?l.stats.buffering:null;0===c.start&&(c.start=h),m&&0===m.start&&(m.start=h);let p=a.audio,f=!1;"audio"===n&&(null==p?void 0:p.container)==="audio/mpeg"&&(f=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);let g=o.start;r.append({execute:()=>{if(u.executeStart=self.performance.now(),f){let e=this.sourceBuffer[n];if(e){let t=g-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${g} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=g)}}this.appendExecutor(s,n)},onStart:()=>{},onComplete:()=>{let e=self.performance.now();u.executeEnd=u.end=e,0===c.first&&(c.first=e),m&&0===m.first&&(m.first=e);let{sourceBuffer:t}=this,i={};for(let e in t)i[e]=aa.getBuffered(t[e]);this.appendErrors[n]=0,"audio"===n||"video"===n?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(tK.BUFFER_APPENDED,{type:n,frag:o,part:l,chunkMeta:d,parent:o.type,timeRanges:i})},onError:e=>{let t={type:tW.MEDIA_ERROR,parent:o.type,details:tY.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:o,part:l,chunkMeta:d,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=tY.BUFFER_FULL_ERROR;else{let e=++this.appendErrors[n];t.details=tY.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${i.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer`),e>=i.config.appendErrorMaxRetry&&(t.fatal=!0)}i.trigger(tK.ERROR,t)}},n,!!this.pendingTracks[n])}onBufferFlushing(e,t){let{operationQueue:i}=this,r=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(tK.BUFFER_FLUSHED,{type:e})},onError:t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?i.append(r(t.type),t.type):this.getSourceBufferTypes().forEach(e=>{i.append(r(e),e)})}onFragParsed(e,t){let{frag:i,part:r}=t,a=[],s=r?r.elementaryStreams:i.elementaryStreams;s[t2.AUDIOVIDEO]?a.push("audiovideo"):(s[t2.AUDIO]&&a.push("audio"),s[t2.VIDEO]&&a.push("video")),0===a.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(()=>{let e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);let t=r?r.stats:i.stats;this.hls.trigger(tK.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})},a)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((e,i)=>{let r=this.sourceBuffer[i];return!r||t.type&&t.type!==i||(r.ending=!0,r.ended||(r.ended=!0,this.log(`${i} sourceBuffer now EOS`))),e&&!!(!r||r.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(e=>{let t=this.sourceBuffer[e];t&&(t.ending=!1)});let{mediaSource:e}=this;if(!e||"open"!==e.readyState){e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),e.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){let{hls:e,details:t,media:i}=this;if(!i||null===t||!this.getSourceBufferTypes().length)return;let r=e.config,a=i.currentTime,s=t.levelTargetDuration,n=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(tG(n)&&n>0){let e=Math.max(n,s),t=Math.floor(a/s)*s-e;this.flushBackBuffer(a,s,t)}if(tG(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){let e=Math.max(Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),s),t=Math.floor(a/s)*s+e;this.flushFrontBuffer(a,s,t)}}flushBackBuffer(e,t,i){let{details:r,sourceBuffer:a}=this;this.getSourceBufferTypes().forEach(s=>{let n=a[s];if(n){let a=aa.getBuffered(n);if(a.length>0&&i>a.start(0)){if(this.hls.trigger(tK.BACK_BUFFER_REACHED,{bufferEnd:i}),null!=r&&r.live)this.hls.trigger(tK.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(n.ended&&a.end(a.length-1)-e<2*t){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(tK.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){let{sourceBuffer:r}=this;this.getSourceBufferTypes().forEach(a=>{let s=r[a];if(s){let r=aa.getBuffered(s),n=r.length;if(n<2)return;let o=r.start(n-1),l=r.end(n-1);if(i>o||e>=o&&e<=l)return;if(s.ended&&e-l<2*t){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(tK.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;let{details:e,hls:t,media:i,mediaSource:r}=this,a=e.fragments[0].start+e.totalduration,s=i.duration,n=tG(r.duration)?r.duration:0;e.live&&t.config.liveDurationInfinity?(r.duration=1/0,this.updateSeekableRange(e)):(a>n&&a>s||!tG(s))&&(this.log(`Updating Media Source duration to ${a.toFixed(3)}`),r.duration=a)}updateSeekableRange(e){let t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&null!=t&&t.setLiveSeekableRange){let r=Math.max(0,i[0].start),a=Math.max(r,r+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${r}-${a}.`),t.setLiveSeekableRange(r,a)}}checkPendingTracks(){let{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&(!e||2===r||"audiovideo"in i)){this.createSourceBuffers(i),this.pendingTracks={};let e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(tK.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(e=>{t.executeNext(e)});else{let e=Error("could not create source buffer for media codec(s)");this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){let{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(let a in e)if(!t[a]){var r;let s=e[a];if(!s)throw Error(`source buffer exists for track ${a}, however track does not`);let n=(null==(r=s.levelCodec)?void 0:r.indexOf(","))===-1?s.levelCodec:s.codec;n&&"audio"===a.slice(0,5)&&(n=i9(n,this.appendSource));let o=`${s.container};codecs=${n}`;this.log(`creating sourceBuffer(${o})`);try{let e=t[a]=i.addSourceBuffer(o);this.addBufferListener(a,"updatestart",this._onSBUpdateStart),this.addBufferListener(a,"updateend",this._onSBUpdateEnd),this.addBufferListener(a,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(a,"bufferedchange",(e,t)=>{let i=t.removedRanges;null!=i&&i.length&&this.hls.trigger(tK.BUFFER_FLUSHED,{type:a})}),this.tracks[a]={buffer:e,codec:n,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(e){this.error(`error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:a,mimeType:o})}}}get mediaSrc(){var e,t;let i=(null==(e=this.media)?void 0:null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==i?void 0:i.src}_onSBUpdateStart(e){let{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if((null==(t=this.mediaSource)?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let{operationQueue:i}=this;i.current(e).onComplete(),i.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var i;let r=Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(i=this.mediaSource)?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});let a=this.operationQueue.current(e);a&&a.onError(r)}removeExecutor(e,t,i){let{media:r,mediaSource:a,operationQueue:s,sourceBuffer:n}=this,o=n[e];if(!r||!a||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),s.shiftAndExecuteNext(e);return}let l=tG(r.duration)?r.duration:1/0,d=tG(a.duration)?a.duration:1/0,u=Math.max(0,t),h=Math.min(i,l,d);h>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${h}] from the ${e} SourceBuffer`),o.remove(u,h)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){let i=this.sourceBuffer[t];if(!i){if(!this.pendingTracks[t])throw Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}i.ended=!1,i.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}let{operationQueue:i}=this;Promise.all(t.map(e=>i.appendBlocker(e))).then(()=>{e(),t.forEach(e=>{let t=this.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){let r=this.sourceBuffer[e];if(!r)return;let a=i.bind(this,e);this.listeners[e].push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){let t=this.sourceBuffer[e];t&&this.listeners[e].forEach(e=>{t.removeEventListener(e.event,e.listener)})}},capLevelController:s6,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=tX.log.bind(tX,"[info]:"),this.warn=tX.warn.bind(tX,"[warning]:"),this.error=tX.error.bind(tX,"[error]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(tK.ERROR,this.onError,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(tK.ERROR,this.onError,this),e.off(tK.ERROR,this.onErrorOut,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===rc.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,r,a,s;if(t.fatal)return;let n=this.hls,o=t.context;switch(t.details){case tY.FRAG_LOAD_ERROR:case tY.FRAG_LOAD_TIMEOUT:case tY.KEY_LOAD_ERROR:case tY.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case tY.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap){t.errorAction={action:rX.DoNothing,flags:rQ.None};return}case tY.FRAG_GAP:case tY.FRAG_DECRYPT_ERROR:t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=rX.SendAlternateToPenaltyBox;return;case tY.LEVEL_EMPTY_ERROR:case tY.LEVEL_PARSING_ERROR:{let e=t.parent===rc.MAIN?t.level:n.loadLevel;t.details===tY.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(s=a.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case tY.LEVEL_LOAD_ERROR:case tY.LEVEL_LOAD_TIMEOUT:"number"==typeof(null==o?void 0:o.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case tY.AUDIO_TRACK_LOAD_ERROR:case tY.AUDIO_TRACK_LOAD_TIMEOUT:case tY.SUBTITLE_LOAD_ERROR:case tY.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){let e=n.levels[n.loadLevel];e&&(o.type===rh.AUDIO_TRACK&&e.hasAudioGroup(o.groupId)||o.type===rh.SUBTITLE_TRACK&&e.hasSubtitleGroup(o.groupId))&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=rX.SendAlternateToPenaltyBox,t.errorAction.flags=rQ.MoveAllAlternatesMatchingHost)}return;case tY.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let e=n.levels[n.loadLevel],i=null==e?void 0:e.attrs["HDCP-LEVEL"];i?t.errorAction={action:rX.SendAlternateToPenaltyBox,flags:rQ.MoveAllAlternatesMatchingHDCP,hdcpLevel:i}:this.keySystemError(t)}return;case tY.BUFFER_ADD_CODEC_ERROR:case tY.REMUX_ALLOC_ERROR:case tY.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,null!=(r=t.level)?r:n.loadLevel);return;case tY.INTERNAL_EXCEPTION:case tY.BUFFER_APPENDING_ERROR:case tY.BUFFER_FULL_ERROR:case tY.LEVEL_SWITCH_ERROR:case tY.BUFFER_STALLED_ERROR:case tY.BUFFER_SEEK_OVER_HOLE:case tY.BUFFER_NUDGE_ON_STALL:t.errorAction={action:rX.DoNothing,flags:rQ.None};return}t.type===tW.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){let t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){let i=rV(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(rY(i,r,rH(e),e.response))return{action:rX.RetryRequest,flags:rQ.None,retryConfig:i,retryCount:r};let a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=r),a}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:a,keyLoadPolicy:s}=t.config,n=rV(e.details.startsWith("key")?s:a,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r&&(e.details!==tY.FRAG_GAP&&r.fragmentError++,rY(n,o,rH(e),e.response)))return{action:rX.RetryRequest,flags:rQ.None,retryConfig:n,retryCount:o};let l=this.getLevelSwitchAction(e,i);return n&&(l.retryConfig=n,l.retryCount=o),l}getLevelSwitchAction(e,t){let i=this.hls;null==t&&(t=i.loadLevel);let r=this.hls.levels[t];if(r){var a,s,n,o;let t=e.details;r.loadError++,t===tY.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1,{levels:d,loadLevel:u,minAutoLevel:h,maxAutoLevel:c}=i;i.autoLevelEnabled||(i.loadLevel=-1);let m=null==(a=e.frag)?void 0:a.type,p=(m===rc.AUDIO&&t===tY.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===tY.BUFFER_ADD_CODEC_ERROR||t===tY.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:e})=>r.audioCodec!==e),f="video"===e.sourceBufferName&&(t===tY.BUFFER_ADD_CODEC_ERROR||t===tY.BUFFER_APPEND_ERROR)&&d.some(({codecSet:e,audioCodec:t})=>r.codecSet!==e&&r.audioCodec===t),{type:g,groupId:E}=null!=(s=e.context)?s:{};for(let i=d.length;i--;){let a=(i+u)%d.length;if(a!==u&&a>=h&&a<=c&&0===d[a].loadError){let i=d[a];if(t===tY.FRAG_GAP&&m===rc.MAIN&&e.frag){let t=d[a].details;if(t){let i=rj(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else if(g===rh.AUDIO_TRACK&&i.hasAudioGroup(E)||g===rh.SUBTITLE_TRACK&&i.hasSubtitleGroup(E))continue;else if(m===rc.AUDIO&&null!=(n=r.audioGroups)&&n.some(e=>i.hasAudioGroup(e))||m===rc.SUBTITLE&&null!=(o=r.subtitleGroups)&&o.some(e=>i.hasSubtitleGroup(e))||p&&r.audioCodec===i.audioCodec||!p&&r.audioCodec!==i.audioCodec||f&&r.codecSet===i.codecSet)continue;l=a;break}}if(l>-1&&i.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:rX.SendAlternateToPenaltyBox,flags:rQ.None,nextAutoLevel:l}}return{action:rX.SendAlternateToPenaltyBox,flags:rQ.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case rX.DoNothing:break;case rX.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===tY.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0;case rX.RetryRequest:}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:r,hdcpLevel:a,nextAutoLevel:s}=i;switch(r){case rQ.None:this.switchLevel(e,s);break;case rQ.MoveAllAlternatesMatchingHDCP:a&&(t.maxHdcpLevel=rL[rL.indexOf(a)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(tK.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(tK.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){let r=performance.now();if(t){if(this.lastTime){let e=r-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,n=1e3*a/e,o=this.hls;if(o.trigger(tK.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),n>0&&a>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;tX.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(tK.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e){if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:il,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:nD,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends aT{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",rc.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tK.ERROR,this.onError,this),e.on(tK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(tK.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(tK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(tK.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tK.ERROR,this.onError,this),e.off(tK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(tK.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(tK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(tK.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=ay.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let i;let{frag:r,success:a}=t;if(this.fragPrevious=r,this.state=ay.IDLE,!a)return;let s=this.tracksBuffered[this.currentTrackId];if(!s)return;let n=r.start;for(let e=0;e<s.length;e++)if(n>=s[e].start&&n<=s[e].end){i=s[e];break}let o=r.start+r.duration;i?i.end=o:(i={start:n,end:o},s.push(i)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){let{startOffset:i,endOffset:r}=t;if(0===i&&r!==Number.POSITIVE_INFINITY){let e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let i=0;i<t.length;){if(t[i].end<=e){t.shift();continue}if(t[i].start<e)t[i].start=e;else break;i++}}),this.fragmentTracker.removeFragmentsInRange(i,e,rc.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===rc.MAIN){var i;null!=(i=this.media)&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){let i=t.frag;(null==i?void 0:i.type)===rc.SUBTITLE&&(t.details===tY.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ay.STOPPED&&(this.state=ay.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&sh(this.levels,t)){this.levels=t.map(e=>new rM(e));return}this.tracksBuffered=[],this.levels=t.map(e=>{let t=new rM(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,rc.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!(null!=(i=this.levels)&&i.length)||-1===this.currentTrackId){this.clearInterval();return}let r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i,r;let{currentTrackId:a,levels:s}=this,{details:n,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}let l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(n.live||null!=(i=l.details)&&i.live){let e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;let t=e.fragments[0];l.details?0===(d=this.alignPlaylists(n,l.details,null==(r=this.levelLastLoaded)?void 0:r.details))&&t&&rF(n,d=t.start):n.hasProgramDateTime&&e.hasProgramDateTime?(au(n,e),d=n.fragments[0].start):t&&rF(n,d=t.start)}l.details=n,this.levelLastLoaded=l,o===a&&(this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(this.mainDetails||n,d),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===ay.IDLE&&!rj(null,n.fragments,this.media.currentTime,0)&&(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){let e=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(e=>{throw a.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(i=>{let r=performance.now();a.trigger(tK.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=ay.IDLE})}}doTick(){if(!this.media){this.state=ay.IDLE;return}if(this.state===ay.IDLE){let{currentTrackId:e,levels:t}=this,i=null==t?void 0:t[e];if(!i||!t.length||!i.details)return;let{config:r}=this,a=this.getLoadPosition(),{end:s,len:n}=aa.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),o=this.getFwdBufferInfo(this.media,rc.MAIN),l=i.details;if(n>this.getMaxBufferLength(null==o?void 0:o.len)+l.levelTargetDuration)return;let d=l.fragments,u=d.length,h=l.edge,c=null,m=this.fragPrevious;if(s<h){let e=r.maxFragLookUpTolerance;(c=rj(m,d,Math.max(d[0].start,s),s>h-e?0:e))||!m||!(m.start<d[0].start)||(c=d[0])}else c=d[u-1];if(!c)return;if("initSegment"!==(c=this.mapToInitFragWhenRequired(c)).sn){let e=d[c.sn-l.startSN-1];e&&e.cc===c.cc&&this.fragmentTracker.getState(e)===r7.NOT_LOADED&&(c=e)}this.fragmentTracker.getState(c)===r7.NOT_LOADED&&this.loadFragment(c,i,s)}}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new sp(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends rZ{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null,t=ry(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}let i=this.findTrackForTextTrack(e);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.LEVEL_LOADING,this.onLevelLoading,this),e.on(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(tK.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.LEVEL_LOADING,this.onLevelLoading,this),e.off(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(tK.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ry(this.media.textTracks).forEach(e=>{rE(e)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,groupId:r,details:a}=t,s=this.tracksInGroup[i];if(!s||s.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);return}let n=s.details;s.details=t.details,this.log(`Subtitle track ${i} "${s.name}" lang:${s.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.subtitleGroups||null,r=this.groupIds,a=this.currentTrack;if(!i||(null==r?void 0:r.length)!==(null==i?void 0:i.length)||null!=i&&i.some(e=>(null==r?void 0:r.indexOf(e))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!i||-1!==i.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.subtitlePreference;if(!a&&t){this.selectDefaultTrack=!1;let i=r4(t,e);if(i>-1)a=e[i];else{let e=r4(t,this.tracks);a=this.tracks[e]}}let r=this.findTrackId(a);-1===r&&a&&(r=this.findTrackId(null)),this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==i?void 0:i.join(",")}" group-id`),this.hls.trigger(tK.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}else this.shouldReloadPlaylist(a)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){let t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){let a=t[r];if((!i||a.default)&&(i||e)&&(!e||r5(a,e)))return r}if(e){for(let i=0;i<t.length;i++){let r=t[i];if(sc(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){let r=t[i];if(sc(e.attrs,r.attrs,["LANGUAGE"]))return i}}return -1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++)if(sm(t[i],e))return i}return -1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==rh.SUBTITLE_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let i=this.currentTrack;if(i&&r5(e,i))return i;let r=r4(e,this.tracksInGroup);if(r>-1){let e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}if(i);else{let i=r4(e,t);if(i>-1)return t[i]}}}return null}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){let i=t.id,r=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(tK.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(){let e;let{media:t}=this;if(!t)return;let i=ry(t.textTracks),r=this.currentTrack;if(!r||(e=i.filter(e=>sm(r,e))[0])||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`),[].slice.call(i).forEach(t=>{"disabled"!==t.mode&&t!==e&&(t.mode="disabled")}),e){let t=this.subtitleDisplay?"showing":"hidden";e.mode!==t&&(e.mode=t)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!tG(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(tK.SUBTITLE_TRACK_SWITCH,{id:e});return}let a=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));let{id:s,groupId:n="",name:o,type:l,url:d}=r;this.hls.trigger(tK.SUBTITLE_TRACK_SWITCH,{id:s,groupId:n,name:o,type:l,url:d});let u=this.switchParams(r.url,null==i?void 0:i.details,r.details);this.loadPlaylist(u)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=s9(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(tK.FRAG_LOADING,this.onFragLoading,this),e.on(tK.FRAG_LOADED,this.onFragLoaded,this),e.on(tK.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(tK.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(tK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(tK.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(tK.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(tK.FRAG_LOADING,this.onFragLoading,this),e.off(tK.FRAG_LOADED,this.onFragLoaded,this),e.off(tK.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(tK.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(tK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(tK.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){let e=new sM(this,"textTrack1"),t=new sM(this,"textTrack2"),i=new sM(this,"textTrack3"),r=new sM(this,"textTrack4");this.cea608Parser1=new sx(1,e,t),this.cea608Parser2=new sx(3,i,r)}}addCues(e,t,i,r,a){let s=!1;for(let e=a.length;e--;){var n,o;let r=a[e],l=(n=r[0],o=r[1],Math.min(o,i)-Math.max(n,t));if(l>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],i),s=!0,l/(i-t)>.5))return}if(s||a.push([t,i]),this.config.renderTextTracksNatively){let a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{let a=this.Cues.newCue(null,t,i,r);this.hls.trigger(tK.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a}){let{unparsedVttFrags:s}=this;"main"===i&&(this.initPTS[t.cc]={baseTime:r,timescale:a}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.onFragLoaded(tK.FRAG_LOADED,e)}))}getExistingTrack(e,t){let{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){let a=i.textTracks[r];if(s8(a,{name:e,lang:t,attrs:{}}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:r}=this,{label:a,languageCode:s}=t[e],n=this.getExistingTrack(a,s);if(n)i[e]=n,rE(i[e]),rg(i[e],r);else{let t=this.createTextTrack("captions",a,s);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(tK.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,i){let r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){let{captionsTracks:e}=this;Object.keys(e).forEach(t=>{rE(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=s9(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let e=0;e<t.length;e++)rE(t[e])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],r=i.some(e=>e.textCodec===sz);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(sh(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let e=this.media,t=e?ry(e.textTracks):null;if(this.tracks.forEach((e,i)=>{let r;if(t){let i=null;for(let r=0;r<t.length;r++)if(t[r]&&s8(t[r],e)){i=t[r],t[r]=null;break}i&&(r=i)}if(r)rE(r);else{let t=s5(e);(r=this.createTextTrack(t,e.name,e.lang))&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){let e=t.filter(e=>null!==e).map(e=>e.label);e.length&&tX.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(tK.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{let t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;let i=`textTrack${t[1]}`,r=this.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===rc.MAIN){var i,r;let{cea608Parser1:e,cea608Parser2:a,lastSn:s}=this,{cc:n,sn:o}=t.frag,l=null!=(i=null==(r=t.part)?void 0:r.index)?i:-1;e&&a&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||n!==this.lastCc)&&(e.reset(),a.reset()),this.lastCc=n,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){let{frag:i,payload:r}=t;if(i.type===rc.SUBTITLE){if(r.byteLength){let e=i.decryptdata,a="stats"in t;if(null==e||!e.encrypted||a){let e=this.tracks[i.level],a=this.vttCCs;a[i.cc]||(a[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===sz?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(tK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:Error("Empty subtitle payload")})}}_parseIMSC1(e,t){let i=this.hls;sJ(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),i.trigger(tK.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{tX.log(`Failed to parse IMSC1: ${t}`),i.trigger(tK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;let{frag:i,payload:r}=e,{initPTS:a,unparsedVttFrags:s}=this,n=a.length-1;if(!a[i.cc]&&-1===n){s.push(e);return}let o=this.hls;!function(e,t,i,r,a,s,n){let o;let l=new sH,d=iR(new Uint8Array(e)).trim().replace(sV,"\n").split("\n"),u=[],h=t?function(e,t=1){return a2(e,9e4,1/t)}(t.baseTime,t.timescale):0,c="00:00.000",m=0,p=0,f=!0;l.oncue=function(e){let s=i[r],n=i.ccOffset,l=(m-h)/9e4;if(null!=s&&s.new&&(void 0!==p?n=i.ccOffset=s.start:sj(i,r,l)),l){if(!t){o=Error("Missing initPTS for VTT MPEGTS");return}n=l-i.presentationOffset}let d=e.endTime-e.startTime,c=a9((e.startTime+n-p)*9e4,9e4*a)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+d,0);let f=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(f)),e.id||(e.id=sq(e.startTime,e.endTime,f)),e.endTime>0&&u.push(e)},l.onparsingerror=function(e){o=e},l.onflush=function(){if(o){n(o);return}s(u)},d.forEach(e=>{if(f){if(sK(e,"X-TIMESTAMP-MAP=")){f=!1,e.slice(16).split(",").forEach(e=>{sK(e,"LOCAL:")?c=e.slice(6):sK(e,"MPEGTS:")&&(m=parseInt(e.slice(7)))});try{p=sW(c)/1e3}catch(e){o=e}return}""===e&&(f=!1)}l.parse(e+"\n")}),l.flush()}(null!=(t=i.initSegment)&&t.data?iH(i.initSegment.data,new Uint8Array(r)):r,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,e=>{this._appendCues(e,i.level),o.trigger(tK.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},t=>{let a="Missing initPTS for VTT MPEGTS"===t.message;a?s.push(e):this._fallbackToIMSC1(i,r),tX.log(`Failed to parse VTT cue: ${t}`),(!a||!(n>i.cc))&&o.trigger(tK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:t})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||sJ(t,this.initPTS[e.cc],()=>{i.textCodec=sz,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(e=>rv(i,e))}else{let r=this.tracks[t];if(!r)return;let a=r.default?"default":"subtitles"+t;i.trigger(tK.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===rc.SUBTITLE&&this.onFragLoaded(tK.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();let{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!i||!r)return;let{frag:a,samples:s}=t;if(a.type!==rc.MAIN||"NONE"!==this.closedCaptionsForLevel(a))for(let e=0;e<s.length;e++){let t=s[e].bytes;if(t){let a=this.extractCea608Data(t);i.addData(s[e].pts,a[0]),r.addData(s[e].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:a}){let{media:s}=this;if(s&&!(s.currentTime<i)){if(!a||"video"===a){let{captionsTracks:e}=this;Object.keys(e).forEach(r=>rb(e[r],t,i))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==r){let{textTracks:e}=this;Object.keys(e).forEach(i=>rb(e[i],t,r))}}}extractCea608Data(e){let t=[[],[]],i=31&e[0],r=2;for(let a=0;a<i;a++){let i=e[r++],a=127&e[r++],s=127&e[r++];if((0!==a||0!==s)&&(4&i)!=0){let e=3&i;(0===e||1===e)&&(t[e].push(a),t[e].push(s))}}return t}},audioStreamController:class extends aT{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",rc.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tK.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(tK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(tK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(tK.ERROR,this.onError,this),e.on(tK.BUFFER_RESET,this.onBufferReset,this),e.on(tK.BUFFER_CREATED,this.onBufferCreated,this),e.on(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(tK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tK.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(tK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(tK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(tK.ERROR,this.onError,this),e.off(tK.BUFFER_RESET,this.onBufferReset,this),e.off(tK.BUFFER_CREATED,this.onBufferCreated,this),e.off(tK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(tK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:a}){if("main"===i){let e=t.cc;this.initPTS[t.cc]={baseTime:r,timescale:a},this.log(`InitPTS for cc: ${e} found from main: ${r}`),this.videoTrackCC=e,this.state===ay.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=ay.STOPPED;return}let t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=ay.IDLE):(this.loadedmetadata=!1,this.state=ay.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){var e,t;switch(this.state){case ay.IDLE:this.doTickIdle();break;case ay.WAITING_TRACK:{let{levels:t,trackId:i}=this,r=null==t?void 0:null==(e=t[i])?void 0:e.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=ay.WAITING_INIT_PTS}break}case ay.FRAG_LOADING_WAITING_RETRY:{let e=performance.now(),i=this.retryDate;if(!i||e>=i||null!=(t=this.media)&&t.seeking){let{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=ay.IDLE}break}case ay.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:i,cache:r,complete:a}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=ay.FRAG_LOADING;let e={frag:t,part:i,payload:r.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),a&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{let e=this.getLoadPosition(),i=aa.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);0>rz(i.end,this.config.maxFragLookUpTolerance,t)&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${i.end} is needed`),this.clearWaitingFragment())}}else this.state=ay.IDLE}}this.onTickEnd()}clearWaitingFragment(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=ay.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){let{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){let{hls:e,levels:t,media:i,trackId:r}=this,a=e.config;if(!this.buffering||!i&&(this.startFragRequested||!a.startFragPrefetch)||!(null!=t&&t[r]))return;let s=t[r],n=s.details;if(!n||n.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(n)){this.state=ay.WAITING_TRACK;return}let o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,t2.AUDIO,rc.AUDIO));let l=this.getFwdBufferInfo(o,rc.AUDIO);if(null===l)return;if(!this.switchingTrack&&this._streamEnded(l,n)){e.trigger(tK.BUFFER_EOS,{type:"audio"}),this.state=ay.ENDED;return}let d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,rc.MAIN),u=l.len,h=this.getMaxBufferLength(null==d?void 0:d.len),c=n.fragments,m=c[0].start,p=this.getLoadPosition(),f=this.flushing?p:l.end;if(this.switchingTrack&&i&&n.PTSKnown&&p<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=m+.05),u>=h&&!this.switchingTrack&&f<c[c.length-1].start)return;let g=this.getNextFragment(f,n),E=!1;if(g&&this.isLoopLoading(g,f)&&(E=!!g.gap,g=this.getNextFragmentLoopLoading(g,n,l,rc.MAIN,h)),!g){this.bufferFlushed=!0;return}let b=d&&g.start>d.end+n.targetduration;if(b||!(null!=d&&d.len)&&l.len){let e=this.getAppendedFrag(g.start,rc.MAIN);if(null===e||(E||(E=!!e.gap||!!b&&0===d.len),b&&!E||E&&l.nextStart&&l.nextStart<e.end))return}this.loadFragment(g,s,f)}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new rM(e))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=ay.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=ay.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(tK.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i,r;if(null==this.mainDetails){this.cachedTrackLoadedData=t;return}let{levels:a}=this,{details:s,id:n}=t;if(!a){this.warn(`Audio tracks were reset while loading level ${n}`);return}this.log(`Audio track ${n} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);let o=a[n],l=0;if(s.live||null!=(i=o.details)&&i.live){this.checkLiveUpdate(s);let e=this.mainDetails;if(s.deltaUpdateFailed||!e)return;!o.details&&s.hasProgramDateTime&&e.hasProgramDateTime?(au(s,e),l=s.fragments[0].start):l=this.alignPlaylists(s,o.details,null==(r=this.levelLastLoaded)?void 0:r.details)}o.details=s,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(this.mainDetails||s,l),this.state!==ay.WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=ay.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:i,part:r,payload:a}=e,{config:s,trackId:n,levels:o}=this;if(!o){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let l=o[n];if(!l){this.warn("Audio track is undefined on fragment load progress");return}let d=l.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new su(this.hls,rc.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let c=this.initPTS[i.cc],m=null==(t=i.initSegment)?void 0:t.data;if(void 0!==c){let e=r?r.index:-1,t=new as(i.level,i.sn,i.stats.chunkCount,a.byteLength,e,-1!==e);h.push(a,m,u,"",i,r,d.totalduration,!1,t,c)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${n}`);let{cache:e}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new a_,complete:!1};e.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=ay.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i.type!==rc.AUDIO){if(!this.loadedmetadata&&i.type===rc.MAIN){let e=this.videoBuffer||this.media;e&&aa.getBuffered(e).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if("initSegment"!==i.sn){this.fragPrevious=i;let e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(tK.AUDIO_TRACK_SWITCHED,tB({},e)))}this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=ay.ERROR;return}switch(t.details){case tY.FRAG_GAP:case tY.FRAG_PARSING_ERROR:case tY.FRAG_DECRYPT_ERROR:case tY.FRAG_LOAD_ERROR:case tY.FRAG_LOAD_TIMEOUT:case tY.KEY_LOAD_ERROR:case tY.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(rc.AUDIO,t);break;case tY.AUDIO_TRACK_LOAD_ERROR:case tY.AUDIO_TRACK_LOAD_TIMEOUT:case tY.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ay.WAITING_TRACK||(null==(i=t.context)?void 0:i.type)!==rh.AUDIO_TRACK||(this.state=ay.IDLE);break;case tY.BUFFER_APPEND_ERROR:case tY.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===tY.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case tY.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==t2.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==t2.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ay.ENDED&&(this.state=ay.IDLE);let e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,rc.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let i="audio",{hls:r}=this,{remuxResult:a,chunkMeta:s}=e,n=this.getCurrentContext(s);if(!n){this.resetWhenMissingContext(s);return}let{frag:o,part:l,level:d}=n,{details:u}=d,{audio:h,text:c,id3:m,initSegment:p}=a;if(this.fragContextChanged(o)||!u){this.fragmentTracker.removeFragment(o);return}if(this.state=ay.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){let e=o.initSegment||o;this._bufferInitSegment(d,p.tracks,e,s),r.trigger(tK.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:p.tracks})}if(h){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=h;l&&(l.elementaryStreams[t2.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(t2.AUDIO,e,t,i,r),this.bufferFragmentData(h,o,l,s)}if(null!=m&&null!=(t=m.samples)&&t.length){let e=t$({id:i,frag:o,details:u},m);r.trigger(tK.FRAG_PARSING_METADATA,e)}if(c){let e=t$({id:i,frag:o,details:u},c);r.trigger(tK.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,i,r){if(this.state!==ay.PARSING)return;t.video&&delete t.video;let a=t.audio;if(!a)return;a.id="audio";let s=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${s}/${a.codec}]`),s&&1===s.split(",").length&&(a.levelCodec=s),this.hls.trigger(tK.BUFFER_CODECS,t);let n=a.initSegment;if(null!=n&&n.byteLength){let e={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:n};this.hls.trigger(tK.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||r===r7.NOT_LOADED||r===r7.PARTIAL){var a;if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(a=t.details)&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ay.WAITING_INIT_PTS;let i=this.mainDetails;i&&i.fragments[0].start!==t.details.fragments[0].start&&au(t.details,i)}else this.startFragRequested=!0,super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:i,assocLang:r,characteristics:a,audioCodec:s,channels:n}=this.bufferedTrack;r5({name:t,lang:i,assocLang:r,characteristics:a,audioCodec:s,channels:n},e,r8)||(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(tK.AUDIO_TRACK_SWITCHED,tB({},e))}},audioTrackController:class extends rZ{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.LEVEL_LOADING,this.onLevelLoading,this),e.on(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(tK.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.LEVEL_LOADING,this.onLevelLoading,this),e.off(tK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(tK.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:r,details:a}=t,s=this.tracksInGroup[i];if(!s||s.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);return}let n=s.details;s.details=t.details,this.log(`Audio track ${i} "${s.name}" lang:${s.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.audioGroups||null,r=this.groupIds,a=this.currentTrack;if(!i||(null==r?void 0:r.length)!==(null==i?void 0:i.length)||null!=i&&i.some(e=>(null==r?void 0:r.indexOf(e))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!i||-1!==i.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.audioPreference;if(!a&&t){let i=r4(t,e,r8);if(i>-1)a=e[i];else{let e=r4(t,this.tracks);a=this.tracks[e]}}let r=this.findTrackId(a);-1===r&&a&&(r=this.findTrackId(null)),this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==i?void 0:i.join(",")}`),this.hls.trigger(tK.AUDIO_TRACKS_UPDATED,{audioTracks:e});let n=this.trackId;if(-1!==r&&-1===n)this.setAudioTrack(r);else if(e.length&&-1===n){var s;let t=Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}else this.shouldReloadPlaylist(a)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&(t.context.type!==rh.AUDIO_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){let r=this.currentTrack;if(r&&r5(e,r,r8))return r;let a=r4(e,this.tracksInGroup,r8);if(a>-1){let e=this.tracksInGroup[a];return this.setAudioTrack(a),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);let a=function(e,t,i,r,a){let s=t[r],n=t.reduce((e,t,i)=>{let r=t.uri;return(e[r]||(e[r]=[])).push(i),e},{})[s.uri];n.length>1&&(r=Math.max.apply(Math,n));let o=s.videoRange,l=s.frameRate,d=s.codecSet.substring(0,4),u=r9(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==d)return!1;let r=t.audioGroups;return r4(e,i.filter(e=>!r||-1!==r.indexOf(e.groupId)),a)>-1});return u>-1?u:r9(t,r,t=>{let r=t.audioGroups;return r4(e,i.filter(e=>!r||-1!==r.indexOf(e.groupId)),a)>-1})}(e,t.levels,i,r,r8);if(-1===a)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){let t=r4(e,i);if(t>-1)return i[t]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===i&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(tK.AUDIO_TRACK_SWITCHING,tB({},r)),a))return;let s=this.switchParams(r.url,null==i?void 0:i.details,r.details);this.loadPlaylist(s)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||r5(e,r,r8)))return i}if(e){let{name:i,lang:r,assocLang:a,characteristics:s,audioCodec:n,channels:o}=e;for(let e=0;e<t.length;e++)if(r5({name:i,lang:r,assocLang:a,characteristics:s,audioCodec:n,channels:o},t[e],r8))return e;for(let i=0;i<t.length;i++){let r=t[i];if(sc(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){let r=t[i];if(sc(e.attrs,r.attrs,["LANGUAGE"]))return i}}return -1}loadPlaylist(e){let t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();let i=t.id,r=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${r}`),this.clearTimer(),this.hls.trigger(tK.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:e||null})}}},emeController:ne,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:oz.MANIFEST,su:!this.initialized})}catch(e){tX.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{let t=e.frag,i=this.hls.levels[t.level],r=this.getObjectType(t),a={d:1e3*t.duration,ot:r};(r===oz.VIDEO||r===oz.AUDIO||r==oz.MUXED)&&(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(r)/1e3,a.bl=this.getBufferLength(r)),this.apply(e,a)}catch(e){tX.warn("Could not generate segment CMCD data.",e)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||function(){try{return crypto.randomUUID()}catch(e){try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(t){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})}}}(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHED,this.onMediaDetached,this),e.on(tK.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHED,this.onMediaDetached,this),e.off(tK.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:oX.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){t$(t,this.createData());let i=t.ot===oz.INIT||t.ot===oz.VIDEO||t.ot===oz.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);let{includeKeys:r}=this;if(r&&(t=Object.keys(t).reduce((e,i)=>(r.includes(i)&&(e[i]=t[i]),e),{})),this.useHeaders){var a;e.headers||(e.headers={}),a=e.headers,t$(a,function(e,t={}){if(!e)return{};let i=Object.entries(e),r=Object.entries(ni).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{}));return Object.entries(i.reduce((e,t)=>{var i,a;let[s,n]=t,o=(null==(i=r.find(e=>e[1].includes(s)))?void 0:i[0])||oQ.REQUEST;return null!=e[o]||(e[o]={}),e[o][s]=n,e},{})).reduce((e,[i,r])=>(e[i]=nb(r,t),e),{})}(t,void 0))}else e.url=function(e,t,i){let r=function(e,t={}){if(!e)return"";let i=nb(e,t);return`CMCD=${encodeURIComponent(i)}`}(t,void 0);if(!r)return e;if(ny.test(e))return e.replace(ny,r);let a=e.includes("?")?"&":"?";return`${e}${a}${r}`}(e.url,t)}getObjectType(e){let{type:t}=e;return"subtitle"===t?oz.TIMED_TEXT:"initSegment"===e.sn?oz.INIT:"audio"===t?oz.AUDIO:"main"===t?this.hls.audioTracks.length?oz.VIDEO:oz.MUXED:void 0}getTopBandwidth(e){let t,i=0,r=this.hls;if(e===oz.AUDIO)t=r.audioTracks;else{let e=r.maxAutoLevel,i=e>-1?e+1:r.levels.length;t=r.levels.slice(0,i)}for(let e of t)e.bitrate>i&&(i=e.bitrate);return i>0?i:NaN}getBufferLength(e){let t=this.hls.media,i=e===oz.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*aa.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}},contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=tX.log.bind(tX,"[content-steering]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if((null==i?void 0:i.action)===rX.SendAlternateToPenaltyBox&&i.flags===rQ.MoveAllAlternatesMatchingHost){let e=this.levels,r=this.pathwayPriority,a=this.pathwayId;if(t.context){let{groupId:i,pathwayId:r,type:s}=t.context;i&&e?a=this.getPathwayForGroupId(i,s,a):r&&(a=r)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&e&&(r=e.reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==a),i.resolved||tX.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${e?e.length:e} priorities: ${JSON.stringify(r)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){let i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;let i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(e=>{r-i[e]>3e5&&delete i[e]});for(let r=0;r<e.length;r++){let a=e[r];if(a in i)continue;if(a===this.pathwayId)return;let s=this.hls.nextLoadLevel,n=this.hls.levels[s];if((t=this.getLevelsForPathway(a)).length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,rG(t),this.hls.trigger(tK.LEVELS_UPDATED,{levels:t});let e=this.hls.levels[s];n&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==n.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==n.bitrate&&this.log(`Unstable Pathways change from bitrate ${n.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,i){let r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let i=0;i<r.length;i++)if(t===rh.AUDIO_TRACK&&r[i].hasAudioGroup(e)||t===rh.SUBTITLE_TRACK&&r[i].hasSubtitleGroup(e))return r[i].pathwayId;return i}clonePathways(e){let t=this.levels;if(!t)return;let i={},r={};e.forEach(e=>{let{ID:a,"BASE-ID":s,"URI-REPLACEMENT":n}=e;if(t.some(e=>e.pathwayId===a))return;let o=this.getLevelsForPathway(s).map(e=>{let t=new tJ(e.attrs);t["PATHWAY-ID"]=a;let s=t.AUDIO&&`${t.AUDIO}_clone_${a}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${a}`;s&&(i[t.AUDIO]=s,t.AUDIO=s),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);let l=n_(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",n),d=new rM({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)d.addGroupId("audio",`${e.audioGroups[t]}_clone_${a}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)d.addGroupId("text",`${e.subtitleGroups[t]}_clone_${a}`);return d});t.push(...o),nT(this.audioTracks,i,n,a),nT(this.subtitleTracks,r,n,a)})}loadSteeringManifest(e){let t;let i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);try{t=new self.URL(e)}catch(t){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if("data:"!==t.protocol){let e=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+e)}let a={responseType:"json",url:t.href},s=i.steeringManifestLoadPolicy.default,n=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0};this.log(`Requesting steering manifest: ${t}`),this.loader.load(a,o,{onSuccess:(e,i,r,a)=>{this.log(`Loaded steering manifest: "${t}"`);let s=e.data;if(1!==s.VERSION){this.log(`Steering VERSION ${s.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=s.TTL;let{"RELOAD-URI":n,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(n)try{this.uri=new self.URL(n,t).href}catch(e){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${n}`);return}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);let d={steeringManifest:s,url:t.toString()};this.hls.trigger(tK.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},onError:(e,t,i,r)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code){this.enabled=!1,this.log(`Steering manifest ${t.url} no longer available`);return}let a=1e3*this.timeToLoad;if(429===e.code){let e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){let t=e.getResponseHeader("Retry-After");t&&(a=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`);return}this.scheduleRefresh(this.uri||t.url,a)},onTimeout:(e,t,i)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}})}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;let i=null==(t=this.hls)?void 0:t.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,1e3*this.timeToLoad)},t)}}});class nx extends rZ{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tK.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tK.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i=this.hls.config.preferManagedMediaSource,r=[],a={},n={},o=!1,l=!1,d=!1;t.levels.forEach(e=>{var t,u;let h=e.attrs,{audioCodec:c,videoCodec:m}=e;(null==(t=c)?void 0:t.indexOf("mp4a.40.34"))!==-1&&(s||(s=/chrome|firefox/i.test(navigator.userAgent)),s&&(e.audioCodec=c=void 0)),c&&(e.audioCodec=c=i9(c,i)),(null==(u=m)?void 0:u.indexOf("avc1"))===0&&(m=e.videoCodec=function(e){let t=e.split(",");for(let e=0;e<t.length;e++){let i=t[e].split(".");if(i.length>2){let r=i.shift()+".";r+=parseInt(i.shift()).toString(16),r+=("000"+parseInt(i.shift()).toString(16)).slice(-4),t[e]=r}}return t.join(",")}(m));let{width:p,height:f,unknownCodecs:g}=e;if(o||(o=!!(p&&f)),l||(l=!!m),d||(d=!!c),null!=g&&g.length||c&&!i0(c,"audio",i)||m&&!i0(m,"video",i))return;let{CODECS:E,"FRAME-RATE":b,"HDCP-LEVEL":y,"PATHWAY-ID":T,RESOLUTION:_,"VIDEO-RANGE":A}=h,S=`${T||"."}-`,k=`${S}${e.bitrate}-${_}-${b}-${E}-${A}-${y}`;if(a[k]){if(a[k].uri===e.url||e.attrs["PATHWAY-ID"])a[k].addGroupId("audio",h.AUDIO),a[k].addGroupId("text",h.SUBTITLES);else{let t=n[k]+=1;e.attrs["PATHWAY-ID"]=Array(t+1).join(".");let i=new rM(e);a[k]=i,r.push(i)}}else{let t=new rM(e);a[k]=t,n[k]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,o,l,d)}filterAndSortMediaOptions(e,t,i,r,a){let s=[],n=[],o=e;if((i||r)&&a&&(o=o.filter(({videoCodec:e,videoRange:t,width:i,height:r})=>{var a;return(!!e||!!(i&&r))&&!!(a=t)&&rw.indexOf(a)>-1})),0===o.length){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);let e=Error("no level with compatible codecs found in manifest");this.hls.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}});return}if(t.audioTracks){let{preferManagedMediaSource:e}=this.hls.config;nM(s=t.audioTracks.filter(t=>!t.audioCodec||i0(t.audioCodec,"audio",e)))}t.subtitles&&nM(n=t.subtitles);let l=o.slice(0);o.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return rw.indexOf(e.videoRange)-rw.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){let i=i3(e.videoCodec),r=i3(t.videoCodec);if(i!==r)return r-i}if(e.uri===t.uri&&e.codecSet!==t.codecSet){let i=i4(e.codecSet),r=i4(t.codecSet);if(i!==r)return r-i}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o)).length!==l.length){for(let e=0;e<l.length;e++)if(l[e].pathwayId===o[0].pathwayId){d=l[e];break}}this._levels=o;for(let e=0;e<o.length;e++)if(o[e]===d){var u;this._firstLevel=e;let t=d.bitrate,i=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${t}`),(null==(u=this.hls.userConfig)?void 0:u.abrEwmaDefaultEstimate)===void 0){let e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>i&&i===nC.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}let h=a&&!r,c={levels:o,audioTracks:s,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:!h&&s.some(e=>!!e.url)};this.hls.trigger(tK.MANIFEST_PARSED,c),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){let i=Error("invalid level idx"),r=e<0;if(this.hls.trigger(tK.ERROR,{type:tW.OTHER_ERROR,details:tY.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:i,reason:i.message}),r)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,s=t[e],n=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,i===e&&s.details&&r&&a===n)return;this.log(`Switching to level ${e} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${n?" with Pathway "+n:""} from level ${i}${a?" with Pathway "+a:""}`);let o={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(tK.LEVEL_SWITCHING,o);let l=s.details;if(!l||l.live){let e=this.switchParams(s.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){let e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===rh.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===rc.MAIN){let e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;let i=this._levels[t.level];null!=i&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var i,r;let{level:a,details:s}=t,n=this._levels[a];if(!n){this.warn(`Invalid level index ${a}`),null!=(r=t.deliveryDirectives)&&r.skip&&(s.deltaUpdateFailed=!0);return}a===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(a,t,n.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();let t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){let r=i.uri;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}let a=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(null==e?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} ${r}`),this.clearTimer(),this.hls.trigger(tK.LEVEL_LOADING,{url:r,level:t,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;let i=this._levels.filter((t,i)=>i!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));rG(i),this._levels=i,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(tK.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(tK.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function nM(e){let t={};e.forEach(e=>{let i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}class nO{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let i in this.keyUriToKeyInfo){let r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){for(let e in this.detach(),this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=tY.KEY_LOAD_ERROR,i,r,a){return new ap({type:tW.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){let{sn:i,cc:r}=e;for(let e=0;e<t.length;e++){let a=t[e];if(r<=a.cc&&("initSegment"===i||"initSegment"===a.sn||i<a.sn)){this.emeController.selectKeySystemFormat(a).then(e=>{a.setKeyFormat(e)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r,a;t&&e.setKeyFormat(t);let s=e.decryptdata;if(!s){let i=Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,tY.KEY_LOAD_ERROR,i))}let n=s.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,tY.KEY_LOAD_ERROR,Error(`Invalid key URI: "${n}"`)));let o=this.keyUriToKeyInfo[n];if(null!=(i=o)&&i.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(null!=(r=o)&&r.keyLoadPromise)switch(null==(a=o.mediaKeySessionContext)?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>(s.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}switch(o=this.keyUriToKeyInfo[n]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":if("identity"===s.keyFormat)return this.loadKeyHTTP(o,e);return this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,tY.KEY_LOAD_ERROR,Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let t=this.emeController.loadKey(i);if(t)return(e.keyLoadPromise=t.then(t=>(e.mediaKeySessionContext=t,i))).catch(t=>{throw e.keyLoadPromise=null,t})}return Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,r=new i.loader(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,s)=>{let n={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=i.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};r.load(n,l,{onSuccess:(e,t,i,r)=>{let{frag:n,keyInfo:o,url:l}=i;if(!n.decryptdata||o!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(n,tY.KEY_LOAD_ERROR,Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=n.decryptdata.key=new Uint8Array(e.data),n.keyLoader=null,o.loader=null,a({frag:n,keyInfo:o})},onError:(e,i,r,a)=>{this.resetLoader(i),s(this.createKeyLoadError(t,tY.KEY_LOAD_ERROR,Error(`HTTP Error ${e.code} loading key ${e.text}`),r,tB({url:n.url,data:void 0},e)))},onTimeout:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,tY.KEY_LOAD_TIMEOUT,Error("key loading timed out"),r))},onAbort:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,tY.INTERNAL_ABORTED,Error("key loading aborted"),r))}})})}resetLoader(e){let{frag:t,keyInfo:i,url:r}=e,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],a&&a.destroy()}}function nN(){return self.SourceBuffer||self.WebKitSourceBuffer}function nP(){if(!iZ())return!1;let e=nN();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class nU{constructor(e,t,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){let{config:i,media:r,stalled:a}=this;if(null===r)return;let{currentTime:s,seeking:n}=r,o=this.seeking&&!n,l=!this.seeking&&n;if(this.seeking=n,s!==e){if(this.moved=!0,n||(this.nudgeRetry=0),null!==a){if(this.stallReported){let e=self.performance.now()-a;tX.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o){this.stalled=null;return}if(r.paused&&!n||r.ended||0===r.playbackRate||!aa.getBuffered(r).length){this.nudgeRetry=0;return}let d=aa.bufferInfo(r,s,0),u=d.nextStart||0;if(n){let e=d.len>2,i=!u||t&&t.start<=s||u-s>2&&!this.fragmentTracker.getPartialFragment(s);if(e||i)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var h;if(!(d.len>0)&&!u)return;let e=Math.max(u,d.start||0)-s,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,i=(null==t?void 0:null==(h=t.details)?void 0:h.live)?2*t.details.targetduration:2,a=this.fragmentTracker.getPartialFragment(s);if(e>0&&(e<=i||a)){r.paused||this._trySkipBufferHole(a);return}}let c=self.performance.now();if(null===a){this.stalled=c;return}let m=c-a;if(!n&&m>=250&&(this._reportStall(d),!this.media))return;let p=aa.bufferInfo(r,s,i.maxBufferHole);this._tryFixBufferStall(p,m)}_tryFixBufferStall(e,t){let{config:i,fragmentTracker:r,media:a}=this;if(null===a)return;let s=a.currentTime,n=r.getPartialFragment(s);!(n&&(this._trySkipBufferHole(n)||!this.media))&&(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-s<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(tX.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){let{hls:t,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;let r=Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);tX.warn(r.message),t.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}}_trySkipBufferHole(e){let{config:t,hls:i,media:r}=this;if(null===r)return 0;let a=r.currentTime,s=aa.bufferInfo(r,a,0),n=a<s.start?s.start:s.nextStart;if(n){let o=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&r.readyState<3,d=n-a;if(d>0&&(o||l)){if(d>t.maxBufferHole){let{fragmentTracker:t}=this,i=!1;if(0===a){let e=t.getAppendedFrag(0,rc.MAIN);e&&n<e.end&&(i=!0)}if(!i){let i=e||t.getAppendedFrag(a,rc.MAIN);if(i){let e=!1,r=i.end;for(;r<n;){let i=t.getPartialFragment(r);if(i)r+=i.duration;else{e=!0;break}}if(e)return 0}}}let s=Math.max(n+.05,a+.1);if(tX.warn(`skipping hole, adjusting currentTime from ${a} to ${s}`),this.moved=!0,this.stalled=null,r.currentTime=s,e&&!e.gap){let t=Error(`fragment loaded with buffer holes, seeking from ${a} to ${s}`);i.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){let{config:e,hls:t,media:i,nudgeRetry:r}=this;if(null===i)return;let a=i.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){let s=a+(r+1)*e.nudgeOffset,n=Error(`Nudging 'currentTime' from ${a} to ${s}`);tX.warn(n.message),i.currentTime=s,t.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_NUDGE_ON_STALL,error:n,fatal:!1})}else{let i=Error(`Playhead still not moving while enough data buffered @${a} after ${e.nudgeMaxRetry} nudges`);tX.error(i.message),t.trigger(tK.ERROR,{type:tW.MEDIA_ERROR,details:tY.BUFFER_STALLED_ERROR,error:i,fatal:!0})}}}class nF extends aT{constructor(e,t,i){super(e,t,i,"[stream-controller]",rc.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tK.LEVEL_LOADING,this.onLevelLoading,this),e.on(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tK.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(tK.ERROR,this.onError,this),e.on(tK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(tK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(tK.BUFFER_CREATED,this.onBufferCreated,this),e.on(tK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(tK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tK.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(tK.ERROR,this.onError,this),e.off(tK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(tK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(tK.BUFFER_CREATED,this.onBufferCreated,this),e.off(tK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(tK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tK.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){let{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=ay.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=ay.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ay.WAITING_LEVEL:{let{levels:e,level:t}=this,i=null==e?void 0:e[t],r=null==i?void 0:i.details;if(r&&(!r.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(r))break;this.state=ay.IDLE}else this.hls.nextLoadLevel!==this.level&&(this.state=ay.IDLE);break}case ay.FRAG_LOADING_WAITING_RETRY:{var e;let t=self.performance.now(),i=this.retryDate;if(!i||t>=i||null!=(e=this.media)&&e.seeking){let{levels:e,level:t}=this,i=null==e?void 0:e[t];this.resetStartWhenNotLoaded(i||null),this.state=ay.IDLE}}}this.state===ay.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(null===t||!r&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(null!=i&&i[a]))return;let s=i[a],n=this.getMainFwdBufferInfo();if(null===n)return;let o=this.getLevelDetails();if(o&&this._streamEnded(n,o)){let e={};this.altAudio&&(e.type="video"),this.hls.trigger(tK.BUFFER_EOS,e),this.state=ay.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&-1===e.manualLevel&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;let l=s.details;if(!l||this.state===ay.WAITING_LEVEL||l.live&&this.levelLastLoaded!==s){this.level=a,this.state=ay.WAITING_LEVEL;return}let d=n.len,u=this.getMaxBufferLength(s.maxBitrate);if(d>=u)return;this.backtrackFragment&&this.backtrackFragment.start>n.end&&(this.backtrackFragment=null);let h=this.backtrackFragment?this.backtrackFragment.start:n.end,c=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&c&&"initSegment"!==c.sn&&this.fragmentTracker.getState(c)!==r7.OK){var m;let e=(null!=(m=this.backtrackFragment)?m:c).sn-l.startSN,t=l.fragments[e-1];t&&c.cc===t.cc&&(c=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&n.len&&(this.backtrackFragment=null);if(c&&this.isLoopLoading(c,h)){if(!c.gap){let e=this.audioOnly&&!this.altAudio?t2.AUDIO:t2.VIDEO,t=(e===t2.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,rc.MAIN)}c=this.getNextFragmentLoopLoading(c,l,n,rc.MAIN,u)}c&&(!c.initSegment||c.initSegment.data||this.bitrateTest||(c=c.initSegment),this.loadFragment(c,s,h))}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===r7.NOT_LOADED||r===r7.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,rc.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(null!=t&&t.readyState){let i;let r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);let a=this.getLevelDetails();if(null!=a&&a.live){let e=this.getMainFwdBufferInfo();if(!e||e.len<2*a.targetduration)return}if(!t.paused&&e){let t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;i=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else i=0;let s=this.getBufferedFrag(t.currentTime+i);if(s){let e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();let t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,r=Math.max(s.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,i*(this.couldBacktrack?.5:.125)),i*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ay.KEY_LOADING:case ay.FRAG_LOADING:case ay.FRAG_LOADING_WAITING_RETRY:case ay.PARSING:case ay.PARSED:this.state=ay.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new nU(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){let{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){let e=this.media,t=e?e.currentTime:null;tG(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);let i=this.getMainFwdBufferInfo();if(null===i||0===i.len){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(tK.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let i=!1,r=!1;t.levels.forEach(e=>{let t=e.audioCodec;t&&(i=i||-1!==t.indexOf("mp4a.40.2"),r=r||-1!==t.indexOf("mp4a.40.5"))}),this.audioCodecSwitch=i&&r&&!function(){var e;let t=nN();return"function"==typeof(null==t?void 0:null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==ay.IDLE)return;let r=i[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(r.details))&&(this.state=ay.WAITING_LEVEL)}onLevelLoaded(e,t){var i,r;let{levels:a}=this,s=t.level,n=t.details,o=n.totalduration;if(!a){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${o}`);let l=a[s],d=this.fragCurrent;d&&(this.state===ay.FRAG_LOADING||this.state===ay.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let u=0;if(n.live||null!=(i=l.details)&&i.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;u=this.alignPlaylists(n,l.details,null==(r=this.levelLastLoaded)?void 0:r.details)}if(l.details=n,this.levelLastLoaded=l,this.hls.trigger(tK.LEVEL_UPDATED,{details:n,level:s}),this.state===ay.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=ay.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,u),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:i,part:r,payload:a}=e,{levels:s}=this;if(!s){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let n=s[i.level],o=n.details;if(!o){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}let l=n.videoCodec,d=o.PTSKnown||!o.live,u=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(n),c=this.transmuxer=this.transmuxer||new su(this.hls,rc.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,p=new as(i.level,i.sn,i.stats.chunkCount,a.byteLength,m,-1!==m),f=this.initPTS[i.cc];c.push(a,u,h,l,i,r,o.totalduration,d,p,f)}onAudioTrackSwitching(e,t){let i=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();let e=this.hls;i&&(e.trigger(tK.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(tK.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=t.id,r=!!this.hls.audioTracks[i].url;if(r){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r,this.tick()}onBufferCreated(e,t){let i,r;let a=t.tracks,s=!1;for(let e in a){let t=a[e];if("main"===t.id){if(r=e,i=t,"video"===e){let t=a[e];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i&&i.type!==rc.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ay.PARSED&&(this.state=ay.IDLE);return}let a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=ay.ERROR;return}switch(t.details){case tY.FRAG_GAP:case tY.FRAG_PARSING_ERROR:case tY.FRAG_DECRYPT_ERROR:case tY.FRAG_LOAD_ERROR:case tY.FRAG_LOAD_TIMEOUT:case tY.KEY_LOAD_ERROR:case tY.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(rc.MAIN,t);break;case tY.LEVEL_LOAD_ERROR:case tY.LEVEL_LOAD_TIMEOUT:case tY.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ay.WAITING_LEVEL||(null==(i=t.context)?void 0:i.type)!==rh.LEVEL||(this.state=ay.IDLE);break;case tY.BUFFER_APPEND_ERROR:case tY.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===tY.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case tY.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){let{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!aa.getBuffered(e).length){let e=this.state!==ay.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=ay.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==t2.AUDIO||this.audioOnly&&!this.altAudio){let e=(t===t2.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,rc.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}let r=aa.getBuffered(e),a=(r.length?r.start(0):0)-i;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),i+=a,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{let{hls:r}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=ay.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(tK.FRAG_LOADED,i),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;let i="main",{hls:r}=this,{remuxResult:a,chunkMeta:s}=e,n=this.getCurrentContext(s);if(!n){this.resetWhenMissingContext(s);return}let{frag:o,part:l,level:d}=n,{video:u,text:h,id3:c,initSegment:m}=a,{details:p}=d,f=this.altAudio?void 0:a.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=ay.PARSING,m){if(null!=m&&m.tracks){let e=o.initSegment||o;this._bufferInitSegment(d,m.tracks,e,s),r.trigger(tK.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:m.tracks})}let e=m.initPTS,t=m.timescale;tG(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},r.trigger(tK.INIT_PTS_FOUND,{frag:o,id:i,initPTS:e,timescale:t}))}if(u&&p&&"initSegment"!==o.sn){let e=p.fragments[o.sn-1-p.startSN],t=o.sn===p.startSN,i=!e||o.cc>e.cc;if(!1!==a.independent){let{startPTS:e,endPTS:r,startDTS:a,endDTS:n}=u;if(l)l.elementaryStreams[u.type]={startPTS:e,endPTS:r,startDTS:a,endDTS:n};else if(u.firstKeyFrame&&u.independent&&1===s.id&&!i&&(this.couldBacktrack=!0),u.dropped&&u.independent){let a=this.getMainFwdBufferInfo(),s=(a?a.end:this.getLoadPosition())+this.config.maxBufferHole,l=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(t||!(s<l-this.config.maxBufferHole)||i)i&&(o.gap=!0);else{this.backtrack(o);return}o.setElementaryStreamInfo(u.type,o.start,r,o.start,n,!0)}else t&&e>2&&(o.gap=!0);o.setElementaryStreamInfo(u.type,e,r,a,n),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,s,t||i)}else if(t||i)o.gap=!0;else{this.backtrack(o);return}}if(f){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=f;l&&(l.elementaryStreams[t2.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(t2.AUDIO,e,t,i,r),this.bufferFragmentData(f,o,l,s)}if(p&&null!=c&&null!=(t=c.samples)&&t.length){let e={id:i,frag:o,details:p,samples:c.samples};r.trigger(tK.FRAG_PARSING_METADATA,e)}if(p&&h){let e={id:i,frag:o,details:p,samples:h.samples};r.trigger(tK.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,i,r){if(this.state!==ay.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;let{audio:a,video:s,audiovideo:n}=t;if(a){let t=e.audioCodec,i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");let e=a.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(t="mp4a.40.5")}t&&-1!==t.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==a.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),a.levelCodec=t,a.id="main",this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${a.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),n&&this.log(`Init audiovideo buffer, container:${n.container}, codecs[level/parsed]=[${e.codecs}/${n.codec}]`),this.hls.trigger(tK.BUFFER_CODECS,t),Object.keys(t).forEach(e=>{let a=t[e].initSegment;null!=a&&a.byteLength&&this.hls.trigger(tK.BUFFER_APPENDING,{type:e,data:a,frag:i,part:null,chunkMeta:r,parent:i.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,rc.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ay.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){let i=e.currentTime;if(aa.isBuffered(e,i)?t=this.getAppendedFrag(i):aa.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let e=this.fragPlaying,i=t.level;e&&t.sn===e.sn&&e.level===i||(this.fragPlaying=t,this.hls.trigger(tK.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(tK.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){let e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){let e=this.media;if(e){let t=e.currentTime,i=this.currentFrag;if(i&&tG(t)&&tG(i.programDateTime))return new Date(i.programDateTime+(t-i.start)*1e3)}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class nB{static get version(){return"1.5.20"}static isMSESupported(){return nP()}static isSupported(){return function(){if(!nP())return!1;let e=iZ();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(i2(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(i2(t,"audio"))))}()}static getMediaSource(){return iZ()}static get Events(){return tK}static get ErrorTypes(){return tW}static get ErrorDetails(){return tY}static get DefaultConfig(){return nB.defaultConfig?nB.defaultConfig:nC}static set DefaultConfig(e){nB.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new sd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(e,t){if("object"==typeof console&&!0===e||"object"==typeof e){!function(e,...t){t.forEach(function(t){tz[t]=e[t]?e[t].bind(e):function(e){let t=self.console[e];return t?t.bind(self.console,`[${e}] >`):tq}(t)})}(e,"debug","log","info","warn","error");try{tz.log(`Debug logs enabled for "${t}" in hls.js version 1.5.20`)}catch(e){tz=tj}}else tz=tj}(e.debug||!1,"Hls instance");let t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=function e(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).reduce((i,r)=>(i[r]=e(t[r]),i),{}):t}(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{let a=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[a],n=[];r.forEach(r=>{let o=`${e}Loading${r}`,l=t[o];if(void 0!==l&&s){n.push(o);let e=i[a].default;switch(t[a]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),n.length&&tX.warn(`hls.js config: "${n.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(t[a])}`)}),tB(tB({},i),t)}(nB.DefaultConfig,e);this.userConfig=e,t.progressive&&function(e){let t=e.loader;t!==nR&&t!==nS?(tX.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=nR,e.progressive=!0,e.enableSoftwareAES=!0,tX.log("[config]: Progressive streaming enabled, using FetchLoader"))}(t);let{abrController:i,bufferController:r,capLevelController:a,errorController:s,fpsController:n}=t,o=new s(this),l=this.abrController=new i(this),d=this.bufferController=new r(this),u=this.capLevelController=new a(this),h=new n(this),c=new rf(this),m=new rR(this),p=t.contentSteeringController,f=p?new p(this):null,g=this.levelController=new nx(this,f),E=new ae(this),b=new nO(this.config),y=this.streamController=new nF(this,E,b);u.setStreamController(y),h.setStreamController(y);let T=[c,g,y];f&&T.splice(1,0,f),this.networkControllers=T;let _=[l,d,u,h,m,E];this.audioTrackController=this.createController(t.audioTrackController,T);let A=t.audioStreamController;A&&T.push(new A(this,E,b)),this.subtitleTrackController=this.createController(t.subtitleTrackController,T);let S=t.subtitleStreamController;S&&T.push(new S(this,E,b)),this.createController(t.timelineController,_),b.emeController=this.emeController=this.createController(t.emeController,_),this.cmcdController=this.createController(t.cmcdController,_),this.latencyController=this.createController(rI,_),this.coreComponents=_,T.push(o);let k=o.onErrorOut;"function"==typeof k&&this.on(tK.ERROR,k,o)}createController(e,t){if(e){let i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(tX.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;let i=e===tK.ERROR;this.trigger(tK.ERROR,{type:tW.OTHER_ERROR,details:tY.INTERNAL_EXCEPTION,fatal:i,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){tX.log("destroy"),this.trigger(tK.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;let e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){tX.log("attachMedia"),this._media=e,this.trigger(tK.MEDIA_ATTACHING,{media:e})}detachMedia(){tX.log("detachMedia"),this.trigger(tK.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();let t=this.media,i=this.url,r=this.url=tU.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,tX.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(tK.MANIFEST_LOADING,{url:e})}startLoad(e=-1){tX.log(`startLoad(${e})`),this.started=!0,this.resumeBuffering();for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(e),this.started&&this.networkControllers);t++);}stopLoad(){tX.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}resumeBuffering(){tX.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()})}pauseBuffering(){tX.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()})}swapAudioCodec(){tX.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){tX.log("recoverMediaError");let e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){tX.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){tX.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){tX.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){tX.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){let e=this.levelController.startLevel;return -1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){tX.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){let t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(tX.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){rL.indexOf(e)>-1&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return -1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;let i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){let e;let{levels:t,autoLevelCapping:i,maxHdcpLevel:r}=this;if(e=-1===i&&null!=t&&t.length?t.length-1:i,r)for(let i=e;i--;){let e=t[i].attrs["HDCP-LEVEL"];if(e&&e<=r)return i}return e}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get allAudioTracks(){let e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){let e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){let e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){let t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){let e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){let e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){let e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){let t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){let e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){let t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}nB.defaultConfig=void 0;var n$={VIDEO:"video",DRM:"drm"},nG={NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},nH=e=>e===n$.VIDEO?"playback":e,nV=class e extends Error{constructor(t,i=e.MEDIA_ERR_CUSTOM,r,a){var s;super(t),this.name="MediaError",this.code=i,this.context=a,this.fatal=null!=r?r:i>=e.MEDIA_ERR_NETWORK&&i<=e.MEDIA_ERR_ENCRYPTED,this.message||(this.message=null!=(s=e.defaultMessages[this.code])?s:"")}};nV.MEDIA_ERR_ABORTED=1,nV.MEDIA_ERR_NETWORK=2,nV.MEDIA_ERR_DECODE=3,nV.MEDIA_ERR_SRC_NOT_SUPPORTED=4,nV.MEDIA_ERR_ENCRYPTED=5,nV.MEDIA_ERR_CUSTOM=100,nV.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var nK=nV,nW=e=>null==e,nY=(e,t)=>!nW(t)&&e in t,nq={ANY:"any",MUTED:"muted"},nj={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},nz={MSE:"mse",NATIVE:"native"},nX={HEADER:"header",QUERY:"query",NONE:"none"},nQ=Object.values(nX),nZ={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},nJ={HLS:nZ.M3U8},n0=(Object.keys(nJ),[...Object.values(nZ)],{upTo720p:"720p",upTo1080p:"1080p",upTo1440p:"1440p",upTo2160p:"2160p"}),n1={noLessThan480p:"480p",noLessThan540p:"540p",noLessThan720p:"720p",noLessThan1080p:"1080p",noLessThan1440p:"1440p",noLessThan2160p:"2160p"},n2={DESCENDING:"desc"},n3={code:"en"},n4=(e,t,i,r,a=e)=>{a.addEventListener(t,i,r),e.addEventListener("teardown",()=>{a.removeEventListener(t,i)},{once:!0})},n5=e=>{let t=e.indexOf("?");return t<0?[e]:[e.slice(0,t),e.slice(t)]},n8=e=>{let{type:t}=e;if(t){let e=t.toUpperCase();return nY(e,nJ)?nJ[e]:t}return n7(e)},n9=e=>"VOD"===e?nj.ON_DEMAND:nj.LIVE,n6=e=>"EVENT"===e?Number.POSITIVE_INFINITY:"VOD"===e?Number.NaN:0,n7=e=>{let{src:t}=e;if(!t)return"";let i="";try{i=new URL(t).pathname}catch{console.error("invalid url")}let r=i.lastIndexOf(".");if(r<0)return ot(e)?nZ.M3U8:"";let a=i.slice(r+1).toUpperCase();return nY(a,nZ)?nZ[a]:""},oe="mux.com",ot=({src:e,customDomain:t=oe})=>{let i;try{i=new URL(`${e}`)}catch{return!1}let r="https:"===i.protocol,a=i.hostname===`stream.${t}`.toLowerCase(),s=i.pathname.split("/"),n=2===s.length,o=!(null!=s&&s[1].includes("."));return r&&a&&n&&o},oi=e=>{let t=(null!=e?e:"").split(".")[1];if(t)try{let e=t.replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(i)}catch{return}},or=({exp:e},t=Date.now())=>!e||1e3*e<t,oa=({sub:e},t)=>e!==t,os=({aud:e},t)=>!e,on=({aud:e},t)=>e!==t;function oo(e,t=!0){var i;return new ol(t&&null!=(i=null==n3?void 0:n3[e])?i:e,t?n3.code:"en")}var ol=class{constructor(e,t=(e=>null!=(e=n3)?e:"en")()){this.message=e,this.locale=t}format(e){return this.message.replace(/\{(\w+)\}/g,(t,i)=>{var r;return null!=(r=e[i])?r:""})}toString(){return this.message}},od=Object.values(nq),ou=e=>"boolean"==typeof e||"string"==typeof e&&od.includes(e),oh=(e,t,i)=>{let{autoplay:r}=e,a=!1,s=!1,n=ou(r)?r:!!r,o=()=>{a||n4(t,"playing",()=>{a=!0},{once:!0})};if(o(),n4(t,"loadstart",()=>{a=!1,o(),oc(t,n)},{once:!0}),n4(t,"loadstart",()=>{i||(s=e.streamType&&e.streamType!==nj.UNKNOWN?e.streamType===nj.LIVE:!Number.isFinite(t.duration)),oc(t,n)},{once:!0}),i&&i.once(nB.Events.LEVEL_LOADED,(t,i)=>{var r;s=e.streamType&&e.streamType!==nj.UNKNOWN?e.streamType===nj.LIVE:null!=(r=i.details.live)&&r}),!n){let r=()=>{!s||Number.isFinite(e.startTime)||(null!=i&&i.liveSyncPosition?t.currentTime=i.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};i&&n4(t,"play",()=>{"metadata"===t.preload?i.once(nB.Events.LEVEL_UPDATED,r):r()},{once:!0})}return e=>{a||oc(t,n=ou(e)?e:!!e)}},oc=(e,t)=>{if(!t)return;let i=e.muted,r=()=>e.muted=i;switch(t){case nq.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(r)});break;case nq.MUTED:e.muted=!0,e.play().catch(r);break;default:e.play().catch(()=>{})}},om=({preload:e,src:t},i,r)=>{let a=e=>{null!=e&&["","none","metadata","auto"].includes(e)?i.setAttribute("preload",e):i.removeAttribute("preload")};if(!r)return a(e),a;let s=!1,n=!1,o=r.config.maxBufferLength,l=r.config.maxBufferSize,d=e=>{a(e);let t=null!=e?e:i.preload;n||"none"===t||("metadata"===t?(r.config.maxBufferLength=1,r.config.maxBufferSize=1):(r.config.maxBufferLength=o,r.config.maxBufferSize=l),u())},u=()=>{!s&&t&&(s=!0,r.loadSource(t))};return n4(i,"play",()=>{n=!0,r.config.maxBufferLength=o,r.config.maxBufferSize=l,u()},{once:!0}),d(e),d},op=e=>"time"in e?e.time:e.startTime;function of(e,t,i,r,a,s){let n=document.createElement("track");return n.kind=t,n.label=i,r&&(n.srclang=r),a&&(n.id=a),s&&(n.default=!0),n.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",n.setAttribute("data-removeondestroy",""),e.append(n),n.track}function og(e,t,i){var r;return null==(r=Array.from(e.querySelectorAll("track")).find(e=>e.track.label===t&&e.track.kind===i))?void 0:r.track}async function ov(e,t,i,r){let a=og(e,i,r);return a||((a=of(e,r,i)).mode="hidden",await new Promise(e=>setTimeout(()=>e(void 0),0))),"hidden"!==a.mode&&(a.mode="hidden"),[...t].sort((e,t)=>op(t)-op(e)).forEach(t=>{var i,s;let n=t.value,o=op(t);if("endTime"in t&&null!=t.endTime)null==a||a.addCue(new VTTCue(o,t.endTime,"chapters"===r?n:JSON.stringify(null!=n?n:null)));else{let t=Array.prototype.findIndex.call(null==a?void 0:a.cues,e=>e.startTime>=o),l=null==(i=null==a?void 0:a.cues)?void 0:i[t],d=l?l.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,u=null==(s=null==a?void 0:a.cues)?void 0:s[t-1];u&&(u.endTime=o),null==a||a.addCue(new VTTCue(o,d,"chapters"===r?n:JSON.stringify(null!=n?n:null)))}}),e.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),a}var oE="cuepoints",ob=Object.freeze({label:oE});async function oy(e,t,i=ob){return ov(e,t,i.label,"metadata")}var oT=e=>({time:e.startTime,value:JSON.parse(e.text)});function o_(e,t={label:oE}){var i,r;let a=og(e,t.label,"metadata");if(!(null!=(i=null==a?void 0:a.activeCues)&&i.length))return;if(1===a.activeCues.length)return oT(a.activeCues[0]);let{currentTime:s}=e;return oT(Array.prototype.find.call(null!=(r=a.activeCues)?r:[],({startTime:e,endTime:t})=>e<=s&&t>s)||a.activeCues[0])}async function oA(e,t=ob){return new Promise(i=>{n4(e,"loadstart",async()=>{let r=await oy(e,[],t);n4(e,"cuechange",()=>{let t=o_(e);if(t){let i=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}},{},r),i(r)})})}var oS="chapters",ok=Object.freeze({label:oS}),oR=e=>({startTime:e.startTime,endTime:e.endTime,value:e.text});async function oI(e,t,i=ok){return ov(e,t,i.label,"chapters")}function oL(e,t={label:oS}){var i,r;let a=og(e,t.label,"chapters");if(!(null!=(i=null==a?void 0:a.activeCues)&&i.length))return;if(1===a.activeCues.length)return oR(a.activeCues[0]);let{currentTime:s}=e;return oR(Array.prototype.find.call(null!=(r=a.activeCues)?r:[],({startTime:e,endTime:t})=>e<=s&&t>s)||a.activeCues[0])}async function ow(e,t=ok){return new Promise(i=>{n4(e,"loadstart",async()=>{let r=await oI(e,[],t);n4(e,"cuechange",()=>{let t=oL(e);if(t){let i=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}},{},r),i(r)})})}var oD={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},oC=e=>e===n$.VIDEO?oD.VIDEO:e===n$.DRM?oD.DRM:void 0,ox=(e,t)=>{var i,r;let a=nH(e),s=`${a}Token`;return null!=(i=t.tokens)&&i[a]?null==(r=t.tokens)?void 0:r[a]:nY(s,t)?t[s]:void 0},oM=(e,t,i,r,a=!1,s=!(e=>null==(e=globalThis.navigator)?void 0:e.onLine)())=>{var n,o;if(s){let i=oo("Your device appears to be offline",a),r=nK.MEDIA_ERR_NETWORK,s=new nK(i,r,!1,void 0);return s.errorCategory=t,s.muxCode=nG.NETWORK_OFFLINE,s.data=e,s}let l="status"in e?e.status:e.code,d=Date.now(),u=nK.MEDIA_ERR_NETWORK;if(200===l)return;let h=nH(t),c=ox(t,i),m=oC(t),[p]=n5(null!=(n=i.playbackId)?n:"");if(!l||!p)return;let f=oi(c);if(c&&!f){let i=new nK(oo("The {tokenNamePrefix}-token provided is invalid or malformed.",a).format({tokenNamePrefix:h}),u,!0,oo("Compact JWT string: {token}",a).format({token:c}));return i.errorCategory=t,i.muxCode=nG.NETWORK_TOKEN_MALFORMED,i.data=e,i}if(l>=500){let e=new nK("",u,null==r||r);return e.errorCategory=t,e.muxCode=nG.NETWORK_UNKNOWN_ERROR,e}if(403===l){if(f){if(or(f,d)){let i={timeStyle:"medium",dateStyle:"medium"},r=new nK(oo("The video\u2019s secured {tokenNamePrefix}-token has expired.",a).format({tokenNamePrefix:h}),u,!0,oo("Expired at: {expiredDate}. Current time: {currentDate}.",a).format({expiredDate:new Intl.DateTimeFormat("en",i).format(null!=(o=f.exp)?o:0),currentDate:new Intl.DateTimeFormat("en",i).format(d)}));return r.errorCategory=t,r.muxCode=nG.NETWORK_TOKEN_EXPIRED,r.data=e,r}if(oa(f,p)){let i=new nK(oo("The video\u2019s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",a).format({tokenNamePrefix:h}),u,!0,oo("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",a).format({tokenNamePrefix:h,playbackId:p,tokenPlaybackId:f.sub}));return i.errorCategory=t,i.muxCode=nG.NETWORK_TOKEN_SUB_MISMATCH,i.data=e,i}if(os(f,m)){let i=new nK(oo("The {tokenNamePrefix}-token is formatted with incorrect information.",a).format({tokenNamePrefix:h}),u,!0,oo("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",a).format({tokenNamePrefix:h,expectedAud:m}));return i.errorCategory=t,i.muxCode=nG.NETWORK_TOKEN_AUD_MISSING,i.data=e,i}if(on(f,m)){let i=new nK(oo("The {tokenNamePrefix}-token is formatted with incorrect information.",a).format({tokenNamePrefix:h}),u,!0,oo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",a).format({tokenNamePrefix:h,expectedAud:m,aud:f.aud}));return i.errorCategory=t,i.muxCode=nG.NETWORK_TOKEN_AUD_MISMATCH,i.data=e,i}}else{let i=new nK(oo("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",a).format({tokenNamePrefix:h,category:t}),u,null==r||r,oo("Specified playback ID: {playbackId}",a).format({playbackId:p}));return i.errorCategory=t,i.muxCode=nG.NETWORK_TOKEN_MISSING,i.data=e,i}}if(412===l){let i=new nK(oo("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",a),u,null==r||r,oo("Specified playback ID: {playbackId}",a).format({playbackId:p}));return i.errorCategory=t,i.muxCode=nG.NETWORK_NOT_READY,i.data=e,i}if(404===l){let i=new nK(oo("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",a),u,null==r||r,oo("Specified playback ID: {playbackId}",a).format({playbackId:p}));return i.errorCategory=t,i.muxCode=nG.NETWORK_NOT_FOUND,i.data=e,i}if(400===l){let i=new nK(oo("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),u,null==r||r,oo("Specified playback ID: {playbackId}",a).format({playbackId:p}));return i.errorCategory=t,i.muxCode=nG.NETWORK_INVALID_URL,i.data=e,i}let g=new nK("",u,null==r||r);return g.errorCategory=t,g.muxCode=nG.NETWORK_UNKNOWN_ERROR,g.data=e,g},oO=nB.DefaultConfig.capLevelController,oN=class e extends oO{constructor(e){super(e)}get levels(){var e;return null!=(e=this.hls.levels)?e:[]}getValidLevels(e){return this.levels.filter((t,i)=>this.isLevelAllowed(t)&&i<=e)}getMaxLevel(t){let i=super.getMaxLevel(t),r=this.getValidLevels(t);if(!r[i])return i;let a=Math.min(r[i].width,r[i].height),s=e.minMaxResolution;return a>=s?i:oO.getMaxLevelByMediaSize(r,16/9*s,s)}};oN.minMaxResolution=720;var oP,oU,oF,oB,o$,oG,oH,oV,oK,oW,oY,oq,oj,oz,oX,oQ,oZ,oJ,o0,o1,o2,o3,o4={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},o5=e=>e.includes("fps")?o4.FAIRPLAY:e.includes("playready")?o4.PLAYREADY:e.includes("widevine")?o4.WIDEVINE:void 0,o8=async e=>fetch(e).then(e=>200!==e.status?Promise.reject(e):e.text()).then(e=>fetch(e.split(`
`).find((e,t,i)=>t&&i[t-1].startsWith("#EXT-X-STREAM-INF"))).then(e=>200!==e.status?Promise.reject(e):e.text()).then(e=>e.split(`
`))),o9=e=>{var t,i,r;let a=null==(i=(null!=(t=e.find(e=>e.startsWith("#EXT-X-PLAYLIST-TYPE")))?t:"").split(":")[1])?void 0:i.trim(),s=n9(a),n=n6(a),o;if(s===nj.LIVE){let t=e.find(e=>e.startsWith("#EXT-X-PART-INF"));if(t)o=2*+t.split(":")[1].split("=")[1];else{let t=e.find(e=>e.startsWith("#EXT-X-TARGETDURATION")),i=null==(r=null==t?void 0:t.split(":"))?void 0:r[1];o=3*+(null!=i?i:6)}}return{streamType:s,targetLiveWindow:n,liveEdgeStartOffset:o}},o6=async(e,t)=>t===nZ.MP4?{streamType:nj.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0}:t===nZ.M3U8?o9(await o8(e)):(console.error(`Media type ${t} is an unrecognized or unsupported type for src ${e}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0}),o7=async(e,t,i=n8({src:e}))=>{var r,a,s;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:l}=await o6(e,i);(null!=(r=ls.get(t))?r:{}).liveEdgeStartOffset=l,(null!=(a=ls.get(t))?a:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(s=ls.get(t))?s:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},le=e=>{var t;let i=e.type,r=n9(i),a=n6(i),s,n=!!(null!=(t=e.partList)&&t.length);return r===nj.LIVE&&(s=n?2*e.partTarget:3*e.targetduration),{streamType:r,targetLiveWindow:a,liveEdgeStartOffset:s,lowLatency:n}},lt=(e,t,i)=>{var r,a,s,n,o,l,d,u;let{streamType:h,targetLiveWindow:c,liveEdgeStartOffset:m,lowLatency:p}=le(e);if(h===nj.LIVE){p?(i.config.backBufferLength=null!=(r=i.userConfig.backBufferLength)?r:4,i.config.maxFragLookUpTolerance=null!=(a=i.userConfig.maxFragLookUpTolerance)?a:.001,i.config.abrBandWidthUpFactor=null!=(s=i.userConfig.abrBandWidthUpFactor)?s:i.config.abrBandWidthFactor):i.config.backBufferLength=null!=(n=i.userConfig.backBufferLength)?n:8;let e=Object.freeze({get length(){return t.seekable.length},start:e=>t.seekable.start(e),end(e){var r;return e>this.length||e<0||Number.isFinite(t.duration)?t.seekable.end(e):null!=(r=i.liveSyncPosition)?r:t.seekable.end(e)}});(null!=(o=ls.get(t))?o:{}).seekable=e}(null!=(l=ls.get(t))?l:{}).liveEdgeStartOffset=m,(null!=(d=ls.get(t))?d:{}).targetLiveWindow=c,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(u=ls.get(t))?u:{}).streamType=h,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},li=null!=(oJ=null==(oZ=null==globalThis?void 0:globalThis.navigator)?void 0:oZ.userAgent)?oJ:"",lr=null!=(o2=null==(o1=null==(o0=null==globalThis?void 0:globalThis.navigator)?void 0:o0.userAgentData)?void 0:o1.platform)?o2:"",la=li.toLowerCase().includes("android")||["x11","android"].some(e=>lr.toLowerCase().includes(e)),ls=new WeakMap,ln="mux.com",lo=null==(o3=nB.isSupported)?void 0:o3.call(nB),ll=()=>tO.utils.now(),ld=tO.utils.generateUUID,lu=({playbackId:e,customDomain:t=ln,maxResolution:i,minResolution:r,renditionOrder:a,programStartTime:s,programEndTime:n,assetStartTime:o,assetEndTime:l,playbackToken:d,tokens:{playback:u=d}={},extraSourceParams:h={}}={})=>{if(!e)return;let[c,m=""]=n5(e),p=new URL(`https://stream.${t}/${c}.m3u8${m}`);return u||p.searchParams.has("token")?(p.searchParams.forEach((e,t)=>{"token"!=t&&p.searchParams.delete(t)}),u&&p.searchParams.set("token",u)):(i&&p.searchParams.set("max_resolution",i),r&&(p.searchParams.set("min_resolution",r),i&&+i.slice(0,-1)<+r.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",r,"maxResolution",i)),a&&p.searchParams.set("rendition_order",a),s&&p.searchParams.set("program_start_time",`${s}`),n&&p.searchParams.set("program_end_time",`${n}`),o&&p.searchParams.set("asset_start_time",`${o}`),l&&p.searchParams.set("asset_end_time",`${l}`),Object.entries(h).forEach(([e,t])=>{null!=t&&p.searchParams.set(e,t)})),p.toString()},lh=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},lc=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(".m3u8");return t||void 0},lm=e=>{var t,i,r;return null!=(t=null==e?void 0:e.metadata)&&t.video_id?e.metadata.video_id:lP(e)&&null!=(r=null!=(i=lh(e.playbackId))?i:lc(e.src))?r:e.src},lp=e=>{var t;return null==(t=ls.get(e))?void 0:t.error},lf=e=>{var t,i;return null!=(i=null==(t=ls.get(e))?void 0:t.streamType)?i:nj.UNKNOWN},lg=e=>{var t,i;return null!=(i=null==(t=ls.get(e))?void 0:t.targetLiveWindow)?i:Number.NaN},lv=e=>{var t,i;return null!=(i=null==(t=ls.get(e))?void 0:t.seekable)?i:e.seekable},lE=e=>{var t;let i=null==(t=ls.get(e))?void 0:t.liveEdgeStartOffset;if("number"!=typeof i)return Number.NaN;let r=lv(e);return r.length?r.end(r.length-1)-i:Number.NaN},lb=.034,ly=(e,t,i=lb)=>Math.abs(e-t)<=i,lT=(e,t,i=lb)=>e>t||ly(e,t,i),l_=(e,t=lb)=>e.paused&&lT(e.currentTime,e.duration,t),lA=(e,t)=>{var i,r,a;if(!t||!e.buffered.length)return;if(e.readyState>2)return!1;let s=t.currentLevel>=0?null==(r=null==(i=t.levels)?void 0:i[t.currentLevel])?void 0:r.details:null==(a=t.levels.find(e=>!!e.details))?void 0:a.details;if(!s||s.live)return;let{fragments:n}=s;if(!(null!=n&&n.length))return;if(e.currentTime<e.duration-(s.targetduration+.5))return!1;let o=n[n.length-1];if(e.currentTime<=o.start)return!1;let l=o.start+o.duration/2,d=e.buffered.start(e.buffered.length-1),u=e.buffered.end(e.buffered.length-1);return l>d&&l<u},lS=(e,t)=>e.ended||e.loop?e.ended:!!(t&&lA(e,t))||l_(e),lk=(e,t,i)=>{lR(t,i);let{metadata:r={}}=e,{view_session_id:a=ld()}=r,s=lm(e);r.view_session_id=a,r.video_id=s,e.metadata=r,e.drmTypeCb=e=>{var i;null==(i=t.mux)||i.emit("hb",{view_drm_type:e})},ls.set(t,{});let n=lL(e,t),o=om(e,t,n);lU(e,t,n),lF(e,t,n),oA(t),ow(t);let l=oh(e,t,n);return{engine:n,setAutoplay:l,setPreload:o}},lR=(e,t)=>{let i=null==t?void 0:t.engine;i&&(i.detachMedia(),i.destroy()),null!=e&&e.mux&&!e.mux.deleted&&(e.mux.destroy(),delete e.mux),e&&(e.removeAttribute("src"),e.load(),e.removeEventListener("error",l$),e.removeEventListener("error",lH),e.removeEventListener("durationchange",lB),ls.delete(e),e.dispatchEvent(new Event("teardown")))};function lI(e,t){var i;let r=n8(e);if(r!==nZ.M3U8)return!0;let a=!r||null==(i=t.canPlayType(r))||i,{preferPlayback:s}=e,n=s===nz.MSE,o=s===nz.NATIVE;return a&&(o||!(lo&&(n||la)))}var lL=(e,t)=>{let{debug:i,streamType:r,startTime:a=-1,metadata:s,preferCmcd:n,_hlsConfig:o={}}=e,l=n8(e)===nZ.M3U8,d=lI(e,t);if(l&&!d&&lo){let t=lw(r),l=lD(e);return new nB({debug:i,startPosition:a,cmcd:n!==nX.NONE?{useHeaders:n===nX.HEADER,sessionId:null==s?void 0:s.view_session_id,contentId:null==s?void 0:s.video_id}:void 0,xhrSetup:(e,t)=>{var i,r;if(n&&n!==nX.QUERY)return;let a=new URL(t);if(!a.searchParams.has("CMCD"))return;let s=(null!=(r=null==(i=a.searchParams.get("CMCD"))?void 0:i.split(","))?r:[]).filter(e=>e.startsWith("sid")||e.startsWith("cid")).join(",");a.searchParams.set("CMCD",s),e.open("GET",a)},capLevelController:oN,backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0,...t,...l,...o})}},lw=e=>e===nj.LIVE?{backBufferLength:8}:{},lD=e=>{let{tokens:{drm:t}={},playbackId:i,drmTypeCb:r}=e,a=lh(i);return t&&a?{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:lO(e,"fairplay"),serverCertificateUrl:lN(e,"fairplay")},"com.widevine.alpha":{licenseUrl:lO(e,"widevine")},"com.microsoft.playready":{licenseUrl:lO(e,"playready")}},requestMediaKeySystemAccessFunc:(e,t)=>("com.widevine.alpha"===e&&(t=[...t.map(e=>{var t;let i=null==(t=e.videoCapabilities)?void 0:t.map(e=>({...e,robustness:"HW_SECURE_ALL"}));return{...e,videoCapabilities:i}}),...t]),navigator.requestMediaKeySystemAccess(e,t).then(t=>{let i=o5(e);return null==r||r(i),t}))}:{}},lC=async e=>{let t=await fetch(e);return 200!==t.status?Promise.reject(t):await t.arrayBuffer()},lx=async(e,t)=>{let i=await fetch(t,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:e});return 200!==i.status?Promise.reject(i):new Uint8Array(await i.arrayBuffer())},lM=(e,t)=>{n4(t,"encrypted",async i=>{try{let r=i.initDataType;if("skd"!==r){console.error(`Received unexpected initialization data type "${r}"`);return}if(!t.mediaKeys){let i=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[r],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(t=>{var i;return null==(i=e.drmTypeCb)||i.call(e,o4.FAIRPLAY),t}).catch(()=>{let e=oo("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),i=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!0);i.errorCategory=n$.DRM,i.muxCode=nG.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,lG(t,i)});if(!i)return;let a=await i.createMediaKeys();try{let t=await lC(lN(e,"fairplay")).catch(t=>{if(t instanceof Response){let i=oM(t,n$.DRM,e);return console.error("mediaError",null==i?void 0:i.message,null==i?void 0:i.context),i?Promise.reject(i):Promise.reject(Error("Unexpected error in app cert request"))}return Promise.reject(t)});await a.setServerCertificate(t).catch(()=>{let e=oo("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),t=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!0);return t.errorCategory=n$.DRM,t.muxCode=nG.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(t)})}catch(e){lG(t,e);return}await t.setMediaKeys(a)}let a=i.initData;if(null==a){console.error(`Could not start encrypted playback due to missing initData in ${i.type} event`);return}let s=t.mediaKeys.createSession();s.addEventListener("keystatuseschange",()=>{s.keyStatuses.forEach(e=>{let i;if("internal-error"===e){let e=oo("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");(i=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!0)).errorCategory=n$.DRM,i.muxCode=nG.ENCRYPTED_CDM_ERROR}else if("output-restricted"===e||"output-downscaled"===e){let e=oo("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");(i=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!1)).errorCategory=n$.DRM,i.muxCode=nG.ENCRYPTED_OUTPUT_RESTRICTED}i&&lG(t,i)})});let n=await Promise.all([s.generateRequest(r,a).catch(()=>{let e=oo("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),i=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!0);i.errorCategory=n$.DRM,i.muxCode=nG.ENCRYPTED_GENERATE_REQUEST_FAILED,lG(t,i)}),new Promise(e=>{s.addEventListener("message",t=>{e(t.message)},{once:!0})})]).then(([,e])=>e),o=await lx(n,lO(e,"fairplay")).catch(t=>{if(t instanceof Response){let i=oM(t,n$.DRM,e);return console.error("mediaError",null==i?void 0:i.message,null==i?void 0:i.context),i?Promise.reject(i):Promise.reject(Error("Unexpected error in license key request"))}return Promise.reject(t)});await s.update(o).catch(()=>{let e=oo("Failed to update DRM license. This may be an issue with the player or your protected content."),t=new nK(e,nK.MEDIA_ERR_ENCRYPTED,!0);return t.errorCategory=n$.DRM,t.muxCode=nG.ENCRYPTED_UPDATE_LICENSE_FAILED,Promise.reject(t)})}catch(e){lG(t,e);return}})},lO=({playbackId:e,tokens:{drm:t}={},customDomain:i=ln},r)=>{let a=lh(e);return`https://license.${i.toLocaleLowerCase().endsWith(ln)?i:ln}/license/${r}/${a}?token=${t}`},lN=({playbackId:e,tokens:{drm:t}={},customDomain:i=ln},r)=>{let a=lh(e);return`https://license.${i.toLocaleLowerCase().endsWith(ln)?i:ln}/appcert/${r}/${a}?token=${t}`},lP=({playbackId:e,src:t,customDomain:i})=>{if(e)return!0;if("string"!=typeof t)return!1;let r=new URL(t,null==window?void 0:window.location.href).hostname.toLocaleLowerCase();return r.includes(ln)||!!i&&r.includes(i.toLocaleLowerCase())},lU=(e,t,i)=>{var r;let{envKey:a,disableTracking:s}=e,n=lP(e);if(!s&&(a||n)){let{playerInitTime:s,playerSoftwareName:n,playerSoftwareVersion:o,beaconCollectionDomain:l,debug:d,disableCookies:u}=e,h={...e.metadata,video_title:(null==(r=null==e?void 0:e.metadata)?void 0:r.video_title)||void 0};tO.monitor(t,{debug:d,beaconCollectionDomain:l,hlsjs:i,Hls:i?nB:void 0,automaticErrorTracking:!1,errorTranslator:t=>"string"!=typeof t.player_error_code&&("function"==typeof e.errorTranslator?e.errorTranslator(t):t),disableCookies:u,data:{...a?{env_key:a}:{},player_software_name:n,player_software:n,player_software_version:o,player_init_time:s,...h}})}},lF=(e,t,i)=>{var r,a;let s=lI(e,t),{src:n}=e,o=()=>{t.ended||!lS(t,i)||(lA(t,i)?t.currentTime=t.buffered.end(t.buffered.length-1):t.dispatchEvent(new Event("ended")))},l,d,u=()=>{let e=lv(t),i,r;e.length>0&&(i=e.start(0),r=e.end(0)),(d!==r||l!==i)&&t.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),l=i,d=r};if(n4(t,"durationchange",u),t&&s){let i=n8(e);if("string"==typeof n){let s=()=>{if(lf(t)!==nj.LIVE||Number.isFinite(t.duration))return;let e=setInterval(u,1e3);t.addEventListener("teardown",()=>{clearInterval(e)},{once:!0}),n4(t,"durationchange",()=>{Number.isFinite(t.duration)&&clearInterval(e)})},o=async()=>o7(n,t,i).then(s).catch(i=>{if(i instanceof Response){let r=oM(i,n$.VIDEO,e);if(r){lG(t,r);return}}});if("none"===t.preload){let e=()=>{o(),t.removeEventListener("loadedmetadata",i)},i=()=>{o(),t.removeEventListener("play",e)};n4(t,"play",e,{once:!0}),n4(t,"loadedmetadata",i,{once:!0})}else o();null!=(r=e.tokens)&&r.drm?lM(e,t):n4(t,"encrypted",()=>{let e=new nK(oo("Attempting to play DRM-protected content without providing a DRM token."),nK.MEDIA_ERR_ENCRYPTED,!0);e.errorCategory=n$.DRM,e.muxCode=nG.ENCRYPTED_MISSING_TOKEN,lG(t,e)},{once:!0}),t.setAttribute("src",n),e.startTime&&((null!=(a=ls.get(t))?a:{}).startTime=e.startTime,t.addEventListener("durationchange",lB,{once:!0}))}else t.removeAttribute("src");t.addEventListener("error",l$),t.addEventListener("error",lH),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})},{once:!0}),n4(t,"pause",o),n4(t,"seeked",o),n4(t,"play",()=>{t.ended||lT(t.currentTime,t.duration)&&(t.currentTime=t.seekable.length?t.seekable.start(0):0)})}else i&&n?(i.once(nB.Events.LEVEL_LOADED,(e,r)=>{lt(r.details,t,i),u(),lf(t)!==nj.LIVE||Number.isFinite(t.duration)||(i.on(nB.Events.LEVEL_UPDATED,u),n4(t,"durationchange",()=>{Number.isFinite(t.duration)&&i.off(nB.Events.LEVELS_UPDATED,u)}))}),i.on(nB.Events.ERROR,(i,r)=>{lG(t,lV(r,e))}),t.addEventListener("error",lH),n4(t,"waiting",o),function(e,t){var i;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(nB.Events.MANIFEST_PARSED,function(t,i){o();let a=e.addVideoTrack("main");for(let[e,t]of(a.selected=!0,i.levels.entries())){let i=a.addRendition(t.url[0],t.width,t.height,t.videoCodec,t.bitrate);r.set(t,`${e}`),i.id=`${e}`}}),t.on(nB.Events.AUDIO_TRACKS_UPDATED,function(t,i){for(let t of(n(),i.audioTracks)){let i=t.default?"main":"alternative",r=e.addAudioTrack(i,t.name,t.lang);r.id=`${t.id}`,t.default&&(r.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var i;let r=+(null==(i=[...e.audioTracks].find(e=>e.enabled))?void 0:i.id),a=t.audioTracks.map(e=>e.id);r!=t.audioTrack&&a.includes(r)&&(t.audioTrack=r)}),t.on(nB.Events.LEVELS_UPDATED,function(t,i){var a;let s=e.videoTracks[null!=(a=e.videoTracks.selectedIndex)?a:0];if(!s)return;let n=i.levels.map(e=>r.get(e));for(let t of e.videoRenditions)t.id&&!n.includes(t.id)&&s.removeRendition(t)});let a=i=>{let r=e.currentTime,a=!1,s=(e,t)=>{a||(a=!Number.isFinite(t.endOffset))};t.on(nB.Events.BUFFER_FLUSHING,s),t.nextLevel=i,t.off(nB.Events.BUFFER_FLUSHING,s),a||t.trigger(nB.Events.BUFFER_FLUSHING,{startOffset:r+10,endOffset:1/0,type:"video"})};null==(i=e.videoRenditions)||i.addEventListener("change",e=>{let i=e.target.selectedIndex;i!=t.nextLevel&&a(i)});let s=()=>{for(let t of e.videoTracks)e.removeVideoTrack(t)},n=()=>{for(let t of e.audioTracks)e.removeAudioTrack(t)},o=()=>{s(),n()};t.once(nB.Events.DESTROYING,o)}(e,i),function(e,t){t.on(nB.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(i,{tracks:r})=>{r.forEach(i=>{var r,a;let s=null!=(r=i.subtitleTrack)?r:i.closedCaptions,n=t.subtitleTracks.findIndex(({lang:e,name:t,type:r})=>e==(null==s?void 0:s.lang)&&t===i.label&&r.toLowerCase()===i.kind),o=(null!=(a=i._id)?a:i.default)?"default":`${i.kind}${n}`;of(e,i.kind,i.label,null==s?void 0:s.lang,o,i.default)})});let i=()=>{if(!t.subtitleTracks.length)return;let i=Array.from(e.textTracks).find(e=>e.id&&"showing"===e.mode&&["subtitles","captions"].includes(e.kind));if(!i)return;let r=t.subtitleTracks[t.subtitleTrack],a=r?r.default?"default":`${t.subtitleTracks[t.subtitleTrack].type.toLowerCase()}${t.subtitleTrack}`:void 0;if(t.subtitleTrack<0||(null==i?void 0:i.id)!==a){let e=t.subtitleTracks.findIndex(({lang:e,name:t,type:r,default:a})=>"default"===i.id&&a||e==i.language&&t===i.label&&r.toLowerCase()===i.kind);t.subtitleTrack=e}(null==i?void 0:i.id)===a&&i.cues&&Array.from(i.cues).forEach(e=>{i.addCue(e)})};e.textTracks.addEventListener("change",i),t.on(nB.Events.CUES_PARSED,(t,{track:i,cues:r})=>{let a=e.textTracks.getTrackById(i);if(!a)return;let s="disabled"===a.mode;s&&(a.mode="hidden"),r.forEach(e=>{var t;null!=(t=a.cues)&&t.getCueById(e.id)||a.addCue(e)}),s&&(a.mode="disabled")}),t.once(nB.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",i),e.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})});let r=()=>{Array.from(e.textTracks).forEach(t=>{var i,r;if(!["subtitles","caption"].includes(t.kind)&&("thumbnails"===t.label||"chapters"===t.kind)){if(!(null!=(i=t.cues)&&i.length)){let i="track";t.kind&&(i+=`[kind="${t.kind}"]`),t.label&&(i+=`[label="${t.label}"]`);let a=e.querySelector(i),s=null!=(r=null==a?void 0:a.getAttribute("src"))?r:"";null==a||a.removeAttribute("src"),setTimeout(()=>{null==a||a.setAttribute("src",s)},0)}"hidden"!==t.mode&&(t.mode="hidden")}})};t.once(nB.Events.MANIFEST_LOADED,r),t.once(nB.Events.MEDIA_ATTACHED,r)}(t,i),i.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function lB(e){var t;let i=e.target,r=null==(t=ls.get(i))?void 0:t.startTime;if(r&&function(e,t,i){t&&i>t&&(i=t);for(let t=0;t<e.length;t++)if(e.start(t)<=i&&e.end(t)>=i)return!0;return!1}(i.seekable,i.duration,r)){let e="auto"===i.preload;e&&(i.preload="none"),i.currentTime=r,e&&(i.preload="auto")}}async function l$(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(null!=t&&t.error))return;let{message:i,code:r}=t.error,a=new nK(i,r);if(t.src&&r===nK.MEDIA_ERR_SRC_NOT_SUPPORTED&&t.readyState===HTMLMediaElement.HAVE_NOTHING){setTimeout(()=>{var e;let i=null!=(e=lp(t))?e:t.error;(null==i?void 0:i.code)===nK.MEDIA_ERR_SRC_NOT_SUPPORTED&&lG(t,a)},500);return}if(t.src&&(r!==nK.MEDIA_ERR_DECODE||void 0!==r))try{let{status:e}=await fetch(t.src);a.data={response:{code:e}}}catch{}lG(t,a)}function lG(e,t){var i;t.fatal&&((null!=(i=ls.get(e))?i:{}).error=t,e.dispatchEvent(new CustomEvent("error",{detail:t})))}function lH(e){var t,i;if(!(e instanceof CustomEvent)||!(e.detail instanceof nK))return;let r=e.target,a=e.detail;a&&a.fatal&&((null!=(t=ls.get(r))?t:{}).error=a,null==(i=r.mux)||i.emit("error",{player_error_code:a.code,player_error_message:a.message,player_error_context:a.context}))}var lV=(e,t)=>{var i,r,a;console.error("getErrorFromHlsErrorData()",e);let s={[nB.ErrorTypes.NETWORK_ERROR]:nK.MEDIA_ERR_NETWORK,[nB.ErrorTypes.MEDIA_ERROR]:nK.MEDIA_ERR_DECODE,[nB.ErrorTypes.KEY_SYSTEM_ERROR]:nK.MEDIA_ERR_ENCRYPTED},n,o=[nB.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,nB.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(e.details)?nK.MEDIA_ERR_NETWORK:s[e.type];if(o===nK.MEDIA_ERR_NETWORK&&e.response){let a=null!=(i=e.type===nB.ErrorTypes.KEY_SYSTEM_ERROR?n$.DRM:e.type===nB.ErrorTypes.NETWORK_ERROR?n$.VIDEO:void 0)?i:n$.VIDEO;n=null!=(r=oM(e.response,a,t,e.fatal))?r:new nK("",o,e.fatal)}else o===nK.MEDIA_ERR_ENCRYPTED?e.details===nB.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE?((n=new nK(oo("Attempting to play DRM-protected content without providing a DRM token."),nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_MISSING_TOKEN):e.details===nB.ErrorDetails.KEY_SYSTEM_NO_ACCESS?((n=new nK(oo("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM):e.details===nB.ErrorDetails.KEY_SYSTEM_NO_SESSION?((n=new nK(oo("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),nK.MEDIA_ERR_ENCRYPTED,!0)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_GENERATE_REQUEST_FAILED):e.details===nB.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED?((n=new nK(oo("Failed to update DRM license. This may be an issue with the player or your protected content."),nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_UPDATE_LICENSE_FAILED):e.details===nB.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED?((n=new nK(oo("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_UPDATE_SERVER_CERT_FAILED):e.details===nB.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR?((n=new nK(oo("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser."),nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_CDM_ERROR):e.details===nB.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED?((n=new nK(oo("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen."),nK.MEDIA_ERR_ENCRYPTED,!1)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_OUTPUT_RESTRICTED):((n=new nK(e.error.message,nK.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=n$.DRM,n.muxCode=nG.ENCRYPTED_ERROR):n=new nK("",o,e.fatal);return n.context||(n.context=`${e.url?`url: ${e.url}
`:""}${e.response&&(e.response.code||e.response.text)?`response: ${e.response.code}, ${e.response.text}
`:""}${e.reason?`failure reason: ${e.reason}
`:""}${e.level?`level: ${e.level}
`:""}${e.parent?`parent stream controller: ${e.parent}
`:""}${e.buffer?`buffer length: ${e.buffer}
`:""}${e.error?`error: ${e.error}
`:""}${e.event?`event: ${e.event}
`:""}${e.err?`error message: ${null==(a=e.err)?void 0:a.message}
`:""}`),n.data=e,n};let lK={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_TOGGLE_SUBTITLES_REQUEST:"mediatogglesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",MEDIA_RENDITION_REQUEST:"mediarenditionrequest",MEDIA_AUDIO_TRACK_REQUEST:"mediaaudiotrackrequest",MEDIA_SEEK_TO_LIVE_REQUEST:"mediaseektoliverequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},lW={MEDIA_CHROME_ATTRIBUTES:"mediachromeattributes",MEDIA_CONTROLLER:"mediacontroller"},lY={MEDIA_AIRPLAY_UNAVAILABLE:"mediaAirplayUnavailable",MEDIA_AUDIO_TRACK_ENABLED:"mediaAudioTrackEnabled",MEDIA_AUDIO_TRACK_LIST:"mediaAudioTrackList",MEDIA_AUDIO_TRACK_UNAVAILABLE:"mediaAudioTrackUnavailable",MEDIA_BUFFERED:"mediaBuffered",MEDIA_CAST_UNAVAILABLE:"mediaCastUnavailable",MEDIA_CHAPTERS_CUES:"mediaChaptersCues",MEDIA_CURRENT_TIME:"mediaCurrentTime",MEDIA_DURATION:"mediaDuration",MEDIA_ENDED:"mediaEnded",MEDIA_ERROR:"mediaError",MEDIA_ERROR_CODE:"mediaErrorCode",MEDIA_ERROR_MESSAGE:"mediaErrorMessage",MEDIA_FULLSCREEN_UNAVAILABLE:"mediaFullscreenUnavailable",MEDIA_HAS_PLAYED:"mediaHasPlayed",MEDIA_HEIGHT:"mediaHeight",MEDIA_IS_AIRPLAYING:"mediaIsAirplaying",MEDIA_IS_CASTING:"mediaIsCasting",MEDIA_IS_FULLSCREEN:"mediaIsFullscreen",MEDIA_IS_PIP:"mediaIsPip",MEDIA_LOADING:"mediaLoading",MEDIA_MUTED:"mediaMuted",MEDIA_PAUSED:"mediaPaused",MEDIA_PIP_UNAVAILABLE:"mediaPipUnavailable",MEDIA_PLAYBACK_RATE:"mediaPlaybackRate",MEDIA_PREVIEW_CHAPTER:"mediaPreviewChapter",MEDIA_PREVIEW_COORDS:"mediaPreviewCoords",MEDIA_PREVIEW_IMAGE:"mediaPreviewImage",MEDIA_PREVIEW_TIME:"mediaPreviewTime",MEDIA_RENDITION_LIST:"mediaRenditionList",MEDIA_RENDITION_SELECTED:"mediaRenditionSelected",MEDIA_RENDITION_UNAVAILABLE:"mediaRenditionUnavailable",MEDIA_SEEKABLE:"mediaSeekable",MEDIA_STREAM_TYPE:"mediaStreamType",MEDIA_SUBTITLES_LIST:"mediaSubtitlesList",MEDIA_SUBTITLES_SHOWING:"mediaSubtitlesShowing",MEDIA_TARGET_LIVE_WINDOW:"mediaTargetLiveWindow",MEDIA_TIME_IS_LIVE:"mediaTimeIsLive",MEDIA_VOLUME:"mediaVolume",MEDIA_VOLUME_LEVEL:"mediaVolumeLevel",MEDIA_VOLUME_UNAVAILABLE:"mediaVolumeUnavailable",MEDIA_WIDTH:"mediaWidth"},lq=Object.entries(lY),lj=lq.reduce((e,[t,i])=>(e[t]=i.toLowerCase(),e),{}),lz=lq.reduce((e,[t,i])=>(e[t]=i.toLowerCase(),e),{USER_INACTIVE_CHANGE:"userinactivechange",BREAKPOINTS_CHANGE:"breakpointchange",BREAKPOINTS_COMPUTED:"breakpointscomputed"});Object.entries(lz).reduce((e,[t,i])=>{let r=lj[t];return r&&(e[i]=r),e},{userinactivechange:"userinactive"});let lX=Object.entries(lj).reduce((e,[t,i])=>{let r=lz[t];return r&&(e[i]=r),e},{userinactive:"userinactivechange"}),lQ={SUBTITLES:"subtitles",CAPTIONS:"captions",CHAPTERS:"chapters",METADATA:"metadata"},lZ={DISABLED:"disabled",SHOWING:"showing"},lJ={MOUSE:"mouse",TOUCH:"touch"},l0={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},l1={LIVE:"live",ON_DEMAND:"on-demand",UNKNOWN:"unknown"},l2={FULLSCREEN:"fullscreen"};function l3(e){if(e){let{id:t,width:i,height:r}=e;return[t,i,r].filter(e=>null!=e).join(":")}}function l4(e){if(e){let[t,i,r]=e.split(":");return{id:t,width:+i,height:+r}}}function l5(e){if(e){let{id:t,kind:i,language:r,label:a}=e;return[t,i,r,a].filter(e=>null!=e).join(":")}}function l8(e){if(e){let[t,i,r,a]=e.split(":");return{id:t,kind:i,language:r,label:a}}}function l9(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}function l6(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}let l7=e=>new Promise(t=>setTimeout(t,e)),de=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],dt=(e,t)=>{let i=1===e?de[t].singular:de[t].plural;return`${e} ${i}`},di=e=>{if(!l9(e))return"";let t=Math.abs(e),i=t!==e,r=new Date(0,0,0,0,0,t,0),a=[r.getHours(),r.getMinutes(),r.getSeconds()].map((e,t)=>e&&dt(e,t)).filter(e=>e).join(", ");return`${a}${i?" remaining":""}`};function dr(e,t){let i=!1;e<0&&(i=!0,e=0-e);let r=Math.floor((e=e<0?0:e)%60),a=Math.floor(e/60%60),s=Math.floor(e/3600),n=Math.floor(t/60%60),o=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(s=a=r="0"),a=(((s=s>0||o>0?s+":":"")||n>=10)&&a<10?"0"+a:a)+":",(i?"-":"")+s+a+(r=r<10?"0"+r:r)}Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});let da={"Start airplay":"Start airplay","Stop airplay":"Stop airplay",Audio:"Audio",Captions:"Captions","Enable captions":"Enable captions","Disable captions":"Disable captions","Start casting":"Start casting","Stop casting":"Stop casting","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode",Mute:"Mute",Unmute:"Unmute","Enter picture in picture mode":"Enter picture in picture mode","Exit picture in picture mode":"Exit picture in picture mode",Play:"Play",Pause:"Pause","Playback rate":"Playback rate","Playback rate {playbackRate}":"Playback rate {playbackRate}",Quality:"Quality","Seek backward":"Seek backward","Seek forward":"Seek forward",Settings:"Settings","audio player":"audio player","video player":"video player",volume:"volume",seek:"seek","closed captions":"closed captions","current playback rate":"current playback rate","playback time":"playback time","media loading":"media loading",settings:"settings","audio tracks":"audio tracks",quality:"quality",play:"play",pause:"pause",mute:"mute",unmute:"unmute",live:"live","start airplay":"start airplay","stop airplay":"stop airplay","start casting":"start casting","stop casting":"stop casting","enter fullscreen mode":"enter fullscreen mode","exit fullscreen mode":"exit fullscreen mode","enter picture in picture mode":"enter picture in picture mode","exit picture in picture mode":"exit picture in picture mode","seek to live":"seek to live","playing live":"playing live","seek back {seekOffset} seconds":"seek back {seekOffset} seconds","seek forward {seekOffset} seconds":"seek forward {seekOffset} seconds","Network Error":"Network Error","Decode Error":"Decode Error","Source Not Supported":"Source Not Supported","Encryption Error":"Encryption Error","A network error caused the media download to fail.":"A network error caused the media download to fail.","A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.":"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.","An unsupported error occurred. The server or network failed, or your browser does not support this format.":"An unsupported error occurred. The server or network failed, or your browser does not support this format.","The media is encrypted and there are no keys to decrypt it.":"The media is encrypted and there are no keys to decrypt it."},ds={en:da},dn=(null==(m$=null==(mB=globalThis.navigator)?void 0:mB.language)?void 0:m$.split("-")[0])||"en",dl=e=>{dn=e},dd=(e,t={})=>{var i;return((null==(i=ds[dn])?void 0:i[e])||da[e]).replace(/\{(\w+)\}/g,(e,i)=>void 0!==t[i]?String(t[i]):`{${i}}`)};class du{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}}class dh extends du{}class dc extends dh{constructor(){super(...arguments),this.role=null}}let dm={createElement:function(){return new dp.HTMLElement},createElementNS:function(){return new dp.HTMLElement},addEventListener(){},removeEventListener(){},dispatchEvent:e=>!1},dp={ResizeObserver:class{observe(){}unobserve(){}disconnect(){}},document:dm,Node:dh,Element:dc,HTMLElement:class extends dc{constructor(){super(...arguments),this.innerHTML=""}get content(){return new dp.DocumentFragment}},DocumentFragment:class extends du{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},localStorage:{getItem:e=>null,setItem(e,t){},removeItem(e){}},CustomEvent:function(){},getComputedStyle:function(){},navigator:{languages:[],get userAgent(){return""}},matchMedia:e=>({matches:!1,media:e})},df="undefined"==typeof window||void 0===window.customElements,dg=Object.keys(dp).every(e=>e in globalThis),dv=df&&!dg?dp:globalThis,dE=df&&!dg?dm:globalThis.document,db=new WeakMap,dy=e=>{let t=db.get(e);return t||db.set(e,t=new Set),t},dT=new dv.ResizeObserver(e=>{for(let t of e)for(let e of dy(t.target))e(t)});function d_(e,t){dy(e).add(t),dT.observe(e)}function dA(e,t){let i=dy(e);i.delete(t),i.size||dT.unobserve(e)}function dS(e){var t;return null!=(t=dk(e))?t:dD(e,"media-controller")}function dk(e){var t;let{MEDIA_CONTROLLER:i}=lW,r=e.getAttribute(i);if(r)return null==(t=dx(e))?void 0:t.getElementById(r)}let dR=(e,t,i=".value")=>{let r=e.querySelector(i);r&&(r.textContent=t)},dI=(e,t)=>{let i=`slot[name="${t}"]`,r=e.shadowRoot.querySelector(i);return r?r.children:[]},dL=(e,t)=>dI(e,t)[0],dw=(e,t)=>!!e&&!!t&&(null!=e&&!!e.contains(t)||dw(e,t.getRootNode().host)),dD=(e,t)=>{if(!e)return null;let i=e.closest(t);return i||dD(e.getRootNode().host,t)};function dC(e=document){var t;let i=null==e?void 0:e.activeElement;return i?null!=(t=dC(i.shadowRoot))?t:i:null}function dx(e){var t;let i=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e);return i instanceof ShadowRoot||i instanceof Document?i:null}function dM(e,{depth:t=3,checkOpacity:i=!0,checkVisibilityCSS:r=!0}={}){if(e.checkVisibility)return e.checkVisibility({checkOpacity:i,checkVisibilityCSS:r});let a=e;for(;a&&t>0;){let e=getComputedStyle(a);if(i&&"0"===e.opacity||r&&"hidden"===e.visibility||"none"===e.display)return!1;a=a.parentElement,t--}return!0}function dO(e,t){let i=function(e,t){var i,r;let a;for(a of null!=(i=e.querySelectorAll("style:not([media])"))?i:[]){let e;try{e=null==(r=a.sheet)?void 0:r.cssRules}catch{continue}for(let i of null!=e?e:[])if(t(i.selectorText))return i}}(e,e=>e===t);return i||dN(e,t)}function dN(e,t){var i,r;let a=null!=(i=e.querySelectorAll("style:not([media])"))?i:[],s=null==a?void 0:a[a.length-1];return(null==s?void 0:s.sheet)?(null==s||s.sheet.insertRule(`${t}{}`,s.sheet.cssRules.length),null==(r=s.sheet.cssRules)?void 0:r[s.sheet.cssRules.length-1]):(console.warn("Media Chrome: No style sheet found on style tag of",e),{style:{setProperty:()=>{},removeProperty:()=>"",getPropertyValue:()=>""}})}function dP(e,t,i=Number.NaN){let r=e.getAttribute(t);return null!=r?+r:i}function dU(e,t,i){let r=+i;if(null==i||Number.isNaN(r)){e.hasAttribute(t)&&e.removeAttribute(t);return}dP(e,t,void 0)!==r&&e.setAttribute(t,`${r}`)}function dF(e,t){return e.hasAttribute(t)}function dB(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}dF(e,t)!=i&&e.toggleAttribute(t,i)}function d$(e,t,i=null){var r;return null!=(r=e.getAttribute(t))?r:i}function dG(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}let r=`${i}`;d$(e,t,void 0)!==r&&e.setAttribute(t,r)}var dH=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},dV=(e,t,i)=>(dH(e,t,"read from private field"),i?i.call(e):t.get(e)),dK=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},dW=(e,t,i,r)=>(dH(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let dY=dE.createElement("template");dY.innerHTML=`
<style>
  :host {
    display: var(--media-control-display, var(--media-gesture-receiver-display, inline-block));
    box-sizing: border-box;
  }
</style>
`;class dq extends dv.HTMLElement{constructor(e={}){if(super(),dK(this,mG,void 0),!this.shadowRoot){let t=this.attachShadow({mode:"open"}),i=dY.content.cloneNode(!0);this.nativeEl=i;let r=e.slotTemplate;r||((r=dE.createElement("template")).innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(r.content.cloneNode(!0)),t.appendChild(i)}}static get observedAttributes(){return[lW.MEDIA_CONTROLLER,lj.MEDIA_PAUSED]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===lW.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=dV(this,mG))?void 0:r.unassociateElement)||a.call(r,this),dW(this,mG,null)),i&&this.isConnected&&(dW(this,mG,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=dV(this,mG))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i,r;this.tabIndex=-1,this.setAttribute("aria-hidden","true"),dW(this,mG,function(e){var t;let i=e.getAttribute(lW.MEDIA_CONTROLLER);return i?null==(t=e.getRootNode())?void 0:t.getElementById(i):dD(e,"media-controller")}(this)),this.getAttribute(lW.MEDIA_CONTROLLER)&&(null==(t=null==(e=dV(this,mG))?void 0:e.associateElement)||t.call(e,this)),null==(i=dV(this,mG))||i.addEventListener("pointerdown",this),null==(r=dV(this,mG))||r.addEventListener("click",this)}disconnectedCallback(){var e,t,i,r;this.getAttribute(lW.MEDIA_CONTROLLER)&&(null==(t=null==(e=dV(this,mG))?void 0:e.unassociateElement)||t.call(e,this)),null==(i=dV(this,mG))||i.removeEventListener("pointerdown",this),null==(r=dV(this,mG))||r.removeEventListener("click",this),dW(this,mG,null)}handleEvent(e){var t;let i=null==(t=e.composedPath())?void 0:t[0];if(["video","media-controller"].includes(null==i?void 0:i.localName)){if("pointerdown"===e.type)this._pointerType=e.pointerType;else if("click"===e.type){let{clientX:t,clientY:i}=e,{left:r,top:a,width:s,height:n}=this.getBoundingClientRect(),o=t-r,l=i-a;if(o<0||l<0||o>s||l>n||0===s&&0===n)return;let{pointerType:d=this._pointerType}=e;if(this._pointerType=void 0,d===lJ.TOUCH){this.handleTap(e);return}if(d===lJ.MOUSE){this.handleMouseClick(e);return}}}}get mediaPaused(){return dF(this,lj.MEDIA_PAUSED)}set mediaPaused(e){dB(this,lj.MEDIA_PAUSED,e)}handleTap(e){}handleMouseClick(e){let t=this.mediaPaused?lK.MEDIA_PLAY_REQUEST:lK.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new dv.CustomEvent(t,{composed:!0,bubbles:!0}))}}mG=new WeakMap,dv.customElements.get("media-gesture-receiver")||dv.customElements.define("media-gesture-receiver",dq);var dj=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},dz=(e,t,i)=>(dj(e,t,"read from private field"),i?i.call(e):t.get(e)),dX=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},dQ=(e,t,i,r)=>(dj(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),dZ=(e,t,i)=>(dj(e,t,"access private method"),i);let dJ={AUDIO:"audio",AUTOHIDE:"autohide",BREAKPOINTS:"breakpoints",GESTURES_DISABLED:"gesturesdisabled",KEYBOARD_CONTROL:"keyboardcontrol",NO_AUTOHIDE:"noautohide",USER_INACTIVE:"userinactive",AUTOHIDE_OVER_CONTROLS:"autohideovercontrols"},d0=dE.createElement("template");d0.innerHTML=`
  <style>
    
    :host([${lj.MEDIA_IS_FULLSCREEN}]) ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([${dJ.AUDIO}])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    slot[name=media] {
      display: var(--media-slot-display, contents);
    }

    
    :host([${dJ.AUDIO}]) slot[name=media] {
      display: var(--media-slot-display, none);
    }

    
    :host([${dJ.AUDIO}]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([${dJ.AUDIO}])[${dJ.GESTURES_DISABLED}]) ::slotted([slot=gestures-chrome]),
    :host(:not([${dJ.AUDIO}])[${dJ.GESTURES_DISABLED}]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator):not([role=dialog]):not([hidden])) {
      pointer-events: auto;
    }

    :host(:not([${dJ.AUDIO}])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([${dJ.AUDIO}])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([${dJ.AUDIO}])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([${dJ.AUDIO}])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not([${dJ.NO_AUTOHIDE}]):not([hidden]):not([role=dialog])) {
      opacity: 1;
      transition: var(--media-control-transition-in, opacity 0.25s);
    }

    
    :host([${dJ.USER_INACTIVE}]:not([${lj.MEDIA_PAUSED}]):not([${lj.MEDIA_IS_AIRPLAYING}]):not([${lj.MEDIA_IS_CASTING}]):not([${dJ.AUDIO}])) ::slotted(:not([slot=media]):not([slot=poster]):not([${dJ.NO_AUTOHIDE}]):not([role=dialog])) {
      opacity: 0;
      transition: var(--media-control-transition-out, opacity 1s);
    }

    :host([${dJ.USER_INACTIVE}]:not([${dJ.NO_AUTOHIDE}]):not([${lj.MEDIA_PAUSED}]):not([${lj.MEDIA_IS_CASTING}]):not([${dJ.AUDIO}])) ::slotted([slot=media]) {
      cursor: none;
    }

    :host([${dJ.USER_INACTIVE}][${dJ.AUTOHIDE_OVER_CONTROLS}]:not([${dJ.NO_AUTOHIDE}]):not([${lj.MEDIA_PAUSED}]):not([${lj.MEDIA_IS_CASTING}]):not([${dJ.AUDIO}])) * {
     --media-cursor: none;
     cursor: none;
    }


    ::slotted(media-control-bar)  {
      align-self: stretch;
    }

    
    :host(:not([${dJ.AUDIO}])[${lj.MEDIA_HAS_PLAYED}]) slot[name=poster] {
      display: none;
    }

    ::slotted([role=dialog]) {
      width: 100%;
      height: 100%;
      align-self: center;
    }

    ::slotted([role=menu]) {
      align-self: end;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
  <slot name="dialog" part="layer dialog-layer"></slot>
`;let d1=Object.values(lj);function d2(e,t){var i,r,a;if(!e.isConnected)return;let s=Object.fromEntries((null!=(i=e.getAttribute(dJ.BREAKPOINTS))?i:"sm:384 md:576 lg:768 xl:960").split(/\s+/).map(e=>e.split(":"))),n=(r=s,a=t,Object.keys(r).filter(e=>a>=parseInt(r[e]))),o=!1;if(Object.keys(s).forEach(t=>{if(n.includes(t)){e.hasAttribute(`breakpoint${t}`)||(e.setAttribute(`breakpoint${t}`,""),o=!0);return}e.hasAttribute(`breakpoint${t}`)&&(e.removeAttribute(`breakpoint${t}`),o=!0)}),o){let t=new CustomEvent(lz.BREAKPOINTS_CHANGE,{detail:n});e.dispatchEvent(t)}e.breakpointsComputed||(e.breakpointsComputed=!0,e.dispatchEvent(new CustomEvent(lz.BREAKPOINTS_COMPUTED,{bubbles:!0,composed:!0})))}class d3 extends dv.HTMLElement{constructor(){super(),dX(this,mq),dX(this,mQ),dX(this,mJ),dX(this,m1),dX(this,m3),dX(this,m5),dX(this,mH,0),dX(this,mV,null),dX(this,mK,null),dX(this,mW,void 0),this.breakpointsComputed=!1,dX(this,mY,new MutationObserver(dZ(this,mq,mj).bind(this))),dX(this,mz,!1),dX(this,mX,e=>{dz(this,mz)||(setTimeout(()=>{d2(e.target,e.contentRect.width),dQ(this,mz,!1)},0),dQ(this,mz,!0))}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(d0.content.cloneNode(!0)));let e=this.querySelector(":scope > slot[slot=media]");e&&e.addEventListener("slotchange",()=>{if(!e.assignedElements({flatten:!0}).length){dz(this,mV)&&this.mediaUnsetCallback(dz(this,mV));return}this.handleMediaUpdated(this.media)})}static get observedAttributes(){return[dJ.AUTOHIDE,dJ.GESTURES_DISABLED].concat(d1).filter(e=>![lj.MEDIA_RENDITION_LIST,lj.MEDIA_AUDIO_TRACK_LIST,lj.MEDIA_CHAPTERS_CUES,lj.MEDIA_WIDTH,lj.MEDIA_HEIGHT,lj.MEDIA_ERROR,lj.MEDIA_ERROR_MESSAGE].includes(e))}attributeChangedCallback(e,t,i){e.toLowerCase()==dJ.AUTOHIDE&&(this.autohide=i)}get media(){let e=this.querySelector(":scope > [slot=media]");return(null==e?void 0:e.nodeName)=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}async handleMediaUpdated(e){e&&(dQ(this,mV,e),e.localName.includes("-")&&await dv.customElements.whenDefined(e.localName),this.mediaSetCallback(e))}connectedCallback(){var e;dz(this,mY).observe(this,{childList:!0,subtree:!0}),d_(this,dz(this,mX));let t=null!=this.getAttribute(dJ.AUDIO)?dd("audio player"):dd("video player");this.setAttribute("role","region"),this.setAttribute("aria-label",t),this.handleMediaUpdated(this.media),this.setAttribute(dJ.USER_INACTIVE,""),d2(this,this.getBoundingClientRect().width),this.addEventListener("pointerdown",this),this.addEventListener("pointermove",this),this.addEventListener("pointerup",this),this.addEventListener("mouseleave",this),this.addEventListener("keyup",this),null==(e=dv.window)||e.addEventListener("mouseup",this)}disconnectedCallback(){var e;dz(this,mY).disconnect(),dA(this,dz(this,mX)),this.media&&this.mediaUnsetCallback(this.media),null==(e=dv.window)||e.removeEventListener("mouseup",this)}mediaSetCallback(e){}mediaUnsetCallback(e){dQ(this,mV,null)}handleEvent(e){switch(e.type){case"pointerdown":dQ(this,mH,e.timeStamp);break;case"pointermove":dZ(this,mQ,mZ).call(this,e);break;case"pointerup":dZ(this,mJ,m0).call(this,e);break;case"mouseleave":dZ(this,m1,m2).call(this);break;case"mouseup":this.removeAttribute(dJ.KEYBOARD_CONTROL);break;case"keyup":dZ(this,m5,m8).call(this),this.setAttribute(dJ.KEYBOARD_CONTROL,"")}}set autohide(e){let t=Number(e);dQ(this,mW,isNaN(t)?0:t)}get autohide(){return(void 0===dz(this,mW)?2:dz(this,mW)).toString()}get breakpoints(){return d$(this,dJ.BREAKPOINTS)}set breakpoints(e){dG(this,dJ.BREAKPOINTS,e)}get audio(){return dF(this,dJ.AUDIO)}set audio(e){dB(this,dJ.AUDIO,e)}get gesturesDisabled(){return dF(this,dJ.GESTURES_DISABLED)}set gesturesDisabled(e){dB(this,dJ.GESTURES_DISABLED,e)}get keyboardControl(){return dF(this,dJ.KEYBOARD_CONTROL)}set keyboardControl(e){dB(this,dJ.KEYBOARD_CONTROL,e)}get noAutohide(){return dF(this,dJ.NO_AUTOHIDE)}set noAutohide(e){dB(this,dJ.NO_AUTOHIDE,e)}get autohideOverControls(){return dF(this,dJ.AUTOHIDE_OVER_CONTROLS)}set autohideOverControls(e){dB(this,dJ.AUTOHIDE_OVER_CONTROLS,e)}get userInteractive(){return dF(this,dJ.USER_INACTIVE)}set userInteractive(e){dB(this,dJ.USER_INACTIVE,e)}}mH=new WeakMap,mV=new WeakMap,mK=new WeakMap,mW=new WeakMap,mY=new WeakMap,mq=new WeakSet,mj=function(e){let t=this.media;for(let i of e)if("childList"===i.type){for(let e of i.removedNodes){if("media"!=e.slot||i.target!=this)continue;let r=i.previousSibling&&i.previousSibling.previousElementSibling;if(r&&t){let t="media"!==r.slot;for(;null!==(r=r.previousSibling);)"media"==r.slot&&(t=!1);t&&this.mediaUnsetCallback(e)}else this.mediaUnsetCallback(e)}if(t)for(let e of i.addedNodes)e===t&&this.handleMediaUpdated(t)}},mz=new WeakMap,mX=new WeakMap,mQ=new WeakSet,mZ=function(e){if("mouse"!==e.pointerType&&e.timeStamp-dz(this,mH)<250)return;dZ(this,m3,m4).call(this),clearTimeout(dz(this,mK));let t=this.hasAttribute(dJ.AUTOHIDE_OVER_CONTROLS);([this,this.media].includes(e.target)||t)&&dZ(this,m5,m8).call(this)},mJ=new WeakSet,m0=function(e){if("touch"===e.pointerType){let t=!this.hasAttribute(dJ.USER_INACTIVE);[this,this.media].includes(e.target)&&t?dZ(this,m1,m2).call(this):dZ(this,m5,m8).call(this)}else e.composedPath().some(e=>["media-play-button","media-fullscreen-button"].includes(null==e?void 0:e.localName))&&dZ(this,m5,m8).call(this)},m1=new WeakSet,m2=function(){if(0>dz(this,mW)||this.hasAttribute(dJ.USER_INACTIVE))return;this.setAttribute(dJ.USER_INACTIVE,"");let e=new dv.CustomEvent(lz.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(e)},m3=new WeakSet,m4=function(){if(!this.hasAttribute(dJ.USER_INACTIVE))return;this.removeAttribute(dJ.USER_INACTIVE);let e=new dv.CustomEvent(lz.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(e)},m5=new WeakSet,m8=function(){dZ(this,m3,m4).call(this),clearTimeout(dz(this,mK));let e=parseInt(this.autohide);e<0||dQ(this,mK,setTimeout(()=>{dZ(this,m1,m2).call(this)},1e3*e))},dv.customElements.get("media-container")||dv.customElements.define("media-container",d3);var d4=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},d5=(e,t,i)=>(d4(e,t,"read from private field"),i?i.call(e):t.get(e)),d8=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},d9=(e,t,i,r)=>(d4(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class d6{constructor(e,t,{defaultValue:i}={defaultValue:void 0}){d8(this,pt),d8(this,m9,void 0),d8(this,m6,void 0),d8(this,m7,void 0),d8(this,pe,new Set),d9(this,m9,e),d9(this,m6,t),d9(this,m7,new Set(i))}[Symbol.iterator](){return d5(this,pt,pi).values()}get length(){return d5(this,pt,pi).size}get value(){var e;return null!=(e=[...d5(this,pt,pi)].join(" "))?e:""}set value(e){var t;e!==this.value&&(d9(this,pe,new Set),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return[...d5(this,pt,pi)][e]}values(){return d5(this,pt,pi).values()}forEach(e,t){d5(this,pt,pi).forEach(e,t)}add(...e){var t,i;e.forEach(e=>d5(this,pe).add(e)),(""!==this.value||(null==(t=d5(this,m9))?void 0:t.hasAttribute(`${d5(this,m6)}`)))&&(null==(i=d5(this,m9))||i.setAttribute(`${d5(this,m6)}`,`${this.value}`))}remove(...e){var t;e.forEach(e=>d5(this,pe).delete(e)),null==(t=d5(this,m9))||t.setAttribute(`${d5(this,m6)}`,`${this.value}`)}contains(e){return d5(this,pt,pi).has(e)}toggle(e,t){return void 0!==t?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){return this.remove(e),this.add(t),e===t}}m9=new WeakMap,m6=new WeakMap,m7=new WeakMap,pe=new WeakMap,pt=new WeakSet,pi=function(){return d5(this,pe).size?d5(this,pe):d5(this,m7)};let d7=(e="")=>e.split(/\s+/),ue=(e="")=>{let[t,i,r]=e.split(":"),a=r?decodeURIComponent(r):void 0;return{kind:"cc"===t?lQ.CAPTIONS:lQ.SUBTITLES,language:i,label:a}},ut=(e="",t={})=>d7(e).map(e=>{let i=ue(e);return{...t,...i}}),ui=e=>e?Array.isArray(e)?e.map(e=>"string"==typeof e?ue(e):e):"string"==typeof e?ut(e):[e]:[],ur=({kind:e,label:t,language:i}={kind:"subtitles"})=>t?`${"captions"===e?"cc":"sb"}:${i}:${encodeURIComponent(t)}`:i,ua=(e=[])=>Array.prototype.map.call(e,ur).join(" "),us=(e,t)=>i=>i[e]===t,un=e=>{let t=Object.entries(e).map(([e,t])=>us(e,t));return e=>t.every(t=>t(e))},uo=(e,t=[],i=[])=>{let r=ui(i).map(un);Array.from(t).filter(e=>r.some(t=>t(e))).forEach(t=>{t.mode=e})},ul=(e,t=()=>!0)=>{if(!(null==e?void 0:e.textTracks))return[];let i="function"==typeof t?t:un(t);return Array.from(e.textTracks).filter(i)},ud=e=>{var t;return!!(null==(t=e.mediaSubtitlesShowing)?void 0:t.length)||e.hasAttribute(lj.MEDIA_SUBTITLES_SHOWING)},uu=e=>{var t;let{media:i,fullscreenElement:r}=e;try{let e=r&&"requestFullscreen"in r?"requestFullscreen":r&&"webkitRequestFullScreen"in r?"webkitRequestFullScreen":void 0;if(e){let i=null==(t=r[e])?void 0:t.call(r);if(i instanceof Promise)return i.catch(()=>{})}else(null==i?void 0:i.webkitEnterFullscreen)?i.webkitEnterFullscreen():(null==i?void 0:i.requestFullscreen)&&i.requestFullscreen()}catch(e){console.error(e)}},uh="exitFullscreen"in dE?"exitFullscreen":"webkitExitFullscreen"in dE?"webkitExitFullscreen":"webkitCancelFullScreen"in dE?"webkitCancelFullScreen":void 0,uc=e=>{var t;let{documentElement:i}=e;if(uh){let e=null==(t=null==i?void 0:i[uh])?void 0:t.call(i);if(e instanceof Promise)return e.catch(()=>{})}},um="fullscreenElement"in dE?"fullscreenElement":"webkitFullscreenElement"in dE?"webkitFullscreenElement":void 0,up=e=>{let{documentElement:t,media:i}=e,r=null==t?void 0:t[um];return!r&&"webkitDisplayingFullscreen"in i&&"webkitPresentationMode"in i&&i.webkitDisplayingFullscreen&&i.webkitPresentationMode===l2.FULLSCREEN?i:r},uf=e=>{var t;let{media:i,documentElement:r,fullscreenElement:a=i}=e;if(!i||!r)return!1;let s=up(e);if(!s)return!1;if(s===a||s===i)return!0;if(s.localName.includes("-")){let e=s.shadowRoot;if(!(um in e))return dw(s,a);for(;null==e?void 0:e[um];){if(e[um]===a)return!0;e=null==(t=e[um])?void 0:t.shadowRoot}}return!1},ug="fullscreenEnabled"in dE?"fullscreenEnabled":"webkitFullscreenEnabled"in dE?"webkitFullscreenEnabled":void 0,uv=e=>{let{documentElement:t,media:i}=e;return!!(null==t?void 0:t[ug])||i&&"webkitSupportsFullscreen"in i},uE=()=>{var e;return n||(n=null==(e=null==dE?void 0:dE.createElement)?void 0:e.call(dE,"video"))},ub=async(e=uE())=>{if(!e)return!1;let t=e.volume;e.volume=t/2+.1;let i=new AbortController,r=await Promise.race([uy(e,i.signal),uT(e,t)]);return i.abort(),r},uy=(e,t)=>new Promise(i=>{e.addEventListener("volumechange",()=>i(!0),{signal:t})}),uT=async(e,t)=>{for(let i=0;i<10;i++){if(e.volume===t)return!1;await l7(10)}return e.volume!==t},u_=/.*Version\/.*Safari\/.*/.test(dv.navigator.userAgent),uA=(e=uE())=>(!dv.matchMedia("(display-mode: standalone)").matches||!u_)&&"function"==typeof(null==e?void 0:e.requestPictureInPicture),uS=(e=uE())=>uv({documentElement:dE,media:e}),uk=uS(),uR=uA(),uI=!!dv.WebKitPlaybackTargetAvailabilityEvent,uL=!!dv.chrome,uw=e=>ul(e.media,e=>[lQ.SUBTITLES,lQ.CAPTIONS].includes(e.kind)).sort((e,t)=>e.kind>=t.kind?1:-1),uD=e=>ul(e.media,e=>e.mode===lZ.SHOWING&&[lQ.SUBTITLES,lQ.CAPTIONS].includes(e.kind)),uC=(e,t)=>{let i=uw(e),r=uD(e),a=!!r.length;if(i.length){if(!1===t||a&&!0!==t)uo(lZ.DISABLED,i,r);else if(!0===t||!a&&!1!==t){let t=i[0],{options:a}=e;if(!(null==a?void 0:a.noSubtitlesLangPref)){let e=globalThis.localStorage.getItem("media-chrome-pref-subtitles-lang"),r=e?[e,...globalThis.navigator.languages]:globalThis.navigator.languages,a=i.filter(e=>r.some(t=>e.language.toLowerCase().startsWith(t.split("-")[0]))).sort((e,t)=>r.findIndex(t=>e.language.toLowerCase().startsWith(t.split("-")[0]))-r.findIndex(e=>t.language.toLowerCase().startsWith(e.split("-")[0])));a[0]&&(t=a[0])}let{language:s,label:n,kind:o}=t;uo(lZ.DISABLED,i,r),uo(lZ.SHOWING,i,[{language:s,label:n,kind:o}])}}},ux=(e,t)=>e===t||null!=e&&null!=t&&typeof e==typeof t&&(!!("number"==typeof e&&Number.isNaN(e)&&Number.isNaN(t))||"object"==typeof e&&(Array.isArray(e)?uM(e,t):Object.entries(e).every(([e,i])=>e in t&&ux(i,t[e])))),uM=(e,t)=>{let i=Array.isArray(e),r=Array.isArray(t);return i===r&&(!i&&!r||e.length===t.length&&e.every((e,i)=>ux(e,t[i])))},uO=Object.values(l1),uN=ub().then(e=>o=e),uP=async(...e)=>{await Promise.all(e.filter(e=>e).map(async e=>{if(!("localName"in e&&e instanceof dv.HTMLElement))return;let t=e.localName;if(!t.includes("-"))return;let i=dv.customElements.get(t);i&&e instanceof i||(await dv.customElements.whenDefined(t),dv.customElements.upgrade(e))}))},uU={mediaError:{get(e,t){let{media:i}=e;if((null==t?void 0:t.type)!=="playing")return null==i?void 0:i.error},mediaEvents:["emptied","error","playing"]},mediaErrorCode:{get(e,t){var i;let{media:r}=e;if((null==t?void 0:t.type)!=="playing")return null==(i=null==r?void 0:r.error)?void 0:i.code},mediaEvents:["emptied","error","playing"]},mediaErrorMessage:{get(e,t){var i,r;let{media:a}=e;if((null==t?void 0:t.type)!=="playing")return null!=(r=null==(i=null==a?void 0:a.error)?void 0:i.message)?r:""},mediaEvents:["emptied","error","playing"]},mediaWidth:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.videoWidth)?t:0},mediaEvents:["resize"]},mediaHeight:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.videoHeight)?t:0},mediaEvents:["resize"]},mediaPaused:{get(e){var t;let{media:i}=e;return null==(t=null==i?void 0:i.paused)||t},set(e,t){var i;let{media:r}=t;r&&(e?r.pause():null==(i=r.play())||i.catch(()=>{}))},mediaEvents:["play","playing","pause","emptied"]},mediaHasPlayed:{get(e,t){let{media:i}=e;return!!i&&(t?"playing"===t.type:!i.paused)},mediaEvents:["playing","emptied"]},mediaEnded:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.ended)&&t},mediaEvents:["seeked","ended","emptied"]},mediaPlaybackRate:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.playbackRate)?t:1},set(e,t){let{media:i}=t;i&&Number.isFinite(+e)&&(i.playbackRate=+e)},mediaEvents:["ratechange","loadstart"]},mediaMuted:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.muted)&&t},set(e,t){let{media:i}=t;if(i){try{dv.localStorage.setItem("media-chrome-pref-muted",e?"true":"false")}catch(e){console.debug("Error setting muted pref",e)}i.muted=e}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(e,t)=>{let{options:{noMutedPref:i}}=t,{media:r}=t;if(r&&!r.muted&&!i)try{let i="true"===dv.localStorage.getItem("media-chrome-pref-muted");uU.mediaMuted.set(i,t),e(i)}catch(e){console.debug("Error getting muted pref",e)}}]},mediaVolume:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.volume)?t:1},set(e,t){let{media:i}=t;if(i){try{null==e?dv.localStorage.removeItem("media-chrome-pref-volume"):dv.localStorage.setItem("media-chrome-pref-volume",e.toString())}catch(e){console.debug("Error setting volume pref",e)}Number.isFinite(+e)&&(i.volume=+e)}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(e,t)=>{let{options:{noVolumePref:i}}=t;if(!i)try{let{media:i}=t;if(!i)return;let r=dv.localStorage.getItem("media-chrome-pref-volume");if(null==r)return;uU.mediaVolume.set(+r,t),e(+r)}catch(e){console.debug("Error getting volume pref",e)}}]},mediaVolumeLevel:{get(e){let{media:t}=e;return void 0===(null==t?void 0:t.volume)?"high":t.muted||0===t.volume?"off":t.volume<.5?"low":t.volume<.75?"medium":"high"},mediaEvents:["volumechange"]},mediaCurrentTime:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.currentTime)?t:0},set(e,t){let{media:i}=t;i&&l9(e)&&(i.currentTime=e)},mediaEvents:["timeupdate","loadedmetadata"]},mediaDuration:{get(e){let{media:t,options:{defaultDuration:i}={}}=e;return i&&(!t||!t.duration||Number.isNaN(t.duration)||!Number.isFinite(t.duration))?i:Number.isFinite(null==t?void 0:t.duration)?t.duration:Number.NaN},mediaEvents:["durationchange","loadedmetadata","emptied"]},mediaLoading:{get(e){let{media:t}=e;return(null==t?void 0:t.readyState)<3},mediaEvents:["waiting","playing","emptied"]},mediaSeekable:{get(e){var t;let{media:i}=e;if(!(null==(t=null==i?void 0:i.seekable)?void 0:t.length))return;let r=i.seekable.start(0),a=i.seekable.end(i.seekable.length-1);if(r||a)return[Number(r.toFixed(3)),Number(a.toFixed(3))]},mediaEvents:["loadedmetadata","emptied","progress","seekablechange"]},mediaBuffered:{get(e){var t;let{media:i}=e,r=null!=(t=null==i?void 0:i.buffered)?t:[];return Array.from(r).map((e,t)=>[Number(r.start(t).toFixed(3)),Number(r.end(t).toFixed(3))])},mediaEvents:["progress","emptied"]},mediaStreamType:{get(e){let{media:t,options:{defaultStreamType:i}={}}=e,r=[l1.LIVE,l1.ON_DEMAND].includes(i)?i:void 0;if(!t)return r;let{streamType:a}=t;if(uO.includes(a))return a===l1.UNKNOWN?r:a;let s=t.duration;return s===1/0?l1.LIVE:Number.isFinite(s)?l1.ON_DEMAND:r},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange"]},mediaTargetLiveWindow:{get(e){let{media:t}=e;if(!t)return Number.NaN;let{targetLiveWindow:i}=t,r=uU.mediaStreamType.get(e);return(null==i||Number.isNaN(i))&&r===l1.LIVE?0:i},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange","targetlivewindowchange"]},mediaTimeIsLive:{get(e){let{media:t,options:{liveEdgeOffset:i=10}={}}=e;if(!t)return!1;if("number"==typeof t.liveEdgeStart)return!Number.isNaN(t.liveEdgeStart)&&t.currentTime>=t.liveEdgeStart;if(uU.mediaStreamType.get(e)!==l1.LIVE)return!1;let r=t.seekable;if(!r)return!0;if(!r.length)return!1;let a=r.end(r.length-1)-i;return t.currentTime>=a},mediaEvents:["playing","timeupdate","progress","waiting","emptied"]},mediaSubtitlesList:{get:e=>uw(e).map(({kind:e,label:t,language:i})=>({kind:e,label:t,language:i})),mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack"]},mediaSubtitlesShowing:{get:e=>uD(e).map(({kind:e,label:t,language:i})=>({kind:e,label:t,language:i})),mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(e,t)=>{var i,r;let{media:a,options:s}=t;if(!a)return;let n=e=>{var i;s.defaultSubtitles&&(e&&![lQ.CAPTIONS,lQ.SUBTITLES].includes(null==(i=null==e?void 0:e.track)?void 0:i.kind)||uC(t,!0))};return a.addEventListener("loadstart",n),null==(i=a.textTracks)||i.addEventListener("addtrack",n),null==(r=a.textTracks)||r.addEventListener("removetrack",n),()=>{var e,t;a.removeEventListener("loadstart",n),null==(e=a.textTracks)||e.removeEventListener("addtrack",n),null==(t=a.textTracks)||t.removeEventListener("removetrack",n)}}]},mediaChaptersCues:{get(e){var t;let{media:i}=e;if(!i)return[];let[r]=ul(i,{kind:lQ.CHAPTERS});return Array.from(null!=(t=null==r?void 0:r.cues)?t:[]).map(({text:e,startTime:t,endTime:i})=>({text:e,startTime:t,endTime:i}))},mediaEvents:["loadstart","loadedmetadata"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(!r)return;let a=r.querySelector('track[kind="chapters"][default][src]'),s=null==(i=r.shadowRoot)?void 0:i.querySelector(':is(video,audio) > track[kind="chapters"][default][src]');return null==a||a.addEventListener("load",e),null==s||s.addEventListener("load",e),()=>{null==a||a.removeEventListener("load",e),null==s||s.removeEventListener("load",e)}}]},mediaIsPip:{get(e){var t,i;let{media:r,documentElement:a}=e;if(!r||!a||!a.pictureInPictureElement)return!1;if(a.pictureInPictureElement===r)return!0;if(a.pictureInPictureElement instanceof HTMLMediaElement)return null!=(t=r.localName)&&!!t.includes("-")&&dw(r,a.pictureInPictureElement);if(a.pictureInPictureElement.localName.includes("-")){let e=a.pictureInPictureElement.shadowRoot;for(;null==e?void 0:e.pictureInPictureElement;){if(e.pictureInPictureElement===r)return!0;e=null==(i=e.pictureInPictureElement)?void 0:i.shadowRoot}}return!1},set(e,t){let{media:i}=t;if(i){if(e){if(!dE.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!i.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}let e=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};i.requestPictureInPicture().catch(t=>{if(11===t.code){if(!i.src){console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a src set.");return}if(0===i.readyState&&"none"===i.preload){let t=()=>{i.removeEventListener("loadedmetadata",r),i.preload="none"},r=()=>{i.requestPictureInPicture().catch(e),t()};i.addEventListener("loadedmetadata",r),i.preload="metadata",setTimeout(()=>{0===i.readyState&&e(),t()},1e3)}else throw t}else throw t})}else dE.pictureInPictureElement&&dE.exitPictureInPicture()}},mediaEvents:["enterpictureinpicture","leavepictureinpicture"]},mediaRenditionList:{get(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.videoRenditions)?t:[]].map(e=>({...e}))},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaRenditionSelected:{get(e){var t,i,r;let{media:a}=e;return null==(r=null==(i=null==a?void 0:a.videoRenditions)?void 0:i[null==(t=a.videoRenditions)?void 0:t.selectedIndex])?void 0:r.id},set(e,t){let{media:i}=t;if(!(null==i?void 0:i.videoRenditions)){console.warn("MediaController: Rendition selection not supported by this media.");return}let r=Array.prototype.findIndex.call(i.videoRenditions,t=>t.id==e);i.videoRenditions.selectedIndex!=r&&(i.videoRenditions.selectedIndex=r)},mediaEvents:["emptied"],videoRenditionsEvents:["addrendition","removerendition","change"]},mediaAudioTrackList:{get(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.audioTracks)?t:[]]},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},mediaAudioTrackEnabled:{get(e){var t,i;let{media:r}=e;return null==(i=[...null!=(t=null==r?void 0:r.audioTracks)?t:[]].find(e=>e.enabled))?void 0:i.id},set(e,t){let{media:i}=t;if(!(null==i?void 0:i.audioTracks)){console.warn("MediaChrome: Audio track selection not supported by this media.");return}for(let t of i.audioTracks)t.enabled=e==t.id},mediaEvents:["emptied"],audioTracksEvents:["addtrack","removetrack","change"]},mediaIsFullscreen:{get:e=>uf(e),set(e,t){e?uu(t):uc(t)},rootEvents:["fullscreenchange","webkitfullscreenchange"],mediaEvents:["webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"]},mediaIsCasting:{get(e){var t;let{media:i}=e;return null!=i&&!!i.remote&&(null==(t=i.remote)?void 0:t.state)!=="disconnected"&&!!i.remote.state},set(e,t){var i,r;let{media:a}=t;if(a&&(!e||(null==(i=a.remote)?void 0:i.state)==="disconnected")&&(e||(null==(r=a.remote)?void 0:r.state)==="connected")){if("function"!=typeof a.remote.prompt){console.warn("MediaChrome: Casting is not supported in this environment");return}a.remote.prompt().catch(()=>{})}},remoteEvents:["connect","connecting","disconnect"]},mediaIsAirplaying:{get:()=>!1,set(e,t){let{media:i}=t;if(i){if(!(i.webkitShowPlaybackTargetPicker&&dv.WebKitPlaybackTargetAvailabilityEvent)){console.error("MediaChrome: received a request to select AirPlay but AirPlay is not supported in this environment");return}i.webkitShowPlaybackTargetPicker()}},mediaEvents:["webkitcurrentplaybacktargetiswirelesschanged"]},mediaFullscreenUnavailable:{get(e){let{media:t}=e;if(!uk||!uS(t))return l0.UNSUPPORTED}},mediaPipUnavailable:{get(e){let{media:t}=e;if(!uR||!uA(t))return l0.UNSUPPORTED}},mediaVolumeUnavailable:{get(e){let{media:t}=e;if(!1===o||(null==t?void 0:t.volume)==void 0)return l0.UNSUPPORTED},stateOwnersUpdateHandlers:[e=>{null==o&&uN.then(t=>e(t?void 0:l0.UNSUPPORTED))}]},mediaCastUnavailable:{get(e,{availability:t="not-available"}={}){var i;let{media:r}=e;return uL&&(null==(i=null==r?void 0:r.remote)?void 0:i.state)?null!=t&&"available"!==t?l0.UNAVAILABLE:void 0:l0.UNSUPPORTED},stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(r)return r.disableRemotePlayback||r.hasAttribute("disableremoteplayback")||null==(i=null==r?void 0:r.remote)||i.watchAvailability(t=>{e({availability:t?"available":"not-available"})}).catch(t=>{"NotSupportedError"===t.name?e({availability:null}):e({availability:"not-available"})}),()=>{var e;null==(e=null==r?void 0:r.remote)||e.cancelWatchAvailability().catch(()=>{})}}]},mediaAirplayUnavailable:{get:(e,t)=>uI?(null==t?void 0:t.availability)==="not-available"?l0.UNAVAILABLE:void 0:l0.UNSUPPORTED,mediaEvents:["webkitplaybacktargetavailabilitychanged"],stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(r)return r.disableRemotePlayback||r.hasAttribute("disableremoteplayback")||null==(i=null==r?void 0:r.remote)||i.watchAvailability(t=>{e({availability:t?"available":"not-available"})}).catch(t=>{"NotSupportedError"===t.name?e({availability:null}):e({availability:"not-available"})}),()=>{var e;null==(e=null==r?void 0:r.remote)||e.cancelWatchAvailability().catch(()=>{})}}]},mediaRenditionUnavailable:{get(e){var t;let{media:i}=e;return(null==i?void 0:i.videoRenditions)?(null==(t=i.videoRenditions)?void 0:t.length)?void 0:l0.UNAVAILABLE:l0.UNSUPPORTED},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaAudioTrackUnavailable:{get(e){var t,i;let{media:r}=e;return(null==r?void 0:r.audioTracks)?(null!=(i=null==(t=r.audioTracks)?void 0:t.length)?i:0)<=1?l0.UNAVAILABLE:void 0:l0.UNSUPPORTED},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]}},uF={[lK.MEDIA_PREVIEW_REQUEST](e,t,{detail:i}){var r,a,s;let n,o;let{media:l}=t,d=null!=i?i:void 0;if(l&&null!=d){let[e]=ul(l,{kind:lQ.METADATA,label:"thumbnails"}),t=Array.prototype.find.call(null!=(r=null==e?void 0:e.cues)?r:[],(e,t,i)=>0===t?e.endTime>d:t===i.length-1?e.startTime<=d:e.startTime<=d&&e.endTime>d);if(t){let e=/'^(?:[a-z]+:)?\/\//i.test(t.text)?void 0:null==(a=null==l?void 0:l.querySelector('track[label="thumbnails"]'))?void 0:a.src,i=new URL(t.text,e);o=new URLSearchParams(i.hash).get("#xywh").split(",").map(e=>+e),n=i.href}}let u=e.mediaDuration.get(t),h=null==(s=e.mediaChaptersCues.get(t).find((e,t,i)=>t===i.length-1&&u===e.endTime?e.startTime<=d&&e.endTime>=d:e.startTime<=d&&e.endTime>d))?void 0:s.text;return null!=i&&null==h&&(h=""),{mediaPreviewTime:d,mediaPreviewImage:n,mediaPreviewCoords:o,mediaPreviewChapter:h}},[lK.MEDIA_PAUSE_REQUEST](e,t){e.mediaPaused.set(!0,t)},[lK.MEDIA_PLAY_REQUEST](e,t){var i,r,a,s;let n=e.mediaStreamType.get(t)===l1.LIVE,o=!(null==(i=t.options)?void 0:i.noAutoSeekToLive),l=e.mediaTargetLiveWindow.get(t)>0;if(n&&o&&!l){let i=null==(r=e.mediaSeekable.get(t))?void 0:r[1];if(i){let r=null!=(s=null==(a=t.options)?void 0:a.seekToLiveOffset)?s:0;e.mediaCurrentTime.set(i-r,t)}}e.mediaPaused.set(!1,t)},[lK.MEDIA_PLAYBACK_RATE_REQUEST](e,t,{detail:i}){e.mediaPlaybackRate.set(i,t)},[lK.MEDIA_MUTE_REQUEST](e,t){e.mediaMuted.set(!0,t)},[lK.MEDIA_UNMUTE_REQUEST](e,t){e.mediaVolume.get(t)||e.mediaVolume.set(.25,t),e.mediaMuted.set(!1,t)},[lK.MEDIA_VOLUME_REQUEST](e,t,{detail:i}){i&&e.mediaMuted.get(t)&&e.mediaMuted.set(!1,t),e.mediaVolume.set(i,t)},[lK.MEDIA_SEEK_REQUEST](e,t,{detail:i}){e.mediaCurrentTime.set(i,t)},[lK.MEDIA_SEEK_TO_LIVE_REQUEST](e,t){var i,r,a;let s=null==(i=e.mediaSeekable.get(t))?void 0:i[1];if(Number.isNaN(Number(s)))return;let n=null!=(a=null==(r=t.options)?void 0:r.seekToLiveOffset)?a:0;e.mediaCurrentTime.set(s-n,t)},[lK.MEDIA_SHOW_SUBTITLES_REQUEST](e,t,{detail:i}){var r;let{options:a}=t,s=uw(t),n=ui(i),o=null==(r=n[0])?void 0:r.language;o&&!a.noSubtitlesLangPref&&dv.localStorage.setItem("media-chrome-pref-subtitles-lang",o),uo(lZ.SHOWING,s,n)},[lK.MEDIA_DISABLE_SUBTITLES_REQUEST](e,t,{detail:i}){let r=uw(t);uo(lZ.DISABLED,r,null!=i?i:[])},[lK.MEDIA_TOGGLE_SUBTITLES_REQUEST](e,t,{detail:i}){uC(t,i)},[lK.MEDIA_RENDITION_REQUEST](e,t,{detail:i}){e.mediaRenditionSelected.set(i,t)},[lK.MEDIA_AUDIO_TRACK_REQUEST](e,t,{detail:i}){e.mediaAudioTrackEnabled.set(i,t)},[lK.MEDIA_ENTER_PIP_REQUEST](e,t){e.mediaIsFullscreen.get(t)&&e.mediaIsFullscreen.set(!1,t),e.mediaIsPip.set(!0,t)},[lK.MEDIA_EXIT_PIP_REQUEST](e,t){e.mediaIsPip.set(!1,t)},[lK.MEDIA_ENTER_FULLSCREEN_REQUEST](e,t){e.mediaIsPip.get(t)&&e.mediaIsPip.set(!1,t),e.mediaIsFullscreen.set(!0,t)},[lK.MEDIA_EXIT_FULLSCREEN_REQUEST](e,t){e.mediaIsFullscreen.set(!1,t)},[lK.MEDIA_ENTER_CAST_REQUEST](e,t){e.mediaIsFullscreen.get(t)&&e.mediaIsFullscreen.set(!1,t),e.mediaIsCasting.set(!0,t)},[lK.MEDIA_EXIT_CAST_REQUEST](e,t){e.mediaIsCasting.set(!1,t)},[lK.MEDIA_AIRPLAY_REQUEST](e,t){e.mediaIsAirplaying.set(!0,t)}},uB=({media:e,fullscreenElement:t,documentElement:i,stateMediator:r=uU,requestMap:a=uF,options:s={},monitorStateOwnersOnlyWithSubscriptions:n=!0})=>{let o;let l=[],d={options:{...s}},u=Object.freeze({mediaPreviewTime:void 0,mediaPreviewImage:void 0,mediaPreviewCoords:void 0,mediaPreviewChapter:void 0}),h=e=>{void 0!=e&&!ux(e,u)&&(u=Object.freeze({...u,...e}),l.forEach(e=>e(u)))},c=()=>{h(Object.entries(r).reduce((e,[t,{get:i}])=>(e[t]=i(d),e),{}))},m={},p=async(e,t)=>{var i,a,s,u,p,f,g,E,b,y,T,_,A,S,k,R;let I=!!o;if(o={...d,...null!=o?o:{},...e},I)return;await uP(...Object.values(e));let L=l.length>0&&0===t&&n,w=d.media!==o.media,D=(null==(i=d.media)?void 0:i.textTracks)!==(null==(a=o.media)?void 0:a.textTracks),C=(null==(s=d.media)?void 0:s.videoRenditions)!==(null==(u=o.media)?void 0:u.videoRenditions),x=(null==(p=d.media)?void 0:p.audioTracks)!==(null==(f=o.media)?void 0:f.audioTracks),M=(null==(g=d.media)?void 0:g.remote)!==(null==(E=o.media)?void 0:E.remote),O=d.documentElement!==o.documentElement,N=!!d.media&&(w||L),P=!!(null==(b=d.media)?void 0:b.textTracks)&&(D||L),U=!!(null==(y=d.media)?void 0:y.videoRenditions)&&(C||L),F=!!(null==(T=d.media)?void 0:T.audioTracks)&&(x||L),B=!!(null==(_=d.media)?void 0:_.remote)&&(M||L),$=!!d.documentElement&&(O||L),G=N||P||U||F||B||$,H=0===l.length&&1===t&&n,V=!!o.media&&(w||H),K=!!(null==(A=o.media)?void 0:A.textTracks)&&(D||H),W=!!(null==(S=o.media)?void 0:S.videoRenditions)&&(C||H),Y=!!(null==(k=o.media)?void 0:k.audioTracks)&&(x||H),q=!!(null==(R=o.media)?void 0:R.remote)&&(M||H),j=!!o.documentElement&&(O||H),z=V||K||W||Y||q||j;if(!(G||z)){Object.entries(o).forEach(([e,t])=>{d[e]=t}),c(),o=void 0;return}Object.entries(r).forEach(([e,{get:t,mediaEvents:i=[],textTracksEvents:r=[],videoRenditionsEvents:a=[],audioTracksEvents:s=[],remoteEvents:n=[],rootEvents:l=[],stateOwnersUpdateHandlers:u=[]}])=>{let c;m[e]||(m[e]={});let p=i=>{h({[e]:t(d,i)})};c=m[e].mediaEvents,i.forEach(t=>{c&&N&&(d.media.removeEventListener(t,c),m[e].mediaEvents=void 0),V&&(o.media.addEventListener(t,p),m[e].mediaEvents=p)}),c=m[e].textTracksEvents,r.forEach(t=>{var i,r;c&&P&&(null==(i=d.media.textTracks)||i.removeEventListener(t,c),m[e].textTracksEvents=void 0),K&&(null==(r=o.media.textTracks)||r.addEventListener(t,p),m[e].textTracksEvents=p)}),c=m[e].videoRenditionsEvents,a.forEach(t=>{var i,r;c&&U&&(null==(i=d.media.videoRenditions)||i.removeEventListener(t,c),m[e].videoRenditionsEvents=void 0),W&&(null==(r=o.media.videoRenditions)||r.addEventListener(t,p),m[e].videoRenditionsEvents=p)}),c=m[e].audioTracksEvents,s.forEach(t=>{var i,r;c&&F&&(null==(i=d.media.audioTracks)||i.removeEventListener(t,c),m[e].audioTracksEvents=void 0),Y&&(null==(r=o.media.audioTracks)||r.addEventListener(t,p),m[e].audioTracksEvents=p)}),c=m[e].remoteEvents,n.forEach(t=>{var i,r;c&&B&&(null==(i=d.media.remote)||i.removeEventListener(t,c),m[e].remoteEvents=void 0),q&&(null==(r=o.media.remote)||r.addEventListener(t,p),m[e].remoteEvents=p)}),c=m[e].rootEvents,l.forEach(t=>{c&&$&&(d.documentElement.removeEventListener(t,c),m[e].rootEvents=void 0),j&&(o.documentElement.addEventListener(t,p),m[e].rootEvents=p)});let f=m[e].stateOwnersUpdateHandlers;u.forEach(t=>{f&&G&&f(),z&&(m[e].stateOwnersUpdateHandlers=t(p,o))})}),Object.entries(o).forEach(([e,t])=>{d[e]=t}),c(),o=void 0};return p({media:e,fullscreenElement:t,documentElement:i,options:s}),{dispatch(e){let{type:t,detail:i}=e;if(a[t]&&null==u.mediaErrorCode){h(a[t](r,d,e));return}"mediaelementchangerequest"===t?p({media:i}):"fullscreenelementchangerequest"===t?p({fullscreenElement:i}):"documentelementchangerequest"===t?p({documentElement:i}):"optionschangerequest"===t&&Object.entries(null!=i?i:{}).forEach(([e,t])=>{d.options[e]=t})},getState:()=>u,subscribe:e=>(p({},l.length+1),l.push(e),e(u),()=>{let t=l.indexOf(e);t>=0&&(p({},l.length-1),l.splice(t,1))})}};var u$=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},uG=(e,t,i)=>(u$(e,t,"read from private field"),i?i.call(e):t.get(e)),uH=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},uV=(e,t,i,r)=>(u$(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),uK=(e,t,i)=>(u$(e,t,"access private method"),i);let uW=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],uY={DEFAULT_SUBTITLES:"defaultsubtitles",DEFAULT_STREAM_TYPE:"defaultstreamtype",DEFAULT_DURATION:"defaultduration",FULLSCREEN_ELEMENT:"fullscreenelement",HOTKEYS:"hotkeys",KEYS_USED:"keysused",LIVE_EDGE_OFFSET:"liveedgeoffset",SEEK_TO_LIVE_OFFSET:"seektoliveoffset",NO_AUTO_SEEK_TO_LIVE:"noautoseektolive",NO_HOTKEYS:"nohotkeys",NO_VOLUME_PREF:"novolumepref",NO_SUBTITLES_LANG_PREF:"nosubtitleslangpref",NO_DEFAULT_STORE:"nodefaultstore",KEYBOARD_FORWARD_SEEK_OFFSET:"keyboardforwardseekoffset",KEYBOARD_BACKWARD_SEEK_OFFSET:"keyboardbackwardseekoffset",LANG:"lang"};class uq extends d3{constructor(){super(),uH(this,pd),uH(this,ph),uH(this,pm),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,uH(this,pr,new d6(this,uY.HOTKEYS)),uH(this,pa,void 0),uH(this,ps,void 0),uH(this,pn,void 0),uH(this,po,void 0),uH(this,pl,e=>{var t;null==(t=uG(this,ps))||t.dispatch(e)}),this.associateElement(this);let e={};uV(this,pn,t=>{Object.entries(t).forEach(([t,i])=>{if(t in e&&e[t]===i)return;this.propagateMediaState(t,i);let r=t.toLowerCase(),a=new dv.CustomEvent(lX[r],{composed:!0,detail:i});this.dispatchEvent(a)}),e=t}),this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat(uY.NO_HOTKEYS,uY.HOTKEYS,uY.DEFAULT_STREAM_TYPE,uY.DEFAULT_SUBTITLES,uY.DEFAULT_DURATION,uY.LANG)}get mediaStore(){return uG(this,ps)}set mediaStore(e){var t,i;if(uG(this,ps)&&(null==(t=uG(this,po))||t.call(this),uV(this,po,void 0)),uV(this,ps,e),!uG(this,ps)&&!this.hasAttribute(uY.NO_DEFAULT_STORE)){uK(this,pd,pu).call(this);return}uV(this,po,null==(i=uG(this,ps))?void 0:i.subscribe(uG(this,pn)))}get fullscreenElement(){var e;return null!=(e=uG(this,pa))?e:this}set fullscreenElement(e){var t;this.hasAttribute(uY.FULLSCREEN_ELEMENT)&&this.removeAttribute(uY.FULLSCREEN_ELEMENT),uV(this,pa,e),null==(t=uG(this,ps))||t.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}get defaultSubtitles(){return dF(this,uY.DEFAULT_SUBTITLES)}set defaultSubtitles(e){dB(this,uY.DEFAULT_SUBTITLES,e)}get defaultStreamType(){return d$(this,uY.DEFAULT_STREAM_TYPE)}set defaultStreamType(e){dG(this,uY.DEFAULT_STREAM_TYPE,e)}get defaultDuration(){return dP(this,uY.DEFAULT_DURATION)}set defaultDuration(e){dU(this,uY.DEFAULT_DURATION,e)}get noHotkeys(){return dF(this,uY.NO_HOTKEYS)}set noHotkeys(e){dB(this,uY.NO_HOTKEYS,e)}get keysUsed(){return d$(this,uY.KEYS_USED)}set keysUsed(e){dG(this,uY.KEYS_USED,e)}get liveEdgeOffset(){return dP(this,uY.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){dU(this,uY.LIVE_EDGE_OFFSET,e)}get noAutoSeekToLive(){return dF(this,uY.NO_AUTO_SEEK_TO_LIVE)}set noAutoSeekToLive(e){dB(this,uY.NO_AUTO_SEEK_TO_LIVE,e)}get noVolumePref(){return dF(this,uY.NO_VOLUME_PREF)}set noVolumePref(e){dB(this,uY.NO_VOLUME_PREF,e)}get noSubtitlesLangPref(){return dF(this,uY.NO_SUBTITLES_LANG_PREF)}set noSubtitlesLangPref(e){dB(this,uY.NO_SUBTITLES_LANG_PREF,e)}get noDefaultStore(){return dF(this,uY.NO_DEFAULT_STORE)}set noDefaultStore(e){dB(this,uY.NO_DEFAULT_STORE,e)}attributeChangedCallback(e,t,i){var r,a,s,n,o,l,d,u;if(super.attributeChangedCallback(e,t,i),e===uY.NO_HOTKEYS)i!==t&&""===i?(this.hasAttribute(uY.HOTKEYS)&&console.warn("Media Chrome: Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):i!==t&&null===i&&this.enableHotkeys();else if(e===uY.HOTKEYS)uG(this,pr).value=i;else if(e===uY.DEFAULT_SUBTITLES&&i!==t)null==(r=uG(this,ps))||r.dispatch({type:"optionschangerequest",detail:{defaultSubtitles:this.hasAttribute(uY.DEFAULT_SUBTITLES)}});else if(e===uY.DEFAULT_STREAM_TYPE)null==(s=uG(this,ps))||s.dispatch({type:"optionschangerequest",detail:{defaultStreamType:null!=(a=this.getAttribute(uY.DEFAULT_STREAM_TYPE))?a:void 0}});else if(e===uY.LIVE_EDGE_OFFSET)null==(n=uG(this,ps))||n.dispatch({type:"optionschangerequest",detail:{liveEdgeOffset:this.hasAttribute(uY.LIVE_EDGE_OFFSET)?+this.getAttribute(uY.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(uY.SEEK_TO_LIVE_OFFSET)?void 0:+this.getAttribute(uY.LIVE_EDGE_OFFSET)}});else if(e===uY.SEEK_TO_LIVE_OFFSET)null==(o=uG(this,ps))||o.dispatch({type:"optionschangerequest",detail:{seekToLiveOffset:this.hasAttribute(uY.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(uY.SEEK_TO_LIVE_OFFSET):void 0}});else if(e===uY.NO_AUTO_SEEK_TO_LIVE)null==(l=uG(this,ps))||l.dispatch({type:"optionschangerequest",detail:{noAutoSeekToLive:this.hasAttribute(uY.NO_AUTO_SEEK_TO_LIVE)}});else if(e===uY.FULLSCREEN_ELEMENT){let e=i?null==(d=this.getRootNode())?void 0:d.getElementById(i):void 0;uV(this,pa,e),null==(u=uG(this,ps))||u.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}else e===uY.LANG&&i!==t&&dl(i)}connectedCallback(){var e,t;uG(this,ps)||this.hasAttribute(uY.NO_DEFAULT_STORE)||uK(this,pd,pu).call(this),null==(e=uG(this,ps))||e.dispatch({type:"documentelementchangerequest",detail:dE}),super.connectedCallback(),uG(this,ps)&&!uG(this,po)&&uV(this,po,null==(t=uG(this,ps))?void 0:t.subscribe(uG(this,pn))),this.enableHotkeys()}disconnectedCallback(){var e,t,i,r;null==(e=super.disconnectedCallback)||e.call(this),uG(this,ps)&&(null==(t=uG(this,ps))||t.dispatch({type:"documentelementchangerequest",detail:void 0}),null==(i=uG(this,ps))||i.dispatch({type:lK.MEDIA_TOGGLE_SUBTITLES_REQUEST,detail:!1})),uG(this,po)&&(null==(r=uG(this,po))||r.call(this),uV(this,po,void 0))}mediaSetCallback(e){var t;super.mediaSetCallback(e),null==(t=uG(this,ps))||t.dispatch({type:"mediaelementchangerequest",detail:e}),e.hasAttribute("tabindex")||(e.tabIndex=-1)}mediaUnsetCallback(e){var t;super.mediaUnsetCallback(e),null==(t=uG(this,ps))||t.dispatch({type:"mediaelementchangerequest",detail:void 0})}propagateMediaState(e,t){u4(this.mediaStateReceivers,e,t)}associateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;if(t.has(e))return;let i=u5(e,this.registerMediaStateReceiver.bind(this),this.unregisterMediaStateReceiver.bind(this));Object.values(lK).forEach(t=>{e.addEventListener(t,uG(this,pl))}),t.set(e,i)}unassociateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;t.has(e)&&(t.get(e)(),t.delete(e),Object.values(lK).forEach(t=>{e.removeEventListener(t,uG(this,pl))}))}registerMediaStateReceiver(e){if(!e)return;let t=this.mediaStateReceivers;!(t.indexOf(e)>-1)&&(t.push(e),uG(this,ps)&&Object.entries(uG(this,ps).getState()).forEach(([t,i])=>{u4([e],t,i)}))}unregisterMediaStateReceiver(e){let t=this.mediaStateReceivers,i=t.indexOf(e);i<0||t.splice(i,1)}enableHotkeys(){this.addEventListener("keydown",uK(this,pm,pp))}disableHotkeys(){this.removeEventListener("keydown",uK(this,pm,pp)),this.removeEventListener("keyup",uK(this,ph,pc))}get hotkeys(){return d$(this,uY.HOTKEYS)}set hotkeys(e){dG(this,uY.HOTKEYS,e)}keyboardShortcutHandler(e){var t,i,r,a,s;let n,o,l;let d=e.target;if(!((null!=(r=null!=(i=null==(t=d.getAttribute(uY.KEYS_USED))?void 0:t.split(" "))?i:null==d?void 0:d.keysUsed)?r:[]).map(e=>"Space"===e?" ":e).filter(Boolean).includes(e.key)||uG(this,pr).contains(`no${e.key.toLowerCase()}`))&&!(" "===e.key&&uG(this,pr).contains("nospace")))switch(e.key){case" ":case"k":n=uG(this,ps).getState().mediaPaused?lK.MEDIA_PLAY_REQUEST:lK.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new dv.CustomEvent(n,{composed:!0,bubbles:!0}));break;case"m":n="off"===this.mediaStore.getState().mediaVolumeLevel?lK.MEDIA_UNMUTE_REQUEST:lK.MEDIA_MUTE_REQUEST,this.dispatchEvent(new dv.CustomEvent(n,{composed:!0,bubbles:!0}));break;case"f":n=this.mediaStore.getState().mediaIsFullscreen?lK.MEDIA_EXIT_FULLSCREEN_REQUEST:lK.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new dv.CustomEvent(n,{composed:!0,bubbles:!0}));break;case"c":this.dispatchEvent(new dv.CustomEvent(lK.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}));break;case"ArrowLeft":{let e=this.hasAttribute(uY.KEYBOARD_BACKWARD_SEEK_OFFSET)?+this.getAttribute(uY.KEYBOARD_BACKWARD_SEEK_OFFSET):10;o=Math.max((null!=(a=this.mediaStore.getState().mediaCurrentTime)?a:0)-e,0),l=new dv.CustomEvent(lK.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l);break}case"ArrowRight":{let e=this.hasAttribute(uY.KEYBOARD_FORWARD_SEEK_OFFSET)?+this.getAttribute(uY.KEYBOARD_FORWARD_SEEK_OFFSET):10;o=Math.max((null!=(s=this.mediaStore.getState().mediaCurrentTime)?s:0)+e,0),l=new dv.CustomEvent(lK.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l)}}}}pr=new WeakMap,pa=new WeakMap,ps=new WeakMap,pn=new WeakMap,po=new WeakMap,pl=new WeakMap,pd=new WeakSet,pu=function(){var e;this.mediaStore=uB({media:this.media,fullscreenElement:this.fullscreenElement,options:{defaultSubtitles:this.hasAttribute(uY.DEFAULT_SUBTITLES),defaultDuration:this.hasAttribute(uY.DEFAULT_DURATION)?+this.getAttribute(uY.DEFAULT_DURATION):void 0,defaultStreamType:null!=(e=this.getAttribute(uY.DEFAULT_STREAM_TYPE))?e:void 0,liveEdgeOffset:this.hasAttribute(uY.LIVE_EDGE_OFFSET)?+this.getAttribute(uY.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(uY.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(uY.SEEK_TO_LIVE_OFFSET):this.hasAttribute(uY.LIVE_EDGE_OFFSET)?+this.getAttribute(uY.LIVE_EDGE_OFFSET):void 0,noAutoSeekToLive:this.hasAttribute(uY.NO_AUTO_SEEK_TO_LIVE),noVolumePref:this.hasAttribute(uY.NO_VOLUME_PREF),noSubtitlesLangPref:this.hasAttribute(uY.NO_SUBTITLES_LANG_PREF)}})},ph=new WeakSet,pc=function(e){let{key:t}=e;if(!uW.includes(t)){this.removeEventListener("keyup",uK(this,ph,pc));return}this.keyboardShortcutHandler(e)},pm=new WeakSet,pp=function(e){let{metaKey:t,altKey:i,key:r}=e;if(t||i||!uW.includes(r)){this.removeEventListener("keyup",uK(this,ph,pc));return}[" ","ArrowLeft","ArrowRight"].includes(r)&&!(uG(this,pr).contains(`no${r.toLowerCase()}`)||" "===r&&uG(this,pr).contains("nospace"))&&e.preventDefault(),this.addEventListener("keyup",uK(this,ph,pc),{once:!0})};let uj=Object.values(lj),uz=Object.values(lY),uX=e=>{var t,i,r,a;let{observedAttributes:s}=e.constructor;!s&&(null==(t=e.nodeName)?void 0:t.includes("-"))&&(dv.customElements.upgrade(e),{observedAttributes:s}=e.constructor);let n=null==(a=null==(r=null==(i=null==e?void 0:e.getAttribute)?void 0:i.call(e,lW.MEDIA_CHROME_ATTRIBUTES))?void 0:r.split)?void 0:a.call(r,/\s+/);return Array.isArray(s||n)?(s||n).filter(e=>uj.includes(e)):[]},uQ=e=>{var t,i;return(null==(t=e.nodeName)?void 0:t.includes("-"))&&dv.customElements.get(null==(i=e.nodeName)?void 0:i.toLowerCase())&&!(e instanceof dv.customElements.get(e.nodeName.toLowerCase()))&&dv.customElements.upgrade(e),uz.some(t=>t in e)},uZ=e=>uQ(e)||!!uX(e).length,uJ=e=>{var t;return null==(t=null==e?void 0:e.join)?void 0:t.call(e,":")},u0={[lj.MEDIA_SUBTITLES_LIST]:ua,[lj.MEDIA_SUBTITLES_SHOWING]:ua,[lj.MEDIA_SEEKABLE]:uJ,[lj.MEDIA_BUFFERED]:e=>null==e?void 0:e.map(uJ).join(" "),[lj.MEDIA_PREVIEW_COORDS]:e=>null==e?void 0:e.join(" "),[lj.MEDIA_RENDITION_LIST]:function(e){return null==e?void 0:e.map(l3).join(" ")},[lj.MEDIA_AUDIO_TRACK_LIST]:function(e){return null==e?void 0:e.map(l5).join(" ")}},u1=async(e,t,i)=>{var r,a;if(e.isConnected||await l7(0),"boolean"==typeof i||null==i)return dB(e,t,i);if("number"==typeof i)return dU(e,t,i);if("string"==typeof i)return dG(e,t,i);if(Array.isArray(i)&&!i.length)return e.removeAttribute(t);let s=null!=(a=null==(r=u0[t])?void 0:r.call(u0,i))?a:i;return e.setAttribute(t,s)},u2=e=>{var t;return!!(null==(t=e.closest)?void 0:t.call(e,'*[slot="media"]'))},u3=(e,t)=>{if(u2(e))return;let i=(e,t)=>{var i,r;uZ(e)&&t(e);let{children:a=[]}=null!=e?e:{};[...a,...null!=(r=null==(i=null==e?void 0:e.shadowRoot)?void 0:i.children)?r:[]].forEach(e=>u3(e,t))},r=null==e?void 0:e.nodeName.toLowerCase();if(r.includes("-")&&!uZ(e)){dv.customElements.whenDefined(r).then(()=>{i(e,t)});return}i(e,t)},u4=(e,t,i)=>{e.forEach(e=>{if(t in e){e[t]=i;return}let r=uX(e),a=t.toLowerCase();r.includes(a)&&u1(e,a,i)})},u5=(e,t,i)=>{u3(e,t);let r=e=>{var i;t(null!=(i=null==e?void 0:e.composedPath()[0])?i:e.target)},a=e=>{var t;i(null!=(t=null==e?void 0:e.composedPath()[0])?t:e.target)};e.addEventListener(lK.REGISTER_MEDIA_STATE_RECEIVER,r),e.addEventListener(lK.UNREGISTER_MEDIA_STATE_RECEIVER,a);let s=[],n=e=>{let r=e.target;"media"!==r.name&&(s.forEach(e=>u3(e,i)),(s=[...r.assignedElements({flatten:!0})]).forEach(e=>u3(e,t)))};e.addEventListener("slotchange",n);let o=new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:r=[],removedNodes:a=[],type:s,target:n,attributeName:o}=e;"childList"===s?(Array.prototype.forEach.call(r,e=>u3(e,t)),Array.prototype.forEach.call(a,e=>u3(e,i))):"attributes"===s&&o===lW.MEDIA_CHROME_ATTRIBUTES&&(uZ(n)?t(n):i(n))})});return o.observe(e,{childList:!0,attributes:!0,subtree:!0}),()=>{u3(e,i),e.removeEventListener("slotchange",n),o.disconnect(),e.removeEventListener(lK.REGISTER_MEDIA_STATE_RECEIVER,r),e.removeEventListener(lK.UNREGISTER_MEDIA_STATE_RECEIVER,a)}};dv.customElements.get("media-controller")||dv.customElements.define("media-controller",uq);var u8=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},u9=(e,t,i)=>(u8(e,t,"read from private field"),i?i.call(e):t.get(e)),u6=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},u7=(e,t,i,r)=>(u8(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),he=(e,t,i)=>(u8(e,t,"access private method"),i);let ht={TOOLTIP_PLACEMENT:"tooltipplacement",DISABLED:"disabled",NO_TOOLTIP:"notooltip"},hi=dE.createElement("template");hi.innerHTML=`
<style>
  :host {
    position: relative;
    font: var(--media-font,
      var(--media-font-weight, bold)
      var(--media-font-size, 14px) /
      var(--media-text-content-height, var(--media-control-height, 24px))
      var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
    color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
    background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
    padding: var(--media-button-padding, var(--media-control-padding, 10px));
    justify-content: var(--media-button-justify-content, center);
    display: inline-flex;
    align-items: center;
    vertical-align: middle;
    box-sizing: border-box;
    transition: background .15s linear;
    pointer-events: auto;
    cursor: var(--media-cursor, pointer);
    -webkit-tap-highlight-color: transparent;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50 50 70 / .7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }

  media-tooltip {
    
    max-width: 0;
    overflow-x: clip;
    opacity: 0;
    transition: opacity .3s, max-width 0s 9s;
  }

  :host(:hover) media-tooltip,
  :host(:focus-visible) media-tooltip {
    max-width: 100vw;
    opacity: 1;
    transition: opacity .3s;
  }

  :host([notooltip]) slot[name="tooltip"] {
    display: none;
  }
</style>

<slot name="tooltip">
  <media-tooltip part="tooltip" aria-hidden="true">
    <slot name="tooltip-content"></slot>
  </media-tooltip>
</slot>
`;class hr extends dv.HTMLElement{constructor(e={}){var t;if(super(),u6(this,py),u6(this,pf,void 0),this.preventClick=!1,this.tooltipEl=null,this.tooltipContent="",u6(this,pg,e=>{this.preventClick||this.handleClick(e),setTimeout(u9(this,pv),0)}),u6(this,pv,()=>{var e,t;null==(t=null==(e=this.tooltipEl)?void 0:e.updateXOffset)||t.call(e)}),u6(this,pE,e=>{let{key:t}=e;if(!this.keysUsed.includes(t)){this.removeEventListener("keyup",u9(this,pE));return}this.preventClick||this.handleClick(e)}),u6(this,pb,e=>{let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r)){this.removeEventListener("keyup",u9(this,pE));return}this.addEventListener("keyup",u9(this,pE),{once:!0})}),!this.shadowRoot){this.attachShadow({mode:"open"});let i=hi.content.cloneNode(!0);this.nativeEl=i;let r=e.slotTemplate;r||((r=dE.createElement("template")).innerHTML=`<slot>${e.defaultContent||""}</slot>`),e.tooltipContent&&(i.querySelector('slot[name="tooltip-content"]').innerHTML=null!=(t=e.tooltipContent)?t:"",this.tooltipContent=e.tooltipContent),this.nativeEl.appendChild(r.content.cloneNode(!0)),this.shadowRoot.appendChild(i)}this.tooltipEl=this.shadowRoot.querySelector("media-tooltip")}static get observedAttributes(){return["disabled",ht.TOOLTIP_PLACEMENT,lW.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",u9(this,pg)),this.addEventListener("keydown",u9(this,pb)),this.tabIndex=0}disable(){this.removeEventListener("click",u9(this,pg)),this.removeEventListener("keydown",u9(this,pb)),this.removeEventListener("keyup",u9(this,pE)),this.tabIndex=-1}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===lW.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=u9(this,pf))?void 0:r.unassociateElement)||a.call(r,this),u7(this,pf,null)),i&&this.isConnected&&(u7(this,pf,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=u9(this,pf))?void 0:n.associateElement)||o.call(n,this))):"disabled"===e&&i!==t?null==i?this.enable():this.disable():e===ht.TOOLTIP_PLACEMENT&&this.tooltipEl&&i!==t&&(this.tooltipEl.placement=i),u9(this,pv).call(this)}connectedCallback(){var e,t,i;let{style:r}=dO(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`),this.hasAttribute("disabled")?this.disable():this.enable(),this.setAttribute("role","button");let a=this.getAttribute(lW.MEDIA_CONTROLLER);a&&(u7(this,pf,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=u9(this,pf))?void 0:t.associateElement)||i.call(t,this)),dv.customElements.whenDefined("media-tooltip").then(()=>he(this,py,pT).call(this))}disconnectedCallback(){var e,t;this.disable(),null==(t=null==(e=u9(this,pf))?void 0:e.unassociateElement)||t.call(e,this),u7(this,pf,null),this.removeEventListener("mouseenter",u9(this,pv)),this.removeEventListener("focus",u9(this,pv)),this.removeEventListener("click",u9(this,pg))}get keysUsed(){return["Enter"," "]}get tooltipPlacement(){return d$(this,ht.TOOLTIP_PLACEMENT)}set tooltipPlacement(e){dG(this,ht.TOOLTIP_PLACEMENT,e)}get mediaController(){return d$(this,lW.MEDIA_CONTROLLER)}set mediaController(e){dG(this,lW.MEDIA_CONTROLLER,e)}get disabled(){return dF(this,ht.DISABLED)}set disabled(e){dB(this,ht.DISABLED,e)}get noTooltip(){return dF(this,ht.NO_TOOLTIP)}set noTooltip(e){dB(this,ht.NO_TOOLTIP,e)}handleClick(e){}}pf=new WeakMap,pg=new WeakMap,pv=new WeakMap,pE=new WeakMap,pb=new WeakMap,py=new WeakSet,pT=function(){this.addEventListener("mouseenter",u9(this,pv)),this.addEventListener("focus",u9(this,pv)),this.addEventListener("click",u9(this,pg));let e=this.tooltipPlacement;e&&this.tooltipEl&&(this.tooltipEl.placement=e)},dv.customElements.get("media-chrome-button")||dv.customElements.define("media-chrome-button",hr);let ha=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,hs=dE.createElement("template");hs.innerHTML=`
  <style>
    :host([${lj.MEDIA_IS_AIRPLAYING}]) slot[name=icon] slot:not([name=exit]) {
      display: none !important;
    }

    
    :host(:not([${lj.MEDIA_IS_AIRPLAYING}])) slot[name=icon] slot:not([name=enter]) {
      display: none !important;
    }

    :host([${lj.MEDIA_IS_AIRPLAYING}]) slot[name=tooltip-enter],
    :host(:not([${lj.MEDIA_IS_AIRPLAYING}])) slot[name=tooltip-exit] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="enter">${ha}</slot>
    <slot name="exit">${ha}</slot>
  </slot>
`;let hn=`
  <slot name="tooltip-enter">${dd("start airplay")}</slot>
  <slot name="tooltip-exit">${dd("stop airplay")}</slot>
`,ho=e=>{let t=e.mediaIsAirplaying?dd("stop airplay"):dd("start airplay");e.setAttribute("aria-label",t)};dv.customElements.get("media-airplay-button")||dv.customElements.define("media-airplay-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_IS_AIRPLAYING,lj.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(e={}){super({slotTemplate:hs,tooltipContent:hn,...e})}connectedCallback(){super.connectedCallback(),ho(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_IS_AIRPLAYING&&ho(this)}get mediaIsAirplaying(){return dF(this,lj.MEDIA_IS_AIRPLAYING)}set mediaIsAirplaying(e){dB(this,lj.MEDIA_IS_AIRPLAYING,e)}get mediaAirplayUnavailable(){return d$(this,lj.MEDIA_AIRPLAY_UNAVAILABLE)}set mediaAirplayUnavailable(e){dG(this,lj.MEDIA_AIRPLAY_UNAVAILABLE,e)}handleClick(){let e=new dv.CustomEvent(lK.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}});let hl=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,hd=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,hu=dE.createElement("template");hu.innerHTML=`
  <style>
    :host([aria-checked="true"]) slot[name=off] {
      display: none !important;
    }

    
    :host(:not([aria-checked="true"])) slot[name=on] {
      display: none !important;
    }

    :host([aria-checked="true"]) slot[name=tooltip-enable],
    :host(:not([aria-checked="true"])) slot[name=tooltip-disable] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="on">${hl}</slot>
    <slot name="off">${hd}</slot>
  </slot>
`;let hh=`
  <slot name="tooltip-enable">${dd("Enable captions")}</slot>
  <slot name="tooltip-disable">${dd("Disable captions")}</slot>
`,hc=e=>{e.setAttribute("aria-checked",ud(e).toString())},hm=(e,t)=>{let i=e.getAttribute(t);return i?ut(i):[]},hp=(e,t,i)=>{if(!(null==i?void 0:i.length)){e.removeAttribute(t);return}let r=ua(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};dv.customElements.get("media-captions-button")||dv.customElements.define("media-captions-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_SUBTITLES_LIST,lj.MEDIA_SUBTITLES_SHOWING]}constructor(e={}){super({slotTemplate:hu,tooltipContent:hh,...e}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",dd("closed captions")),hc(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_SUBTITLES_SHOWING&&hc(this)}get mediaSubtitlesList(){return hm(this,lj.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){hp(this,lj.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return hm(this,lj.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){hp(this,lj.MEDIA_SUBTITLES_SHOWING,e)}handleClick(){this.dispatchEvent(new dv.CustomEvent(lK.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}))}});let hf=dE.createElement("template");hf.innerHTML=`
  <style>
  :host([${lj.MEDIA_IS_CASTING}]) slot[name=icon] slot:not([name=exit]) {
    display: none !important;
  }

  
  :host(:not([${lj.MEDIA_IS_CASTING}])) slot[name=icon] slot:not([name=enter]) {
    display: none !important;
  }

  :host([${lj.MEDIA_IS_CASTING}]) slot[name=tooltip-enter],
    :host(:not([${lj.MEDIA_IS_CASTING}])) slot[name=tooltip-exit] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="enter"><svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg></slot>
    <slot name="exit"><svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg></slot>
  </slot>
`;let hg=`
  <slot name="tooltip-enter">${dd("Start casting")}</slot>
  <slot name="tooltip-exit">${dd("Stop casting")}</slot>
`,hv=e=>{let t=e.mediaIsCasting?dd("stop casting"):dd("start casting");e.setAttribute("aria-label",t)};dv.customElements.get("media-cast-button")||dv.customElements.define("media-cast-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_IS_CASTING,lj.MEDIA_CAST_UNAVAILABLE]}constructor(e={}){super({slotTemplate:hf,tooltipContent:hg,...e})}connectedCallback(){super.connectedCallback(),hv(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_IS_CASTING&&hv(this)}get mediaIsCasting(){return dF(this,lj.MEDIA_IS_CASTING)}set mediaIsCasting(e){dB(this,lj.MEDIA_IS_CASTING,e)}get mediaCastUnavailable(){return d$(this,lj.MEDIA_CAST_UNAVAILABLE)}set mediaCastUnavailable(e){dG(this,lj.MEDIA_CAST_UNAVAILABLE,e)}handleClick(){let e=this.mediaIsCasting?lK.MEDIA_EXIT_CAST_REQUEST:lK.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new dv.CustomEvent(e,{composed:!0,bubbles:!0}))}});var hE=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hb=(e,t,i)=>(hE(e,t,"read from private field"),i?i.call(e):t.get(e)),hy=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},hT=(e,t,i,r)=>(hE(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),h_=(e,t,i)=>(hE(e,t,"access private method"),i);let hA="open";class hS extends dv.HTMLElement{constructor(){super(),hy(this,pk),hy(this,pI),hy(this,pw),hy(this,pC),hy(this,pM),hy(this,pN),hy(this,p_,!1),hy(this,pA,null),hy(this,pS,null),this.addEventListener("invoke",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this)}static get observedAttributes(){return[hA,"anchor"]}get open(){return dF(this,hA)}set open(e){dB(this,hA,e)}handleEvent(e){switch(e.type){case"invoke":h_(this,pC,px).call(this,e);break;case"focusout":h_(this,pM,pO).call(this,e);break;case"keydown":h_(this,pN,pP).call(this,e)}}connectedCallback(){h_(this,pk,pR).call(this),this.role||(this.role="dialog")}attributeChangedCallback(e,t,i){h_(this,pk,pR).call(this),e===hA&&i!==t&&(this.open?h_(this,pI,pL).call(this):h_(this,pw,pD).call(this))}focus(){hT(this,pA,dC());let e=!this.dispatchEvent(new Event("focus",{composed:!0,cancelable:!0})),t=!this.dispatchEvent(new Event("focusin",{composed:!0,bubbles:!0,cancelable:!0}));if(e||t)return;let i=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');null==i||i.focus()}get keysUsed(){return["Escape","Tab"]}}p_=new WeakMap,pA=new WeakMap,pS=new WeakMap,pk=new WeakSet,pR=function(){if(!hb(this,p_)&&(hT(this,p_,!0),!this.shadowRoot)){this.attachShadow({mode:"open"});let e=function(e){let t={};for(let i of e)t[i.name]=i.value;return t}(this.attributes);this.shadowRoot.innerHTML=`
        ${this.constructor.getTemplateHTML(e)}
      `,queueMicrotask(()=>{let{style:e}=dO(this.shadowRoot,":host");e.setProperty("transition","display .15s, visibility .15s, opacity .15s ease-in, transform .15s ease-in")})}},pI=new WeakSet,pL=function(){var e;null==(e=hb(this,pS))||e.setAttribute("aria-expanded","true"),this.dispatchEvent(new Event("open",{composed:!0,bubbles:!0})),this.addEventListener("transitionend",()=>this.focus(),{once:!0})},pw=new WeakSet,pD=function(){var e;null==(e=hb(this,pS))||e.setAttribute("aria-expanded","false"),this.dispatchEvent(new Event("close",{composed:!0,bubbles:!0}))},pC=new WeakSet,px=function(e){hT(this,pS,e.relatedTarget),dw(this,e.relatedTarget)||(this.open=!this.open)},pM=new WeakSet,pO=function(e){var t;!dw(this,e.relatedTarget)&&(null==(t=hb(this,pA))||t.focus(),hb(this,pS)&&hb(this,pS)!==e.relatedTarget&&this.open&&(this.open=!1))},pN=new WeakSet,pP=function(e){var t,i,r,a,s;let{key:n,ctrlKey:o,altKey:l,metaKey:d}=e;!o&&!l&&!d&&this.keysUsed.includes(n)&&(e.preventDefault(),e.stopPropagation(),"Tab"===n?(e.shiftKey?null==(i=null==(t=this.previousElementSibling)?void 0:t.focus)||i.call(t):null==(a=null==(r=this.nextElementSibling)?void 0:r.focus)||a.call(r),this.blur()):"Escape"===n&&(null==(s=hb(this,pA))||s.focus(),this.open=!1))},hS.getTemplateHTML=function(e){return`
    <style>
      :host {
        font: var(--media-font,
          var(--media-font-weight, normal)
          var(--media-font-size, 14px) /
          var(--media-text-content-height, var(--media-control-height, 24px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        display: var(--media-dialog-display, inline-flex);
        justify-content: center;
        align-items: center;
        
        transition-behavior: allow-discrete;
        visibility: hidden;
        opacity: 0;
        transform: translateY(2px) scale(.99);
        pointer-events: none;
      }

      :host([open]) {
        transition: display .2s, visibility 0s, opacity .2s ease-out, transform .15s ease-out;
        visibility: visible;
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }

      #content {
        display: flex;
        position: relative;
        box-sizing: border-box;
        width: min(320px, 100%);
        word-wrap: break-word;
        max-height: 100%;
        overflow: auto;
        text-align: center;
        line-height: 1.4;
      }
    </style>
    ${this.getSlotTemplateHTML(e)}
  `},hS.getSlotTemplateHTML=function(e){return`
    <slot id="content"></slot>
  `},dv.customElements.get("media-chrome-dialog")||dv.customElements.define("media-chrome-dialog",hS);var hk=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hR=(e,t,i)=>(hk(e,t,"read from private field"),i?i.call(e):t.get(e)),hI=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},hL=(e,t,i,r)=>(hk(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),hw=(e,t,i)=>(hk(e,t,"access private method"),i);let hD=dE.createElement("template");hD.innerHTML=`
  <style>
    :host {
      --_focus-box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
      --_media-range-padding: var(--media-range-padding, var(--media-control-padding, 10px));

      box-shadow: var(--_focus-visible-box-shadow, none);
      background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      display: inline-flex;
      align-items: center;
      
      vertical-align: middle;
      box-sizing: border-box;
      position: relative;
      width: 100px;
      transition: background .15s linear;
      cursor: var(--media-cursor, pointer);
      pointer-events: auto;
      touch-action: none; 
    }

    
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgb(50 50 70 / .7));
    }

    #leftgap {
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
    }

    #rightgap {
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
    }

    #startpoint,
    #endpoint {
      position: absolute;
    }

    #endpoint {
      right: 0;
    }

    #container {
      
      width: var(--media-range-track-width, 100%);
      transform: translate(var(--media-range-track-translate-x, 0px), var(--media-range-track-translate-y, 0px));
      position: relative;
      height: 100%;
      display: flex;
      align-items: center;
      min-width: 40px;
    }

    #range {
      
      display: var(--media-time-range-hover-display, block);
      bottom: var(--media-time-range-hover-bottom, -7px);
      height: var(--media-time-range-hover-height, max(100% + 7px, 25px));
      width: 100%;
      position: absolute;
      cursor: var(--media-cursor, pointer);

      -webkit-appearance: none; 
      -webkit-tap-highlight-color: transparent;
      background: transparent; 
      margin: 0;
      z-index: 1;
    }

    @media (hover: hover) {
      #range {
        bottom: var(--media-time-range-hover-bottom, -5px);
        height: var(--media-time-range-hover-height, max(100% + 5px, 20px));
      }
    }

    
    
    #range::-webkit-slider-thumb {
      -webkit-appearance: none;
      background: transparent;
      width: .1px;
      height: .1px;
    }

    
    #range::-moz-range-thumb {
      background: transparent;
      border: transparent;
      width: .1px;
      height: .1px;
    }

    #appearance {
      height: var(--media-range-track-height, 4px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 100%;
      position: absolute;
      
      will-change: transform;
    }

    #track {
      background: var(--media-range-track-background, rgb(255 255 255 / .2));
      border-radius: var(--media-range-track-border-radius, 1px);
      border: var(--media-range-track-border, none);
      outline: var(--media-range-track-outline);
      outline-offset: var(--media-range-track-outline-offset);
      backdrop-filter: var(--media-range-track-backdrop-filter);
      -webkit-backdrop-filter: var(--media-range-track-backdrop-filter);
      box-shadow: var(--media-range-track-box-shadow, none);
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #progress,
    #pointer {
      position: absolute;
      height: 100%;
      will-change: width;
    }

    #progress {
      background: var(--media-range-bar-color, var(--media-primary-color, rgb(238 238 238)));
      transition: var(--media-range-track-transition);
    }

    #pointer {
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    @media (hover: hover) {
      :host(:hover) #pointer {
        transition: visibility .5s, opacity .5s;
        visibility: visible;
        opacity: 1;
      }
    }

    #thumb,
    ::slotted([slot=thumb]) {
      width: var(--media-range-thumb-width, 10px);
      height: var(--media-range-thumb-height, 10px);
      transition: var(--media-range-thumb-transition);
      transform: var(--media-range-thumb-transform, none);
      opacity: var(--media-range-thumb-opacity, 1);
      translate: -50%;
      position: absolute;
      left: 0;
      cursor: var(--media-cursor, pointer);
    }

    #thumb {
      border-radius: var(--media-range-thumb-border-radius, 10px);
      background: var(--media-range-thumb-background, var(--media-primary-color, rgb(238 238 238)));
      box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
      border: var(--media-range-thumb-border, none);
    }

    :host([disabled]) #thumb {
      background-color: #777;
    }

    .segments #appearance {
      height: var(--media-range-segment-hover-height, 7px);
    }

    #track {
      clip-path: url(#segments-clipping);
    }

    #segments {
      --segments-gap: var(--media-range-segments-gap, 2px);
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #segments-clipping {
      transform: translateX(calc(var(--segments-gap) / 2));
    }

    #segments-clipping:empty {
      display: none;
    }

    #segments-clipping rect {
      height: var(--media-range-track-height, 4px);
      y: calc((var(--media-range-segment-hover-height, 7px) - var(--media-range-track-height, 4px)) / 2);
      transition: var(--media-range-segment-transition, transform .1s ease-in-out);
      transform: var(--media-range-segment-transform, scaleY(1));
      transform-origin: center;
    }
  </style>
  <div id="leftgap"></div>
  <div id="container">
    <div id="startpoint"></div>
    <div id="endpoint"></div>
    <div id="appearance">
      <div id="track" part="track">
        <div id="pointer"></div>
        <div id="progress" part="progress"></div>
      </div>
      <slot name="thumb">
        <div id="thumb" part="thumb"></div>
      </slot>
      <svg id="segments"><clipPath id="segments-clipping"></clipPath></svg>
    </div>
    <input id="range" type="range" min="0" max="1" step="any" value="0">
  </div>
  <div id="rightgap"></div>
`;class hC extends dv.HTMLElement{constructor(){super(),hI(this,pY),hI(this,pj),hI(this,pX),hI(this,pZ),hI(this,p0),hI(this,p2),hI(this,p4),hI(this,p8),hI(this,pU,void 0),hI(this,pF,void 0),hI(this,pB,void 0),hI(this,p$,void 0),hI(this,pG,{}),hI(this,pH,[]),hI(this,pV,()=>{if(this.range.matches(":focus-visible")){let{style:e}=dO(this.shadowRoot,":host");e.setProperty("--_focus-visible-box-shadow","var(--_focus-box-shadow)")}}),hI(this,pK,()=>{let{style:e}=dO(this.shadowRoot,":host");e.removeProperty("--_focus-visible-box-shadow")}),hI(this,pW,()=>{let e=this.shadowRoot.querySelector("#segments-clipping");e&&e.parentNode.append(e)}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(hD.content.cloneNode(!0))),this.container=this.shadowRoot.querySelector("#container"),hL(this,pB,this.shadowRoot.querySelector("#startpoint")),hL(this,p$,this.shadowRoot.querySelector("#endpoint")),this.range=this.shadowRoot.querySelector("#range"),this.appearance=this.shadowRoot.querySelector("#appearance")}static get observedAttributes(){return["disabled","aria-disabled",lW.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===lW.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=hR(this,pU))?void 0:r.unassociateElement)||a.call(r,this),hL(this,pU,null)),i&&this.isConnected&&(hL(this,pU,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=hR(this,pU))?void 0:n.associateElement)||o.call(n,this))):("disabled"===e||"aria-disabled"===e&&t!==i)&&(null==i?(this.range.removeAttribute(e),hw(this,pj,pz).call(this)):(this.range.setAttribute(e,i),hw(this,pX,pQ).call(this)))}connectedCallback(){var e,t,i;let{style:r}=dO(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`),hR(this,pG).pointer=dO(this.shadowRoot,"#pointer"),hR(this,pG).progress=dO(this.shadowRoot,"#progress"),hR(this,pG).thumb=dO(this.shadowRoot,'#thumb, ::slotted([slot="thumb"])'),hR(this,pG).activeSegment=dO(this.shadowRoot,"#segments-clipping rect:nth-child(0)");let a=this.getAttribute(lW.MEDIA_CONTROLLER);a&&(hL(this,pU,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=hR(this,pU))?void 0:t.associateElement)||i.call(t,this)),this.updateBar(),this.shadowRoot.addEventListener("focusin",hR(this,pV)),this.shadowRoot.addEventListener("focusout",hR(this,pK)),hw(this,pj,pz).call(this),d_(this.container,hR(this,pW))}disconnectedCallback(){var e,t;hw(this,pX,pQ).call(this),null==(t=null==(e=hR(this,pU))?void 0:e.unassociateElement)||t.call(e,this),hL(this,pU,null),this.shadowRoot.removeEventListener("focusin",hR(this,pV)),this.shadowRoot.removeEventListener("focusout",hR(this,pK)),dA(this.container,hR(this,pW))}updatePointerBar(e){var t;null==(t=hR(this,pG).pointer)||t.style.setProperty("width",`${100*this.getPointerRatio(e)}%`)}updateBar(){var e,t;let i=100*this.range.valueAsNumber;null==(e=hR(this,pG).progress)||e.style.setProperty("width",`${i}%`),null==(t=hR(this,pG).thumb)||t.style.setProperty("left",`${i}%`)}updateSegments(e){let t=this.shadowRoot.querySelector("#segments-clipping");if(t.textContent="",this.container.classList.toggle("segments",!!(null==e?void 0:e.length)),!(null==e?void 0:e.length))return;let i=[...new Set([+this.range.min,...e.flatMap(e=>[e.start,e.end]),+this.range.max])];hL(this,pH,[...i]);let r=i.pop();for(let[e,a]of i.entries()){let[s,n]=[0===e,e===i.length-1],o=s?"calc(var(--segments-gap) / -1)":`${100*a}%`,l=n?r:i[e+1],d=`calc(${(l-a)*100}%${s||n?"":" - var(--segments-gap)"})`,u=dE.createElementNS("http://www.w3.org/2000/svg","rect"),h=dO(this.shadowRoot,`#segments-clipping rect:nth-child(${e+1})`);h.style.setProperty("x",o),h.style.setProperty("width",d),t.append(u)}}getPointerRatio(e){return function(e,t,i,r){let a=r.x-i.x,s=r.y-i.y,n=a*a+s*s;return 0===n?0:Math.max(0,Math.min(1,((e-i.x)*a+(t-i.y)*s)/n))}(e.clientX,e.clientY,hR(this,pB).getBoundingClientRect(),hR(this,p$).getBoundingClientRect())}get dragging(){return this.hasAttribute("dragging")}handleEvent(e){switch(e.type){case"pointermove":hw(this,p8,p9).call(this,e);break;case"input":this.updateBar();break;case"pointerenter":hw(this,p0,p1).call(this,e);break;case"pointerdown":hw(this,pZ,pJ).call(this,e);break;case"pointerup":hw(this,p2,p3).call(this);break;case"pointerleave":hw(this,p4,p5).call(this)}}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}pU=new WeakMap,pF=new WeakMap,pB=new WeakMap,p$=new WeakMap,pG=new WeakMap,pH=new WeakMap,pV=new WeakMap,pK=new WeakMap,pW=new WeakMap,pY=new WeakSet,pq=function(e){let t=hR(this,pG).activeSegment;if(!t)return;let i=this.getPointerRatio(e),r=hR(this,pH).findIndex((e,t,r)=>{let a=r[t+1];return null!=a&&i>=e&&i<=a}),a=`#segments-clipping rect:nth-child(${r+1})`;t.selectorText==a&&t.style.transform||(t.selectorText=a,t.style.setProperty("transform","var(--media-range-segment-hover-transform, scaleY(2))"))},pj=new WeakSet,pz=function(){this.hasAttribute("disabled")||(this.addEventListener("input",this),this.addEventListener("pointerdown",this),this.addEventListener("pointerenter",this))},pX=new WeakSet,pQ=function(){var e,t;this.removeEventListener("input",this),this.removeEventListener("pointerdown",this),this.removeEventListener("pointerenter",this),null==(e=dv.window)||e.removeEventListener("pointerup",this),null==(t=dv.window)||t.removeEventListener("pointermove",this)},pZ=new WeakSet,pJ=function(e){var t;hL(this,pF,e.composedPath().includes(this.range)),null==(t=dv.window)||t.addEventListener("pointerup",this)},p0=new WeakSet,p1=function(e){var t;"mouse"!==e.pointerType&&hw(this,pZ,pJ).call(this,e),this.addEventListener("pointerleave",this),null==(t=dv.window)||t.addEventListener("pointermove",this)},p2=new WeakSet,p3=function(){var e;null==(e=dv.window)||e.removeEventListener("pointerup",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled")},p4=new WeakSet,p5=function(){var e,t;this.removeEventListener("pointerleave",this),null==(e=dv.window)||e.removeEventListener("pointermove",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled"),null==(t=hR(this,pG).activeSegment)||t.style.removeProperty("transform")},p8=new WeakSet,p9=function(e){this.toggleAttribute("dragging",1===e.buttons||"mouse"!==e.pointerType),this.updatePointerBar(e),hw(this,pY,pq).call(this,e),this.dragging&&("mouse"!==e.pointerType||!hR(this,pF))&&(this.range.disabled=!0,this.range.valueAsNumber=this.getPointerRatio(e),this.range.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})))},dv.customElements.get("media-chrome-range")||dv.customElements.define("media-chrome-range",hC);var hx=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hM=(e,t,i)=>(hx(e,t,"read from private field"),i?i.call(e):t.get(e)),hO=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},hN=(e,t,i,r)=>(hx(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let hP=dE.createElement("template");hP.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-control-bar-display, inline-flex));
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      --media-loading-indicator-icon-height: 44px;
    }

    ::slotted(media-time-range),
    ::slotted(media-volume-range) {
      min-height: 100%;
    }

    ::slotted(media-time-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }

    ::slotted([role="menu"]) {
      position: absolute;
    }
  </style>

  <slot></slot>
`;class hU extends dv.HTMLElement{constructor(){super(),hO(this,p6,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(hP.content.cloneNode(!0)))}static get observedAttributes(){return[lW.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===lW.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=hM(this,p6))?void 0:r.unassociateElement)||a.call(r,this),hN(this,p6,null)),i&&this.isConnected&&(hN(this,p6,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=hM(this,p6))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(lW.MEDIA_CONTROLLER);r&&(hN(this,p6,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=hM(this,p6))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=hM(this,p6))?void 0:e.unassociateElement)||t.call(e,this),hN(this,p6,null)}}p6=new WeakMap,dv.customElements.get("media-control-bar")||dv.customElements.define("media-control-bar",hU);var hF=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hB=(e,t,i)=>(hF(e,t,"read from private field"),i?i.call(e):t.get(e)),h$=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},hG=(e,t,i,r)=>(hF(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let hH=dE.createElement("template");hH.innerHTML=`
  <style>
    :host {
      font: var(--media-font,
        var(--media-font-weight, normal)
        var(--media-font-size, 14px) /
        var(--media-text-content-height, var(--media-control-height, 24px))
        var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      background: var(--media-text-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7))));
      padding: var(--media-control-padding, 10px);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      text-align: center;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <slot></slot>
`;class hV extends dv.HTMLElement{constructor(){super(),h$(this,p7,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(hH.content.cloneNode(!0)))}static get observedAttributes(){return[lW.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===lW.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=hB(this,p7))?void 0:r.unassociateElement)||a.call(r,this),hG(this,p7,null)),i&&this.isConnected&&(hG(this,p7,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=hB(this,p7))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let{style:r}=dO(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`);let a=this.getAttribute(lW.MEDIA_CONTROLLER);a&&(hG(this,p7,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=hB(this,p7))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=hB(this,p7))?void 0:e.unassociateElement)||t.call(e,this),hG(this,p7,null)}}p7=new WeakMap,dv.customElements.get("media-text-display")||dv.customElements.define("media-text-display",hV);var hK=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hW=(e,t,i)=>(hK(e,t,"read from private field"),i?i.call(e):t.get(e)),hY=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},hq=(e,t,i,r)=>(hK(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);fe=new WeakMap,dv.customElements.get("media-duration-display")||dv.customElements.define("media-duration-display",class extends hV{constructor(){super(),hY(this,fe,void 0),hq(this,fe,this.shadowRoot.querySelector("slot")),hW(this,fe).textContent=dr(0)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_DURATION]}attributeChangedCallback(e,t,i){e===lj.MEDIA_DURATION&&(hW(this,fe).textContent=dr(+i)),super.attributeChangedCallback(e,t,i)}get mediaDuration(){return dP(this,lj.MEDIA_DURATION)}set mediaDuration(e){dU(this,lj.MEDIA_DURATION,e)}});let hj={2:dd("Network Error"),3:dd("Decode Error"),4:dd("Source Not Supported"),5:dd("Encryption Error")},hz={2:dd("A network error caused the media download to fail."),3:dd("A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format."),4:dd("An unsupported error occurred. The server or network failed, or your browser does not support this format."),5:dd("The media is encrypted and there are no keys to decrypt it.")},hX=e=>{var t,i;return 1===e.code?null:{title:null!=(t=hj[e.code])?t:`Error ${e.code}`,message:null!=(i=hz[e.code])?i:e.message}};var hQ=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},hZ=(e,t,i)=>(hQ(e,t,"read from private field"),i?i.call(e):t.get(e)),hJ=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},h0=(e,t,i,r)=>(hQ(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);function h1(e){var t;let{title:i,message:r}=null!=(t=hX(e))?t:{},a="";return i&&(a+=`<slot name="error-${e.code}-title"><h3>${i}</h3></slot>`),r&&(a+=`<slot name="error-${e.code}-message"><p>${r}</p></slot>`),a}let h2=[lj.MEDIA_ERROR_CODE,lj.MEDIA_ERROR_MESSAGE];class h3 extends hS{constructor(){super(...arguments),hJ(this,ft,null)}static get observedAttributes(){return[...super.observedAttributes,...h2]}formatErrorMessage(e){return this.constructor.formatErrorMessage(e)}attributeChangedCallback(e,t,i){var r;if(super.attributeChangedCallback(e,t,i),!h2.includes(e))return;let a=null!=(r=this.mediaError)?r:{code:this.mediaErrorCode,message:this.mediaErrorMessage};this.open=a.code&&null!==hX(a),this.open&&(this.shadowRoot.querySelector("slot").name=`error-${this.mediaErrorCode}`,this.shadowRoot.querySelector("#content").innerHTML=this.formatErrorMessage(a))}get mediaError(){return hZ(this,ft)}set mediaError(e){h0(this,ft,e)}get mediaErrorCode(){return dP(this,"mediaerrorcode")}set mediaErrorCode(e){dU(this,"mediaerrorcode",e)}get mediaErrorMessage(){return d$(this,"mediaerrormessage")}set mediaErrorMessage(e){dG(this,"mediaerrormessage",e)}}ft=new WeakMap,h3.getSlotTemplateHTML=function(e){return`
    <style>
      :host {
        background: rgb(20 20 30 / .8);
      }

      #content {
        display: block;
        padding: 1.2em 1.5em;
      }

      h3,
      p {
        margin-block: 0 .3em;
      }
    </style>
    <slot name="error-${e.mediaerrorcode}" id="content">
      ${h1({code:+e.mediaerrorcode,message:e.mediaerrormessage})}
    </slot>
  `},h3.formatErrorMessage=h1,dv.customElements.get("media-error-dialog")||dv.customElements.define("media-error-dialog",h3);let h4=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,h5=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,h8=dE.createElement("template");h8.innerHTML=`
  <style>
    :host([${lj.MEDIA_IS_FULLSCREEN}]) slot[name=icon] slot:not([name=exit]) {
      display: none !important;
    }

    
    :host(:not([${lj.MEDIA_IS_FULLSCREEN}])) slot[name=icon] slot:not([name=enter]) {
      display: none !important;
    }

    :host([${lj.MEDIA_IS_FULLSCREEN}]) slot[name=tooltip-enter],
    :host(:not([${lj.MEDIA_IS_FULLSCREEN}])) slot[name=tooltip-exit] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="enter">${h4}</slot>
    <slot name="exit">${h5}</slot>
  </slot>
`;let h9=`
  <slot name="tooltip-enter">${dd("Enter fullscreen mode")}</slot>
  <slot name="tooltip-exit">${dd("Exit fullscreen mode")}</slot>
`,h6=e=>{let t=e.mediaIsFullscreen?dd("exit fullscreen mode"):dd("enter fullscreen mode");e.setAttribute("aria-label",t)};dv.customElements.get("media-fullscreen-button")||dv.customElements.define("media-fullscreen-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_IS_FULLSCREEN,lj.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(e={}){super({slotTemplate:h8,tooltipContent:h9,...e})}connectedCallback(){super.connectedCallback(),h6(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_IS_FULLSCREEN&&h6(this)}get mediaFullscreenUnavailable(){return d$(this,lj.MEDIA_FULLSCREEN_UNAVAILABLE)}set mediaFullscreenUnavailable(e){dG(this,lj.MEDIA_FULLSCREEN_UNAVAILABLE,e)}get mediaIsFullscreen(){return dF(this,lj.MEDIA_IS_FULLSCREEN)}set mediaIsFullscreen(e){dB(this,lj.MEDIA_IS_FULLSCREEN,e)}handleClick(){let e=this.mediaIsFullscreen?lK.MEDIA_EXIT_FULLSCREEN_REQUEST:lK.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new dv.CustomEvent(e,{composed:!0,bubbles:!0}))}});let{MEDIA_TIME_IS_LIVE:h7,MEDIA_PAUSED:ce}=lj,{MEDIA_SEEK_TO_LIVE_REQUEST:ct,MEDIA_PLAY_REQUEST:ci}=lK,cr=dE.createElement("template");cr.innerHTML=`
  <style>
  :host { --media-tooltip-display: none; }
  
  slot[name=indicator] > *,
  :host ::slotted([slot=indicator]) {
    
    min-width: auto;
    fill: var(--media-live-button-icon-color, rgb(140, 140, 140));
    color: var(--media-live-button-icon-color, rgb(140, 140, 140));
  }

  :host([${h7}]:not([${ce}])) slot[name=indicator] > *,
  :host([${h7}]:not([${ce}])) ::slotted([slot=indicator]) {
    fill: var(--media-live-button-indicator-color, rgb(255, 0, 0));
    color: var(--media-live-button-indicator-color, rgb(255, 0, 0));
  }

  :host([${h7}]:not([${ce}])) {
    cursor: var(--media-cursor, not-allowed);
  }

  slot[name=text]{
    text-transform: uppercase;
  }

  </style>

  <slot name="indicator"><svg viewBox="0 0 6 12"><circle cx="3" cy="6" r="2"></circle></svg></slot>
  
  <slot name="spacer">&nbsp;</slot><slot name="text">${dd("live")}</slot>
`;let ca=e=>{let t=e.mediaPaused||!e.mediaTimeIsLive,i=t?dd("seek to live"):dd("playing live");e.setAttribute("aria-label",i),t?e.removeAttribute("aria-disabled"):e.setAttribute("aria-disabled","true")};dv.customElements.get("media-live-button")||dv.customElements.define("media-live-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,ce,h7]}constructor(e={}){super({slotTemplate:cr,...e})}connectedCallback(){ca(this),super.connectedCallback()}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),ca(this)}get mediaPaused(){return dF(this,lj.MEDIA_PAUSED)}set mediaPaused(e){dB(this,lj.MEDIA_PAUSED,e)}get mediaTimeIsLive(){return dF(this,lj.MEDIA_TIME_IS_LIVE)}set mediaTimeIsLive(e){dB(this,lj.MEDIA_TIME_IS_LIVE,e)}handleClick(){(this.mediaPaused||!this.mediaTimeIsLive)&&(this.dispatchEvent(new dv.CustomEvent(ct,{composed:!0,bubbles:!0})),this.hasAttribute(ce)&&this.dispatchEvent(new dv.CustomEvent(ci,{composed:!0,bubbles:!0})))}});var cs=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cn=(e,t,i)=>(cs(e,t,"read from private field"),i?i.call(e):t.get(e)),co=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cl=(e,t,i,r)=>(cs(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let cd="loadingdelay",cu="noautohide",ch=dE.createElement("template"),cc=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;ch.innerHTML=`
<style>
:host {
  display: var(--media-control-display, var(--media-loading-indicator-display, inline-block));
  vertical-align: middle;
  box-sizing: border-box;
  --_loading-indicator-delay: var(--media-loading-indicator-transition-delay, 500ms);
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=icon] > *,
:host ::slotted([slot=icon]) {
  opacity: var(--media-loading-indicator-opacity, 0);
  transition: opacity 0.15s;
}

:host([${lj.MEDIA_LOADING}]:not([${lj.MEDIA_PAUSED}])) slot[name=icon] > *,
:host([${lj.MEDIA_LOADING}]:not([${lj.MEDIA_PAUSED}])) ::slotted([slot=icon]) {
  opacity: var(--media-loading-indicator-opacity, 1);
  transition: opacity 0.15s var(--_loading-indicator-delay);
}

:host #status {
  visibility: var(--media-loading-indicator-opacity, hidden);
  transition: visibility 0.15s;
}

:host([${lj.MEDIA_LOADING}]:not([${lj.MEDIA_PAUSED}])) #status {
  visibility: var(--media-loading-indicator-opacity, visible);
  transition: visibility 0.15s var(--_loading-indicator-delay);
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-indicator-icon-width);
  height: var(--media-loading-indicator-icon-height, 100px);
  fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
  vertical-align: middle;
}
</style>

<slot name="icon">${cc}</slot>
<div id="status" role="status" aria-live="polite">${dd("media loading")}</div>
`;class cm extends dv.HTMLElement{constructor(){if(super(),co(this,fi,void 0),co(this,fr,500),!this.shadowRoot){let e=this.attachShadow({mode:"open"}),t=ch.content.cloneNode(!0);e.appendChild(t)}}static get observedAttributes(){return[lW.MEDIA_CONTROLLER,lj.MEDIA_PAUSED,lj.MEDIA_LOADING,cd]}attributeChangedCallback(e,t,i){var r,a,s,n,o;e===cd&&t!==i?this.loadingDelay=Number(i):e===lW.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=cn(this,fi))?void 0:r.unassociateElement)||a.call(r,this),cl(this,fi,null)),i&&this.isConnected&&(cl(this,fi,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=cn(this,fi))?void 0:n.associateElement)||o.call(n,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(lW.MEDIA_CONTROLLER);r&&(cl(this,fi,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=cn(this,fi))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=cn(this,fi))?void 0:e.unassociateElement)||t.call(e,this),cl(this,fi,null)}get loadingDelay(){return cn(this,fr)}set loadingDelay(e){cl(this,fr,e);let{style:t}=dO(this.shadowRoot,":host");t.setProperty("--_loading-indicator-delay",`var(--media-loading-indicator-transition-delay, ${e}ms)`)}get mediaPaused(){return dF(this,lj.MEDIA_PAUSED)}set mediaPaused(e){dB(this,lj.MEDIA_PAUSED,e)}get mediaLoading(){return dF(this,lj.MEDIA_LOADING)}set mediaLoading(e){dB(this,lj.MEDIA_LOADING,e)}get mediaController(){return d$(this,lW.MEDIA_CONTROLLER)}set mediaController(e){dG(this,lW.MEDIA_CONTROLLER,e)}get noAutohide(){return dF(this,cu)}set noAutohide(e){dB(this,cu,e)}}fi=new WeakMap,fr=new WeakMap,dv.customElements.get("media-loading-indicator")||dv.customElements.define("media-loading-indicator",cm);let{MEDIA_VOLUME_LEVEL:cp}=lj,cf=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,cg=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,cv=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,cE=dE.createElement("template");cE.innerHTML=`
  <style>
  
  :host(:not([${cp}])) slot[name=icon] slot:not([name=high]), 
  :host([${cp}=high]) slot[name=icon] slot:not([name=high]) {
    display: none !important;
  }

  :host([${cp}=off]) slot[name=icon] slot:not([name=off]) {
    display: none !important;
  }

  :host([${cp}=low]) slot[name=icon] slot:not([name=low]) {
    display: none !important;
  }

  :host([${cp}=medium]) slot[name=icon] slot:not([name=medium]) {
    display: none !important;
  }

  :host(:not([${cp}=off])) slot[name=tooltip-unmute],
  :host([${cp}=off]) slot[name=tooltip-mute] {
    display: none;
  }
  </style>

  <slot name="icon">
    <slot name="off">${cf}</slot>
    <slot name="low">${cg}</slot>
    <slot name="medium">${cg}</slot>
    <slot name="high">${cv}</slot>
  </slot>
`;let cb=`
  <slot name="tooltip-mute">${dd("Mute")}</slot>
  <slot name="tooltip-unmute">${dd("Unmute")}</slot>
`,cy=e=>{let t="off"===e.mediaVolumeLevel?dd("unmute"):dd("mute");e.setAttribute("aria-label",t)};dv.customElements.get("media-mute-button")||dv.customElements.define("media-mute-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_VOLUME_LEVEL]}constructor(e={}){super({slotTemplate:cE,tooltipContent:cb,...e})}connectedCallback(){cy(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===lj.MEDIA_VOLUME_LEVEL&&cy(this),super.attributeChangedCallback(e,t,i)}get mediaVolumeLevel(){return d$(this,lj.MEDIA_VOLUME_LEVEL)}set mediaVolumeLevel(e){dG(this,lj.MEDIA_VOLUME_LEVEL,e)}handleClick(){let e="off"===this.mediaVolumeLevel?lK.MEDIA_UNMUTE_REQUEST:lK.MEDIA_MUTE_REQUEST;this.dispatchEvent(new dv.CustomEvent(e,{composed:!0,bubbles:!0}))}});let cT=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,c_=dE.createElement("template");c_.innerHTML=`
  <style>
  :host([${lj.MEDIA_IS_PIP}]) slot[name=icon] slot:not([name=exit]) {
    display: none !important;
  }

  
  :host(:not([${lj.MEDIA_IS_PIP}])) slot[name=icon] slot:not([name=enter]) {
    display: none !important;
  }

  :host([${lj.MEDIA_IS_PIP}]) slot[name=tooltip-enter],
  :host(:not([${lj.MEDIA_IS_PIP}])) slot[name=tooltip-exit] {
    display: none;
  }
  </style>

  <slot name="icon">
    <slot name="enter">${cT}</slot>
    <slot name="exit">${cT}</slot>
  </slot>
`;let cA=`
  <slot name="tooltip-enter">${dd("Enter picture in picture mode")}</slot>
  <slot name="tooltip-exit">${dd("Exit picture in picture mode")}</slot>
`,cS=e=>{let t=e.mediaIsPip?dd("exit picture in picture mode"):dd("enter picture in picture mode");e.setAttribute("aria-label",t)};dv.customElements.get("media-pip-button")||dv.customElements.define("media-pip-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_IS_PIP,lj.MEDIA_PIP_UNAVAILABLE]}constructor(e={}){super({slotTemplate:c_,tooltipContent:cA,...e})}connectedCallback(){cS(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===lj.MEDIA_IS_PIP&&cS(this),super.attributeChangedCallback(e,t,i)}get mediaPipUnavailable(){return d$(this,lj.MEDIA_PIP_UNAVAILABLE)}set mediaPipUnavailable(e){dG(this,lj.MEDIA_PIP_UNAVAILABLE,e)}get mediaIsPip(){return dF(this,lj.MEDIA_IS_PIP)}set mediaIsPip(e){dB(this,lj.MEDIA_IS_PIP,e)}handleClick(){let e=this.mediaIsPip?lK.MEDIA_EXIT_PIP_REQUEST:lK.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new dv.CustomEvent(e,{composed:!0,bubbles:!0}))}});var ck=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cR=(e,t,i)=>(ck(e,t,"read from private field"),i?i.call(e):t.get(e)),cI=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)};let cL="rates",cw=[1,1.2,1.5,1.7,2],cD=dE.createElement("template");cD.innerHTML=`
  <style>
    :host {
      min-width: 5ch;
      padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));
    }
  </style>
  <slot name="icon"></slot>
`,fa=new WeakMap,dv.customElements.get("media-playback-rate-button")||dv.customElements.define("media-playback-rate-button",class extends hr{constructor(e={}){super({slotTemplate:cD,tooltipContent:dd("Playback rate"),...e}),cI(this,fa,new d6(this,cL,{defaultValue:cw})),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML="1x"}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PLAYBACK_RATE,cL]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===cL&&(cR(this,fa).value=i),e===lj.MEDIA_PLAYBACK_RATE){let e=i?+i:Number.NaN,t=Number.isNaN(e)?1:e;this.container.innerHTML=`${t}x`,this.setAttribute("aria-label",dd("Playback rate {playbackRate}",{playbackRate:t}))}}get rates(){return cR(this,fa)}set rates(e){e?Array.isArray(e)&&(cR(this,fa).value=e.join(" ")):cR(this,fa).value=""}get mediaPlaybackRate(){return dP(this,lj.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){dU(this,lj.MEDIA_PLAYBACK_RATE,e)}handleClick(){var e,t;let i=Array.from(this.rates.values(),e=>+e).sort((e,t)=>e-t),r=null!=(t=null!=(e=i.find(e=>e>this.mediaPlaybackRate))?e:i[0])?t:1,a=new dv.CustomEvent(lK.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(a)}});let cC=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,cx=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,cM=dE.createElement("template");cM.innerHTML=`
  <style>
    :host([${lj.MEDIA_PAUSED}]) slot[name=pause],
    :host(:not([${lj.MEDIA_PAUSED}])) slot[name=play] {
      display: none !important;
    }

    :host([${lj.MEDIA_PAUSED}]) slot[name=tooltip-pause],
    :host(:not([${lj.MEDIA_PAUSED}])) slot[name=tooltip-play] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="play">${cC}</slot>
    <slot name="pause">${cx}</slot>
  </slot>
`;let cO=`
  <slot name="tooltip-play">${dd("Play")}</slot>
  <slot name="tooltip-pause">${dd("Pause")}</slot>
`,cN=e=>{let t=e.mediaPaused?dd("play"):dd("pause");e.setAttribute("aria-label",t)};dv.customElements.get("media-play-button")||dv.customElements.define("media-play-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PAUSED,lj.MEDIA_ENDED]}constructor(e={}){super({slotTemplate:cM,tooltipContent:cO,...e})}connectedCallback(){cN(this),super.connectedCallback()}attributeChangedCallback(e,t,i){e===lj.MEDIA_PAUSED&&cN(this),super.attributeChangedCallback(e,t,i)}get mediaPaused(){return dF(this,lj.MEDIA_PAUSED)}set mediaPaused(e){dB(this,lj.MEDIA_PAUSED,e)}handleClick(){let e=this.mediaPaused?lK.MEDIA_PLAY_REQUEST:lK.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new dv.CustomEvent(e,{composed:!0,bubbles:!0}))}});let cP={PLACEHOLDER_SRC:"placeholdersrc",SRC:"src"},cU=dE.createElement("template");cU.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: var(--media-poster-image-display, inline-block);
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-poster-image-background-position, var(--media-object-position, center));
      background-size: var(--media-poster-image-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }
  </style>

  <img part="poster img" aria-hidden="true" id="image"/>
`;let cF=e=>{e.style.removeProperty("background-image")},cB=(e,t)=>{e.style["background-image"]=`url('${t}')`};class c$ extends dv.HTMLElement{static get observedAttributes(){return[cP.PLACEHOLDER_SRC,cP.SRC]}constructor(){super(),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(cU.content.cloneNode(!0))),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(e,t,i){e===cP.SRC&&(null==i?this.image.removeAttribute(cP.SRC):this.image.setAttribute(cP.SRC,i)),e===cP.PLACEHOLDER_SRC&&(null==i?cF(this.image):cB(this.image,i))}get placeholderSrc(){return d$(this,cP.PLACEHOLDER_SRC)}set placeholderSrc(e){dG(this,cP.SRC,e)}get src(){return d$(this,cP.SRC)}set src(e){dG(this,cP.SRC,e)}}dv.customElements.get("media-poster-image")||dv.customElements.define("media-poster-image",c$);var cG=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cH=(e,t,i)=>(cG(e,t,"read from private field"),i?i.call(e):t.get(e)),cV=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cK=(e,t,i,r)=>(cG(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);fs=new WeakMap,dv.customElements.get("media-preview-chapter-display")||dv.customElements.define("media-preview-chapter-display",class extends hV{constructor(){super(),cV(this,fs,void 0),cK(this,fs,this.shadowRoot.querySelector("slot"))}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PREVIEW_CHAPTER]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_PREVIEW_CHAPTER&&i!==t&&null!=i&&(cH(this,fs).textContent=i,""!==i?this.setAttribute("aria-valuetext",`chapter: ${i}`):this.removeAttribute("aria-valuetext"))}get mediaPreviewChapter(){return d$(this,lj.MEDIA_PREVIEW_CHAPTER)}set mediaPreviewChapter(e){dG(this,lj.MEDIA_PREVIEW_CHAPTER,e)}});var cW=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cY=(e,t,i)=>(cW(e,t,"read from private field"),i?i.call(e):t.get(e)),cq=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cj=(e,t,i,r)=>(cW(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let cz=dE.createElement("template");cz.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-preview-thumbnail-display, inline-block));
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async">
`;class cX extends dv.HTMLElement{constructor(){super(),cq(this,fn,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(cz.content.cloneNode(!0)))}static get observedAttributes(){return[lW.MEDIA_CONTROLLER,lj.MEDIA_PREVIEW_IMAGE,lj.MEDIA_PREVIEW_COORDS]}connectedCallback(){var e,t,i;let r=this.getAttribute(lW.MEDIA_CONTROLLER);r&&(cj(this,fn,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=cY(this,fn))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=cY(this,fn))?void 0:e.unassociateElement)||t.call(e,this),cj(this,fn,null)}attributeChangedCallback(e,t,i){var r,a,s,n,o;[lj.MEDIA_PREVIEW_IMAGE,lj.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===lW.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=cY(this,fn))?void 0:r.unassociateElement)||a.call(r,this),cj(this,fn,null)),i&&this.isConnected&&(cj(this,fn,null==(s=this.getRootNode())?void 0:s.getElementById(i)),null==(o=null==(n=cY(this,fn))?void 0:n.associateElement)||o.call(n,this)))}get mediaPreviewImage(){return d$(this,lj.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){dG(this,lj.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewCoords(){let e=this.getAttribute(lj.MEDIA_PREVIEW_COORDS);if(e)return e.split(/\s+/).map(e=>+e)}set mediaPreviewCoords(e){if(!e){this.removeAttribute(lj.MEDIA_PREVIEW_COORDS);return}this.setAttribute(lj.MEDIA_PREVIEW_COORDS,e.join(" "))}update(){let e=this.mediaPreviewCoords,t=this.mediaPreviewImage;if(!(e&&t))return;let[i,r,a,s]=e,n=t.split("#")[0],{maxWidth:o,maxHeight:l,minWidth:d,minHeight:u}=getComputedStyle(this),h=Math.min(parseInt(o)/a,parseInt(l)/s),c=Math.max(parseInt(d)/a,parseInt(u)/s),m=h<1,p=m?h:c>1?c:1,{style:f}=dO(this.shadowRoot,":host"),g=dO(this.shadowRoot,"img").style,E=this.shadowRoot.querySelector("img"),b=m?"min":"max";f.setProperty(`${b}-width`,"initial","important"),f.setProperty(`${b}-height`,"initial","important"),f.width=`${a*p}px`,f.height=`${s*p}px`;let y=()=>{g.width=`${this.imgWidth*p}px`,g.height=`${this.imgHeight*p}px`,g.display="block"};E.src!==n&&(E.onload=()=>{this.imgWidth=E.naturalWidth,this.imgHeight=E.naturalHeight,y()},E.src=n,y()),y(),g.transform=`translate(-${i*p}px, -${r*p}px)`}}fn=new WeakMap,dv.customElements.get("media-preview-thumbnail")||dv.customElements.define("media-preview-thumbnail",cX);var cQ=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cZ=(e,t,i)=>(cQ(e,t,"read from private field"),i?i.call(e):t.get(e)),cJ=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},c0=(e,t,i,r)=>(cQ(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);fo=new WeakMap,dv.customElements.get("media-preview-time-display")||dv.customElements.define("media-preview-time-display",class extends hV{constructor(){super(),cJ(this,fo,void 0),c0(this,fo,this.shadowRoot.querySelector("slot")),cZ(this,fo).textContent=dr(0)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_PREVIEW_TIME&&null!=i&&(cZ(this,fo).textContent=dr(parseFloat(i)))}get mediaPreviewTime(){return dP(this,lj.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){dU(this,lj.MEDIA_PREVIEW_TIME,e)}});let c1={SEEK_OFFSET:"seekoffset"},c2=dE.createElement("template");c2.innerHTML=`
  <slot name="icon"><svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">30</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg></slot>
`,dv.customElements.get("media-seek-backward-button")||dv.customElements.define("media-seek-backward-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_CURRENT_TIME,c1.SEEK_OFFSET]}constructor(e={}){super({slotTemplate:c2,tooltipContent:dd("Seek backward"),...e})}connectedCallback(){this.seekOffset=dP(this,c1.SEEK_OFFSET,30),super.connectedCallback()}attributeChangedCallback(e,t,i){e===c1.SEEK_OFFSET&&(this.seekOffset=dP(this,c1.SEEK_OFFSET,30)),super.attributeChangedCallback(e,t,i)}get seekOffset(){return dP(this,c1.SEEK_OFFSET,30)}set seekOffset(e){dU(this,c1.SEEK_OFFSET,e),this.setAttribute("aria-label",dd("seek back {seekOffset} seconds",{seekOffset:this.seekOffset})),dR(dL(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return dP(this,lj.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){dU(this,lj.MEDIA_CURRENT_TIME,e)}handleClick(){let e=Math.max(this.mediaCurrentTime-this.seekOffset,0),t=new dv.CustomEvent(lK.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}});let c3={SEEK_OFFSET:"seekoffset"},c4=dE.createElement("template");c4.innerHTML=`
  <slot name="icon"><svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">30</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg></slot>
`,dv.customElements.get("media-seek-forward-button")||dv.customElements.define("media-seek-forward-button",class extends hr{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_CURRENT_TIME,c3.SEEK_OFFSET]}constructor(e={}){super({slotTemplate:c4,tooltipContent:dd("Seek forward"),...e})}connectedCallback(){this.seekOffset=dP(this,c3.SEEK_OFFSET,30),super.connectedCallback()}attributeChangedCallback(e,t,i){e===c3.SEEK_OFFSET&&(this.seekOffset=dP(this,c3.SEEK_OFFSET,30)),super.attributeChangedCallback(e,t,i)}get seekOffset(){return dP(this,c3.SEEK_OFFSET,30)}set seekOffset(e){dU(this,c3.SEEK_OFFSET,e),this.setAttribute("aria-label",dd("seek forward {seekOffset} seconds",{seekOffset:this.seekOffset})),dR(dL(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return dP(this,lj.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){dU(this,lj.MEDIA_CURRENT_TIME,e)}handleClick(){let e=this.mediaCurrentTime+this.seekOffset,t=new dv.CustomEvent(lK.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}});var c5=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},c8=(e,t,i)=>(c5(e,t,"read from private field"),i?i.call(e):t.get(e)),c9=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},c6=(e,t,i,r)=>(c5(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let c7={REMAINING:"remaining",SHOW_DURATION:"showduration",NO_TOGGLE:"notoggle"},me=[...Object.values(c7),lj.MEDIA_CURRENT_TIME,lj.MEDIA_DURATION,lj.MEDIA_SEEKABLE],mt=["Enter"," "],mi="&nbsp;/&nbsp;",mr=(e,{timesSep:t=mi}={})=>{var i,r;let a=e.hasAttribute(c7.REMAINING),s=e.hasAttribute(c7.SHOW_DURATION),n=null!=(i=e.mediaCurrentTime)?i:0,[,o]=null!=(r=e.mediaSeekable)?r:[],l=0;Number.isFinite(e.mediaDuration)?l=e.mediaDuration:Number.isFinite(o)&&(l=o);let d=a?dr(0-(l-n)):dr(n);return s?`${d}${t}${dr(l)}`:d},ma=e=>{var t;let i=e.mediaCurrentTime,[,r]=null!=(t=e.mediaSeekable)?t:[],a=null;if(Number.isFinite(e.mediaDuration)?a=e.mediaDuration:Number.isFinite(r)&&(a=r),null==i||null===a){e.setAttribute("aria-valuetext","video not loaded, unknown time.");return}let s=e.hasAttribute(c7.REMAINING),n=e.hasAttribute(c7.SHOW_DURATION),o=s?di(0-(a-i)):di(i);if(!n){e.setAttribute("aria-valuetext",o);return}let l=di(a),d=`${o} of ${l}`;e.setAttribute("aria-valuetext",d)};fl=new WeakMap,dv.customElements.get("media-time-display")||dv.customElements.define("media-time-display",class extends hV{constructor(){super(),c9(this,fl,void 0),c6(this,fl,this.shadowRoot.querySelector("slot")),c8(this,fl).innerHTML=`${mr(this)}`}static get observedAttributes(){return[...super.observedAttributes,...me,"disabled"]}connectedCallback(){let{style:e}=dO(this.shadowRoot,":host(:hover:not([notoggle]))");e.setProperty("cursor","var(--media-cursor, pointer)"),e.setProperty("background","var(--media-control-hover-background, rgba(50 50 70 / .7))"),this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",dd("playback time"));let t=e=>{let{key:i}=e;if(!mt.includes(i)){this.removeEventListener("keyup",t);return}this.toggleTimeDisplay()};this.addEventListener("keydown",e=>{let{metaKey:i,altKey:r,key:a}=e;if(i||r||!mt.includes(a)){this.removeEventListener("keyup",t);return}this.addEventListener("keyup",t)}),this.addEventListener("click",this.toggleTimeDisplay),super.connectedCallback()}toggleTimeDisplay(){!this.noToggle&&(this.hasAttribute("remaining")?this.removeAttribute("remaining"):this.setAttribute("remaining",""))}disconnectedCallback(){this.disable(),super.disconnectedCallback()}attributeChangedCallback(e,t,i){me.includes(e)?this.update():"disabled"===e&&i!==t&&(null==i?this.enable():this.disable()),super.attributeChangedCallback(e,t,i)}enable(){this.tabIndex=0}disable(){this.tabIndex=-1}get remaining(){return dF(this,c7.REMAINING)}set remaining(e){dB(this,c7.REMAINING,e)}get showDuration(){return dF(this,c7.SHOW_DURATION)}set showDuration(e){dB(this,c7.SHOW_DURATION,e)}get noToggle(){return dF(this,c7.NO_TOGGLE)}set noToggle(e){dB(this,c7.NO_TOGGLE,e)}get mediaDuration(){return dP(this,lj.MEDIA_DURATION)}set mediaDuration(e){dU(this,lj.MEDIA_DURATION,e)}get mediaCurrentTime(){return dP(this,lj.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){dU(this,lj.MEDIA_CURRENT_TIME,e)}get mediaSeekable(){let e=this.getAttribute(lj.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e){this.removeAttribute(lj.MEDIA_SEEKABLE);return}this.setAttribute(lj.MEDIA_SEEKABLE,e.join(":"))}update(){let e=mr(this);ma(this),e!==c8(this,fl).innerHTML&&(c8(this,fl).innerHTML=e)}});var ms=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},mn=(e,t,i)=>(ms(e,t,"read from private field"),i?i.call(e):t.get(e)),mo=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},ml=(e,t,i,r)=>(ms(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),md=(e,t,i,r)=>({set _(value){ml(e,t,value,i)},get _(){return mn(e,t,r)}});class mu{constructor(e,t,i){mo(this,fd,void 0),mo(this,fu,void 0),mo(this,fh,void 0),mo(this,fc,void 0),mo(this,fm,void 0),mo(this,fp,void 0),mo(this,ff,void 0),mo(this,fg,void 0),mo(this,fv,0),mo(this,fE,(e=performance.now())=>{ml(this,fv,requestAnimationFrame(mn(this,fE))),ml(this,fc,performance.now()-mn(this,fh));let t=1e3/this.fps;if(mn(this,fc)>t){ml(this,fh,e-mn(this,fc)%t);let i=1e3/((e-mn(this,fu))/++md(this,fm)._),r=(e-mn(this,fp))/1e3/this.duration,a=mn(this,ff)+r*this.playbackRate;a-mn(this,fd).valueAsNumber>0?ml(this,fg,this.playbackRate/this.duration/i):(ml(this,fg,.995*mn(this,fg)),a=mn(this,fd).valueAsNumber+mn(this,fg)),this.callback(a)}}),ml(this,fd,e),this.callback=t,this.fps=i}start(){0===mn(this,fv)&&(ml(this,fh,performance.now()),ml(this,fu,mn(this,fh)),ml(this,fm,0),mn(this,fE).call(this))}stop(){0!==mn(this,fv)&&(cancelAnimationFrame(mn(this,fv)),ml(this,fv,0))}update({start:e,duration:t,playbackRate:i}){let r=e-mn(this,fd).valueAsNumber,a=Math.abs(t-this.duration);(r>0||r<-.03||a>=.5)&&this.callback(e),ml(this,ff,e),ml(this,fp,performance.now()),this.duration=t,this.playbackRate=i}}fd=new WeakMap,fu=new WeakMap,fh=new WeakMap,fc=new WeakMap,fm=new WeakMap,fp=new WeakMap,ff=new WeakMap,fg=new WeakMap,fv=new WeakMap,fE=new WeakMap;var mh=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},mc=(e,t,i)=>(mh(e,t,"read from private field"),i?i.call(e):t.get(e)),mm=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},mp=(e,t,i,r)=>(mh(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),mf=(e,t,i)=>(mh(e,t,"access private method"),i);let mg=e=>{let t=e.range,i=di(+mb(e)),r=di(+e.mediaSeekableEnd),a=i&&r?`${i} of ${r}`:"video not loaded, unknown time.";t.setAttribute("aria-valuetext",a)},mv=dE.createElement("template");mv.innerHTML=`
  <style>
    :host {
      --media-box-border-radius: 4px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
      --media-preview-border-radius: var(--media-box-border-radius);
      --media-box-arrow-offset: var(--media-box-border-radius);
      --_control-background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
      --_preview-background: var(--media-preview-background, var(--_control-background));

      
      contain: layout;
    }

    #buffered {
      background: var(--media-time-range-buffered-color, rgb(255 255 255 / .4));
      position: absolute;
      height: 100%;
      will-change: width;
    }

    #preview-rail,
    #current-rail {
      width: 100%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
      will-change: transform;
    }

    [part~="box"] {
      width: min-content;
      
      position: absolute;
      bottom: 100%;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="current-box"] {
      display: var(--media-current-box-display, var(--media-box-display, flex));
      margin: var(--media-current-box-margin, var(--media-box-margin, 0 0 5px));
      visibility: hidden;
    }

    [part~="preview-box"] {
      display: var(--media-preview-box-display, var(--media-box-display, flex));
      margin: var(--media-preview-box-margin, var(--media-box-margin, 0 0 5px));
      transition-property: var(--media-preview-transition-property, visibility, opacity);
      transition-duration: var(--media-preview-transition-duration-out, .25s);
      transition-delay: var(--media-preview-transition-delay-out, 0s);
      visibility: hidden;
      opacity: 0;
    }

    :host(:is([${lj.MEDIA_PREVIEW_IMAGE}], [${lj.MEDIA_PREVIEW_TIME}])[dragging]) [part~="preview-box"] {
      transition-duration: var(--media-preview-transition-duration-in, .5s);
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
      opacity: 1;
    }

    @media (hover: hover) {
      :host(:is([${lj.MEDIA_PREVIEW_IMAGE}], [${lj.MEDIA_PREVIEW_TIME}]):hover) [part~="preview-box"] {
        transition-duration: var(--media-preview-transition-duration-in, .5s);
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        visibility: visible;
        opacity: 1;
      }
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      
      transition: visibility 0s .25s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-thumbnail-background, var(--_preview-background));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgb(0 0 0 / .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${lj.MEDIA_PREVIEW_IMAGE}][dragging]) media-preview-thumbnail,
    :host([${lj.MEDIA_PREVIEW_IMAGE}][dragging]) ::slotted(media-preview-thumbnail) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
    }

    @media (hover: hover) {
      :host([${lj.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
      :host([${lj.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        visibility: visible;
      }

      :host([${lj.MEDIA_PREVIEW_TIME}]:hover) {
        --media-time-range-hover-display: block;
      }
    }

    media-preview-chapter-display,
    ::slotted(media-preview-chapter-display) {
      font-size: var(--media-font-size, 13px);
      line-height: 17px;
      min-width: 0;
      visibility: hidden;
      
      transition: min-width 0s, border-radius 0s, margin 0s, padding 0s, visibility 0s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-chapter-background, var(--_preview-background));
      border-radius: var(--media-preview-chapter-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-chapter-padding, 3.5px 9px);
      margin: var(--media-preview-chapter-margin, 0 0 5px);
      text-shadow: var(--media-preview-chapter-text-shadow, 0 0 4px rgb(0 0 0 / .75));
    }

    :host([${lj.MEDIA_PREVIEW_IMAGE}]) media-preview-chapter-display,
    :host([${lj.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-chapter-display) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      border-radius: var(--media-preview-chapter-border-radius, 0);
      padding: var(--media-preview-chapter-padding, 3.5px 9px 0);
      margin: var(--media-preview-chapter-margin, 0);
      min-width: 100%;
    }

    media-preview-chapter-display[${lj.MEDIA_PREVIEW_CHAPTER}],
    ::slotted(media-preview-chapter-display[${lj.MEDIA_PREVIEW_CHAPTER}]) {
      visibility: visible;
    }

    media-preview-chapter-display:not([aria-valuetext]),
    ::slotted(media-preview-chapter-display:not([aria-valuetext])) {
      display: none;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display),
    media-time-display,
    ::slotted(media-time-display) {
      font-size: var(--media-font-size, 13px);
      line-height: 17px;
      min-width: 0;
      
      transition: min-width 0s, border-radius 0s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-time-background, var(--_preview-background));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 3.5px 9px);
      margin: var(--media-preview-time-margin, 0);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgb(0 0 0 / .75));
      transform: translateX(min(
        max(calc(50% - var(--_box-width) / 2),
        calc(var(--_box-shift, 0))),
        calc(var(--_box-width) / 2 - 50%)
      ));
    }

    :host([${lj.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${lj.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
      min-width: 100%;
    }

    :host([${lj.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }

    [part~="arrow"],
    ::slotted([part~="arrow"]) {
      display: var(--media-box-arrow-display, inline-block);
      transform: translateX(min(
        max(calc(50% - var(--_box-width) / 2 + var(--media-box-arrow-offset)),
        calc(var(--_box-shift, 0))),
        calc(var(--_box-width) / 2 - 50% - var(--media-box-arrow-offset))
      ));
      
      border-color: transparent;
      border-top-color: var(--media-box-arrow-background, var(--_control-background));
      border-width: var(--media-box-arrow-border-width,
        var(--media-box-arrow-height, 5px) var(--media-box-arrow-width, 6px) 0);
      border-style: solid;
      justify-content: center;
      height: 0;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-chapter-display></media-preview-chapter-display>
      <media-preview-time-display></media-preview-time-display>
      <slot name="preview-arrow"><div part="arrow"></div></slot>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`;let mE=(e,t=e.mediaCurrentTime)=>{let i=Number.isFinite(e.mediaSeekableStart)?e.mediaSeekableStart:0,r=Number.isFinite(e.mediaDuration)?e.mediaDuration:e.mediaSeekableEnd;return Number.isNaN(r)?0:Math.max(0,Math.min((t-i)/(r-i),1))},mb=(e,t=e.range.valueAsNumber)=>{let i=Number.isFinite(e.mediaSeekableStart)?e.mediaSeekableStart:0,r=Number.isFinite(e.mediaDuration)?e.mediaDuration:e.mediaSeekableEnd;return Number.isNaN(r)?0:t*(r-i)+i};fb=new WeakMap,fy=new WeakMap,fT=new WeakMap,f_=new WeakMap,fA=new WeakMap,fS=new WeakMap,fk=new WeakMap,fR=new WeakMap,fI=new WeakMap,fL=new WeakSet,fw=function(){mf(this,fD,fC).call(this)?mc(this,fy).start():mc(this,fy).stop()},fD=new WeakSet,fC=function(){return this.isConnected&&!this.mediaPaused&&!this.mediaLoading&&!this.mediaEnded&&this.mediaSeekableEnd>0&&dM(this)},fx=new WeakMap,fM=new WeakSet,fO=function(e){var t;let i=(null!=(t=this.getAttribute("bounds")?dD(this,`#${this.getAttribute("bounds")}`):this.parentElement)?t:this).getBoundingClientRect(),r=this.range.getBoundingClientRect(),a=e.offsetWidth,s=-(r.left-i.left-a/2),n=i.right-r.left-a/2;return{box:{width:a,min:s,max:n},bounds:i,range:r}},fN=new WeakSet,fP=function(e,t){let i=`${100*t}%`,{width:r,min:a,max:s}=e.box;if(!r)return i;if(!Number.isNaN(a)){let e=`calc(1 / var(--_range-width) * 100 * ${a}% + var(--media-box-padding-left))`;i=`max(${e}, ${i})`}if(!Number.isNaN(s)){let e=`calc(1 / var(--_range-width) * 100 * ${s}% - var(--media-box-padding-right))`;i=`min(${i}, ${e})`}return i},fU=new WeakSet,fF=function(e,t){let{width:i,min:r,max:a}=e.box,s=t*e.range.width;if(s<r+mc(this,fk)){let t=e.range.left-e.bounds.left-mc(this,fk);return`${s-i/2+t}px`}if(s>a-mc(this,fR)){let t=e.bounds.right-e.range.right-mc(this,fR);return`${s+i/2-t-e.range.width}px`}return 0},fB=new WeakSet,f$=function(e){let t=[...mc(this,fT)].some(t=>e.composedPath().includes(t));if(!this.dragging&&(t||!e.composedPath().includes(this))){mf(this,fG,fH).call(this,null);return}let i=this.mediaSeekableEnd;if(!i)return;let r=dO(this.shadowRoot,"#preview-rail"),a=dO(this.shadowRoot,'[part~="preview-box"]'),s=mf(this,fM,fO).call(this,mc(this,fA)),n=(e.clientX-s.range.left)/s.range.width;n=Math.max(0,Math.min(1,n));let o=mf(this,fN,fP).call(this,s,n),l=mf(this,fU,fF).call(this,s,n);r.style.transform=`translateX(${o})`,r.style.setProperty("--_range-width",`${s.range.width}`),a.style.setProperty("--_box-shift",`${l}`),a.style.setProperty("--_box-width",`${s.box.width}px`),1>Math.abs(Math.round(mc(this,f_))-Math.round(n*i))&&n>.01&&n<.99||(mp(this,f_,n*i),mf(this,fG,fH).call(this,mc(this,f_)))},fG=new WeakSet,fH=function(e){this.dispatchEvent(new dv.CustomEvent(lK.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:e}))},fV=new WeakSet,fK=function(){mc(this,fy).stop();let e=mb(this);this.dispatchEvent(new dv.CustomEvent(lK.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e}))},dv.customElements.get("media-time-range")||dv.customElements.define("media-time-range",class extends hC{constructor(){super(),mm(this,fL),mm(this,fD),mm(this,fM),mm(this,fN),mm(this,fU),mm(this,fB),mm(this,fG),mm(this,fV),mm(this,fb,void 0),mm(this,fy,void 0),mm(this,fT,void 0),mm(this,f_,void 0),mm(this,fA,void 0),mm(this,fS,void 0),mm(this,fk,void 0),mm(this,fR,void 0),mm(this,fI,void 0),mm(this,fx,e=>{this.dragging||(l9(e)&&(this.range.valueAsNumber=e),this.updateBar())}),this.container.appendChild(mv.content.cloneNode(!0)),this.shadowRoot.querySelector("#track").insertAdjacentHTML("afterbegin",'<div id="buffered" part="buffered"></div>'),mp(this,fT,this.shadowRoot.querySelectorAll('[part~="box"]')),mp(this,fA,this.shadowRoot.querySelector('[part~="preview-box"]')),mp(this,fS,this.shadowRoot.querySelector('[part~="current-box"]'));let e=getComputedStyle(this);mp(this,fk,parseInt(e.getPropertyValue("--media-box-padding-left"))),mp(this,fR,parseInt(e.getPropertyValue("--media-box-padding-right"))),mp(this,fy,new mu(this.range,mc(this,fx),60))}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PAUSED,lj.MEDIA_DURATION,lj.MEDIA_SEEKABLE,lj.MEDIA_CURRENT_TIME,lj.MEDIA_PREVIEW_IMAGE,lj.MEDIA_PREVIEW_TIME,lj.MEDIA_PREVIEW_CHAPTER,lj.MEDIA_BUFFERED,lj.MEDIA_PLAYBACK_RATE,lj.MEDIA_LOADING,lj.MEDIA_ENDED]}connectedCallback(){var e;super.connectedCallback(),this.range.setAttribute("aria-label",dd("seek")),mf(this,fL,fw).call(this),mp(this,fb,this.getRootNode()),null==(e=mc(this,fb))||e.addEventListener("transitionstart",this)}disconnectedCallback(){var e;super.disconnectedCallback(),mf(this,fL,fw).call(this),null==(e=mc(this,fb))||e.removeEventListener("transitionstart",this),mp(this,fb,null)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),t!=i&&(e===lj.MEDIA_CURRENT_TIME||e===lj.MEDIA_PAUSED||e===lj.MEDIA_ENDED||e===lj.MEDIA_LOADING||e===lj.MEDIA_DURATION||e===lj.MEDIA_SEEKABLE?(mc(this,fy).update({start:mE(this),duration:this.mediaSeekableEnd-this.mediaSeekableStart,playbackRate:this.mediaPlaybackRate}),mf(this,fL,fw).call(this),mg(this)):e===lj.MEDIA_BUFFERED&&this.updateBufferedBar(),(e===lj.MEDIA_DURATION||e===lj.MEDIA_SEEKABLE)&&(this.mediaChaptersCues=mc(this,fI),this.updateBar()))}get mediaChaptersCues(){return mc(this,fI)}set mediaChaptersCues(e){var t;mp(this,fI,e),this.updateSegments(null==(t=mc(this,fI))?void 0:t.map(e=>({start:mE(this,e.startTime),end:mE(this,e.endTime)})))}get mediaPaused(){return dF(this,lj.MEDIA_PAUSED)}set mediaPaused(e){dB(this,lj.MEDIA_PAUSED,e)}get mediaLoading(){return dF(this,lj.MEDIA_LOADING)}set mediaLoading(e){dB(this,lj.MEDIA_LOADING,e)}get mediaDuration(){return dP(this,lj.MEDIA_DURATION)}set mediaDuration(e){dU(this,lj.MEDIA_DURATION,e)}get mediaCurrentTime(){return dP(this,lj.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){dU(this,lj.MEDIA_CURRENT_TIME,e)}get mediaPlaybackRate(){return dP(this,lj.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){dU(this,lj.MEDIA_PLAYBACK_RATE,e)}get mediaBuffered(){let e=this.getAttribute(lj.MEDIA_BUFFERED);return e?e.split(" ").map(e=>e.split(":").map(e=>+e)):[]}set mediaBuffered(e){if(!e){this.removeAttribute(lj.MEDIA_BUFFERED);return}let t=e.map(e=>e.join(":")).join(" ");this.setAttribute(lj.MEDIA_BUFFERED,t)}get mediaSeekable(){let e=this.getAttribute(lj.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e){this.removeAttribute(lj.MEDIA_SEEKABLE);return}this.setAttribute(lj.MEDIA_SEEKABLE,e.join(":"))}get mediaSeekableEnd(){var e;let[,t=this.mediaDuration]=null!=(e=this.mediaSeekable)?e:[];return t}get mediaSeekableStart(){var e;let[t=0]=null!=(e=this.mediaSeekable)?e:[];return t}get mediaPreviewImage(){return d$(this,lj.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){dG(this,lj.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewTime(){return dP(this,lj.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){dU(this,lj.MEDIA_PREVIEW_TIME,e)}get mediaEnded(){return dF(this,lj.MEDIA_ENDED)}set mediaEnded(e){dB(this,lj.MEDIA_ENDED,e)}updateBar(){super.updateBar(),this.updateBufferedBar(),this.updateCurrentBox()}updateBufferedBar(){var e;let t;let i=this.mediaBuffered;if(!i.length)return;if(this.mediaEnded)t=1;else{let r=this.mediaCurrentTime,[,a=this.mediaSeekableStart]=null!=(e=i.find(([e,t])=>e<=r&&r<=t))?e:[];t=mE(this,a)}let{style:r}=dO(this.shadowRoot,"#buffered");r.setProperty("width",`${100*t}%`)}updateCurrentBox(){if(!this.shadowRoot.querySelector('slot[name="current"]').assignedElements().length)return;let e=dO(this.shadowRoot,"#current-rail"),t=dO(this.shadowRoot,'[part~="current-box"]'),i=mf(this,fM,fO).call(this,mc(this,fS)),r=mf(this,fN,fP).call(this,i,this.range.valueAsNumber),a=mf(this,fU,fF).call(this,i,this.range.valueAsNumber);e.style.transform=`translateX(${r})`,e.style.setProperty("--_range-width",`${i.range.width}`),t.style.setProperty("--_box-shift",`${a}`),t.style.setProperty("--_box-width",`${i.box.width}px`),t.style.setProperty("visibility","initial")}handleEvent(e){switch(super.handleEvent(e),e.type){case"input":mf(this,fV,fK).call(this);break;case"pointermove":mf(this,fB,f$).call(this,e);break;case"pointerup":case"pointerleave":mf(this,fG,fH).call(this,null);break;case"transitionstart":dw(e.target,this)&&setTimeout(()=>mf(this,fL,fw).call(this),0)}}});let my="placement",mT="bounds",m_=dE.createElement("template");m_.innerHTML=`
  <style>
    :host {
      --_tooltip-background-color: var(--media-tooltip-background-color, var(--media-secondary-color, rgba(20, 20, 30, .7)));
      --_tooltip-background: var(--media-tooltip-background, var(--_tooltip-background-color));
      --_tooltip-arrow-half-width: calc(var(--media-tooltip-arrow-width, 12px) / 2);
      --_tooltip-arrow-height: var(--media-tooltip-arrow-height, 5px);
      --_tooltip-arrow-background: var(--media-tooltip-arrow-color, var(--_tooltip-background-color));
      position: relative;
      pointer-events: none;
      display: var(--media-tooltip-display, inline-flex);
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      z-index: var(--media-tooltip-z-index, 1);
      background: var(--_tooltip-background);
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      font: var(--media-font,
        var(--media-font-weight, 400)
        var(--media-font-size, 13px) /
        var(--media-text-content-height, var(--media-control-height, 18px))
        var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
      padding: var(--media-tooltip-padding, .35em .7em);
      border: var(--media-tooltip-border, none);
      border-radius: var(--media-tooltip-border-radius, 5px);
      filter: var(--media-tooltip-filter, drop-shadow(0 0 4px rgba(0, 0, 0, .2)));
      white-space: var(--media-tooltip-white-space, nowrap);
    }

    :host([hidden]) {
      display: none;
    }

    img, svg {
      display: inline-block;
    }

    #arrow {
      position: absolute;
      width: 0px;
      height: 0px;
      border-style: solid;
      display: var(--media-tooltip-arrow-display, block);
    }

    :host(:not([placement])),
    :host([placement="top"]) {
      position: absolute;
      bottom: calc(100% + var(--media-tooltip-distance, 12px));
      left: 50%;
      transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);
    }
    :host(:not([placement])) #arrow,
    :host([placement="top"]) #arrow {
      top: 100%;
      left: 50%;
      border-width: var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width);
      border-color: var(--_tooltip-arrow-background) transparent transparent transparent;
      transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);
    }

    :host([placement="right"]) {
      position: absolute;
      left: calc(100% + var(--media-tooltip-distance, 12px));
      top: 50%;
      transform: translate(0, -50%);
    }
    :host([placement="right"]) #arrow {
      top: 50%;
      right: 100%;
      border-width: var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0;
      border-color: transparent var(--_tooltip-arrow-background) transparent transparent;
      transform: translate(0, -50%);
    }

    :host([placement="bottom"]) {
      position: absolute;
      top: calc(100% + var(--media-tooltip-distance, 12px));
      left: 50%;
      transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);
    }
    :host([placement="bottom"]) #arrow {
      bottom: 100%;
      left: 50%;
      border-width: 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width);
      border-color: transparent transparent var(--_tooltip-arrow-background) transparent;
      transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);
    }

    :host([placement="left"]) {
      position: absolute;
      right: calc(100% + var(--media-tooltip-distance, 12px));
      top: 50%;
      transform: translate(0, -50%);
    }
    :host([placement="left"]) #arrow {
      top: 50%;
      left: 100%;
      border-width: var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height);
      border-color: transparent transparent transparent var(--_tooltip-arrow-background);
      transform: translate(0, -50%);
    }
    
    :host([placement="none"]) #arrow {
      display: none;
    }

  </style>
  <slot></slot>
  <div id="arrow"></div>
`;class mA extends dv.HTMLElement{constructor(){if(super(),this.updateXOffset=()=>{var e;if(!dM(this,{checkOpacity:!1,checkVisibilityCSS:!1}))return;let t=this.placement;if("left"===t||"right"===t){this.style.removeProperty("--media-tooltip-offset-x");return}let i=getComputedStyle(this),r=null!=(e=dD(this,"#"+this.bounds))?e:dS(this);if(!r)return;let{x:a,width:s}=r.getBoundingClientRect(),{x:n,width:o}=this.getBoundingClientRect(),l=i.getPropertyValue("--media-tooltip-offset-x"),d=l?parseFloat(l.replace("px","")):0,u=i.getPropertyValue("--media-tooltip-container-margin"),h=u?parseFloat(u.replace("px","")):0,c=n-a+d-h,m=n+o-(a+s)+d+h;if(c<0){this.style.setProperty("--media-tooltip-offset-x",`${c}px`);return}if(m>0){this.style.setProperty("--media-tooltip-offset-x",`${m}px`);return}this.style.removeProperty("--media-tooltip-offset-x")},this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(m_.content.cloneNode(!0))),this.arrowEl=this.shadowRoot.querySelector("#arrow"),Object.prototype.hasOwnProperty.call(this,"placement")){let e=this.placement;delete this.placement,this.placement=e}}static get observedAttributes(){return[my,mT]}get placement(){return d$(this,my)}set placement(e){dG(this,my,e)}get bounds(){return d$(this,mT)}set bounds(e){dG(this,mT,e)}}dv.customElements.get("media-tooltip")||dv.customElements.define("media-tooltip",mA);let mS=e=>e.mediaMuted?0:e.mediaVolume,mk=e=>`${Math.round(100*e)}%`;dv.customElements.get("media-volume-range")||dv.customElements.define("media-volume-range",class extends hC{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_VOLUME,lj.MEDIA_MUTED,lj.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.addEventListener("input",()=>{let e=this.range.value,t=new dv.CustomEvent(lK.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)})}connectedCallback(){super.connectedCallback(),this.range.setAttribute("aria-label",dd("volume"))}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),(e===lj.MEDIA_VOLUME||e===lj.MEDIA_MUTED)&&(this.range.valueAsNumber=mS(this),this.range.setAttribute("aria-valuetext",mk(this.range.valueAsNumber)),this.updateBar())}get mediaVolume(){return dP(this,lj.MEDIA_VOLUME,1)}set mediaVolume(e){dU(this,lj.MEDIA_VOLUME,e)}get mediaMuted(){return dF(this,lj.MEDIA_MUTED)}set mediaMuted(e){dB(this,lj.MEDIA_MUTED,e)}get mediaVolumeUnavailable(){return d$(this,lj.MEDIA_VOLUME_UNAVAILABLE)}set mediaVolumeUnavailable(e){dG(this,lj.MEDIA_VOLUME_UNAVAILABLE,e)}});var mR=Object.defineProperty,mI=Object.getPrototypeOf,mL=Reflect.get,mw=e=>{throw TypeError(e)},mD=(e,t,i)=>t in e?mR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,mC=(e,t,i)=>mD(e,"symbol"!=typeof t?t+"":t,i),mx=(e,t,i)=>t.has(e)||mw("Cannot "+i),mM=(e,t,i)=>(mx(e,t,"read from private field"),i?i.call(e):t.get(e)),mO=(e,t,i)=>t.has(e)?mw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),mN=(e,t,i,r)=>(mx(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),mP=(e,t,i)=>(mx(e,t,"access private method"),i),mU=(e,t,i)=>mL(mI(e),i,t),mF=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends mF{});var mB,m$,mG,mH,mV,mK,mW,mY,mq,mj,mz,mX,mQ,mZ,mJ,m0,m1,m2,m3,m4,m5,m8,m9,m6,m7,pe,pt,pi,pr,pa,ps,pn,po,pl,pd,pu,ph,pc,pm,pp,pf,pg,pv,pE,pb,py,pT,p_,pA,pS,pk,pR,pI,pL,pw,pD,pC,px,pM,pO,pN,pP,pU,pF,pB,p$,pG,pH,pV,pK,pW,pY,pq,pj,pz,pX,pQ,pZ,pJ,p0,p1,p2,p3,p4,p5,p8,p9,p6,p7,fe,ft,fi,fr,fa,fs,fn,fo,fl,fd,fu,fh,fc,fm,fp,ff,fg,fv,fE,fb,fy,fT,f_,fA,fS,fk,fR,fI,fL,fw,fD,fC,fx,fM,fO,fN,fP,fU,fF,fB,f$,fG,fH,fV,fK,fW,fY=class extends mF{},fq=class{constructor(e,t={}){mO(this,fW),mN(this,fW,null==t?void 0:t.detail)}get detail(){return mM(this,fW)}initCustomEvent(){}};fW=new WeakMap;var fj={document:{createElement:function(e,t){return new fY}},DocumentFragment,customElements:{get(e){},define(e,t,i){},getName:e=>null,upgrade(e){},whenDefined:e=>Promise.resolve(fY)},CustomEvent:fq,EventTarget:mF,HTMLElement:fY,HTMLVideoElement:class extends mF{}},fz="undefined"==typeof window||void 0===globalThis.customElements,fX=fz?fj:globalThis;fz&&fj.document;var fQ=(()=>{try{return"0.25.2"}catch{}return"UNKNOWN"})(),fZ=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],fJ=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function f0(e){return`
    <style>
      :host {
        display: inline-flex;
        line-height: 0;
        flex-direction: column;
        justify-content: end;
      }

      audio {
        width: 100%;
      }
    </style>
    <slot name="media">
      <audio${f3(e)}></audio>
    </slot>
    <slot></slot>
  `}function f1(e){return`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot name="media">
      <video${f3(e)}></video>
    </slot>
    <slot></slot>
  `}function f2(e,{tag:t,is:i}){var r,a,s,n,o,l,d,u,h,c,m,p,f,g,E,b,y;let T=null==(a=null==(r=globalThis.document)?void 0:r.createElement)?void 0:a.call(r,t,{is:i}),_=T?function(e){let t=[];for(let i=Object.getPrototypeOf(e);i&&i!==HTMLElement.prototype;i=Object.getPrototypeOf(i)){let e=Object.getOwnPropertyNames(i);t.push(...e)}return t}(T):[];return s=class extends e{constructor(){super(...arguments),mO(this,m),mO(this,d,!1),mO(this,u,null),mO(this,h,new Map),mO(this,c),mC(this,"get"),mC(this,"set"),mC(this,"call")}static get observedAttributes(){var e,t,i;return mP(e=s,o,l).call(e),[...null!=(i=null==(t=null==T?void 0:T.constructor)?void 0:t.observedAttributes)?i:[],...fJ]}get nativeEl(){var e,i,r,a,s;return mP(this,m,p).call(this),null!=(s=null!=(a=null!=(i=null!=(e=mM(this,u))?e:this.querySelector(":scope > [slot=media]"))?i:this.querySelector(t))?a:null==(r=this.shadowRoot)?void 0:r.querySelector(t))?s:null}set nativeEl(e){mN(this,u,e)}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(e){this.toggleAttribute("muted",e)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",`${e}`)}get preload(){var e,t;return null!=(t=this.getAttribute("preload"))?t:null==(e=this.nativeEl)?void 0:e.preload}set preload(e){this.setAttribute("preload",`${e}`)}init(){var e;if(!this.shadowRoot){this.attachShadow({mode:"open"});let e=function(e){let t={};for(let i of e)t[i.name]=i.value;return t}(this.attributes);i&&(e.is=i),t&&(e.part=t),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}for(let e of(this.nativeEl.muted=this.hasAttribute("muted"),_))mP(this,m,b).call(this,e);for(let t of(mN(this,c,new MutationObserver(mP(this,m,g).bind(this))),this.shadowRoot.addEventListener("slotchange",this),mP(this,m,f).call(this),this.constructor.Events))null==(e=this.shadowRoot)||e.addEventListener(t,this,!0)}handleEvent(e){if("slotchange"===e.type){mP(this,m,f).call(this);return}e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}))}attributeChangedCallback(e,t,i){mP(this,m,p).call(this),mP(this,m,y).call(this,e,t,i)}connectedCallback(){mP(this,m,p).call(this)}},n=new WeakMap,o=new WeakSet,l=function(){if(mM(this,n))return;mN(this,n,!0);let e=new Set(this.observedAttributes);for(let t of(e.delete("muted"),_))if(!(t in this.prototype)){if("function"==typeof T[t])this.prototype[t]=function(...e){return mP(this,m,p).call(this),(()=>{var i;if(this.call)return this.call(t,...e);let r=null==(i=this.nativeEl)?void 0:i[t];return null==r?void 0:r.apply(this.nativeEl,e)})()};else{let i={get(){var i,r,a;mP(this,m,p).call(this);let s=t.toLowerCase();if(e.has(s)){let e=this.getAttribute(s);return null!==e&&(""===e||e)}return null!=(a=null==(i=this.get)?void 0:i.call(this,t))?a:null==(r=this.nativeEl)?void 0:r[t]}};t!==t.toUpperCase()&&(i.set=function(i){mP(this,m,p).call(this);let r=t.toLowerCase();if(e.has(r)){!0===i||!1===i||null==i?this.toggleAttribute(r,!!i):this.setAttribute(r,i);return}if(this.set){this.set(t,i);return}this.nativeEl&&(this.nativeEl[t]=i)}),Object.defineProperty(this.prototype,t,i)}}},d=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,m=new WeakSet,p=function(){mM(this,d)||(mN(this,d,!0),this.init())},f=function(){var e;let t=new Map(mM(this,h)),i=null==(e=this.shadowRoot)?void 0:e.querySelector("slot:not([name])");(null==i?void 0:i.assignedElements({flatten:!0}).filter(e=>["track","source"].includes(e.localName))).forEach(e=>{var i,r;t.delete(e);let a=mM(this,h).get(e);a||(a=e.cloneNode(),mM(this,h).set(e,a),null==(i=mM(this,c))||i.observe(e,{attributes:!0})),null==(r=this.nativeEl)||r.append(a),mP(this,m,E).call(this,a)}),t.forEach((e,t)=>{e.remove(),mM(this,h).delete(t)})},g=function(e){var t;for(let i of e)if("attributes"===i.type){let{target:e,attributeName:r}=i,a=mM(this,h).get(e);a&&r&&(a.setAttribute(r,null!=(t=e.getAttribute(r))?t:""),mP(this,m,E).call(this,a))}},E=function(e){e&&"track"===e.localName&&e.default&&("chapters"===e.kind||"metadata"===e.kind)&&"disabled"===e.track.mode&&(e.track.mode="hidden")},b=function(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}},y=function(e,t,i){var r,a,n;["id","class"].includes(e)||!s.observedAttributes.includes(e)&&this.constructor.observedAttributes.includes(e)||(null===i?null==(r=this.nativeEl)||r.removeAttribute(e):(null==(a=this.nativeEl)?void 0:a.getAttribute(e))!==i&&(null==(n=this.nativeEl)||n.setAttribute(e,i)))},mO(s,o),mC(s,"getTemplateHTML",t.endsWith("audio")?f0:f1),mC(s,"shadowRootOptions",{mode:"open"}),mC(s,"Events",fZ),mO(s,n,!1),s}function f3(e){let t="";for(let i in e){if(!fJ.includes(i))continue;let r=e[i];""===r?t+=` ${i}`:t+=` ${i}="${r}"`}return t}var f4,f5,f8=f2(null!=(f4=globalThis.HTMLElement)?f4:class{},{tag:"video"});f2(null!=(f5=globalThis.HTMLElement)?f5:class{},{tag:"audio"});var f9=new WeakMap,f6=class extends Error{},f7=class extends Error{},ge=["application/x-mpegURL","application/vnd.apple.mpegurl","audio/mpegurl"];function gt(){var e,t;return null==(t=null==(e=globalThis.cast)?void 0:e.framework)?void 0:t.CastContext.getInstance()}function gi(){var e;return null==(e=gt())?void 0:e.getCurrentSession()}function gr(){var e;return null==(e=gi())?void 0:e.getSessionObj().media[0]}function ga(e){return gt().setOptions({...gs(),...e})}function gs(){return{receiverApplicationId:"CC1AD845",autoJoinPolicy:"origin_scoped",androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0}}async function gn(e){try{let t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Type");return ge.some(e=>t===e)}catch(e){return console.error("Error while trying to get the Content-Type of the manifest",e),!1}}async function go(e){try{let t=await (await fetch(e)).text(),i=t,r=function(e){let t=e.split(`
`),i=[];for(let e=0;e<t.length;e++)if(t[e].trim().startsWith("#EXT-X-STREAM-INF")){let r=t[e+1]?t[e+1].trim():"";r&&!r.startsWith("#")&&i.push(r)}return i}(t);if(r.length>0){let t=new URL(r[0],e).toString();i=await (await fetch(t)).text()}let a=i.split(`
`).find(e=>!e.trim().startsWith("#")&&""!==e.trim());return function(e){if(!e)return;let t=e.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);return t?t[1]:null}(a)}catch(e){console.error("Error while trying to parse the manifest playlist",e);return}}var gl,gd=new(globalThis.WeakRef?class extends Set{add(e){super.add(new WeakRef(e))}forEach(e){super.forEach(t=>{let i=t.deref();i&&e(i)})}}:Set),gu=new WeakSet;gh=()=>{var e,t,i,r;if(!(null!=(t=null==(e=globalThis.chrome)?void 0:e.cast)&&t.isAvailable)){console.debug("chrome.cast.isAvailable",null==(r=null==(i=globalThis.chrome)?void 0:i.cast)?void 0:r.isAvailable);return}gl||(gl=cast.framework,gt().addEventListener(gl.CastContextEventType.CAST_STATE_CHANGED,e=>{gd.forEach(t=>{var i,r;return null==(r=(i=f9.get(t)).onCastStateChanged)?void 0:r.call(i,e)})}),gt().addEventListener(gl.CastContextEventType.SESSION_STATE_CHANGED,e=>{gd.forEach(t=>{var i,r;return null==(r=(i=f9.get(t)).onSessionStateChanged)?void 0:r.call(i,e)})}),gd.forEach(e=>{var t,i;return null==(i=(t=f9.get(e)).init)?void 0:i.call(t)}))},null!=(gm=null==(gc=globalThis.chrome)?void 0:gc.cast)&&gm.isAvailable?null!=(gp=globalThis.cast)&&gp.framework?gh():customElements.whenDefined("google-cast-button").then(gh):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(gh)};var gh,gc,gm,gp,gf,gg,gv,gE,gb,gy,gT,g_,gA,gS,gk,gR,gI,gL,gw,gD,gC,gx=0,gM=class extends EventTarget{constructor(e){super(),mO(this,gA),mO(this,gf),mO(this,gg),mO(this,gv),mO(this,gE),mO(this,gb,"disconnected"),mO(this,gy,!1),mO(this,gT,new Set),mO(this,g_,new WeakMap),mN(this,gf,e),gd.add(this),f9.set(this,{init:()=>mP(this,gA,gw).call(this),onCastStateChanged:()=>mP(this,gA,gI).call(this),onSessionStateChanged:()=>mP(this,gA,gL).call(this),getCastPlayer:()=>mM(this,gA,gS)}),mP(this,gA,gw).call(this)}get state(){return mM(this,gb)}async watchAvailability(e){if(mM(this,gf).disableRemotePlayback)throw new f6("disableRemotePlayback attribute is present.");return mM(this,g_).set(e,++gx),mM(this,gT).add(e),queueMicrotask(()=>e(mP(this,gA,gR).call(this))),gx}async cancelWatchAvailability(e){if(mM(this,gf).disableRemotePlayback)throw new f6("disableRemotePlayback attribute is present.");e?mM(this,gT).delete(e):mM(this,gT).clear()}async prompt(){var e,t,i,r;if(mM(this,gf).disableRemotePlayback)throw new f6("disableRemotePlayback attribute is present.");if(!(null!=(t=null==(e=globalThis.chrome)?void 0:e.cast)&&t.isAvailable))throw new f7("The RemotePlayback API is disabled on this platform.");let a=gu.has(mM(this,gf));gu.add(mM(this,gf)),ga(mM(this,gf).castOptions),Object.entries(mM(this,gE)).forEach(([e,t])=>{mM(this,gv).controller.addEventListener(e,t)});try{await gt().requestSession()}catch(e){if(a||gu.delete(mM(this,gf)),"cancel"===e)return;throw Error(e)}null==(r=null==(i=f9.get(mM(this,gf)))?void 0:i.loadOnPrompt)||r.call(i)}};gf=new WeakMap,gg=new WeakMap,gv=new WeakMap,gE=new WeakMap,gb=new WeakMap,gy=new WeakMap,gT=new WeakMap,g_=new WeakMap,gA=new WeakSet,gS=function(){if(gu.has(mM(this,gf)))return mM(this,gv)},gk=function(){gu.has(mM(this,gf))&&(Object.entries(mM(this,gE)).forEach(([e,t])=>{mM(this,gv).controller.removeEventListener(e,t)}),gu.delete(mM(this,gf)),mM(this,gf).muted=mM(this,gv).isMuted,mM(this,gf).currentTime=mM(this,gv).savedPlayerState.currentTime,!1===mM(this,gv).savedPlayerState.isPaused&&mM(this,gf).play())},gR=function(){var e;let t=null==(e=gt())?void 0:e.getCastState();return t&&"NO_DEVICES_AVAILABLE"!==t},gI=function(){let e=gt().getCastState();if(gu.has(mM(this,gf))&&"CONNECTING"===e&&(mN(this,gb,"connecting"),this.dispatchEvent(new Event("connecting"))),!mM(this,gy)&&null!=e&&e.includes("CONNECT"))for(let e of(mN(this,gy,!0),mM(this,gT)))e(!0);else if(mM(this,gy)&&(!e||"NO_DEVICES_AVAILABLE"===e))for(let e of(mN(this,gy,!1),mM(this,gT)))e(!1)},gL=async function(){var e,t;let{SESSION_RESUMED:i}=gl.SessionState;if(gt().getSessionState()===i&&mM(this,gf).castSrc===(null==(e=gr())?void 0:e.media.contentId)){gu.add(mM(this,gf)),Object.entries(mM(this,gE)).forEach(([e,t])=>{mM(this,gv).controller.addEventListener(e,t)});try{await (t=new chrome.cast.media.GetStatusRequest,new Promise((e,i)=>{gr().getStatus(t,e,i)}))}catch(e){console.error(e)}mM(this,gE)[gl.RemotePlayerEventType.IS_PAUSED_CHANGED](),mM(this,gE)[gl.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}},gw=function(){!gl||mM(this,gg)||(mN(this,gg,!0),ga(mM(this,gf).castOptions),mM(this,gf).textTracks.addEventListener("change",()=>mP(this,gA,gC).call(this)),mP(this,gA,gI).call(this),mN(this,gv,new gl.RemotePlayer),new gl.RemotePlayerController(mM(this,gv)),mN(this,gE,{[gl.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:e})=>{!0===e?(mN(this,gb,"connected"),this.dispatchEvent(new Event("connect"))):(mP(this,gA,gk).call(this),mN(this,gb,"disconnected"),this.dispatchEvent(new Event("disconnect")))},[gl.RemotePlayerEventType.DURATION_CHANGED]:()=>{mM(this,gf).dispatchEvent(new Event("durationchange"))},[gl.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{mM(this,gf).dispatchEvent(new Event("volumechange"))},[gl.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{mM(this,gf).dispatchEvent(new Event("volumechange"))},[gl.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{var e;null!=(e=mM(this,gA,gS))&&e.isMediaLoaded&&mM(this,gf).dispatchEvent(new Event("timeupdate"))},[gl.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{mM(this,gf).dispatchEvent(new Event("resize"))},[gl.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{mM(this,gf).dispatchEvent(new Event(this.paused?"pause":"play"))},[gl.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var e,t;(null==(e=mM(this,gA,gS))?void 0:e.playerState)!==chrome.cast.media.PlayerState.PAUSED&&mM(this,gf).dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[null==(t=mM(this,gA,gS))?void 0:t.playerState]))},[gl.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{var e;null!=(e=mM(this,gA,gS))&&e.isMediaLoaded&&(await Promise.resolve(),mP(this,gA,gD).call(this))}}))},gD=function(){mP(this,gA,gC).call(this)},gC=async function(){var e,t,i,r,a;let s;if(!mM(this,gA,gS))return;let n=(null!=(t=null==(e=mM(this,gv).mediaInfo)?void 0:e.tracks)?t:[]).filter(({type:e})=>e===chrome.cast.media.TrackType.TEXT),o=[...mM(this,gf).textTracks].filter(({kind:e})=>"subtitles"===e||"captions"===e),l=n.map(({language:e,name:t,trackId:i})=>{var r;let{mode:a}=null!=(r=o.find(i=>i.language===e&&i.label===t))?r:{};return!!a&&{mode:a,trackId:i}}).filter(Boolean),d=l.filter(({mode:e})=>"showing"!==e).map(({trackId:e})=>e),u=l.find(({mode:e})=>"showing"===e),h=null!=(a=null==(r=null==(i=gi())?void 0:i.getSessionObj().media[0])?void 0:r.activeTrackIds)?a:[],c=h;if(h.length&&(c=c.filter(e=>!d.includes(e))),null!=u&&u.trackId&&(c=[...c,u.trackId]),s=c=[...new Set(c)],!(h.length===s.length&&h.every(e=>s.includes(e))))try{let e=new chrome.cast.media.EditTracksInfoRequest(c);await new Promise((t,i)=>{gr().editTracksInfo(e,t,i)})}catch(e){console.error(e)}};var gO=e=>{var t,i,r,a,s,n,o,l,d;return i=class extends e{constructor(){super(...arguments),mO(this,o),mO(this,r,{paused:!1}),mO(this,a,gs()),mO(this,s),mO(this,n)}get remote(){return mM(this,n)?mM(this,n):globalThis.chrome?(this.disableRemotePlayback||function(){var e;let t="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";if(null!=(e=globalThis.chrome)&&e.cast||document.querySelector(`script[src="${t}"]`))return;let i=document.createElement("script");i.src=t,document.head.append(i)}(),f9.set(this,{loadOnPrompt:()=>mP(this,o,d).call(this)}),mN(this,n,new gM(this))):super.remote}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),"cast-receiver"===e&&i){mM(this,a).receiverApplicationId=i;return}if(mM(this,o,l))switch(e){case"cast-stream-type":case"cast-src":this.load()}}async load(){var e,t;if(!mM(this,o,l))return super.load();let i=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType);i.customData=this.castCustomData;let a=[...this.querySelectorAll("track")].filter(({kind:e,src:t})=>t&&("subtitles"===e||"captions"===e)),s=[],n=0;if(a.length&&(i.tracks=a.map(e=>{let t=++n;0===s.length&&"showing"===e.track.mode&&s.push(t);let i=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return i.trackContentId=e.src,i.trackContentType="text/vtt",i.subtype="captions"===e.kind?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,i.name=e.label,i.language=e.srclang,i})),"live"===this.castStreamType?i.streamType=chrome.cast.media.StreamType.LIVE:i.streamType=chrome.cast.media.StreamType.BUFFERED,i.metadata=new chrome.cast.media.GenericMediaMetadata,i.metadata.title=this.title,i.metadata.images=[{url:this.poster}],gn(this.castSrc)){let e=await go(this.castSrc);((null==e?void 0:e.includes("m4s"))||(null==e?void 0:e.includes("mp4")))&&(i.hlsSegmentFormat=chrome.cast.media.HlsSegmentFormat.FMP4,i.hlsVideoSegmentFormat=chrome.cast.media.HlsVideoSegmentFormat.FMP4)}let d=new chrome.cast.media.LoadRequest(i);d.currentTime=null!=(e=super.currentTime)?e:0,d.autoplay=!mM(this,r).paused,d.activeTrackIds=s,await (null==(t=gi())?void 0:t.loadMedia(d)),this.dispatchEvent(new Event("volumechange"))}play(){var e;if(mM(this,o,l)){mM(this,o,l).isPaused&&(null==(e=mM(this,o,l).controller)||e.playOrPause());return}return super.play()}pause(){var e;if(mM(this,o,l)){mM(this,o,l).isPaused||null==(e=mM(this,o,l).controller)||e.playOrPause();return}super.pause()}get castOptions(){return mM(this,a)}get castReceiver(){var e;return null!=(e=this.getAttribute("cast-receiver"))?e:void 0}set castReceiver(e){this.castReceiver!=e&&this.setAttribute("cast-receiver",`${e}`)}get castSrc(){var e,t,i;return null!=(i=null!=(t=this.getAttribute("cast-src"))?t:null==(e=this.querySelector("source"))?void 0:e.src)?i:this.currentSrc}set castSrc(e){this.castSrc!=e&&this.setAttribute("cast-src",`${e}`)}get castContentType(){var e;return null!=(e=this.getAttribute("cast-content-type"))?e:void 0}set castContentType(e){this.setAttribute("cast-content-type",`${e}`)}get castStreamType(){var e,t;return null!=(t=null!=(e=this.getAttribute("cast-stream-type"))?e:this.streamType)?t:void 0}set castStreamType(e){this.setAttribute("cast-stream-type",`${e}`)}get castCustomData(){return mM(this,s)}set castCustomData(e){let t=typeof e;if(!["object","undefined"].includes(t)){console.error(`castCustomData must be nullish or an object but value was of type ${t}`);return}mN(this,s,e)}get readyState(){if(mM(this,o,l))switch(mM(this,o,l).playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return mM(this,o,l)?mM(this,o,l).isPaused:super.paused}get muted(){var e;return mM(this,o,l)?null==(e=mM(this,o,l))?void 0:e.isMuted:super.muted}set muted(e){var t;if(mM(this,o,l)){(e&&!mM(this,o,l).isMuted||!e&&mM(this,o,l).isMuted)&&(null==(t=mM(this,o,l).controller)||t.muteOrUnmute());return}super.muted=e}get volume(){var e,t;return mM(this,o,l)?null!=(t=null==(e=mM(this,o,l))?void 0:e.volumeLevel)?t:1:super.volume}set volume(e){var t;if(mM(this,o,l)){mM(this,o,l).volumeLevel=+e,null==(t=mM(this,o,l).controller)||t.setVolumeLevel();return}super.volume=e}get duration(){var e,t,i;return mM(this,o,l)&&null!=(e=mM(this,o,l))&&e.isMediaLoaded?null!=(i=null==(t=mM(this,o,l))?void 0:t.duration)?i:NaN:super.duration}get currentTime(){var e,t,i;return mM(this,o,l)&&null!=(e=mM(this,o,l))&&e.isMediaLoaded?null!=(i=null==(t=mM(this,o,l))?void 0:t.currentTime)?i:0:super.currentTime}set currentTime(e){var t;if(mM(this,o,l)){mM(this,o,l).currentTime=e,null==(t=mM(this,o,l).controller)||t.seek();return}super.currentTime=e}},r=new WeakMap,a=new WeakMap,s=new WeakMap,n=new WeakMap,o=new WeakSet,l=function(){var e,t;return null==(t=null==(e=f9.get(this.remote))?void 0:e.getCastPlayer)?void 0:t.call(e)},d=async function(){mM(this,r).paused=mU(i.prototype,this,"paused"),mU(i.prototype,this,"pause").call(this),this.muted=mU(i.prototype,this,"muted");try{await this.load()}catch(e){console.error(e)}},mC(i,"observedAttributes",[...null!=(t=e.observedAttributes)?t:[],"cast-src","cast-content-type","cast-stream-type","cast-receiver"]),i},gN=class extends Event{constructor(e,t){super(e),mC(this,"track"),this.track=t.track}},gP=new WeakMap;function gU(e){var t,i,r;let a;return null!=(t=gP.get(e))?t:(i=e,r={},(a=gP.get(i))||gP.set(i,a={}),Object.assign(a,r))}function gF(e,t){let i=e.videoTracks;gU(t).media=e,gU(t).renditionSet||(gU(t).renditionSet=new Set);let r=gU(i).trackSet;r.add(t);let a=r.size-1;a in gW.prototype||Object.defineProperty(gW.prototype,a,{get(){return[...gU(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new gN("addtrack",{track:t}))})}function gB(e){var t;let i=null==(t=gU(e).media)?void 0:t.videoTracks;i&&(gU(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new gN("removetrack",{track:e}))}))}var g$,gG,gH,gV,gK,gW=class extends EventTarget{constructor(){super(),mO(this,gV),mO(this,g$),mO(this,gG),mO(this,gH),gU(this).trackSet=new Set}[Symbol.iterator](){return mM(this,gV,gK).values()}get length(){return mM(this,gV,gK).size}getTrackById(e){var t;return null!=(t=[...mM(this,gV,gK)].find(t=>t.id===e))?t:null}get selectedIndex(){return[...mM(this,gV,gK)].findIndex(e=>e.selected)}get onaddtrack(){return mM(this,g$)}set onaddtrack(e){mM(this,g$)&&(this.removeEventListener("addtrack",mM(this,g$)),mN(this,g$,void 0)),"function"==typeof e&&(mN(this,g$,e),this.addEventListener("addtrack",e))}get onremovetrack(){return mM(this,gG)}set onremovetrack(e){mM(this,gG)&&(this.removeEventListener("removetrack",mM(this,gG)),mN(this,gG,void 0)),"function"==typeof e&&(mN(this,gG,e),this.addEventListener("removetrack",e))}get onchange(){return mM(this,gH)}set onchange(e){mM(this,gH)&&(this.removeEventListener("change",mM(this,gH)),mN(this,gH,void 0)),"function"==typeof e&&(mN(this,gH,e),this.addEventListener("change",e))}};g$=new WeakMap,gG=new WeakMap,gH=new WeakMap,gV=new WeakSet,gK=function(){return gU(this).trackSet};var gY=class extends Event{constructor(e,t){super(e),mC(this,"rendition"),this.rendition=t.rendition}};function gq(e){return[...gU(e).media.videoTracks].filter(e=>e.selected).flatMap(e=>[...gU(e).renditionSet])}var gj,gz,gX,gQ=class extends EventTarget{constructor(){super(...arguments),mO(this,gj),mO(this,gz),mO(this,gX)}[Symbol.iterator](){return gq(this).values()}get length(){return gq(this).length}getRenditionById(e){var t;return null!=(t=gq(this).find(t=>`${t.id}`==`${e}`))?t:null}get selectedIndex(){return gq(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of gq(this).entries())i.selected=t===e}get onaddrendition(){return mM(this,gj)}set onaddrendition(e){mM(this,gj)&&(this.removeEventListener("addrendition",mM(this,gj)),mN(this,gj,void 0)),"function"==typeof e&&(mN(this,gj,e),this.addEventListener("addrendition",e))}get onremoverendition(){return mM(this,gz)}set onremoverendition(e){mM(this,gz)&&(this.removeEventListener("removerendition",mM(this,gz)),mN(this,gz,void 0)),"function"==typeof e&&(mN(this,gz,e),this.addEventListener("removerendition",e))}get onchange(){return mM(this,gX)}set onchange(e){mM(this,gX)&&(this.removeEventListener("change",mM(this,gX)),mN(this,gX,void 0)),"function"==typeof e&&(mN(this,gX,e),this.addEventListener("change",e))}};gj=new WeakMap,gz=new WeakMap,gX=new WeakMap;var gZ,gJ=class{constructor(){mC(this,"src"),mC(this,"id"),mC(this,"width"),mC(this,"height"),mC(this,"bitrate"),mC(this,"frameRate"),mC(this,"codec"),mO(this,gZ,!1)}get selected(){return mM(this,gZ)}set selected(e){var t;let i;mM(this,gZ)!==e&&(mN(this,gZ,e),t=this,(i=gU(t).media.videoRenditions)&&!gU(i).changeRequested&&(gU(i).changeRequested=!0,queueMicrotask(()=>{delete gU(i).changeRequested,gU(t).track.selected&&i.dispatchEvent(new Event("change"))})))}};gZ=new WeakMap;var g0,g1=class{constructor(){mC(this,"id"),mC(this,"kind"),mC(this,"label",""),mC(this,"language",""),mC(this,"sourceBuffer"),mO(this,g0,!1)}addRendition(e,t,i,r,a,s){var n;let o,l,d,u=new gJ;return u.src=e,u.width=t,u.height=i,u.frameRate=s,u.bitrate=a,u.codec=r,n=this,o=gU(n).media.videoRenditions,gU(u).media=gU(n).media,gU(u).track=n,(l=gU(n).renditionSet).add(u),(d=l.size-1)in gQ.prototype||Object.defineProperty(gQ.prototype,d,{get(){return gq(this)[d]}}),queueMicrotask(()=>{n.selected&&o.dispatchEvent(new gY("addrendition",{rendition:u}))}),u}removeRendition(e){let t,i;t=gU(e).media.videoRenditions,i=gU(e).track,gU(i).renditionSet.delete(e),queueMicrotask(()=>{gU(e).track.selected&&t.dispatchEvent(new gY("removerendition",{rendition:e}))})}get selected(){return mM(this,g0)}set selected(e){mM(this,g0)!==e&&(mN(this,g0,e),!0===e&&function(e){var t;let i=null!=(t=gU(e).media.videoTracks)?t:[],r=!1;for(let t of i)t!==e&&(t.selected=!1,r=!0);if(r){if(gU(i).changeRequested)return;gU(i).changeRequested=!0,queueMicrotask(()=>{delete gU(i).changeRequested,i.dispatchEvent(new Event("change"))})}}(this))}};function g2(e){return[...gU(e).media.audioTracks].filter(e=>e.enabled).flatMap(e=>[...gU(e).renditionSet])}g0=new WeakMap;var g3,g4,g5,g8=class extends EventTarget{constructor(){super(...arguments),mO(this,g3),mO(this,g4),mO(this,g5)}[Symbol.iterator](){return g2(this).values()}get length(){return g2(this).length}getRenditionById(e){var t;return null!=(t=g2(this).find(t=>`${t.id}`==`${e}`))?t:null}get selectedIndex(){return g2(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of g2(this).entries())i.selected=t===e}get onaddrendition(){return mM(this,g3)}set onaddrendition(e){mM(this,g3)&&(this.removeEventListener("addrendition",mM(this,g3)),mN(this,g3,void 0)),"function"==typeof e&&(mN(this,g3,e),this.addEventListener("addrendition",e))}get onremoverendition(){return mM(this,g4)}set onremoverendition(e){mM(this,g4)&&(this.removeEventListener("removerendition",mM(this,g4)),mN(this,g4,void 0)),"function"==typeof e&&(mN(this,g4,e),this.addEventListener("removerendition",e))}get onchange(){return mM(this,g5)}set onchange(e){mM(this,g5)&&(this.removeEventListener("change",mM(this,g5)),mN(this,g5,void 0)),"function"==typeof e&&(mN(this,g5,e),this.addEventListener("change",e))}};g3=new WeakMap,g4=new WeakMap,g5=new WeakMap;var g9,g6=class{constructor(){mC(this,"src"),mC(this,"id"),mC(this,"bitrate"),mC(this,"codec"),mO(this,g9,!1)}get selected(){return mM(this,g9)}set selected(e){var t;let i;mM(this,g9)!==e&&(mN(this,g9,e),t=this,(i=gU(t).media.audioRenditions)&&!gU(i).changeRequested&&(gU(i).changeRequested=!0,queueMicrotask(()=>{delete gU(i).changeRequested,gU(t).track.enabled&&i.dispatchEvent(new Event("change"))})))}};function g7(e,t){let i=e.audioTracks;gU(t).media=e,gU(t).renditionSet||(gU(t).renditionSet=new Set);let r=gU(i).trackSet;r.add(t);let a=r.size-1;a in vn.prototype||Object.defineProperty(vn.prototype,a,{get(){return[...gU(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new gN("addtrack",{track:t}))})}function ve(e){var t;let i=null==(t=gU(e).media)?void 0:t.audioTracks;i&&(gU(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new gN("removetrack",{track:e}))}))}g9=new WeakMap;var vt,vi,vr,va,vs,vn=class extends EventTarget{constructor(){super(),mO(this,va),mO(this,vt),mO(this,vi),mO(this,vr),gU(this).trackSet=new Set}[Symbol.iterator](){return mM(this,va,vs).values()}get length(){return mM(this,va,vs).size}getTrackById(e){var t;return null!=(t=[...mM(this,va,vs)].find(t=>t.id===e))?t:null}get onaddtrack(){return mM(this,vt)}set onaddtrack(e){mM(this,vt)&&(this.removeEventListener("addtrack",mM(this,vt)),mN(this,vt,void 0)),"function"==typeof e&&(mN(this,vt,e),this.addEventListener("addtrack",e))}get onremovetrack(){return mM(this,vi)}set onremovetrack(e){mM(this,vi)&&(this.removeEventListener("removetrack",mM(this,vi)),mN(this,vi,void 0)),"function"==typeof e&&(mN(this,vi,e),this.addEventListener("removetrack",e))}get onchange(){return mM(this,vr)}set onchange(e){mM(this,vr)&&(this.removeEventListener("change",mM(this,vr)),mN(this,vr,void 0)),"function"==typeof e&&(mN(this,vr,e),this.addEventListener("change",e))}};vt=new WeakMap,vi=new WeakMap,vr=new WeakMap,va=new WeakSet,vs=function(){return gU(this).trackSet};var vo,vl=class{constructor(){mC(this,"id"),mC(this,"kind"),mC(this,"label",""),mC(this,"language",""),mC(this,"sourceBuffer"),mO(this,vo,!1)}addRendition(e,t,i){var r;let a,s,n,o=new g6;return o.src=e,o.codec=t,o.bitrate=i,r=this,a=gU(r).media.audioRenditions,gU(o).media=gU(r).media,gU(o).track=r,(s=gU(r).renditionSet).add(o),(n=s.size-1)in g8.prototype||Object.defineProperty(g8.prototype,n,{get(){return g2(this)[n]}}),queueMicrotask(()=>{r.enabled&&a.dispatchEvent(new gY("addrendition",{rendition:o}))}),o}removeRendition(e){let t,i;t=gU(e).media.audioRenditions,i=gU(e).track,gU(i).renditionSet.delete(e),queueMicrotask(()=>{gU(e).track.enabled&&t.dispatchEvent(new gY("removerendition",{rendition:e}))})}get enabled(){return mM(this,vo)}set enabled(e){let t;mM(this,vo)!==e&&(mN(this,vo,e),(t=gU(this).media.audioTracks)&&!gU(t).changeRequested&&(gU(t).changeRequested=!0,queueMicrotask(()=>{delete gU(t).changeRequested,t.dispatchEvent(new Event("change"))})))}};vo=new WeakMap;var vd=vc(globalThis.HTMLMediaElement,"video"),vu=vc(globalThis.HTMLMediaElement,"audio");function vh(e){if(!(null!=e&&e.prototype))return e;let t=vc(e,"video");(!t||`${t}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"videoTracks",{get(){return function(e){var t;let i=gU(e).videoTracks;if(!i&&(i=new gW,gU(e).videoTracks=i,vd)){let r=vd.call(null!=(t=e.nativeEl)?t:e);for(let t of r)gF(e,t);r.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",t=>{if([...i].some(e=>e instanceof g1)){for(let e of r)gB(e);return}gF(e,t.track)}),r.addEventListener("removetrack",e=>{gB(e.track)})}return i}(this)}});let i=vc(e,"audio");(!i||`${i}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"audioTracks",{get(){return function(e){var t;let i=gU(e).audioTracks;if(!i&&(i=new vn,gU(e).audioTracks=i,vu)){let r=vu.call(null!=(t=e.nativeEl)?t:e);for(let t of r)g7(e,t);r.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",t=>{if([...i].some(e=>e instanceof vl)){for(let e of r)ve(e);return}g7(e,t.track)}),r.addEventListener("removetrack",e=>{ve(e.track)})}return i}(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(e,t="",i=""){let r=new g1;return r.kind=e,r.label=t,r.language=i,gF(this,r),r}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=gB),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(e,t="",i=""){let r=new vl;return r.kind=e,r.label=t,r.language=i,g7(this,r),r}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=ve),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return r(this)}});let r=e=>{let t=gU(e).videoRenditions;return t||(gU(t=new gQ).media=e,gU(e).videoRenditions=t),t};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return a(this)}});let a=e=>{let t=gU(e).audioRenditions;return t||(gU(t=new g8).media=e,gU(e).audioRenditions=t),t};return e}function vc(e,t){var i;if(null!=e&&e.prototype)return null==(i=Object.getOwnPropertyDescriptor(e.prototype,`${t}Tracks`))?void 0:i.get}var vm=`
<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" class="logo" part="logo" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 1600 500"><g fill="#fff"><path d="M994.287 93.486c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m0-93.486c-34.509 0-62.484 27.976-62.484 62.486v187.511c0 68.943-56.09 125.033-125.032 125.033s-125.03-56.09-125.03-125.033V62.486C681.741 27.976 653.765 0 619.256 0s-62.484 27.976-62.484 62.486v187.511C556.772 387.85 668.921 500 806.771 500c137.851 0 250.001-112.15 250.001-250.003V62.486c0-34.51-27.976-62.486-62.485-62.486M1537.51 468.511c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m-275.883-218.509-143.33 143.329c-24.402 24.402-24.402 63.966 0 88.368 24.402 24.402 63.967 24.402 88.369 0l143.33-143.329 143.328 143.329c24.402 24.4 63.967 24.402 88.369 0 24.403-24.402 24.403-63.966.001-88.368l-143.33-143.329.001-.004 143.329-143.329c24.402-24.402 24.402-63.965 0-88.367s-63.967-24.402-88.369 0L1349.996 161.63 1206.667 18.302c-24.402-24.401-63.967-24.402-88.369 0s-24.402 63.965 0 88.367l143.329 143.329v.004ZM437.511 468.521c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31M461.426 4.759C438.078-4.913 411.2.432 393.33 18.303L249.999 161.632 106.669 18.303C88.798.432 61.922-4.913 38.573 4.759 15.224 14.43-.001 37.214-.001 62.488v375.026c0 34.51 27.977 62.486 62.487 62.486 34.51 0 62.486-27.976 62.486-62.486V213.341l80.843 80.844c24.404 24.402 63.965 24.402 88.369 0l80.843-80.844v224.173c0 34.51 27.976 62.486 62.486 62.486s62.486-27.976 62.486-62.486V62.488c0-25.274-15.224-48.058-38.573-57.729" style="fill-rule:nonzero"/></g></svg>`;fZ.push("castchange","entercast","leavecast");var vp,vf,vg,vv,vE,vb,vy,vT,v_,vA,vS,vk={BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DEBUG:"debug",DISABLE_TRACKING:"disable-tracking",DISABLE_COOKIES:"disable-cookies",DRM_TOKEN:"drm-token",PLAYBACK_TOKEN:"playback-token",ENV_KEY:"env-key",MAX_RESOLUTION:"max-resolution",MIN_RESOLUTION:"min-resolution",RENDITION_ORDER:"rendition-order",PROGRAM_START_TIME:"program-start-time",PROGRAM_END_TIME:"program-end-time",ASSET_START_TIME:"asset-start-time",ASSET_END_TIME:"asset-end-time",METADATA_URL:"metadata-url",PLAYBACK_ID:"playback-id",PLAYER_SOFTWARE_NAME:"player-software-name",PLAYER_SOFTWARE_VERSION:"player-software-version",PLAYER_INIT_TIME:"player-init-time",PREFER_CMCD:"prefer-cmcd",PREFER_PLAYBACK:"prefer-playback",START_TIME:"start-time",STREAM_TYPE:"stream-type",TARGET_LIVE_WINDOW:"target-live-window",LIVE_EDGE_OFFSET:"live-edge-offset",TYPE:"type",LOGO:"logo"},vR=Object.values(vk),vI="mux-video",vL=class extends f8{constructor(){super(),mO(this,vA),mO(this,vp),mO(this,vf),mO(this,vg),mO(this,vv,{}),mO(this,vE,{}),mO(this,vb),mO(this,vy),mO(this,vT),mO(this,v_),mN(this,vg,ll())}static get NAME(){return vI}static get VERSION(){return fQ}static get observedAttributes(){var e;return[...vR,...null!=(e=f8.observedAttributes)?e:[]]}static getTemplateHTML(e={}){let t=super.getTemplateHTML(e),i="false"!==e.logo&&void 0!==e.logo,r=e.logo&&""!==e.logo,a=e.logo,s=i?`
      <style>
        :host {
          position: relative;
        }
        :host slot[name="logo"] {
          display: flex;
          justify-content: end;
          position: absolute;
          top: 1rem;
          right: 1rem;

        }
         :host slot[name="logo"] .logo{
          width: 5rem;
          pointer-events: none;
          user-select: none;
         }
      </style>
      <slot name="logo">
        ${r?`<img class="logo" part="logo" src="${a}" />`:vm}
      </slot>
    `:"";return`
      ${t}
      ${s}
    `}get preferCmcd(){var e;return null!=(e=this.getAttribute(vk.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?nQ.includes(e)?this.setAttribute(vk.PREFER_CMCD,e):console.warn(`Invalid value for preferCmcd. Must be one of ${nQ.join()}`):this.removeAttribute(vk.PREFER_CMCD))}get playerInitTime(){return this.hasAttribute(vk.PLAYER_INIT_TIME)?+this.getAttribute(vk.PLAYER_INIT_TIME):mM(this,vg)}set playerInitTime(e){e!=this.playerInitTime&&(null==e?this.removeAttribute(vk.PLAYER_INIT_TIME):this.setAttribute(vk.PLAYER_INIT_TIME,`${+e}`))}get playerSoftwareName(){var e;return null!=(e=mM(this,vT))?e:vI}set playerSoftwareName(e){mN(this,vT,e)}get playerSoftwareVersion(){var e;return null!=(e=mM(this,vy))?e:fQ}set playerSoftwareVersion(e){mN(this,vy,e)}get _hls(){var e;return null==(e=mM(this,vp))?void 0:e.engine}get mux(){var e;return null==(e=this.nativeEl)?void 0:e.mux}get error(){var e;return null!=(e=lp(this.nativeEl))?e:null}get errorTranslator(){return mM(this,v_)}set errorTranslator(e){mN(this,v_,e)}get src(){return this.getAttribute("src")}set src(e){e!==this.src&&(null==e?this.removeAttribute("src"):this.setAttribute("src",e))}get type(){var e;return null!=(e=this.getAttribute(vk.TYPE))?e:void 0}set type(e){e!==this.type&&(e?this.setAttribute(vk.TYPE,e):this.removeAttribute(vk.TYPE))}get autoplay(){let e=this.getAttribute("autoplay");return null!==e&&(""===e||e)}set autoplay(e){e!==this.autoplay&&(e?this.setAttribute("autoplay","string"==typeof e?e:""):this.removeAttribute("autoplay"))}get preload(){let e=this.getAttribute("preload");return""===e?"auto":["none","metadata","auto"].includes(e)?e:super.preload}set preload(e){e!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(e)?this.setAttribute("preload",e):this.removeAttribute("preload"))}get debug(){return null!=this.getAttribute(vk.DEBUG)}set debug(e){e!==this.debug&&(e?this.setAttribute(vk.DEBUG,""):this.removeAttribute(vk.DEBUG))}get disableTracking(){return this.hasAttribute(vk.DISABLE_TRACKING)}set disableTracking(e){e!==this.disableTracking&&this.toggleAttribute(vk.DISABLE_TRACKING,!!e)}get disableCookies(){return this.hasAttribute(vk.DISABLE_COOKIES)}set disableCookies(e){e!==this.disableCookies&&(e?this.setAttribute(vk.DISABLE_COOKIES,""):this.removeAttribute(vk.DISABLE_COOKIES))}get startTime(){let e=this.getAttribute(vk.START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set startTime(e){e!==this.startTime&&(null==e?this.removeAttribute(vk.START_TIME):this.setAttribute(vk.START_TIME,`${e}`))}get playbackId(){var e;return this.hasAttribute(vk.PLAYBACK_ID)?this.getAttribute(vk.PLAYBACK_ID):null!=(e=lc(this.src))?e:void 0}set playbackId(e){e!==this.playbackId&&(e?this.setAttribute(vk.PLAYBACK_ID,e):this.removeAttribute(vk.PLAYBACK_ID))}get maxResolution(){var e;return null!=(e=this.getAttribute(vk.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(vk.MAX_RESOLUTION,e):this.removeAttribute(vk.MAX_RESOLUTION))}get minResolution(){var e;return null!=(e=this.getAttribute(vk.MIN_RESOLUTION))?e:void 0}set minResolution(e){e!==this.minResolution&&(e?this.setAttribute(vk.MIN_RESOLUTION,e):this.removeAttribute(vk.MIN_RESOLUTION))}get renditionOrder(){var e;return null!=(e=this.getAttribute(vk.RENDITION_ORDER))?e:void 0}set renditionOrder(e){e!==this.renditionOrder&&(e?this.setAttribute(vk.RENDITION_ORDER,e):this.removeAttribute(vk.RENDITION_ORDER))}get programStartTime(){let e=this.getAttribute(vk.PROGRAM_START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set programStartTime(e){null==e?this.removeAttribute(vk.PROGRAM_START_TIME):this.setAttribute(vk.PROGRAM_START_TIME,`${e}`)}get programEndTime(){let e=this.getAttribute(vk.PROGRAM_END_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set programEndTime(e){null==e?this.removeAttribute(vk.PROGRAM_END_TIME):this.setAttribute(vk.PROGRAM_END_TIME,`${e}`)}get assetStartTime(){let e=this.getAttribute(vk.ASSET_START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetStartTime(e){null==e?this.removeAttribute(vk.ASSET_START_TIME):this.setAttribute(vk.ASSET_START_TIME,`${e}`)}get assetEndTime(){let e=this.getAttribute(vk.ASSET_END_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetEndTime(e){null==e?this.removeAttribute(vk.ASSET_END_TIME):this.setAttribute(vk.ASSET_END_TIME,`${e}`)}get customDomain(){var e;return null!=(e=this.getAttribute(vk.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(vk.CUSTOM_DOMAIN,e):this.removeAttribute(vk.CUSTOM_DOMAIN))}get drmToken(){var e;return null!=(e=this.getAttribute(vk.DRM_TOKEN))?e:void 0}set drmToken(e){e!==this.drmToken&&(e?this.setAttribute(vk.DRM_TOKEN,e):this.removeAttribute(vk.DRM_TOKEN))}get playbackToken(){var e,t,i,r;if(this.hasAttribute(vk.PLAYBACK_TOKEN))return null!=(e=this.getAttribute(vk.PLAYBACK_TOKEN))?e:void 0;if(this.hasAttribute(vk.PLAYBACK_ID)){let[,e]=n5(null!=(t=this.playbackId)?t:"");return null!=(i=new URLSearchParams(e).get("token"))?i:void 0}if(this.src)return null!=(r=new URLSearchParams(this.src).get("token"))?r:void 0}set playbackToken(e){e!==this.playbackToken&&(e?this.setAttribute(vk.PLAYBACK_TOKEN,e):this.removeAttribute(vk.PLAYBACK_TOKEN))}get tokens(){let e=this.getAttribute(vk.PLAYBACK_TOKEN),t=this.getAttribute(vk.DRM_TOKEN);return{...mM(this,vE),...null!=e?{playback:e}:{},...null!=t?{drm:t}:{}}}set tokens(e){mN(this,vE,null!=e?e:{})}get ended(){return lS(this.nativeEl,this._hls)}get envKey(){var e;return null!=(e=this.getAttribute(vk.ENV_KEY))?e:void 0}set envKey(e){e!==this.envKey&&(e?this.setAttribute(vk.ENV_KEY,e):this.removeAttribute(vk.ENV_KEY))}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(vk.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(vk.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(vk.BEACON_COLLECTION_DOMAIN))}get streamType(){var e;return null!=(e=this.getAttribute(vk.STREAM_TYPE))?e:lf(this.nativeEl)}set streamType(e){e!==this.streamType&&(e?this.setAttribute(vk.STREAM_TYPE,e):this.removeAttribute(vk.STREAM_TYPE))}get targetLiveWindow(){return this.hasAttribute(vk.TARGET_LIVE_WINDOW)?+this.getAttribute(vk.TARGET_LIVE_WINDOW):lg(this.nativeEl)}set targetLiveWindow(e){e!=this.targetLiveWindow&&(null==e?this.removeAttribute(vk.TARGET_LIVE_WINDOW):this.setAttribute(vk.TARGET_LIVE_WINDOW,`${+e}`))}get liveEdgeStart(){var e,t;if(this.hasAttribute(vk.LIVE_EDGE_OFFSET)){let{liveEdgeOffset:i}=this,r=null!=(e=this.nativeEl.seekable.end(0))?e:0;return Math.max(null!=(t=this.nativeEl.seekable.start(0))?t:0,r-i)}return lE(this.nativeEl)}get liveEdgeOffset(){if(this.hasAttribute(vk.LIVE_EDGE_OFFSET))return+this.getAttribute(vk.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){e!=this.liveEdgeOffset&&(null==e?this.removeAttribute(vk.LIVE_EDGE_OFFSET):this.setAttribute(vk.LIVE_EDGE_OFFSET,`${+e}`))}get seekable(){return lv(this.nativeEl)}async addCuePoints(e){return oy(this.nativeEl,e)}get activeCuePoint(){return o_(this.nativeEl)}get cuePoints(){return function(e,t={label:oE}){let i=og(e,t.label,"metadata");return null!=i&&i.cues?Array.from(i.cues,e=>oT(e)):[]}(this.nativeEl)}async addChapters(e){return oI(this.nativeEl,e)}get activeChapter(){return oL(this.nativeEl)}get chapters(){return function(e,t={label:oS}){var i;let r=og(e,t.label,"chapters");return null!=(i=null==r?void 0:r.cues)&&i.length?Array.from(r.cues,e=>oR(e)):[]}(this.nativeEl)}getStartDate(){return function(e,t){if(t){let i=t.playingDate;if(null!=i)return new Date(i.getTime()-1e3*e.currentTime)}return"function"==typeof e.getStartDate?e.getStartDate():new Date(NaN)}(this.nativeEl,this._hls)}get currentPdt(){var e,t;return e=this.nativeEl,(t=this._hls)&&t.playingDate?t.playingDate:new Date("function"==typeof e.getStartDate?e.getStartDate().getTime()+1e3*e.currentTime:NaN)}get preferPlayback(){let e=this.getAttribute(vk.PREFER_PLAYBACK);if(e===nz.MSE||e===nz.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===nz.MSE||e===nz.NATIVE?this.setAttribute(vk.PREFER_PLAYBACK,e):this.removeAttribute(vk.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(e=>e.startsWith("metadata-")&&![vk.METADATA_URL].includes(e)).reduce((e,t)=>{let i=this.getAttribute(t);return null!=i&&(e[t.replace(/^metadata-/,"").replace(/-/g,"_")]=i),e},{}),...mM(this,vv)}}set metadata(e){mN(this,vv,null!=e?e:{}),this.mux&&this.mux.emit("hb",mM(this,vv))}get _hlsConfig(){return mM(this,vb)}set _hlsConfig(e){mN(this,vb,e)}get logo(){return this.getAttribute(vk.LOGO)}set logo(e){e?this.setAttribute(vk.LOGO,e):this.removeAttribute(vk.LOGO)}load(){mN(this,vp,lk(this,this.nativeEl,mM(this,vp)))}unload(){lR(this.nativeEl,mM(this,vp)),mN(this,vp,void 0)}attributeChangedCallback(e,t,i){var r,a;switch(f8.observedAttributes.includes(e)&&!["src","autoplay","preload"].includes(e)&&super.attributeChangedCallback(e,t,i),e){case vk.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=null!=i?i:void 0;break;case vk.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=null!=i?i:void 0;break;case"src":{let e=!!t,r=!!i;!e&&r?mP(this,vA,vS).call(this):e&&!r?this.unload():e&&r&&(this.unload(),mP(this,vA,vS).call(this));break}case"autoplay":if(i===t)break;null==(r=mM(this,vp))||r.setAutoplay(this.autoplay);break;case"preload":if(i===t)break;null==(a=mM(this,vp))||a.setPreload(i);break;case vk.PLAYBACK_ID:this.src=lu(this);break;case vk.DEBUG:{let e=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=e);break}case vk.METADATA_URL:i&&fetch(i).then(e=>e.json()).then(e=>this.metadata=e).catch(()=>console.error(`Unable to load or parse metadata JSON from metadata-url ${i}!`));break;case vk.STREAM_TYPE:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}));break;case vk.TARGET_LIVE_WINDOW:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0,detail:this.targetLiveWindow}))}}connectedCallback(){var e;null==(e=super.connectedCallback)||e.call(this),this.nativeEl&&this.src&&!mM(this,vp)&&mP(this,vA,vS).call(this)}disconnectedCallback(){this.unload()}};vp=new WeakMap,vf=new WeakMap,vg=new WeakMap,vv=new WeakMap,vE=new WeakMap,vb=new WeakMap,vy=new WeakMap,vT=new WeakMap,v_=new WeakMap,vA=new WeakSet,vS=async function(){mM(this,vf)||(await mN(this,vf,Promise.resolve()),mN(this,vf,null),this.load())};var vw,vD=class extends gO(vh(vL)){constructor(){super(...arguments),mO(this,vw)}get muxCastCustomData(){return{mux:{playbackId:this.playbackId,minResolution:this.minResolution,maxResolution:this.maxResolution,renditionOrder:this.renditionOrder,customDomain:this.customDomain,tokens:{drm:this.drmToken},envKey:this.envKey,metadata:this.metadata,disableCookies:this.disableCookies,disableTracking:this.disableTracking,beaconCollectionDomain:this.beaconCollectionDomain,startTime:this.startTime,preferCmcd:this.preferCmcd}}}get castCustomData(){var e;return null!=(e=mM(this,vw))?e:this.muxCastCustomData}set castCustomData(e){mN(this,vw,e)}};vw=new WeakMap,fX.customElements.get("mux-video")||(fX.customElements.define("mux-video",vD),fX.MuxVideoElement=vD);var vC=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},vx=(e,t,i)=>(vC(e,t,"read from private field"),i?i.call(e):t.get(e)),vM=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},vO=(e,t,i,r)=>(vC(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let vN={processCallback(e,t,i){if(i){for(let[e,r]of t)if(e in i){let t=i[e];"boolean"==typeof t&&r instanceof vV&&"boolean"==typeof r.element[r.attributeName]?r.booleanValue=t:"function"==typeof t&&r instanceof vV?r.element[r.attributeName]=t:r.value=t}}}};class vP extends dv.DocumentFragment{constructor(e,t,i=vN){var r;super(),vM(this,by,void 0),vM(this,bT,void 0),this.append(e.content.cloneNode(!0)),vO(this,by,vU(this)),vO(this,bT,i),null==(r=i.createCallback)||r.call(i,this,vx(this,by),t),i.processCallback(this,vx(this,by),t)}update(e){vx(this,bT).processCallback(this,vx(this,by),e)}}by=new WeakMap,bT=new WeakMap;let vU=(e,t=[])=>{let i,r;for(let a of e.attributes||[])if(a.value.includes("{{")){let s=new vH;for([i,r]of vB(a.value))if(i){let i=new vV(e,a.name,a.namespaceURI);s.append(i),t.push([r,i])}else s.append(r);a.value=s.toString()}for(let a of e.childNodes)if(1!==a.nodeType||a instanceof HTMLTemplateElement){let s=a.data;if(1===a.nodeType||s.includes("{{")){let n=[];if(s)for([i,r]of vB(s))if(i){let i=new vK(e);n.push(i),t.push([r,i])}else n.push(new Text(r));else if(a instanceof HTMLTemplateElement){let i=new vW(e,a);n.push(i),t.push([i.expression,i])}a.replaceWith(...n.flatMap(e=>e.replacementNodes||[e]))}}else vU(a,t);return t},vF={},vB=e=>{let t="",i=0,r=vF[e],a=0,s;if(r)return r;for(r=[];s=e[a];a++)"{"===s&&"{"===e[a+1]&&"\\"!==e[a-1]&&e[a+2]&&1==++i?(t&&r.push([0,t]),t="",a++):"}"!==s||"}"!==e[a+1]||"\\"===e[a-1]||--i?t+=s||"":(r.push([1,t.trim()]),t="",a++);return t&&r.push([0,(i>0?"{{":"")+t]),vF[e]=r};class v${get value(){return""}set value(e){}toString(){return this.value}}let vG=new WeakMap;class vH{constructor(){vM(this,b_,[])}[Symbol.iterator](){return vx(this,b_).values()}get length(){return vx(this,b_).length}item(e){return vx(this,b_)[e]}append(...e){for(let t of e)t instanceof vV&&vG.set(t,this),vx(this,b_).push(t)}toString(){return vx(this,b_).join("")}}b_=new WeakMap;class vV extends v${constructor(e,t,i){super(),vM(this,bI),vM(this,bA,""),vM(this,bS,void 0),vM(this,bk,void 0),vM(this,bR,void 0),vO(this,bS,e),vO(this,bk,t),vO(this,bR,i)}get attributeName(){return vx(this,bk)}get attributeNamespace(){return vx(this,bR)}get element(){return vx(this,bS)}get value(){return vx(this,bA)}set value(e){vx(this,bA)!==e&&(vO(this,bA,e),vx(this,bI,bL)&&1!==vx(this,bI,bL).length?vx(this,bS).setAttributeNS(vx(this,bR),vx(this,bk),vx(this,bI,bL).toString()):null==e?vx(this,bS).removeAttributeNS(vx(this,bR),vx(this,bk)):vx(this,bS).setAttributeNS(vx(this,bR),vx(this,bk),e))}get booleanValue(){return vx(this,bS).hasAttributeNS(vx(this,bR),vx(this,bk))}set booleanValue(e){if(vx(this,bI,bL)&&1!==vx(this,bI,bL).length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}}bA=new WeakMap,bS=new WeakMap,bk=new WeakMap,bR=new WeakMap,bI=new WeakSet,bL=function(){return vG.get(this)};class vK extends v${constructor(e,t){super(),vM(this,bw,void 0),vM(this,bD,void 0),vO(this,bw,e),vO(this,bD,t?[...t]:[new Text])}get replacementNodes(){return vx(this,bD)}get parentNode(){return vx(this,bw)}get nextSibling(){return vx(this,bD)[vx(this,bD).length-1].nextSibling}get previousSibling(){return vx(this,bD)[0].previousSibling}get value(){return vx(this,bD).map(e=>e.textContent).join("")}set value(e){this.replace(e)}replace(...e){let t=e.flat().flatMap(e=>null==e?[new Text]:e.forEach?[...e]:11===e.nodeType?[...e.childNodes]:e.nodeType?[e]:[new Text(e)]);t.length||t.push(new Text),vO(this,bD,function(e,t,i,r=null){let a=0,s,n,o,l=i.length,d=t.length;for(;a<l&&a<d&&t[a]==i[a];)a++;for(;a<l&&a<d&&i[l-1]==t[d-1];)r=i[--d,--l];if(a==d)for(;a<l;)e.insertBefore(i[a++],r);if(a==l)for(;a<d;)e.removeChild(t[a++]);else{for(s=t[a];a<l;)o=i[a++],n=s?s.nextSibling:r,s==o?s=n:a<l&&i[a]==n?(e.replaceChild(o,s),s=n):e.insertBefore(o,s);for(;s!=r;)n=s.nextSibling,e.removeChild(s),s=n}return i}(vx(this,bD)[0].parentNode,vx(this,bD),t,this.nextSibling))}}bw=new WeakMap,bD=new WeakMap;class vW extends vK{constructor(e,t){let i=t.getAttribute("directive")||t.getAttribute("type"),r=t.getAttribute("expression")||t.getAttribute(i)||"";r.startsWith("{{")&&(r=r.trim().slice(2,-2).trim()),super(e),this.expression=r,this.template=t,this.directive=i}}let vY={string:e=>String(e)};class vq{constructor(e){this.template=e,this.state=void 0}}let vj=new WeakMap,vz=new WeakMap,vX={partial:(e,t)=>{t[e.expression]=new vq(e.template)},if:(e,t)=>{var i;if(v0(e.expression,t)){if(vj.get(e)!==e.template){vj.set(e,e.template);let i=new vP(e.template,t,vZ);e.replace(i),vz.set(e,i)}else null==(i=vz.get(e))||i.update(t)}else e.replace(""),vj.delete(e),vz.delete(e)}},vQ=Object.keys(vX),vZ={processCallback(e,t,i){var r,a;if(i)for(let[e,s]of t){if(s instanceof vW){if(!s.directive){let e=vQ.find(e=>s.template.hasAttribute(e));e&&(s.directive=e,s.expression=s.template.getAttribute(e))}null==(r=vX[s.directive])||r.call(vX,s,i);continue}let t=v0(e,i);if(t instanceof vq){vj.get(s)!==t.template?(vj.set(s,t.template),t=new vP(t.template,t.state,vZ),s.value=t,vz.set(s,t)):null==(a=vz.get(s))||a.update(t.state);continue}t?(s instanceof vV&&s.attributeName.startsWith("aria-")&&(t=String(t)),s instanceof vV?"boolean"==typeof t?s.booleanValue=t:"function"==typeof t?s.element[s.attributeName]=t:s.value=t:(s.value=t,vj.delete(s),vz.delete(s))):s instanceof vV?s.value=void 0:(s.value=void 0,vj.delete(s),vz.delete(s))}}},vJ={"!":e=>!e,"!!":e=>!!e,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,"??":(e,t)=>null!=e?e:t,"|":(e,t)=>{var i;return null==(i=vY[t])?void 0:i.call(vY,e)}};function v0(e,t={}){var i,r,a,s,n,o,l;let d=(function(e,t){let i,r,a;let s=[];for(;e;){for(let s in a=null,i=e.length,t)(r=t[s].exec(e))&&r.index<i&&(a={token:r[0],type:s,matches:r.slice(1)},i=r.index);i&&s.push({token:e.substr(0,i),type:void 0}),a&&s.push(a),e=e.substr(i+(a?a.token.length:0))}return s})(e,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=><][=!]?|\?\?|\|/,ws:/\s+/,param:/[$a-z_][$\w]*/i}).filter(({type:e})=>"ws"!==e);if(0===d.length||d.some(({type:e})=>!e))return v1(e);if((null==(i=d[0])?void 0:i.token)===">"){let i=t[null==(r=d[1])?void 0:r.token];if(!i)return v1(e);let o={...t};i.state=o;let l=d.slice(2);for(let e=0;e<l.length;e+=3){let i=null==(a=l[e])?void 0:a.token,r=null==(s=l[e+1])?void 0:s.token,d=null==(n=l[e+2])?void 0:n.token;i&&"="===r&&(o[i]=v3(d,t))}return i}if(1===d.length)return v2(d[0])?v3(d[0].token,t):v1(e);if(2===d.length){let i=vJ[null==(o=d[0])?void 0:o.token];return i&&v2(d[1])?i(v3(d[1].token,t)):v1(e)}if(3===d.length){let i=null==(l=d[1])?void 0:l.token,r=vJ[i];if(!r||!v2(d[0])||!v2(d[2]))return v1(e);let a=v3(d[0].token,t);return r(a,"|"===i?d[2].token:v3(d[2].token,t))}}function v1(e){return console.warn(`Warning: invalid expression \`${e}\``),!1}function v2({type:e}){return["number","boolean","string","param"].includes(e)}function v3(e,t){let i=e[0],r=e.slice(-1);return"true"===e||"false"===e?"true"===e:i===r&&["'",'"'].includes(i)?e.slice(1,-1):l6(e)?parseFloat(e):t[e]}var v4=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},v5=(e,t,i)=>(v4(e,t,"read from private field"),i?i.call(e):t.get(e)),v8=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},v9=(e,t,i,r)=>(v4(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),v6=(e,t,i)=>(v4(e,t,"access private method"),i);let v7={mediatargetlivewindow:"targetlivewindow",mediastreamtype:"streamtype"},Ee=dE.createElement("template");Ee.innerHTML=`
  <style>
    :host {
      display: inline-block;
      line-height: 0;
    }

    media-controller {
      width: 100%;
      height: 100%;
    }

    media-captions-button:not([mediasubtitleslist]),
    media-captions-menu:not([mediasubtitleslist]),
    media-captions-menu-button:not([mediasubtitleslist]),
    media-audio-track-menu[mediaaudiotrackunavailable],
    media-audio-track-menu-button[mediaaudiotrackunavailable],
    media-rendition-menu[mediarenditionunavailable],
    media-rendition-menu-button[mediarenditionunavailable],
    media-volume-range[mediavolumeunavailable],
    media-airplay-button[mediaairplayunavailable],
    media-fullscreen-button[mediafullscreenunavailable],
    media-cast-button[mediacastunavailable],
    media-pip-button[mediapipunavailable] {
      display: none;
    }
  </style>
`;class Et extends dv.HTMLElement{constructor(){super(),v8(this,bO),v8(this,bP),v8(this,bC,void 0),v8(this,bx,void 0),v8(this,bM,void 0),this.shadowRoot?this.renderRoot=this.shadowRoot:(this.renderRoot=this.attachShadow({mode:"open"}),this.createRenderer());let e=new MutationObserver(e=>{var t;(!this.mediaController||(null==(t=this.mediaController)?void 0:t.breakpointsComputed))&&e.some(e=>{let t=e.target;return t===this||"media-controller"===t.localName&&!!(v7[e.attributeName]||e.attributeName.startsWith("breakpoint"))})&&this.render()});e.observe(this,{attributes:!0}),e.observe(this.renderRoot,{attributes:!0,subtree:!0}),this.addEventListener(lz.BREAKPOINTS_COMPUTED,this.render),v6(this,bO,bN).call(this,"template")}get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var e;return null!=(e=v5(this,bC))?e:this.constructor.template}set template(e){v9(this,bM,null),v9(this,bC,e),this.createRenderer()}get props(){var e,t,i;let r=[...Array.from(null!=(t=null==(e=this.mediaController)?void 0:e.attributes)?t:[]).filter(({name:e})=>v7[e]||e.startsWith("breakpoint")),...Array.from(this.attributes)],a={};for(let e of r){let t=null!=(i=v7[e.name])?i:e.name.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase()),{value:r}=e;null!=r?(l6(r)&&(r=parseFloat(r)),a[t]=""===r||r):a[t]=!1}return a}attributeChangedCallback(e,t,i){"template"===e&&t!=i&&v6(this,bP,bU).call(this)}connectedCallback(){v6(this,bP,bU).call(this)}createRenderer(){this.template&&this.template!==v5(this,bx)&&(v9(this,bx,this.template),this.renderer=new vP(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(Ee.content.cloneNode(!0),this.renderer))}render(){var e;null==(e=this.renderer)||e.update(this.props)}}async function Ei(e){let t=await fetch(e);if(200!==t.status)throw Error(`Failed to load resource: the server responded with a status of ${t.status}`);return t.text()}function Er(e){return e.split("-")[0]}bC=new WeakMap,bx=new WeakMap,bM=new WeakMap,bO=new WeakSet,bN=function(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}},bP=new WeakSet,bU=function(){var e;let t=this.getAttribute("template");if(!t||t===v5(this,bM))return;let i=this.getRootNode(),r=null==(e=null==i?void 0:i.getElementById)?void 0:e.call(i,t);if(r){v9(this,bM,t),v9(this,bC,r),this.createRenderer();return}(function(e){if(!/^(\/|\.\/|https?:\/\/)/.test(e))return!1;let t=/^https?:\/\//.test(e)?void 0:location.origin;try{new URL(e,t)}catch(e){return!1}return!0})(t)&&(v9(this,bM,t),Ei(t).then(e=>{let t=dE.createElement("template");t.innerHTML=e,v9(this,bC,t),this.createRenderer()}).catch(console.error))},Et.observedAttributes=["template"],Et.processor=vZ,dv.customElements.get("media-theme")||dv.customElements.define("media-theme",Et);class Ea extends Event{constructor({action:e="auto",relatedTarget:t,...i}){super("invoke",i),this.action=e,this.relatedTarget=t}}class Es extends Event{constructor({newState:e,oldState:t,...i}){super("toggle",i),this.newState=e,this.oldState=t}}var En=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},Eo=(e,t,i)=>(En(e,t,"read from private field"),i?i.call(e):t.get(e)),El=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},Ed=(e,t,i,r)=>(En(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),Eu=(e,t,i)=>(En(e,t,"access private method"),i);function Eh({type:e,text:t,value:i,checked:r}){let a=dE.createElement("media-chrome-menu-item");a.type=null!=e?e:"",a.part.add("menu-item"),e&&a.part.add(e),a.value=i,a.checked=r;let s=dE.createElement("span");return s.textContent=t,a.append(s),a}function Ec(e,t){let i=e.querySelector(`:scope > [slot="${t}"]`);if((null==i?void 0:i.nodeName)=="SLOT"&&(i=i.assignedElements({flatten:!0})[0]),i)return i.cloneNode(!0);let r=e.shadowRoot.querySelector(`[name="${t}"] > svg`);return r?r.cloneNode(!0):""}let Em=dE.createElement("template");Em.innerHTML=`
  <style>
    :host {
      font: var(--media-font,
        var(--media-font-weight, normal)
        var(--media-font-size, 14px) /
        var(--media-text-content-height, var(--media-control-height, 24px))
        var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
      color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
      --_menu-bg: rgb(20 20 30 / .8);
      background: var(--media-menu-background, var(--media-control-background, var(--media-secondary-color, var(--_menu-bg))));
      border-radius: var(--media-menu-border-radius);
      border: var(--media-menu-border, none);
      display: var(--media-menu-display, inline-flex);
      transition: var(--media-menu-transition-in,
        visibility 0s,
        opacity .2s ease-out,
        transform .15s ease-out,
        left .2s ease-in-out,
        min-width .2s ease-in-out,
        min-height .2s ease-in-out
      ) !important;
      
      visibility: var(--media-menu-visibility, visible);
      opacity: var(--media-menu-opacity, 1);
      max-height: var(--media-menu-max-height, var(--_menu-max-height, 300px));
      transform: var(--media-menu-transform-in, translateY(0) scale(1));
      flex-direction: column;
      
      min-height: 0;
      position: relative;
      bottom: var(--_menu-bottom);
      box-sizing: border-box;
    } 

    @-moz-document url-prefix() {
      :host{
        --_menu-bg: rgb(20 20 30);
      }
    }

    :host([hidden]) {
      transition: var(--media-menu-transition-out,
        visibility .15s ease-in,
        opacity .15s ease-in,
        transform .15s ease-in
      ) !important;
      visibility: var(--media-menu-hidden-visibility, hidden);
      opacity: var(--media-menu-hidden-opacity, 0);
      max-height: var(--media-menu-hidden-max-height,
        var(--media-menu-max-height, var(--_menu-max-height, 300px)));
      transform: var(--media-menu-transform-out, translateY(2px) scale(.99));
      pointer-events: none;
    }

    :host([slot="submenu"]) {
      background: none;
      width: 100%;
      min-height: 100%;
      position: absolute;
      bottom: 0;
      right: -100%;
    }

    #container {
      display: flex;
      flex-direction: column;
      min-height: 0;
      transition: transform .2s ease-out;
      transform: translate(0, 0);
    }

    #container.has-expanded {
      transition: transform .2s ease-in;
      transform: translate(-100%, 0);
    }

    button {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      outline: inherit;
      display: inline-flex;
      align-items: center;
    }

    slot[name="header"][hidden] {
      display: none;
    }

    slot[name="header"] > *,
    slot[name="header"]::slotted(*) {
      padding: .4em .7em;
      border-bottom: 1px solid rgb(255 255 255 / .25);
      cursor: var(--media-cursor, default);
    }

    slot[name="header"] > button[part~="back"],
    slot[name="header"]::slotted(button[part~="back"]) {
      cursor: var(--media-cursor, pointer);
    }

    svg[part~="back"] {
      height: var(--media-menu-icon-height, var(--media-control-height, 24px));
      fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
      display: block;
      margin-right: .5ch;
    }

    slot:not([name]) {
      gap: var(--media-menu-gap);
      flex-direction: var(--media-menu-flex-direction, column);
      overflow: var(--media-menu-overflow, hidden auto);
      display: flex;
      min-height: 0;
    }

    :host([role="menu"]) slot:not([name]) {
      padding-block: .4em;
    }

    slot:not([name])::slotted([role="menu"]) {
      background: none;
    }

    media-chrome-menu-item > span {
      margin-right: .5ch;
      max-width: var(--media-menu-item-max-width);
      text-overflow: ellipsis;
      overflow: hidden;
    }
  </style>
  <style id="layout-row" media="width:0">

    slot[name="header"] > *,
    slot[name="header"]::slotted(*) {
      padding: .4em .5em;
    }

    slot:not([name]) {
      gap: var(--media-menu-gap, .25em);
      flex-direction: var(--media-menu-flex-direction, row);
      padding-inline: .5em;
    }

    media-chrome-menu-item {
      padding: .3em .5em;
    }

    media-chrome-menu-item[aria-checked="true"] {
      background: var(--media-menu-item-checked-background, rgb(255 255 255 / .2));
    }

    
    media-chrome-menu-item::part(checked-indicator) {
      display: var(--media-menu-item-checked-indicator-display, none);
    }
  </style>
  <div id="container">
    <slot name="header" hidden>
      <button part="back button" aria-label="Back to previous menu">
        <slot name="back-icon">
          <svg aria-hidden="true" viewBox="0 0 20 24" part="back indicator">
            <path d="m11.88 17.585.742-.669-4.2-4.665 4.2-4.666-.743-.669-4.803 5.335 4.803 5.334Z"/>
          </svg>
        </slot>
        <slot name="title"></slot>
      </button>
    </slot>
    <slot></slot>
  </div>
  <slot name="checked-indicator" hidden></slot>
`;let Ep={STYLE:"style",HIDDEN:"hidden",DISABLED:"disabled",ANCHOR:"anchor"};class Ef extends dv.HTMLElement{constructor(){super(),El(this,bW),El(this,bj),El(this,bX),El(this,bZ),El(this,b0),El(this,b4),El(this,b8),El(this,b6),El(this,ye),El(this,yi),El(this,ya),El(this,yn),El(this,yl),El(this,yu),El(this,yc),El(this,yp),El(this,yg),El(this,bF,null),El(this,bB,null),El(this,b$,null),El(this,bG,new Set),El(this,bH,void 0),El(this,bV,!1),El(this,bK,null),El(this,bq,()=>{let e=Eo(this,bG),t=new Set(this.items);for(let i of e)t.has(i)||this.dispatchEvent(new CustomEvent("removemenuitem",{detail:i}));for(let i of t)e.has(i)||this.dispatchEvent(new CustomEvent("addmenuitem",{detail:i}));Ed(this,bG,t)}),El(this,b2,()=>{Eu(this,b4,b5).call(this),Eu(this,b8,b9).call(this,!1)}),El(this,b3,()=>{Eu(this,b4,b5).call(this)}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.nativeEl=this.constructor.template.content.cloneNode(!0),this.shadowRoot.append(this.nativeEl)),this.container=this.shadowRoot.querySelector("#container"),this.defaultSlot=this.shadowRoot.querySelector("slot:not([name])"),this.shadowRoot.addEventListener("slotchange",this),Ed(this,bH,new MutationObserver(Eo(this,bq))),Eo(this,bH).observe(this.defaultSlot,{childList:!0})}static get observedAttributes(){return[Ep.DISABLED,Ep.HIDDEN,Ep.STYLE,Ep.ANCHOR,lW.MEDIA_CONTROLLER]}static formatMenuItemText(e,t){return e}enable(){this.addEventListener("click",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this),this.addEventListener("invoke",this),this.addEventListener("toggle",this)}disable(){this.removeEventListener("click",this),this.removeEventListener("focusout",this),this.removeEventListener("keyup",this),this.removeEventListener("invoke",this),this.removeEventListener("toggle",this)}handleEvent(e){switch(e.type){case"slotchange":Eu(this,bW,bY).call(this,e);break;case"invoke":Eu(this,bX,bQ).call(this,e);break;case"click":Eu(this,b6,b7).call(this,e);break;case"toggle":Eu(this,yi,yr).call(this,e);break;case"focusout":Eu(this,yn,yo).call(this,e);break;case"keydown":Eu(this,yl,yd).call(this,e)}}connectedCallback(){var e,t;Ed(this,bK,dN(this.shadowRoot,":host")),Eu(this,bj,bz).call(this),this.hasAttribute("disabled")||this.enable(),this.role||(this.role="menu"),Ed(this,bF,dk(this)),null==(t=null==(e=Eo(this,bF))?void 0:e.associateElement)||t.call(e,this),this.hidden||(d_(Ev(this),Eo(this,b2)),d_(this,Eo(this,b3)))}disconnectedCallback(){var e,t;dA(Ev(this),Eo(this,b2)),dA(this,Eo(this,b3)),this.disable(),null==(t=null==(e=Eo(this,bF))?void 0:e.unassociateElement)||t.call(e,this),Ed(this,bF,null)}attributeChangedCallback(e,t,i){var r,a,s,n;e===Ep.HIDDEN&&i!==t?(Eo(this,bV)||Ed(this,bV,!0),this.hidden?Eu(this,b0,b1).call(this):Eu(this,bZ,bJ).call(this),this.dispatchEvent(new Es({oldState:this.hidden?"open":"closed",newState:this.hidden?"closed":"open",bubbles:!0}))):e===lW.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=Eo(this,bF))?void 0:r.unassociateElement)||a.call(r,this),Ed(this,bF,null)),i&&this.isConnected&&(Ed(this,bF,dk(this)),null==(n=null==(s=Eo(this,bF))?void 0:s.associateElement)||n.call(s,this))):e===Ep.DISABLED&&i!==t?null==i?this.enable():this.disable():e===Ep.STYLE&&i!==t&&Eu(this,bj,bz).call(this)}formatMenuItemText(e,t){return this.constructor.formatMenuItemText(e,t)}get anchor(){return this.getAttribute("anchor")}set anchor(e){this.setAttribute("anchor",`${e}`)}get anchorElement(){var e;return this.anchor?null==(e=dx(this))?void 0:e.querySelector(`#${this.anchor}`):null}get items(){return this.defaultSlot.assignedElements({flatten:!0}).filter(Eg)}get radioGroupItems(){return this.items.filter(e=>"menuitemradio"===e.role)}get checkedItems(){return this.items.filter(e=>e.checked)}get value(){var e,t;return null!=(t=null==(e=this.checkedItems[0])?void 0:e.value)?t:""}set value(e){let t=this.items.find(t=>t.value===e);t&&Eu(this,yg,yv).call(this,t)}focus(){if(Ed(this,bB,dC()),this.items.length){Eu(this,yp,yf).call(this,this.items[0]),this.items[0].focus();return}let e=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');null==e||e.focus()}handleSelect(e){var t;let i=Eu(this,yu,yh).call(this,e);i&&(Eu(this,yg,yv).call(this,i,"checkbox"===i.type),Eo(this,b$)&&!this.hidden&&(null==(t=Eo(this,bB))||t.focus(),this.hidden=!0))}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","Home","End"]}handleMove(e){var t,i;let{key:r}=e,a=this.items,s=null!=(i=null!=(t=Eu(this,yu,yh).call(this,e))?t:Eu(this,yc,ym).call(this))?i:a[0],n=Math.max(0,a.indexOf(s));"ArrowDown"===r?n++:"ArrowUp"===r?n--:"Home"===e.key?n=0:"End"===e.key&&(n=a.length-1),n<0&&(n=a.length-1),n>a.length-1&&(n=0),Eu(this,yp,yf).call(this,a[n]),a[n].focus()}}function Eg(e){return["menuitem","menuitemradio","menuitemcheckbox"].includes(null==e?void 0:e.role)}function Ev(e){var t;return null!=(t=e.getAttribute("bounds")?dD(e,`#${e.getAttribute("bounds")}`):dS(e)||e.parentElement)?t:e}bF=new WeakMap,bB=new WeakMap,b$=new WeakMap,bG=new WeakMap,bH=new WeakMap,bV=new WeakMap,bK=new WeakMap,bW=new WeakSet,bY=function(e){let t=e.target;for(let e of t.assignedNodes({flatten:!0}))3===e.nodeType&&""===e.textContent.trim()&&e.remove();["header","title"].includes(t.name)&&(this.shadowRoot.querySelector('slot[name="header"]').hidden=0===t.assignedNodes().length),t.name||Eo(this,bq).call(this)},bq=new WeakMap,bj=new WeakSet,bz=function(){var e;let t=this.shadowRoot.querySelector("#layout-row"),i=null==(e=getComputedStyle(this).getPropertyValue("--media-menu-layout"))?void 0:e.trim();t.setAttribute("media","row"===i?"":"width:0")},bX=new WeakSet,bQ=function(e){Ed(this,b$,e.relatedTarget),dw(this,e.relatedTarget)||(this.hidden=!this.hidden)},bZ=new WeakSet,bJ=function(){var e;null==(e=Eo(this,b$))||e.setAttribute("aria-expanded","true"),this.addEventListener("transitionend",()=>this.focus(),{once:!0}),d_(Ev(this),Eo(this,b2)),d_(this,Eo(this,b3))},b0=new WeakSet,b1=function(){var e;null==(e=Eo(this,b$))||e.setAttribute("aria-expanded","false"),dA(Ev(this),Eo(this,b2)),dA(this,Eo(this,b3))},b2=new WeakMap,b3=new WeakMap,b4=new WeakSet,b5=function(e){if(this.hasAttribute("mediacontroller")&&!this.anchor||this.hidden||!this.anchorElement)return;let{x:t,y:i}=function({anchor:e,floating:t,placement:i}){let{x:r,y:a}=function({anchor:e,floating:t},i){let r;let a="x"==(["top","bottom"].includes(Er(i))?"y":"x")?"y":"x",s="y"===a?"height":"width",n=Er(i),o=e.x+e.width/2-t.width/2,l=e.y+e.height/2-t.height/2,d=e[s]/2-t[s]/2;switch(n){case"top":r={x:o,y:e.y-t.height};break;case"bottom":r={x:o,y:e.y+e.height};break;case"right":r={x:e.x+e.width,y:l};break;case"left":r={x:e.x-t.width,y:l};break;default:r={x:e.x,y:e.y}}switch(i.split("-")[1]){case"start":r[a]-=d;break;case"end":r[a]+=d}return r}(function({anchor:e,floating:t}){return{anchor:function(e,t){var i;let r=e.getBoundingClientRect(),a=null!=(i=null==t?void 0:t.getBoundingClientRect())?i:{x:0,y:0};return{x:r.x-a.x,y:r.y-a.y,width:r.width,height:r.height}}(e,t.offsetParent),floating:{x:0,y:0,width:t.offsetWidth,height:t.offsetHeight}}}({anchor:e,floating:t}),i);return{x:r,y:a}}({anchor:this.anchorElement,floating:this,placement:"top-start"});null!=e||(e=this.offsetWidth);let r=Ev(this).getBoundingClientRect(),a=r.width-t-e,s=r.height-i-this.offsetHeight,{style:n}=Eo(this,bK);n.setProperty("position","absolute"),n.setProperty("right",`${Math.max(0,a)}px`),n.setProperty("--_menu-bottom",`${s}px`);let o=getComputedStyle(this),l=n.getPropertyValue("--_menu-bottom")===o.bottom?s:parseFloat(o.bottom),d=r.height-l-parseFloat(o.marginBottom);this.style.setProperty("--_menu-max-height",`${d}px`)},b8=new WeakSet,b9=function(e){let t=this.querySelector('[role="menuitem"][aria-haspopup][aria-expanded="true"]'),i=null==t?void 0:t.querySelector('[role="menu"]'),{style:r}=Eo(this,bK);if(e||r.setProperty("--media-menu-transition-in","none"),i){let e=i.offsetHeight,r=Math.max(i.offsetWidth,t.offsetWidth);this.style.setProperty("min-width",`${r}px`),this.style.setProperty("min-height",`${e}px`),Eu(this,b4,b5).call(this,r)}else this.style.removeProperty("min-width"),this.style.removeProperty("min-height"),Eu(this,b4,b5).call(this);r.removeProperty("--media-menu-transition-in")},b6=new WeakSet,b7=function(e){var t;if(e.stopPropagation(),e.composedPath().includes(Eo(this,ye,yt))){null==(t=Eo(this,bB))||t.focus(),this.hidden=!0;return}let i=Eu(this,yu,yh).call(this,e);!i||i.hasAttribute("disabled")||(Eu(this,yp,yf).call(this,i),this.handleSelect(e))},ye=new WeakSet,yt=function(){var e;return null==(e=this.shadowRoot.querySelector('slot[name="header"]').assignedElements({flatten:!0}))?void 0:e.find(e=>e.matches('button[part~="back"]'))},yi=new WeakSet,yr=function(e){if(e.target===this)return;Eu(this,ya,ys).call(this);let t=Array.from(this.querySelectorAll('[role="menuitem"][aria-haspopup]'));for(let i of t)i.invokeTargetElement==e.target||"open"!=e.newState||"true"!=i.getAttribute("aria-expanded")||i.invokeTargetElement.hidden||i.invokeTargetElement.dispatchEvent(new Ea({relatedTarget:i}));for(let e of t)e.setAttribute("aria-expanded",`${!e.submenuElement.hidden}`);Eu(this,b8,b9).call(this,!0)},ya=new WeakSet,ys=function(){let e=this.querySelector('[role="menuitem"] > [role="menu"]:not([hidden])');this.container.classList.toggle("has-expanded",!!e)},yn=new WeakSet,yo=function(e){var t;dw(this,e.relatedTarget)||(Eo(this,bV)&&(null==(t=Eo(this,bB))||t.focus()),!Eo(this,b$)||Eo(this,b$)===e.relatedTarget||this.hidden||(this.hidden=!0))},yl=new WeakSet,yd=function(e){var t,i,r,a,s;let{key:n,ctrlKey:o,altKey:l,metaKey:d}=e;if(!o&&!l&&!d&&this.keysUsed.includes(n)){if(e.preventDefault(),e.stopPropagation(),"Tab"===n){if(Eo(this,bV)){this.hidden=!0;return}e.shiftKey?null==(i=null==(t=this.previousElementSibling)?void 0:t.focus)||i.call(t):null==(a=null==(r=this.nextElementSibling)?void 0:r.focus)||a.call(r),this.blur()}else"Escape"===n?(null==(s=Eo(this,bB))||s.focus(),Eo(this,bV)&&(this.hidden=!0)):"Enter"===n||" "===n?this.handleSelect(e):this.handleMove(e)}},yu=new WeakSet,yh=function(e){return e.composedPath().find(e=>["menuitemradio","menuitemcheckbox"].includes(e.role))},yc=new WeakSet,ym=function(){return this.items.find(e=>0===e.tabIndex)},yp=new WeakSet,yf=function(e){for(let t of this.items)t.tabIndex=t===e?0:-1},yg=new WeakSet,yv=function(e,t){let i=[...this.checkedItems];"radio"===e.type&&this.radioGroupItems.forEach(e=>e.checked=!1),t?e.checked=!e.checked:e.checked=!0,this.checkedItems.some((e,t)=>e!=i[t])&&this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))},Ef.template=Em,dv.customElements.get("media-chrome-menu")||dv.customElements.define("media-chrome-menu",Ef);var EE=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},Eb=(e,t,i)=>(EE(e,t,"read from private field"),i?i.call(e):t.get(e)),Ey=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},ET=(e,t,i,r)=>(EE(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),E_=(e,t,i)=>(EE(e,t,"access private method"),i);let EA=dE.createElement("template");EA.innerHTML=`
  <style>
    :host {
      transition: var(--media-menu-item-transition,
        background .15s linear,
        opacity .2s ease-in-out
      );
      outline: var(--media-menu-item-outline, 0);
      outline-offset: var(--media-menu-item-outline-offset, -1px);
      cursor: var(--media-cursor, pointer);
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-self: stretch;
      white-space: nowrap;
      white-space-collapse: collapse;
      text-wrap: nowrap;
      padding: .4em .8em .4em 1em;
    }

    :host(:focus-visible) {
      box-shadow: var(--media-menu-item-focus-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
      outline: var(--media-menu-item-hover-outline, 0);
      outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));
    }

    :host(:hover) {
      cursor: var(--media-cursor, pointer);
      background: var(--media-menu-item-hover-background, rgb(92 92 102 / .5));
      outline: var(--media-menu-item-hover-outline);
      outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));
    }

    :host([aria-checked="true"]) {
      background: var(--media-menu-item-checked-background);
    }

    :host([hidden]) {
      display: none;
    }

    :host([disabled]) {
      pointer-events: none;
      color: rgba(255, 255, 255, .3);
    }

    slot:not([name]) {
      width: 100%;
    }

    slot:not([name="submenu"]) {
      display: inline-flex;
      align-items: center;
      transition: inherit;
      opacity: var(--media-menu-item-opacity, 1);
    }

    slot[name="description"] {
      justify-content: end;
    }

    slot[name="description"] > span {
      display: inline-block;
      margin-inline: 1em .2em;
      max-width: var(--media-menu-item-description-max-width, 100px);
      text-overflow: ellipsis;
      overflow: hidden;
      font-size: .8em;
      font-weight: 400;
      text-align: right;
      position: relative;
      top: .04em;
    }

    slot[name="checked-indicator"] {
      display: none;
    }

    :host(:is([role="menuitemradio"],[role="menuitemcheckbox"])) slot[name="checked-indicator"] {
      display: var(--media-menu-item-checked-indicator-display, inline-block);
    }

    
    svg, img, ::slotted(svg), ::slotted(img) {
      height: var(--media-menu-item-icon-height, var(--media-control-height, 24px));
      fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
      display: block;
    }

    
    [part~="indicator"],
    ::slotted([part~="indicator"]) {
      fill: var(--media-menu-item-indicator-fill,
        var(--media-icon-color, var(--media-primary-color, rgb(238 238 238))));
      height: var(--media-menu-item-indicator-height, 1.25em);
      margin-right: .5ch;
    }

    [part~="checked-indicator"] {
      visibility: hidden;
    }

    :host([aria-checked="true"]) [part~="checked-indicator"] {
      visibility: visible;
    }
  </style>
  <slot name="checked-indicator">
    <svg aria-hidden="true" viewBox="0 1 24 24" part="checked-indicator indicator">
      <path d="m10 15.17 9.193-9.191 1.414 1.414-10.606 10.606-6.364-6.364 1.414-1.414 4.95 4.95Z"/>
    </svg>
  </slot>
  <slot name="prefix"></slot>
  <slot></slot>
  <slot name="description"></slot>
  <slot name="suffix"></slot>
  <slot name="submenu"></slot>
`;let ES={TYPE:"type",VALUE:"value",CHECKED:"checked",DISABLED:"disabled"};class Ek extends dv.HTMLElement{constructor(){super(),Ey(this,yy),Ey(this,y_),Ey(this,yS),Ey(this,yI),Ey(this,yw),Ey(this,yC),Ey(this,yE,!1),Ey(this,yb,void 0),Ey(this,yR,()=>{var e,t;this.setAttribute("submenusize",`${this.submenuElement.items.length}`);let i=this.shadowRoot.querySelector('slot[name="description"]'),r=null==(e=this.submenuElement.checkedItems)?void 0:e[0],a=null!=(t=null==r?void 0:r.dataset.description)?t:null==r?void 0:r.text,s=dE.createElement("span");s.textContent=null!=a?a:"",i.replaceChildren(s)}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.append(this.constructor.template.content.cloneNode(!0))),this.shadowRoot.addEventListener("slotchange",this)}static get observedAttributes(){return[ES.TYPE,ES.DISABLED,ES.CHECKED,ES.VALUE]}enable(){this.hasAttribute("tabindex")||this.setAttribute("tabindex","-1"),ER(this)&&!this.hasAttribute("aria-checked")&&this.setAttribute("aria-checked","false"),this.addEventListener("click",this),this.addEventListener("keydown",this)}disable(){this.removeAttribute("tabindex"),this.removeEventListener("click",this),this.removeEventListener("keydown",this),this.removeEventListener("keyup",this)}handleEvent(e){switch(e.type){case"slotchange":E_(this,yy,yT).call(this,e);break;case"click":this.handleClick(e);break;case"keydown":E_(this,yw,yD).call(this,e);break;case"keyup":E_(this,yI,yL).call(this,e)}}attributeChangedCallback(e,t,i){e===ES.CHECKED&&ER(this)&&!Eb(this,yE)?this.setAttribute("aria-checked",null!=i?"true":"false"):e===ES.TYPE&&i!==t?this.role="menuitem"+i:e===ES.DISABLED&&i!==t&&(null==i?this.enable():this.disable())}connectedCallback(){this.hasAttribute(ES.DISABLED)||this.enable(),this.role="menuitem"+this.type,ET(this,yb,function e(t,i){if(!t)return null;let{host:r}=t.getRootNode();return!i&&r?e(t,r):(null==i?void 0:i.items)?i:e(i,null==i?void 0:i.parentNode)}(this,this.parentNode)),E_(this,yC,yx).call(this)}disconnectedCallback(){this.disable(),E_(this,yC,yx).call(this),ET(this,yb,null)}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget",`${e}`)}get invokeTargetElement(){var e;return this.invokeTarget?null==(e=dx(this))?void 0:e.querySelector(`#${this.invokeTarget}`):this.submenuElement}get submenuElement(){return this.shadowRoot.querySelector('slot[name="submenu"]').assignedElements({flatten:!0})[0]}get type(){var e;return null!=(e=this.getAttribute(ES.TYPE))?e:""}set type(e){this.setAttribute(ES.TYPE,`${e}`)}get value(){var e;return null!=(e=this.getAttribute(ES.VALUE))?e:this.text}set value(e){this.setAttribute(ES.VALUE,e)}get text(){var e;return(null!=(e=this.textContent)?e:"").trim()}get checked(){if(ER(this))return"true"===this.getAttribute("aria-checked")}set checked(e){ER(this)&&(ET(this,yE,!0),this.setAttribute("aria-checked",e?"true":"false"),e?this.part.add("checked"):this.part.remove("checked"))}handleClick(e){!ER(this)&&this.invokeTargetElement&&dw(this,e.target)&&this.invokeTargetElement.dispatchEvent(new Ea({relatedTarget:this}))}get keysUsed(){return["Enter"," "]}}function ER(e){return"radio"===e.type||"checkbox"===e.type}yE=new WeakMap,yb=new WeakMap,yy=new WeakSet,yT=function(e){let t=e.target;if(!(null==t?void 0:t.name))for(let e of t.assignedNodes({flatten:!0}))e instanceof Text&&""===e.textContent.trim()&&e.remove();"submenu"===t.name&&(this.submenuElement?E_(this,y_,yA).call(this):E_(this,yS,yk).call(this))},y_=new WeakSet,yA=async function(){this.setAttribute("aria-haspopup","menu"),this.setAttribute("aria-expanded",`${!this.submenuElement.hidden}`),this.submenuElement.addEventListener("change",Eb(this,yR)),this.submenuElement.addEventListener("addmenuitem",Eb(this,yR)),this.submenuElement.addEventListener("removemenuitem",Eb(this,yR)),Eb(this,yR).call(this)},yS=new WeakSet,yk=function(){this.removeAttribute("aria-haspopup"),this.removeAttribute("aria-expanded"),this.submenuElement.removeEventListener("change",Eb(this,yR)),this.submenuElement.removeEventListener("addmenuitem",Eb(this,yR)),this.submenuElement.removeEventListener("removemenuitem",Eb(this,yR)),Eb(this,yR).call(this)},yR=new WeakMap,yI=new WeakSet,yL=function(e){let{key:t}=e;if(!this.keysUsed.includes(t)){this.removeEventListener("keyup",E_(this,yI,yL));return}this.handleClick(e)},yw=new WeakSet,yD=function(e){let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r)){this.removeEventListener("keyup",E_(this,yI,yL));return}this.addEventListener("keyup",E_(this,yI,yL),{once:!0})},yC=new WeakSet,yx=function(){var e;let t=null==(e=Eb(this,yb))?void 0:e.radioGroupItems;if(!t)return;let i=t.filter(e=>"true"===e.getAttribute("aria-checked")).pop();for(let e of(i||(i=t[0]),t))e.setAttribute("aria-checked","false");null==i||i.setAttribute("aria-checked","true")},Ek.template=EA,dv.customElements.get("media-chrome-menu-item")||dv.customElements.define("media-chrome-menu-item",Ek);let EI=dE.createElement("template");EI.innerHTML=Ef.template.innerHTML+`
  <style>
    :host {
      --_menu-bg: rgb(20 20 30 / .8);
      background: var(--media-settings-menu-background,
          var(--media-menu-background,
            var(--media-control-background,
              var(--media-secondary-color, var(--_menu-bg)))));
      min-width: var(--media-settings-menu-min-width, 170px);
      border-radius: 2px 2px 0 0;
      overflow: hidden;
    }

    @-moz-document url-prefix() {
      :host{
        --_menu-bg: rgb(20 20 30);
      }
    }

    :host([role="menu"]) {
      
      justify-content: end;
    }

    slot:not([name]) {
      justify-content: var(--media-settings-menu-justify-content);
      flex-direction: var(--media-settings-menu-flex-direction, column);
      overflow: visible;
    }

    #container.has-expanded {
      --media-settings-menu-item-opacity: 0;
    }
  </style>
`;class EL extends Ef{get anchorElement(){return"auto"!==this.anchor?super.anchorElement:dS(this).querySelector("media-settings-menu-button")}}EL.template=EI,dv.customElements.get("media-settings-menu")||dv.customElements.define("media-settings-menu",EL);let Ew=dE.createElement("template");Ew.innerHTML=Ek.template.innerHTML+`
  <style>
    slot:not([name="submenu"]) {
      opacity: var(--media-settings-menu-item-opacity, var(--media-menu-item-opacity));
    }

    :host([aria-expanded="true"]:hover) {
      background: transparent;
    }
  </style>
`,(null==(yM=Ew.content)?void 0:yM.querySelector)&&(Ew.content.querySelector('slot[name="suffix"]').innerHTML=`
    <svg aria-hidden="true" viewBox="0 0 20 24">
      <path d="m8.12 17.585-.742-.669 4.2-4.665-4.2-4.666.743-.669 4.803 5.335-4.803 5.334Z"/>
    </svg>
  `);class ED extends Ek{}ED.template=Ew,dv.customElements.get("media-settings-menu-item")||dv.customElements.define("media-settings-menu-item",ED);class EC extends hr{connectedCallback(){super.connectedCallback(),this.invokeTargetElement&&this.setAttribute("aria-haspopup","menu")}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget",`${e}`)}get invokeTargetElement(){var e;return this.invokeTarget?null==(e=dx(this))?void 0:e.querySelector(`#${this.invokeTarget}`):null}handleClick(){var e;null==(e=this.invokeTargetElement)||e.dispatchEvent(new Ea({relatedTarget:this}))}}dv.customElements.get("media-chrome-menu-button")||dv.customElements.define("media-chrome-menu-button",EC);let Ex=dE.createElement("template");Ex.innerHTML=`
  <style>
    :host([aria-expanded="true"]) slot[name=tooltip] {
      display: none;
    }
  </style>
  <slot name="icon">
    <svg aria-hidden="true" viewBox="0 0 24 24">
      <path d="M4.5 14.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
    </svg>
  </slot>
`,dv.customElements.get("media-settings-menu-button")||dv.customElements.define("media-settings-menu-button",class extends EC{static get observedAttributes(){return[...super.observedAttributes,"target"]}constructor(){super({slotTemplate:Ex,tooltipContent:dd("Settings")})}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",dd("settings"))}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:dS(this).querySelector("media-settings-menu")}});var EM=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},EO=(e,t,i)=>(EM(e,t,"read from private field"),i?i.call(e):t.get(e)),EN=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},EP=(e,t,i,r)=>(EM(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),EU=(e,t,i)=>(EM(e,t,"access private method"),i);yO=new WeakMap,yN=new WeakMap,yP=new WeakSet,yU=function(){if(EO(this,yN)===JSON.stringify(this.mediaAudioTrackList))return;EP(this,yN,JSON.stringify(this.mediaAudioTrackList));let e=this.mediaAudioTrackList;for(let t of(this.defaultSlot.textContent="",e)){let e=Eh({type:"radio",text:this.formatMenuItemText(t.label,t),value:`${t.id}`,checked:t.enabled});e.prepend(Ec(this,"checked-indicator")),this.defaultSlot.append(e)}},yF=new WeakSet,yB=function(){if(null==this.value)return;let e=new dv.CustomEvent(lK.MEDIA_AUDIO_TRACK_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},dv.customElements.get("media-audio-track-menu")||dv.customElements.define("media-audio-track-menu",class extends Ef{constructor(){super(...arguments),EN(this,yP),EN(this,yF),EN(this,yO,[]),EN(this,yN,void 0)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_AUDIO_TRACK_LIST,lj.MEDIA_AUDIO_TRACK_ENABLED,lj.MEDIA_AUDIO_TRACK_UNAVAILABLE]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===lj.MEDIA_AUDIO_TRACK_ENABLED&&t!==i)this.value=i;else if(e===lj.MEDIA_AUDIO_TRACK_LIST&&t!==i){var r;EP(this,yO,null==(r=null!=i?i:"")?void 0:r.split(/\s+/).map(l8)),EU(this,yP,yU).call(this)}}connectedCallback(){super.connectedCallback(),this.addEventListener("change",EU(this,yF,yB))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",EU(this,yF,yB))}get anchorElement(){var e;return"auto"!==this.anchor?super.anchorElement:null==(e=dS(this))?void 0:e.querySelector("media-audio-track-menu-button")}get mediaAudioTrackList(){return EO(this,yO)}set mediaAudioTrackList(e){EP(this,yO,e),EU(this,yP,yU).call(this)}get mediaAudioTrackEnabled(){var e;return null!=(e=d$(this,lj.MEDIA_AUDIO_TRACK_ENABLED))?e:""}set mediaAudioTrackEnabled(e){dG(this,lj.MEDIA_AUDIO_TRACK_ENABLED,e)}});let EF=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M11 17H9.5V7H11v10Zm-3-3H6.5v-4H8v4Zm6-5h-1.5v6H14V9Zm3 7h-1.5V8H17v8Z"/>
  <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"/>
</svg>`,EB=dE.createElement("template");EB.innerHTML=`
  <style>
    :host([aria-expanded="true"]) slot[name=tooltip] {
      display: none;
    }
  </style>
  <slot name="icon">${EF}</slot>
`,dv.customElements.get("media-audio-track-menu-button")||dv.customElements.define("media-audio-track-menu-button",class extends EC{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_AUDIO_TRACK_ENABLED,lj.MEDIA_AUDIO_TRACK_UNAVAILABLE]}constructor(){super({slotTemplate:EB,tooltipContent:dd("Audio")})}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",dd("Audio"))}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i)}get invokeTargetElement(){var e;return void 0!=this.invokeTarget?super.invokeTargetElement:null==(e=dS(this))?void 0:e.querySelector("media-audio-track-menu")}get mediaAudioTrackEnabled(){var e;return null!=(e=d$(this,lj.MEDIA_AUDIO_TRACK_ENABLED))?e:""}set mediaAudioTrackEnabled(e){dG(this,lj.MEDIA_AUDIO_TRACK_ENABLED,e)}});var E$=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},EG=(e,t,i)=>(E$(e,t,"read from private field"),i?i.call(e):t.get(e)),EH=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},EV=(e,t,i,r)=>(E$(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),EK=(e,t,i)=>(E$(e,t,"access private method"),i);let EW=`
  <svg aria-hidden="true" viewBox="0 0 26 24" part="captions-indicator indicator">
    <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
  </svg>`,EY=dE.createElement("template");EY.innerHTML=Ef.template.innerHTML+`
  <slot name="captions-indicator" hidden>${EW}</slot>`;class Eq extends Ef{constructor(){super(...arguments),EH(this,yG),EH(this,yV),EH(this,y$,void 0)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_SUBTITLES_LIST,lj.MEDIA_SUBTITLES_SHOWING]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_SUBTITLES_LIST&&t!==i?EK(this,yG,yH).call(this):e===lj.MEDIA_SUBTITLES_SHOWING&&t!==i&&(this.value=i)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",EK(this,yV,yK))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",EK(this,yV,yK))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:dS(this).querySelector("media-captions-menu-button")}get mediaSubtitlesList(){return Ej(this,lj.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){Ez(this,lj.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return Ej(this,lj.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){Ez(this,lj.MEDIA_SUBTITLES_SHOWING,e)}}y$=new WeakMap,yG=new WeakSet,yH=function(){var e;if(EG(this,y$)===JSON.stringify(this.mediaSubtitlesList))return;EV(this,y$,JSON.stringify(this.mediaSubtitlesList)),this.defaultSlot.textContent="";let t=!this.value,i=Eh({type:"radio",text:this.formatMenuItemText("Off"),value:"off",checked:t});for(let t of(i.prepend(Ec(this,"checked-indicator")),this.defaultSlot.append(i),this.mediaSubtitlesList)){let i=Eh({type:"radio",text:this.formatMenuItemText(t.label,t),value:ur(t),checked:this.value==ur(t)});i.prepend(Ec(this,"checked-indicator")),"captions"===(null!=(e=t.kind)?e:"subs")&&i.append(Ec(this,"captions-indicator")),this.defaultSlot.append(i)}},yV=new WeakSet,yK=function(){let e=this.mediaSubtitlesShowing,t=this.getAttribute(lj.MEDIA_SUBTITLES_SHOWING),i=this.value!==t;if((null==e?void 0:e.length)&&i&&this.dispatchEvent(new dv.CustomEvent(lK.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:e})),!this.value||!i)return;let r=new dv.CustomEvent(lK.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(r)},Eq.template=EY;let Ej=(e,t)=>{let i=e.getAttribute(t);return i?ut(i):[]},Ez=(e,t,i)=>{if(!(null==i?void 0:i.length)){e.removeAttribute(t);return}let r=ua(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};dv.customElements.get("media-captions-menu")||dv.customElements.define("media-captions-menu",Eq);var EX=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},EQ=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},EZ=(e,t,i,r)=>(EX(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let EJ=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,E0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,E1=dE.createElement("template");E1.innerHTML=`
  <style>
    :host([aria-checked="true"]) slot[name=off] {
      display: none !important;
    }

    
    :host(:not([aria-checked="true"])) slot[name=on] {
      display: none !important;
    }

    :host([aria-expanded="true"]) slot[name=tooltip] {
      display: none;
    }
  </style>

  <slot name="icon">
    <slot name="on">${EJ}</slot>
    <slot name="off">${E0}</slot>
  </slot>
`;let E2=e=>{e.setAttribute("aria-checked",ud(e).toString())};yW=new WeakMap;let E3=(e,t)=>{let i=e.getAttribute(t);return i?ut(i):[]},E4=(e,t,i)=>{if(!(null==i?void 0:i.length)){e.removeAttribute(t);return}let r=ua(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};dv.customElements.get("media-captions-menu-button")||dv.customElements.define("media-captions-menu-button",class extends EC{constructor(e={}){super({slotTemplate:E1,tooltipContent:dd("Captions"),...e}),EQ(this,yW,void 0),EZ(this,yW,!1)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_SUBTITLES_LIST,lj.MEDIA_SUBTITLES_SHOWING]}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",dd("closed captions")),E2(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_SUBTITLES_SHOWING&&E2(this)}get invokeTargetElement(){var e;return void 0!=this.invokeTarget?super.invokeTargetElement:null==(e=dS(this))?void 0:e.querySelector("media-captions-menu")}get mediaSubtitlesList(){return E3(this,lj.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){E4(this,lj.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return E3(this,lj.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){E4(this,lj.MEDIA_SUBTITLES_SHOWING,e)}});var E5=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},E8=(e,t,i)=>(E5(e,t,"read from private field"),i?i.call(e):t.get(e)),E9=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},E6=(e,t,i)=>(E5(e,t,"access private method"),i);let E7={RATES:"rates"};yY=new WeakMap,yq=new WeakSet,yj=function(){for(let e of(this.defaultSlot.textContent="",this.rates)){let t=Eh({type:"radio",text:this.formatMenuItemText(`${e}x`,e),value:e,checked:this.mediaPlaybackRate==e});t.prepend(Ec(this,"checked-indicator")),this.defaultSlot.append(t)}},yz=new WeakSet,yX=function(){if(!this.value)return;let e=new dv.CustomEvent(lK.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},dv.customElements.get("media-playback-rate-menu")||dv.customElements.define("media-playback-rate-menu",class extends Ef{constructor(){super(),E9(this,yq),E9(this,yz),E9(this,yY,new d6(this,E7.RATES,{defaultValue:cw})),E6(this,yq,yj).call(this)}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PLAYBACK_RATE,E7.RATES]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===lj.MEDIA_PLAYBACK_RATE&&t!=i?this.value=i:e===E7.RATES&&t!=i&&(E8(this,yY).value=i,E6(this,yq,yj).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",E6(this,yz,yX))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",E6(this,yz,yX))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:dS(this).querySelector("media-playback-rate-menu-button")}get rates(){return E8(this,yY)}set rates(e){e?Array.isArray(e)&&(E8(this,yY).value=e.join(" ")):E8(this,yY).value="",E6(this,yq,yj).call(this)}get mediaPlaybackRate(){return dP(this,lj.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){dU(this,lj.MEDIA_PLAYBACK_RATE,e)}});var be=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},bt=(e,t,i)=>(be(e,t,"read from private field"),i?i.call(e):t.get(e)),bi=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)};let br="rates",ba=[1,1.2,1.5,1.7,2],bs=dE.createElement("template");bs.innerHTML=`
  <style>
    :host {
      min-width: 5ch;
      padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));
    }
    
    :host([aria-expanded="true"]) slot[name=tooltip] {
      display: none;
    }
  </style>
  <slot name="icon"></slot>
`,yQ=new WeakMap,dv.customElements.get("media-playback-rate-menu-button")||dv.customElements.define("media-playback-rate-menu-button",class extends EC{constructor(e={}){super({slotTemplate:bs,tooltipContent:dd("Playback rate"),...e}),bi(this,yQ,new d6(this,br,{defaultValue:ba})),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML="1x"}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_PLAYBACK_RATE,br]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===br&&(bt(this,yQ).value=i),e===lj.MEDIA_PLAYBACK_RATE){let e=i?+i:Number.NaN,t=Number.isNaN(e)?1:e;this.container.innerHTML=`${t}x`,this.setAttribute("aria-label",dd("Playback rate {playbackRate}",{playbackRate:t}))}}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:dS(this).querySelector("media-playback-rate-menu")}get rates(){return bt(this,yQ)}set rates(e){e?Array.isArray(e)&&(bt(this,yQ).value=e.join(" ")):bt(this,yQ).value=""}get mediaPlaybackRate(){return dP(this,lj.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){dU(this,lj.MEDIA_PLAYBACK_RATE,e)}});var bn=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},bo=(e,t,i)=>(bn(e,t,"read from private field"),i?i.call(e):t.get(e)),bl=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},bd=(e,t,i,r)=>(bn(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),bu=(e,t,i)=>(bn(e,t,"access private method"),i);yZ=new WeakMap,yJ=new WeakMap,y0=new WeakSet,y1=function(){if(bo(this,yJ).mediaRenditionList===JSON.stringify(this.mediaRenditionList)&&bo(this,yJ).mediaHeight===this.mediaHeight)return;bo(this,yJ).mediaRenditionList=JSON.stringify(this.mediaRenditionList),bo(this,yJ).mediaHeight=this.mediaHeight;let e=this.mediaRenditionList.sort((e,t)=>t.height-e.height);for(let t of e)t.selected=t.id===this.mediaRenditionSelected;this.defaultSlot.textContent="";let t=!this.mediaRenditionSelected;for(let i of e){let e=Eh({type:"radio",text:this.formatMenuItemText(`${Math.min(i.width,i.height)}p`,i),value:`${i.id}`,checked:i.selected&&!t});e.prepend(Ec(this,"checked-indicator")),this.defaultSlot.append(e)}let i=Eh({type:"radio",text:t?this.formatMenuItemText(`Auto (${this.mediaHeight}p)`):this.formatMenuItemText("Auto"),value:"auto",checked:t}),r=this.mediaHeight>0?`Auto (${this.mediaHeight}p)`:"Auto";i.dataset.description=r,i.prepend(Ec(this,"checked-indicator")),this.defaultSlot.append(i)},y2=new WeakSet,y3=function(){if(null==this.value)return;let e=new dv.CustomEvent(lK.MEDIA_RENDITION_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},dv.customElements.get("media-rendition-menu")||dv.customElements.define("media-rendition-menu",class extends Ef{constructor(){super(...arguments),bl(this,y0),bl(this,y2),bl(this,yZ,[]),bl(this,yJ,{})}static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_RENDITION_LIST,lj.MEDIA_RENDITION_SELECTED,lj.MEDIA_RENDITION_UNAVAILABLE,lj.MEDIA_HEIGHT]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===lj.MEDIA_RENDITION_SELECTED&&t!==i)this.value=null!=i?i:"auto",bu(this,y0,y1).call(this);else if(e===lj.MEDIA_RENDITION_LIST&&t!==i)bd(this,yZ,null==i?void 0:i.split(/\s+/).map(l4)),bu(this,y0,y1).call(this);else e===lj.MEDIA_HEIGHT&&t!==i&&bu(this,y0,y1).call(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",bu(this,y2,y3))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",bu(this,y2,y3))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:dS(this).querySelector("media-rendition-menu-button")}get mediaRenditionList(){return bo(this,yZ)}set mediaRenditionList(e){bd(this,yZ,e),bu(this,y0,y1).call(this)}get mediaRenditionSelected(){return d$(this,lj.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){dG(this,lj.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return dP(this,lj.MEDIA_HEIGHT)}set mediaHeight(e){dU(this,lj.MEDIA_HEIGHT,e)}});let bh=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M13.5 2.5h2v6h-2v-2h-11v-2h11v-2Zm4 2h4v2h-4v-2Zm-12 4h2v6h-2v-2h-3v-2h3v-2Zm4 2h12v2h-12v-2Zm1 4h2v6h-2v-2h-8v-2h8v-2Zm4 2h7v2h-7v-2Z" />
</svg>`,bc=dE.createElement("template");bc.innerHTML=`
  <style>
    :host([aria-expanded="true"]) slot[name=tooltip] {
      display: none;
    }
  </style>
  <slot name="icon">${bh}</slot>
`,dv.customElements.get("media-rendition-menu-button")||dv.customElements.define("media-rendition-menu-button",class extends EC{static get observedAttributes(){return[...super.observedAttributes,lj.MEDIA_RENDITION_SELECTED,lj.MEDIA_RENDITION_UNAVAILABLE,lj.MEDIA_HEIGHT]}constructor(){super({slotTemplate:bc,tooltipContent:dd("Quality")})}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",dd("quality"))}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:dS(this).querySelector("media-rendition-menu")}get mediaRenditionSelected(){return d$(this,lj.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){dG(this,lj.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return dP(this,lj.MEDIA_HEIGHT)}set mediaHeight(e){dU(this,lj.MEDIA_HEIGHT,e)}});var bm=e=>{throw TypeError(e)},bp=(e,t,i)=>t.has(e)||bm("Cannot "+i),bf=(e,t,i)=>(bp(e,t,"read from private field"),i?i.call(e):t.get(e)),bg=(e,t,i)=>t.has(e)?bm("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),bv=(e,t,i,r)=>(bp(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),bE=(e,t,i)=>(bp(e,t,"access private method"),i),bb=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends bb{});var by,bT,b_,bA,bS,bk,bR,bI,bL,bw,bD,bC,bx,bM,bO,bN,bP,bU,bF,bB,b$,bG,bH,bV,bK,bW,bY,bq,bj,bz,bX,bQ,bZ,bJ,b0,b1,b2,b3,b4,b5,b8,b9,b6,b7,ye,yt,yi,yr,ya,ys,yn,yo,yl,yd,yu,yh,yc,ym,yp,yf,yg,yv,yE,yb,yy,yT,y_,yA,yS,yk,yR,yI,yL,yw,yD,yC,yx,yM,yO,yN,yP,yU,yF,yB,y$,yG,yH,yV,yK,yW,yY,yq,yj,yz,yX,yQ,yZ,yJ,y0,y1,y2,y3,y4,y5=class extends bb{},y8=class{constructor(e,t={}){bg(this,y4),bv(this,y4,null==t?void 0:t.detail)}get detail(){return bf(this,y4)}initCustomEvent(){}};y4=new WeakMap;var y9={document:{createElement:function(e,t){return new y5}},DocumentFragment,customElements:{get(e){},define(e,t,i){},getName:e=>null,upgrade(e){},whenDefined:e=>Promise.resolve(y5)},CustomEvent:y8,EventTarget:bb,HTMLElement:y5,HTMLVideoElement:class extends bb{}},y6="undefined"==typeof window||void 0===globalThis.customElements,y7=y6?y9:globalThis,Te=y6?y9.document:globalThis.document;function Tt(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Ti(e){return e.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase())}function Tr(e){if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}function Ta(e){let t=(function(e){let t={};for(let i in e)null!=e[i]&&(t[i]=e[i]);return new URLSearchParams(t)})(e).toString();return t?"?"+t:""}var Ts,Tn,To,Tl=(e,t)=>!!e&&!!t&&(!!e.contains(t)||Tl(e,t.getRootNode().host)),Td="mux.com",Tu=(()=>{try{return"3.4.0"}catch{}return"UNKNOWN"})(),Th=(e,{token:t,customDomain:i=Td,thumbnailTime:r,programTime:a}={})=>{var s;let n=null==t?r:void 0,{aud:o}=null!=(s=oi(t))?s:{};if(!(t&&"t"!==o))return`https://image.${i}/${e}/thumbnail.webp${Ta({token:t,time:n,program_time:a})}`},Tc=(e,{token:t,customDomain:i=Td,programStartTime:r,programEndTime:a}={})=>{var s;let{aud:n}=null!=(s=oi(t))?s:{};if(!(t&&"s"!==n))return`https://image.${i}/${e}/storyboard.vtt${Ta({token:t,format:"webp",program_start_time:r,program_end_time:a})}`},Tm=e=>{if(e){if([nj.LIVE,nj.ON_DEMAND].includes(e))return e;if(null!=e&&e.includes("live"))return nj.LIVE}},Tp={crossorigin:"crossOrigin",playsinline:"playsInline"},Tf=class{constructor(e,t){bg(this,Ts),bg(this,Tn),bg(this,To,[]),bv(this,Ts,e),bv(this,Tn,t)}[Symbol.iterator](){return bf(this,To).values()}get length(){return bf(this,To).length}get value(){var e;return null!=(e=bf(this,To).join(" "))?e:""}set value(e){var t;e!==this.value&&(bv(this,To,[]),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return bf(this,To)[e]}values(){return bf(this,To).values()}keys(){return bf(this,To).keys()}forEach(e){bf(this,To).forEach(e)}add(...e){var t,i;e.forEach(e=>{this.contains(e)||bf(this,To).push(e)}),(""!==this.value||null!=(t=bf(this,Ts))&&t.hasAttribute(`${bf(this,Tn)}`))&&null!=(i=bf(this,Ts))&&i.setAttribute(`${bf(this,Tn)}`,`${this.value}`)}remove(...e){var t;e.forEach(e=>{bf(this,To).splice(bf(this,To).indexOf(e),1)}),null==(t=bf(this,Ts))||t.setAttribute(`${bf(this,Tn)}`,`${this.value}`)}contains(e){return bf(this,To).includes(e)}toggle(e,t){return void 0!==t?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){this.remove(e),this.add(t)}};Ts=new WeakMap,Tn=new WeakMap,To=new WeakMap;var Tg=`[mux-player ${Tu}]`;function Tv(...e){console.warn(Tg,...e)}function TE(...e){console.error(Tg,...e)}function Tb(e){var t;let i=null!=(t=e.message)?t:"";e.context&&(i+=` ${e.context}`),e.file&&(i+=` ${oo("Read more: ")}
https://github.com/muxinc/elements/blob/main/errors/${e.file}`),Tv(i)}var Ty={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},TT={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},T_=Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}}),TA=fZ.filter(e=>"error"!==e),TS=Object.values(Ty).filter(e=>![Ty.PLAYSINLINE].includes(e)),Tk=Object.values(TT);function TR(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}var TI=class extends y7.HTMLElement{static get observedAttributes(){return[...TS,...Tk]}constructor(){super()}init(){TA.forEach(e=>{var t;null==(t=this.media)||t.addEventListener(e,e=>{this.dispatchEvent(new Event(e.type))})})}attributeChangedCallback(e,t,i){var r,a;switch(e){case TT.MUTED:this.media&&(this.media.muted=null!=i,this.media.defaultMuted=null!=i);return;case TT.VOLUME:{let e=null!=(r=Tr(i))?r:1;this.media&&(this.media.volume=e);return}case TT.PLAYBACKRATE:{let e=null!=(a=Tr(i))?a:1;this.media&&(this.media.playbackRate=e,this.media.defaultPlaybackRate=e);return}}}play(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.play())?t:Promise.reject()}pause(){var e;null==(e=this.media)||e.pause()}load(){var e;null==(e=this.media)||e.load()}requestCast(e){var t;return null==(t=this.media)?void 0:t.requestCast(e)}get media(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("mux-video")}get audioTracks(){return this.media.audioTracks}get videoTracks(){return this.media.videoTracks}get audioRenditions(){return this.media.audioRenditions}get videoRenditions(){return this.media.videoRenditions}get paused(){var e,t;return null==(t=null==(e=this.media)?void 0:e.paused)||t}get duration(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.duration)?t:NaN}get ended(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.ended)&&t}get buffered(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.buffered)?t:T_}get seekable(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.seekable)?t:T_}get readyState(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.readyState)?t:0}get videoWidth(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoWidth)?t:0}get videoHeight(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoHeight)?t:0}get currentSrc(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.currentSrc)?t:""}get currentTime(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.currentTime)?t:0}set currentTime(e){this.media&&(this.media.currentTime=Number(e))}get volume(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.volume)?t:1}set volume(e){this.media&&(this.media.volume=Number(e))}get playbackRate(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.playbackRate)?t:1}set playbackRate(e){this.media&&(this.media.playbackRate=Number(e))}get defaultPlaybackRate(){var e;return null!=(e=Tr(this.getAttribute(TT.PLAYBACKRATE)))?e:1}set defaultPlaybackRate(e){null!=e?this.setAttribute(TT.PLAYBACKRATE,`${e}`):this.removeAttribute(TT.PLAYBACKRATE)}get crossOrigin(){return TR(this,Ty.CROSSORIGIN)}set crossOrigin(e){this.setAttribute(Ty.CROSSORIGIN,`${e}`)}get autoplay(){return null!=TR(this,Ty.AUTOPLAY)}set autoplay(e){e?this.setAttribute(Ty.AUTOPLAY,"string"==typeof e?e:""):this.removeAttribute(Ty.AUTOPLAY)}get loop(){return null!=TR(this,Ty.LOOP)}set loop(e){e?this.setAttribute(Ty.LOOP,""):this.removeAttribute(Ty.LOOP)}get muted(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.muted)&&t}set muted(e){this.media&&(this.media.muted=!!e)}get defaultMuted(){return null!=TR(this,Ty.MUTED)}set defaultMuted(e){e?this.setAttribute(Ty.MUTED,""):this.removeAttribute(Ty.MUTED)}get playsInline(){return null!=TR(this,Ty.PLAYSINLINE)}set playsInline(e){TE("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(e){["","none","metadata","auto"].includes(e)?this.setAttribute(Ty.PRELOAD,e):this.removeAttribute(Ty.PRELOAD)}},TL=`:host {
  --media-control-display: var(--controls);
  --media-loading-indicator-display: var(--loading-indicator);
  --media-dialog-display: var(--dialog);
  --media-play-button-display: var(--play-button);
  --media-live-button-display: var(--live-button);
  --media-seek-backward-button-display: var(--seek-backward-button);
  --media-seek-forward-button-display: var(--seek-forward-button);
  --media-mute-button-display: var(--mute-button);
  --media-captions-button-display: var(--captions-button);
  --media-captions-menu-button-display: var(--captions-menu-button, var(--media-captions-button-display));
  --media-rendition-menu-button-display: var(--rendition-menu-button);
  --media-audio-track-menu-button-display: var(--audio-track-menu-button);
  --media-airplay-button-display: var(--airplay-button);
  --media-pip-button-display: var(--pip-button);
  --media-fullscreen-button-display: var(--fullscreen-button);
  --media-cast-button-display: var(--cast-button, var(--_cast-button-drm-display));
  --media-playback-rate-button-display: var(--playback-rate-button);
  --media-playback-rate-menu-button-display: var(--playback-rate-menu-button);
  --media-volume-range-display: var(--volume-range);
  --media-time-range-display: var(--time-range);
  --media-time-display-display: var(--time-display);
  --media-duration-display-display: var(--duration-display);
  --media-title-display-display: var(--title-display);

  display: inline-block;
  line-height: 0;
  width: 100%;
}

a {
  color: #fff;
  font-size: 0.9em;
  text-decoration: underline;
}

media-theme {
  display: inline-block;
  line-height: 0;
  width: 100%;
  height: 100%;
  direction: ltr;
}

media-poster-image {
  display: inline-block;
  line-height: 0;
  width: 100%;
  height: 100%;
}

media-poster-image:not([src]):not([placeholdersrc]) {
  display: none;
}

::part(top),
[part~='top'] {
  --media-control-display: var(--controls, var(--top-controls));
  --media-play-button-display: var(--play-button, var(--top-play-button));
  --media-live-button-display: var(--live-button, var(--top-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--top-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--top-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--top-mute-button));
  --media-captions-button-display: var(--captions-button, var(--top-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--top-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--top-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--top-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--top-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--top-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--top-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--top-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--top-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --captions-menu-button,
    var(--media-playback-rate-button-display, var(--top-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--top-volume-range));
  --media-time-range-display: var(--time-range, var(--top-time-range));
  --media-time-display-display: var(--time-display, var(--top-time-display));
  --media-duration-display-display: var(--duration-display, var(--top-duration-display));
  --media-title-display-display: var(--title-display, var(--top-title-display));
}

::part(center),
[part~='center'] {
  --media-control-display: var(--controls, var(--center-controls));
  --media-play-button-display: var(--play-button, var(--center-play-button));
  --media-live-button-display: var(--live-button, var(--center-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--center-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--center-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--center-mute-button));
  --media-captions-button-display: var(--captions-button, var(--center-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--center-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--center-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--center-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--center-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--center-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--center-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--center-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--center-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --playback-rate-menu-button,
    var(--media-playback-rate-button-display, var(--center-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--center-volume-range));
  --media-time-range-display: var(--time-range, var(--center-time-range));
  --media-time-display-display: var(--time-display, var(--center-time-display));
  --media-duration-display-display: var(--duration-display, var(--center-duration-display));
}

::part(bottom),
[part~='bottom'] {
  --media-control-display: var(--controls, var(--bottom-controls));
  --media-play-button-display: var(--play-button, var(--bottom-play-button));
  --media-live-button-display: var(--live-button, var(--bottom-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--bottom-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--bottom-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--bottom-mute-button));
  --media-captions-button-display: var(--captions-button, var(--bottom-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--bottom-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--bottom-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--bottom-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--bottom-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--bottom-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--bottom-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--bottom-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--bottom-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --playback-rate-menu-button,
    var(--media-playback-rate-button-display, var(--bottom-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--bottom-volume-range));
  --media-time-range-display: var(--time-range, var(--bottom-time-range));
  --media-time-display-display: var(--time-display, var(--bottom-time-display));
  --media-duration-display-display: var(--duration-display, var(--bottom-duration-display));
  --media-title-display-display: var(--title-display, var(--bottom-title-display));
}

:host([no-tooltips]) {
  --media-tooltip-display: none;
}
`,Tw=new WeakMap,TD=class e{constructor(e,t){this.element=e,this.type=t,this.element.addEventListener(this.type,this);let i=Tw.get(this.element);i&&i.set(this.type,this)}set(e){if("function"==typeof e)this.handleEvent=e.bind(this.element);else if("object"==typeof e&&"function"==typeof e.handleEvent)this.handleEvent=e.handleEvent.bind(e);else{this.element.removeEventListener(this.type,this);let e=Tw.get(this.element);e&&e.delete(this.type)}}static for(t){Tw.has(t.element)||Tw.set(t.element,new Map);let i=t.attributeName.slice(2),r=Tw.get(t.element);return r&&r.has(i)?r.get(i):new e(t.element,i)}},TC=new Map,Tx=new WeakMap,TM=new WeakMap,TO=class{constructor(e,t,i){this.strings=e,this.values=t,this.processor=i,this.stringsKey=this.strings.join("\x01")}get template(){if(TC.has(this.stringsKey))return TC.get(this.stringsKey);{let e=Te.createElement("template"),t=this.strings.length-1;return e.innerHTML=this.strings.reduce((e,i,r)=>e+i+(r<t?`{{ ${r} }}`:""),""),TC.set(this.stringsKey,e),e}}renderInto(e){var t;let i=this.template;if(Tx.get(e)!==i){Tx.set(e,i);let t=new vP(i,this.values,this.processor);TM.set(e,t),e instanceof vK?e.replace(...t.children):e.appendChild(t);return}let r=TM.get(e);null==(t=null==r?void 0:r.update)||t.call(r,this.values)}},TN={processCallback(e,t,i){var r;if(i)for(let[e,a]of t)e in i&&function(e,t){(function(e,t){if(e instanceof vV&&t instanceof Element){let i=e.element;return i[e.attributeName]!==t&&(e.element.removeAttributeNS(e.attributeNamespace,e.attributeName),i[e.attributeName]=t),!0}return!1})(e,t)||function(e,t){if("boolean"==typeof t&&e instanceof vV){let i=e.attributeNamespace;return t!==e.element.hasAttributeNS(i,e.attributeName)&&(e.booleanValue=t),!0}return!1}(e,t)||e instanceof vV&&e.attributeName.startsWith("on")&&(TD.for(e).set(t),e.element.removeAttributeNS(e.attributeNamespace,e.attributeName),1)||!1===t&&e instanceof vK&&(e.replace(""),1)||t instanceof TO&&e instanceof vK&&(t.renderInto(e),1)||t instanceof DocumentFragment&&e instanceof vK&&(t.childNodes.length&&e.replace(...t.childNodes),1)||function(e,t){if(e instanceof vV){let i=e.attributeNamespace,r=e.element.getAttributeNS(i,e.attributeName);return String(t)!==r&&(e.value=String(t))}e.value=String(t)}(e,t)}(a,null!=(r=i[e])?r:"")}};function TP(e,...t){return new TO(e,t,TN)}var TU=e=>{let{tokens:t}=e;return t.drm?":host { --_cast-button-drm-display: none; }":""},TF=e=>TP`
  <style>
    ${TU(e)}
    ${TL}
  </style>
  ${TG(e)}
`,TB=e=>{let t=e.hotKeys?`${e.hotKeys}`:"";return"live"===Tm(e.streamType)&&(t+=" noarrowleft noarrowright"),t},T$=Object.values({TOP:"top",CENTER:"center",BOTTOM:"bottom",LAYER:"layer",MEDIA_LAYER:"media-layer",POSTER_LAYER:"poster-layer",VERTICAL_LAYER:"vertical-layer",CENTERED_LAYER:"centered-layer",GESTURE_LAYER:"gesture-layer",CONTROLLER_LAYER:"controller",BUTTON:"button",RANGE:"range",DISPLAY:"display",CONTROL_BAR:"control-bar",MENU_BUTTON:"menu-button",MENU:"menu",OPTION:"option",POSTER:"poster",LIVE:"live",PLAY:"play",PRE_PLAY:"pre-play",SEEK_BACKWARD:"seek-backward",SEEK_FORWARD:"seek-forward",MUTE:"mute",CAPTIONS:"captions",AIRPLAY:"airplay",PIP:"pip",FULLSCREEN:"fullscreen",CAST:"cast",PLAYBACK_RATE:"playback-rate",VOLUME:"volume",TIME:"time",TITLE:"title",AUDIO_TRACK:"audio-track",RENDITION:"rendition"}).join(", "),TG=e=>{var t,i,r,a,s,n,o,l,d,u,h,c,m,p,f,g,E,b,y,T,_,A,S,k,R,I,L,w,D,C,x,M,O,N,P,U;let F;return TP`
  <media-theme
    template="${e.themeTemplate||!1}"
    defaultstreamtype="${null!=(t=e.defaultStreamType)&&t}"
    hotkeys="${TB(e)||!1}"
    nohotkeys="${e.noHotKeys||!e.hasSrc||!1}"
    noautoseektolive="${!!(null!=(i=e.streamType)&&i.includes(nj.LIVE))&&0!==e.targetLiveWindow}"
    novolumepref="${e.novolumepref||!1}"
    disabled="${!e.hasSrc||e.isDialogOpen}"
    audio="${null!=(r=e.audio)&&r}"
    style="${null!=(U={"--media-primary-color":e.primaryColor,"--media-secondary-color":e.secondaryColor,"--media-accent-color":e.accentColor},F="",Object.entries(U).forEach(([e,t])=>{null!=t&&(F+=`${Tt(e)}: ${t}; `)}),a=F?F.trim():void 0)&&a}"
    defaultsubtitles="${!e.defaultHiddenCaptions}"
    forwardseekoffset="${null!=(s=e.forwardSeekOffset)&&s}"
    backwardseekoffset="${null!=(n=e.backwardSeekOffset)&&n}"
    playbackrates="${null!=(o=e.playbackRates)&&o}"
    defaultshowremainingtime="${null!=(l=e.defaultShowRemainingTime)&&l}"
    defaultduration="${null!=(d=e.defaultDuration)&&d}"
    hideduration="${null!=(u=e.hideDuration)&&u}"
    title="${null!=(h=e.title)&&h}"
    videotitle="${null!=(c=e.videoTitle)&&c}"
    proudlydisplaymuxbadge="${null!=(m=e.proudlyDisplayMuxBadge)&&m}"
    exportparts="${T$}"
    onclose="${e.onCloseErrorDialog}"
    onfocusin="${e.onFocusInErrorDialog}"
  >
    <mux-video
      slot="media"
      target-live-window="${null!=(p=e.targetLiveWindow)&&p}"
      stream-type="${null!=(f=Tm(e.streamType))&&f}"
      crossorigin="${null!=(g=e.crossOrigin)?g:""}"
      playsinline
      autoplay="${null!=(E=e.autoplay)&&E}"
      muted="${null!=(b=e.muted)&&b}"
      loop="${null!=(y=e.loop)&&y}"
      preload="${null!=(T=e.preload)&&T}"
      debug="${null!=(_=e.debug)&&_}"
      prefer-cmcd="${null!=(A=e.preferCmcd)&&A}"
      disable-tracking="${null!=(S=e.disableTracking)&&S}"
      disable-cookies="${null!=(k=e.disableCookies)&&k}"
      prefer-playback="${null!=(R=e.preferPlayback)&&R}"
      start-time="${null!=e.startTime&&e.startTime}"
      beacon-collection-domain="${null!=(I=e.beaconCollectionDomain)&&I}"
      player-init-time="${null!=(L=e.playerInitTime)&&L}"
      player-software-name="${null!=(w=e.playerSoftwareName)&&w}"
      player-software-version="${null!=(D=e.playerSoftwareVersion)&&D}"
      env-key="${null!=(C=e.envKey)&&C}"
      custom-domain="${null!=(x=e.customDomain)&&x}"
      src="${e.src?e.src:!!e.playbackId&&lu(e)}"
      cast-src="${e.src?e.src:!!e.playbackId&&lu(e)}"
      cast-receiver="${null!=(M=e.castReceiver)&&M}"
      drm-token="${null!=(N=null==(O=e.tokens)?void 0:O.drm)&&N}"
      exportparts="video"
    >
      ${e.storyboard?TP`<track label="thumbnails" default kind="metadata" src="${e.storyboard}" />`:TP``}
      <slot></slot>
    </mux-video>
    <slot name="poster" slot="poster">
      <media-poster-image
        part="poster"
        exportparts="poster, img"
        src="${!!e.poster&&e.poster}"
        placeholdersrc="${null!=(P=e.placeholder)&&P}"
      ></media-poster-image>
    </slot>
  </media-theme>
`},TH=e=>e.charAt(0).toUpperCase()+e.slice(1),TV=(e,t=!1)=>{var i,r;if(e.muxCode){let a=TH(null!=(i=e.errorCategory)?i:"video"),s=nH(null!=(r=e.errorCategory)?r:n$.VIDEO);if(e.muxCode===nG.NETWORK_OFFLINE)return oo("Your device appears to be offline",t);if(e.muxCode===nG.NETWORK_TOKEN_EXPIRED)return oo("{category} URL has expired",t).format({category:a});if([nG.NETWORK_TOKEN_SUB_MISMATCH,nG.NETWORK_TOKEN_AUD_MISMATCH,nG.NETWORK_TOKEN_AUD_MISSING,nG.NETWORK_TOKEN_MALFORMED].includes(e.muxCode))return oo("{category} URL is formatted incorrectly",t).format({category:a});if(e.muxCode===nG.NETWORK_TOKEN_MISSING)return oo("Invalid {categoryName} URL",t).format({categoryName:s});if(e.muxCode===nG.NETWORK_NOT_FOUND)return oo("{category} does not exist",t).format({category:a});if(e.muxCode===nG.NETWORK_NOT_READY)return oo("{category} is not currently available",t).format({category:a})}if(e.code){if(e.code===nK.MEDIA_ERR_NETWORK)return oo("Network Error",t);if(e.code===nK.MEDIA_ERR_DECODE)return oo("Media Error",t);if(e.code===nK.MEDIA_ERR_SRC_NOT_SUPPORTED)return oo("Source Not Supported",t)}return oo("Error",t)},TK=(e,t=!1)=>{var i,r;if(e.muxCode){let a=TH(null!=(i=e.errorCategory)?i:"video"),s=nH(null!=(r=e.errorCategory)?r:n$.VIDEO);return e.muxCode===nG.NETWORK_OFFLINE?oo("Check your internet connection and try reloading this video.",t):e.muxCode===nG.NETWORK_TOKEN_EXPIRED?oo("The video\u2019s secured {tokenNamePrefix}-token has expired.",t).format({tokenNamePrefix:s}):e.muxCode===nG.NETWORK_TOKEN_SUB_MISMATCH?oo("The video\u2019s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",t).format({tokenNamePrefix:s}):e.muxCode===nG.NETWORK_TOKEN_MALFORMED?oo("{category} URL is formatted incorrectly",t).format({category:a}):[nG.NETWORK_TOKEN_AUD_MISMATCH,nG.NETWORK_TOKEN_AUD_MISSING].includes(e.muxCode)?oo("The {tokenNamePrefix}-token is formatted with incorrect information.",t).format({tokenNamePrefix:s}):[nG.NETWORK_TOKEN_MISSING,nG.NETWORK_INVALID_URL].includes(e.muxCode)?oo("The video URL or {tokenNamePrefix}-token are formatted with incorrect or incomplete information.",t).format({tokenNamePrefix:s}):e.muxCode===nG.NETWORK_NOT_FOUND?"":e.muxCode===nG.NETWORK_NOT_READY?oo("The live stream or video file are not yet ready.",t):e.message}return e.code&&(e.code===nK.MEDIA_ERR_NETWORK||e.code===nK.MEDIA_ERR_DECODE||(e.code,nK.MEDIA_ERR_SRC_NOT_SUPPORTED)),e.message},TW=(e,t=!1)=>({title:TV(e,t).toString(),message:TK(e,t).toString()}),TY=e=>{if(e.muxCode){if(e.muxCode===nG.NETWORK_TOKEN_EXPIRED)return"403-expired-token.md";if(e.muxCode===nG.NETWORK_TOKEN_MALFORMED)return"403-malformatted-token.md";if([nG.NETWORK_TOKEN_AUD_MISMATCH,nG.NETWORK_TOKEN_AUD_MISSING].includes(e.muxCode))return"403-incorrect-aud-value.md";if(e.muxCode===nG.NETWORK_TOKEN_SUB_MISMATCH)return"403-playback-id-mismatch.md";if(e.muxCode===nG.NETWORK_TOKEN_MISSING)return"missing-signed-tokens.md";if(e.muxCode===nG.NETWORK_NOT_FOUND)return"404-not-found.md";if(e.muxCode===nG.NETWORK_NOT_READY)return"412-not-playable.md"}if(e.code){if(e.code===nK.MEDIA_ERR_NETWORK)return"";if(e.code===nK.MEDIA_ERR_DECODE)return"media-decode-error.md";if(e.code===nK.MEDIA_ERR_SRC_NOT_SUPPORTED)return"media-src-not-supported.md"}return""},Tq=(e,t)=>{let i=TY(e);return{message:e.message,context:e.context,file:i}},Tj=`<template id="media-theme-gerwig">
  <style>
    @keyframes pre-play-hide {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      30% {
        transform: scale(0.7);
      }

      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    :host {
      --_primary-color: var(--media-primary-color, #fff);
      --_secondary-color: var(--media-secondary-color, transparent);
      --_accent-color: var(--media-accent-color, #fa50b5);
      --_text-color: var(--media-text-color, #000);

      --media-icon-color: var(--_primary-color);
      --media-control-background: var(--_secondary-color);
      --media-control-hover-background: var(--_accent-color);
      --media-time-buffered-color: rgba(255, 255, 255, 0.4);
      --media-preview-time-text-shadow: none;
      --media-control-height: 14px;
      --media-control-padding: 6px;
      --media-tooltip-container-margin: 6px;
      --media-tooltip-distance: 18px;

      color: var(--_primary-color);
      display: inline-block;
      width: 100%;
      height: 100%;
    }

    :host([audio]) {
      --_secondary-color: var(--media-secondary-color, black);
      --media-preview-time-text-shadow: none;
    }

    :host([audio]) ::slotted([slot='media']) {
      height: 0px;
    }

    :host([audio]) media-loading-indicator {
      display: none;
    }

    :host([audio]) media-controller {
      background: transparent;
    }

    :host([audio]) media-controller::part(vertical-layer) {
      background: transparent;
    }

    :host([audio]) media-control-bar {
      width: 100%;
      background-color: var(--media-control-background);
    }

    /*
     * 0.433s is the transition duration for VTT Regions.
     * Borrowed here, so the captions don't move too fast.
     */
    media-controller {
      --media-webkit-text-track-transform: translateY(0) scale(0.98);
      --media-webkit-text-track-transition: transform 0.433s ease-out 0.3s;
    }
    media-controller:is([mediapaused], :not([userinactive])) {
      --media-webkit-text-track-transform: translateY(-50px) scale(0.98);
      --media-webkit-text-track-transition: transform 0.15s ease;
    }

    /*
     * CSS specific to iOS devices.
     * See: https://stackoverflow.com/questions/30102792/css-media-query-to-target-only-ios-devices/60220757#60220757
     */
    @supports (-webkit-touch-callout: none) {
      /* Disable subtitle adjusting for iOS Safari */
      media-controller[mediaisfullscreen] {
        --media-webkit-text-track-transform: unset;
        --media-webkit-text-track-transition: unset;
      }
    }

    media-time-range {
      --media-box-padding-left: 6px;
      --media-box-padding-right: 6px;
      --media-range-bar-color: var(--_accent-color);
      --media-time-range-buffered-color: var(--_primary-color);
      --media-range-track-color: transparent;
      --media-range-track-background: rgba(255, 255, 255, 0.4);
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_accent-color) 25%,
        var(--_accent-color)
      );
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
      --media-range-thumb-transform: scale(0);
      --media-range-thumb-transition: transform 0.3s;
      --media-range-thumb-opacity: 1;
      --media-preview-background: var(--_primary-color);
      --media-box-arrow-background: var(--_primary-color);
      --media-preview-thumbnail-border: 5px solid var(--_primary-color);
      --media-preview-border-radius: 5px;
      --media-text-color: var(--_text-color);
      --media-control-hover-background: transparent;
      --media-preview-chapter-text-shadow: none;
      color: var(--_accent-color);
      padding: 0 6px;
    }

    :host([audio]) media-time-range {
      --media-preview-time-padding: 1.5px 6px;
      --media-preview-box-margin: 0 0 -5px;
    }

    media-time-range:hover {
      --media-range-thumb-transform: scale(1);
    }

    media-preview-thumbnail {
      border-bottom-width: 0;
    }

    [part~='menu'] {
      border-radius: 2px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      bottom: 50px;
      padding: 2.5px 10px;
    }

    [part~='menu']::part(indicator) {
      fill: var(--_accent-color);
    }

    [part~='menu']::part(menu-item) {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      padding: 6px 10px;
      min-height: 34px;
    }

    [part~='menu']::part(checked) {
      font-weight: 700;
    }

    media-captions-menu,
    media-rendition-menu,
    media-audio-track-menu,
    media-playback-rate-menu {
      position: absolute; /* ensure they don't take up space in DOM on load */
      --media-menu-background: var(--_primary-color);
      --media-menu-item-checked-background: transparent;
      --media-text-color: var(--_text-color);
      --media-menu-item-hover-background: transparent;
      --media-menu-item-hover-outline: var(--_accent-color) solid 1px;
    }

    /* The icon is a circle so make it 16px high instead of 14px for more balance. */
    media-audio-track-menu-button {
      --media-control-padding: 5px;
      --media-control-height: 16px;
    }

    media-playback-rate-menu-button {
      --media-control-padding: 6px 3px;
      min-width: 4.4ch;
    }

    media-playback-rate-menu {
      --media-menu-flex-direction: row;
      --media-menu-item-checked-background: var(--_accent-color);
      --media-menu-item-checked-indicator-display: none;
      margin-right: 6px;
      padding: 0;
      --media-menu-gap: 0.25em;
    }

    media-playback-rate-menu[part~='menu']::part(menu-item) {
      padding: 6px 6px 6px 8px;
    }

    media-playback-rate-menu[part~='menu']::part(checked) {
      color: #fff;
    }

    :host(:not([audio])) media-time-range {
      /* Adding px is required here for calc() */
      --media-range-padding: 0px;
      background: transparent;
      z-index: 10;
      height: 10px;
      bottom: -3px;
      width: 100%;
    }

    media-control-bar :is([role='button'], [role='switch'], button) {
      line-height: 0;
    }

    media-control-bar :is([part*='button'], [part*='range'], [part*='display']) {
      border-radius: 3px;
    }

    .spacer {
      flex-grow: 1;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    media-control-bar[slot~='top-chrome'] {
      min-height: 42px;
      pointer-events: none;
    }

    media-control-bar {
      --gradient-steps:
        hsl(0 0% 0% / 0) 0%, hsl(0 0% 0% / 0.013) 8.1%, hsl(0 0% 0% / 0.049) 15.5%, hsl(0 0% 0% / 0.104) 22.5%,
        hsl(0 0% 0% / 0.175) 29%, hsl(0 0% 0% / 0.259) 35.3%, hsl(0 0% 0% / 0.352) 41.2%, hsl(0 0% 0% / 0.45) 47.1%,
        hsl(0 0% 0% / 0.55) 52.9%, hsl(0 0% 0% / 0.648) 58.8%, hsl(0 0% 0% / 0.741) 64.7%, hsl(0 0% 0% / 0.825) 71%,
        hsl(0 0% 0% / 0.896) 77.5%, hsl(0 0% 0% / 0.951) 84.5%, hsl(0 0% 0% / 0.987) 91.9%, hsl(0 0% 0%) 100%;
    }

    :host([title]:not([audio])) media-control-bar[slot='top-chrome']::before {
      content: '';
      position: absolute;
      width: 100%;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(to top, var(--gradient-steps));
      opacity: 0.8;
      pointer-events: none;
    }

    :host(:not([audio])) media-control-bar[part~='bottom']::before {
      content: '';
      position: absolute;
      width: 100%;
      bottom: 0;
      left: 0;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(to bottom, var(--gradient-steps));
      opacity: 0.8;
      z-index: 1;
      pointer-events: none;
    }

    media-control-bar[part~='bottom'] > * {
      z-index: 20;
    }

    media-control-bar[part~='bottom'] {
      padding: 6px 6px;
    }

    media-control-bar[slot~='top-chrome'] > * {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      position: relative;
    }

    media-controller::part(vertical-layer) {
      transition: background-color 1s;
    }

    media-controller:is([mediapaused], :not([userinactive]))::part(vertical-layer) {
      background-color: var(--controls-backdrop-color, var(--controls, transparent));
      transition: background-color 0.25s;
    }

    .center-controls {
      --media-button-icon-width: 100%;
      --media-button-icon-height: auto;
      --media-tooltip-display: none;
      pointer-events: none;
      width: 100%;
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
      paint-order: stroke;
      stroke: rgba(102, 102, 102, 1);
      stroke-width: 0.3px;
      text-shadow:
        0 0 2px rgb(0 0 0 / 0.25),
        0 0 6px rgb(0 0 0 / 0.25);
    }

    .center-controls media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      --media-control-padding: 0;
      width: 40px;
    }

    [breakpointsm] .center-controls media-play-button {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      transition: background 0.4s;
      padding: 24px;
      --media-control-background: #000;
      --media-control-hover-background: var(--_accent-color);
    }

    .center-controls media-seek-backward-button,
    .center-controls media-seek-forward-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      margin: 0 20px;
      width: max(33px, min(8%, 40px));
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback {
      display: grid;
      align-items: initial;
      justify-content: initial;
      height: 100%;
      overflow: hidden;
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback media-play-button {
      place-self: var(--_pre-playback-place, center);
      grid-area: 1 / 1;
      margin: 16px;
    }

    /* Show and hide controls or pre-playback state */

    [breakpointsm]:is([mediahasplayed], :not([mediapaused])):not([audio])
      .center-controls.pre-playback
      media-play-button {
      /* Using \`forwards\` would lead to a laggy UI after the animation got in the end state */
      animation: 0.3s linear pre-play-hide;
      opacity: 0;
      pointer-events: none;
    }

    .autoplay-unmute {
      --media-control-hover-background: transparent;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
    }

    .autoplay-unmute-btn {
      --media-control-height: 16px;
      border-radius: 8px;
      background: #000;
      color: var(--_primary-color);
      display: flex;
      align-items: center;
      padding: 8px 16px;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
    }

    .autoplay-unmute-btn:hover {
      background: var(--_accent-color);
    }

    [breakpointsm] .autoplay-unmute-btn {
      --media-control-height: 30px;
      padding: 14px 24px;
      font-size: 26px;
    }

    .autoplay-unmute-btn svg {
      margin: 0 6px 0 0;
    }

    [breakpointsm] .autoplay-unmute-btn svg {
      margin: 0 10px 0 0;
    }

    media-controller:not([audio]):not([mediahasplayed]) *:is(media-control-bar, media-time-range) {
      display: none;
    }

    media-error-dialog:not([mediaerrorcode]) {
      opacity: 0;
    }

    media-loading-indicator {
      --media-loading-icon-width: 100%;
      --media-button-icon-height: auto;
      display: var(--media-control-display, var(--media-loading-indicator-display, flex));
      pointer-events: none;
      position: absolute;
      width: min(15%, 150px);
      flex-flow: row;
      align-items: center;
      justify-content: center;
    }

    /* Intentionally don't target the div for transition but the children
     of the div. Prevents messing with media-chrome's autohide feature. */
    media-loading-indicator + div * {
      transition: opacity 0.15s;
      opacity: 1;
    }

    media-loading-indicator[medialoading]:not([mediapaused]) ~ div > * {
      opacity: 0;
      transition-delay: 400ms;
    }

    media-volume-range {
      width: min(100%, 100px);
      --media-range-padding-left: 10px;
      --media-range-padding-right: 10px;
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_primary-color) 25%,
        var(--_primary-color)
      );
      --media-control-hover-background: none;
    }

    media-time-display {
      white-space: nowrap;
    }

    /* Generic style for explicitly disabled controls */
    media-control-bar[part~='bottom'] [disabled],
    media-control-bar[part~='bottom'] [aria-disabled='true'] {
      opacity: 60%;
      cursor: not-allowed;
    }

    media-text-display {
      --media-font-size: 16px;
      --media-control-padding: 14px;
      font-weight: 500;
    }

    media-play-button.animated *:is(g, path) {
      transition: all 0.3s;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt1 {
      opacity: 0;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt2 {
      transform-origin: center center;
      transform: scaleY(0);
    }

    media-play-button.animated[mediapaused] .play-icon {
      clip-path: inset(0 0 0 0);
    }

    media-play-button.animated:not([mediapaused]) .play-icon {
      clip-path: inset(0 0 0 100%);
    }

    media-seek-forward-button,
    media-seek-backward-button {
      --media-font-weight: 400;
    }

    .mute-icon {
      display: inline-block;
    }

    .mute-icon :is(path, g) {
      transition: opacity 0.5s;
    }

    .muted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='low'] :is(.volume-medium, .volume-high),
    media-mute-button[mediavolumelevel='medium'] :is(.volume-high) {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .unmuted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .muted {
      opacity: 1;
    }

    /**
     * Our defaults for these buttons are to hide them at small sizes
     * users can override this with CSS
     */
    media-controller:not([breakpointsm]):not([audio]) {
      --bottom-play-button: none;
      --bottom-seek-backward-button: none;
      --bottom-seek-forward-button: none;
      --bottom-time-display: none;
      --bottom-playback-rate-menu-button: none;
      --bottom-pip-button: none;
    }

    [part='mux-badge'] {
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 2;
      opacity: 0.6;
      transition:
        opacity 0.2s ease-in-out,
        bottom 0.2s ease-in-out;
    }

    [part='mux-badge']:hover {
      opacity: 1;
    }

    [part='mux-badge'] a {
      font-size: 14px;
      font-family: var(--_font-family);
      color: var(--_primary-color);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    [part='mux-badge'] .mux-badge-text {
      transition: opacity 0.5s ease-in-out;
      opacity: 0;
    }

    [part='mux-badge'] .mux-badge-logo {
      width: 40px;
      height: auto;
      display: inline-block;
    }

    [part='mux-badge'] .mux-badge-logo svg {
      width: 100%;
      height: 100%;
      fill: white;
    }

    media-controller:not([userinactive]):not([mediahasplayed]) [part='mux-badge'],
    media-controller:not([userinactive]) [part='mux-badge'],
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] {
      transition: bottom 0.1s ease-in-out;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] {
      transition: bottom 0.2s ease-in-out 0.62s;
    }

    media-controller:not([userinactive]) [part='mux-badge'] .mux-badge-text,
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] .mux-badge-text {
      opacity: 1;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] .mux-badge-text {
      opacity: 0;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] {
      bottom: 10px;
    }

    media-controller:not([userinactive]):not([mediahasplayed]) [part='mux-badge'] {
      bottom: 10px;
    }

    media-controller:not([userinactive])[mediahasplayed] [part='mux-badge'],
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] {
      bottom: calc(28px + var(--media-control-height, 0px) + var(--media-control-padding, 0px) * 2);
    }
  </style>

  <template partial="TitleDisplay">
    <template if="videotitle">
      <template if="videotitle != true">
        <media-text-display part="top title display" class="title-display">{{videotitle}}</media-text-display>
      </template>
    </template>
    <template if="!videotitle">
      <template if="title">
        <media-text-display part="top title display" class="title-display">{{title}}</media-text-display>
      </template>
    </template>
  </template>

  <template partial="PlayButton">
    <media-play-button
      part="{{section ?? 'bottom'}} play button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      class="animated"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon">
        <g class="play-icon">
          <path
            d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
          />
        </g>
        <g class="pause-icon">
          <path
            class="pause-icon-pt1"
            d="M5.90709 0H2.96889C2.46857 0 2.06299 0.405585 2.06299 0.9059V13.0941C2.06299 13.5944 2.46857 14 2.96889 14H5.90709C6.4074 14 6.81299 13.5944 6.81299 13.0941V0.9059C6.81299 0.405585 6.4074 0 5.90709 0Z"
          />
          <path
            class="pause-icon-pt2"
            d="M15.1571 0H12.2189C11.7186 0 11.313 0.405585 11.313 0.9059V13.0941C11.313 13.5944 11.7186 14 12.2189 14H15.1571C15.6574 14 16.063 13.5944 16.063 13.0941V0.9059C16.063 0.405585 15.6574 0 15.1571 0Z"
          />
        </g>
      </svg>
    </media-play-button>
  </template>

  <template partial="PrePlayButton">
    <media-play-button
      part="{{section ?? 'center'}} play button pre-play"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon" style="transform: translate(3px, 0)">
        <path
          d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
        />
      </svg>
    </media-play-button>
  </template>

  <template partial="SeekBackwardButton">
    <media-seek-backward-button
      seekoffset="{{backwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-backward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <path
          d="M3.65 2.07888L0.0864 6.7279C-0.0288 6.87812 -0.0288 7.12188 0.0864 7.2721L3.65 11.9211C3.7792 12.0896 4 11.9703 4 11.7321V2.26787C4 2.02968 3.7792 1.9104 3.65 2.07888Z"
        />
        <text transform="translate(6 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
          {{backwardseekoffset}}
        </text>
      </svg>
    </media-seek-backward-button>
  </template>

  <template partial="SeekForwardButton">
    <media-seek-forward-button
      seekoffset="{{forwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-forward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <g>
          <text transform="translate(-1 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
            {{forwardseekoffset}}
          </text>
          <path
            d="M18.35 11.9211L21.9136 7.2721C22.0288 7.12188 22.0288 6.87812 21.9136 6.7279L18.35 2.07888C18.2208 1.91041 18 2.02968 18 2.26787V11.7321C18 11.9703 18.2208 12.0896 18.35 11.9211Z"
          />
        </g>
      </svg>
    </media-seek-forward-button>
  </template>

  <template partial="MuteButton">
    <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" slot="icon" class="mute-icon" aria-hidden="true">
        <g class="unmuted">
          <path
            d="M6.76786 1.21233L3.98606 3.98924H1.19937C0.593146 3.98924 0.101743 4.51375 0.101743 5.1607V6.96412L0 6.99998L0.101743 7.03583V8.83926C0.101743 9.48633 0.593146 10.0108 1.19937 10.0108H3.98606L6.76773 12.7877C7.23561 13.2547 8 12.9007 8 12.2171V1.78301C8 1.09925 7.23574 0.745258 6.76786 1.21233Z"
          />
          <path
            class="volume-low"
            d="M10 3.54781C10.7452 4.55141 11.1393 5.74511 11.1393 6.99991C11.1393 8.25471 10.7453 9.44791 10 10.4515L10.7988 11.0496C11.6734 9.87201 12.1356 8.47161 12.1356 6.99991C12.1356 5.52821 11.6735 4.12731 10.7988 2.94971L10 3.54781Z"
          />
          <path
            class="volume-medium"
            d="M12.3778 2.40086C13.2709 3.76756 13.7428 5.35806 13.7428 7.00026C13.7428 8.64246 13.2709 10.233 12.3778 11.5992L13.2106 12.1484C14.2107 10.6185 14.739 8.83796 14.739 7.00016C14.739 5.16236 14.2107 3.38236 13.2106 1.85156L12.3778 2.40086Z"
          />
          <path
            class="volume-high"
            d="M15.5981 0.75L14.7478 1.2719C15.7937 2.9919 16.3468 4.9723 16.3468 7C16.3468 9.0277 15.7937 11.0082 14.7478 12.7281L15.5981 13.25C16.7398 11.3722 17.343 9.211 17.343 7C17.343 4.789 16.7398 2.6268 15.5981 0.75Z"
          />
        </g>
        <g class="muted">
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.39976 4.98924H1.19937C1.19429 4.98924 1.17777 4.98961 1.15296 5.01609C1.1271 5.04369 1.10174 5.09245 1.10174 5.1607V8.83926C1.10174 8.90761 1.12714 8.95641 1.15299 8.984C1.17779 9.01047 1.1943 9.01084 1.19937 9.01084H4.39977L7 11.6066V2.39357L4.39976 4.98924ZM7.47434 1.92006C7.4743 1.9201 7.47439 1.92002 7.47434 1.92006V1.92006ZM6.76773 12.7877L3.98606 10.0108H1.19937C0.593146 10.0108 0.101743 9.48633 0.101743 8.83926V7.03583L0 6.99998L0.101743 6.96412V5.1607C0.101743 4.51375 0.593146 3.98924 1.19937 3.98924H3.98606L6.76786 1.21233C7.23574 0.745258 8 1.09925 8 1.78301V12.2171C8 12.9007 7.23561 13.2547 6.76773 12.7877Z"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.2677 9.30323C15.463 9.49849 15.7796 9.49849 15.9749 9.30323C16.1701 9.10796 16.1701 8.79138 15.9749 8.59612L14.2071 6.82841L15.9749 5.06066C16.1702 4.8654 16.1702 4.54882 15.9749 4.35355C15.7796 4.15829 15.4631 4.15829 15.2678 4.35355L13.5 6.1213L11.7322 4.35348C11.537 4.15822 11.2204 4.15822 11.0251 4.35348C10.8298 4.54874 10.8298 4.86532 11.0251 5.06058L12.7929 6.82841L11.0251 8.59619C10.8299 8.79146 10.8299 9.10804 11.0251 9.3033C11.2204 9.49856 11.537 9.49856 11.7323 9.3033L13.5 7.53552L15.2677 9.30323Z"
          />
        </g>
      </svg>
    </media-mute-button>
  </template>

  <template partial="PipButton">
    <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M15.9891 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.989C0 13.0996 0.9004 14 2.011 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0ZM17 11.9891C17 12.5465 16.5465 13 15.9891 13H2.011C1.4536 13 1.0001 12.5465 1.0001 11.9891V2.0109C1.0001 1.4535 1.4536 0.9999 2.011 0.9999H15.9891C16.5465 0.9999 17 1.4535 17 2.0109V11.9891Z"
        />
        <path
          d="M15.356 5.67822H8.19523C8.03253 5.67822 7.90063 5.81012 7.90063 5.97282V11.3836C7.90063 11.5463 8.03253 11.6782 8.19523 11.6782H15.356C15.5187 11.6782 15.6506 11.5463 15.6506 11.3836V5.97282C15.6506 5.81012 15.5187 5.67822 15.356 5.67822Z"
        />
      </svg>
    </media-pip-button>
  </template>

  <template partial="CaptionsMenu">
    <media-captions-menu-button part="bottom captions button">
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="on">
        <path
          d="M15.989 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9004 14 2.011 14H15.989C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.989 0ZM4.2292 8.7639C4.5954 9.1902 5.0935 9.4031 5.7233 9.4031C6.1852 9.4031 6.5544 9.301 6.8302 9.0969C7.1061 8.8933 7.2863 8.614 7.3702 8.26H8.4322C8.3062 8.884 8.0093 9.3733 7.5411 9.7273C7.0733 10.0813 6.4703 10.2581 5.732 10.2581C5.108 10.2581 4.5699 10.1219 4.1168 9.8489C3.6637 9.5759 3.3141 9.1946 3.0685 8.7058C2.8224 8.2165 2.6994 7.6511 2.6994 7.009C2.6994 6.3611 2.8224 5.7927 3.0685 5.3034C3.3141 4.8146 3.6637 4.4323 4.1168 4.1559C4.5699 3.88 5.108 3.7418 5.732 3.7418C6.4703 3.7418 7.0733 3.922 7.5411 4.2818C8.0094 4.6422 8.3062 5.1461 8.4322 5.794H7.3702C7.2862 5.4283 7.106 5.1368 6.8302 4.921C6.5544 4.7052 6.1852 4.5968 5.7233 4.5968C5.0934 4.5968 4.5954 4.8116 4.2292 5.2404C3.8635 5.6696 3.6804 6.259 3.6804 7.009C3.6804 7.7531 3.8635 8.3381 4.2292 8.7639ZM11.0974 8.7639C11.4636 9.1902 11.9617 9.4031 12.5915 9.4031C13.0534 9.4031 13.4226 9.301 13.6984 9.0969C13.9743 8.8933 14.1545 8.614 14.2384 8.26H15.3004C15.1744 8.884 14.8775 9.3733 14.4093 9.7273C13.9415 10.0813 13.3385 10.2581 12.6002 10.2581C11.9762 10.2581 11.4381 10.1219 10.985 9.8489C10.5319 9.5759 10.1823 9.1946 9.9367 8.7058C9.6906 8.2165 9.5676 7.6511 9.5676 7.009C9.5676 6.3611 9.6906 5.7927 9.9367 5.3034C10.1823 4.8146 10.5319 4.4323 10.985 4.1559C11.4381 3.88 11.9762 3.7418 12.6002 3.7418C13.3385 3.7418 13.9415 3.922 14.4093 4.2818C14.8776 4.6422 15.1744 5.1461 15.3004 5.794H14.2384C14.1544 5.4283 13.9742 5.1368 13.6984 4.921C13.4226 4.7052 13.0534 4.5968 12.5915 4.5968C11.9616 4.5968 11.4636 4.8116 11.0974 5.2404C10.7317 5.6696 10.5486 6.259 10.5486 7.009C10.5486 7.7531 10.7317 8.3381 11.0974 8.7639Z"
        />
      </svg>
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="off">
        <path
          d="M5.73219 10.258C5.10819 10.258 4.57009 10.1218 4.11699 9.8488C3.66389 9.5758 3.31429 9.1945 3.06869 8.7057C2.82259 8.2164 2.69958 7.651 2.69958 7.0089C2.69958 6.361 2.82259 5.7926 3.06869 5.3033C3.31429 4.8145 3.66389 4.4322 4.11699 4.1558C4.57009 3.8799 5.10819 3.7417 5.73219 3.7417C6.47049 3.7417 7.07348 3.9219 7.54128 4.2817C8.00958 4.6421 8.30638 5.146 8.43238 5.7939H7.37039C7.28639 5.4282 7.10618 5.1367 6.83039 4.9209C6.55459 4.7051 6.18538 4.5967 5.72348 4.5967C5.09358 4.5967 4.59559 4.8115 4.22939 5.2403C3.86369 5.6695 3.68058 6.2589 3.68058 7.0089C3.68058 7.753 3.86369 8.338 4.22939 8.7638C4.59559 9.1901 5.09368 9.403 5.72348 9.403C6.18538 9.403 6.55459 9.3009 6.83039 9.0968C7.10629 8.8932 7.28649 8.6139 7.37039 8.2599H8.43238C8.30638 8.8839 8.00948 9.3732 7.54128 9.7272C7.07348 10.0812 6.47049 10.258 5.73219 10.258Z"
        />
        <path
          d="M12.6003 10.258C11.9763 10.258 11.4382 10.1218 10.9851 9.8488C10.532 9.5758 10.1824 9.1945 9.93685 8.7057C9.69075 8.2164 9.56775 7.651 9.56775 7.0089C9.56775 6.361 9.69075 5.7926 9.93685 5.3033C10.1824 4.8145 10.532 4.4322 10.9851 4.1558C11.4382 3.8799 11.9763 3.7417 12.6003 3.7417C13.3386 3.7417 13.9416 3.9219 14.4094 4.2817C14.8777 4.6421 15.1745 5.146 15.3005 5.7939H14.2385C14.1545 5.4282 13.9743 5.1367 13.6985 4.9209C13.4227 4.7051 13.0535 4.5967 12.5916 4.5967C11.9617 4.5967 11.4637 4.8115 11.0975 5.2403C10.7318 5.6695 10.5487 6.2589 10.5487 7.0089C10.5487 7.753 10.7318 8.338 11.0975 8.7638C11.4637 9.1901 11.9618 9.403 12.5916 9.403C13.0535 9.403 13.4227 9.3009 13.6985 9.0968C13.9744 8.8932 14.1546 8.6139 14.2385 8.2599H15.3005C15.1745 8.8839 14.8776 9.3732 14.4094 9.7272C13.9416 10.0812 13.3386 10.258 12.6003 10.258Z"
        />
        <path
          d="M15.9891 1C16.5465 1 17 1.4535 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H2.0109C1.4535 13 1 12.5465 1 11.9891V2.0109C1 1.4535 1.4535 0.9999 2.0109 0.9999L15.9891 1ZM15.9891 0H2.0109C0.9003 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9003 14 2.0109 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0Z"
        />
      </svg>
    </media-captions-menu-button>
    <media-captions-menu
      hidden
      anchor="auto"
      part="bottom captions menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      exportparts="menu-item"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            display: none;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg></div
    ></media-captions-menu>
  </template>

  <template partial="AirplayButton">
    <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M16.1383 0H1.8618C0.8335 0 0 0.8335 0 1.8617V10.1382C0 11.1664 0.8335 12 1.8618 12H3.076C3.1204 11.9433 3.1503 11.8785 3.2012 11.826L4.004 11H1.8618C1.3866 11 1 10.6134 1 10.1382V1.8617C1 1.3865 1.3866 0.9999 1.8618 0.9999H16.1383C16.6135 0.9999 17.0001 1.3865 17.0001 1.8617V10.1382C17.0001 10.6134 16.6135 11 16.1383 11H13.9961L14.7989 11.826C14.8499 11.8785 14.8798 11.9432 14.9241 12H16.1383C17.1665 12 18.0001 11.1664 18.0001 10.1382V1.8617C18 0.8335 17.1665 0 16.1383 0Z"
        />
        <path
          d="M9.55061 8.21903C9.39981 8.06383 9.20001 7.98633 9.00011 7.98633C8.80021 7.98633 8.60031 8.06383 8.44951 8.21903L4.09771 12.697C3.62471 13.1838 3.96961 13.9998 4.64831 13.9998H13.3518C14.0304 13.9998 14.3754 13.1838 13.9023 12.697L9.55061 8.21903Z"
        />
      </svg>
    </media-airplay-button>
  </template>

  <template partial="FullscreenButton">
    <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M1.00745 4.39539L1.01445 1.98789C1.01605 1.43049 1.47085 0.978289 2.02835 0.979989L6.39375 0.992589L6.39665 -0.007411L2.03125 -0.020011C0.920646 -0.023211 0.0176463 0.874489 0.0144463 1.98509L0.00744629 4.39539H1.00745Z"
        />
        <path
          d="M17.0144 2.03431L17.0076 4.39541H18.0076L18.0144 2.03721C18.0176 0.926712 17.1199 0.0237125 16.0093 0.0205125L11.6439 0.0078125L11.641 1.00781L16.0064 1.02041C16.5638 1.02201 17.016 1.47681 17.0144 2.03431Z"
        />
        <path
          d="M16.9925 9.60498L16.9855 12.0124C16.9839 12.5698 16.5291 13.022 15.9717 13.0204L11.6063 13.0078L11.6034 14.0078L15.9688 14.0204C17.0794 14.0236 17.9823 13.1259 17.9855 12.0153L17.9925 9.60498H16.9925Z"
        />
        <path
          d="M0.985626 11.9661L0.992426 9.60498H-0.0074737L-0.0142737 11.9632C-0.0174737 13.0738 0.880226 13.9767 1.99083 13.98L6.35623 13.9926L6.35913 12.9926L1.99373 12.98C1.43633 12.9784 0.983926 12.5236 0.985626 11.9661Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">
        <path
          d="M5.39655 -0.0200195L5.38955 2.38748C5.38795 2.94488 4.93315 3.39708 4.37565 3.39538L0.0103463 3.38278L0.00744629 4.38278L4.37285 4.39538C5.48345 4.39858 6.38635 3.50088 6.38965 2.39028L6.39665 -0.0200195H5.39655Z"
        />
        <path
          d="M12.6411 2.36891L12.6479 0.0078125H11.6479L11.6411 2.36601C11.6379 3.47651 12.5356 4.37951 13.6462 4.38271L18.0116 4.39531L18.0145 3.39531L13.6491 3.38271C13.0917 3.38111 12.6395 2.92641 12.6411 2.36891Z"
        />
        <path
          d="M12.6034 14.0204L12.6104 11.613C12.612 11.0556 13.0668 10.6034 13.6242 10.605L17.9896 10.6176L17.9925 9.61759L13.6271 9.60499C12.5165 9.60179 11.6136 10.4995 11.6104 11.6101L11.6034 14.0204H12.6034Z"
        />
        <path
          d="M5.359 11.6315L5.3522 13.9926H6.3522L6.359 11.6344C6.3622 10.5238 5.4645 9.62088 4.3539 9.61758L-0.0115043 9.60498L-0.0144043 10.605L4.351 10.6176C4.9084 10.6192 5.3607 11.074 5.359 11.6315Z"
        />
      </svg>
    </media-fullscreen-button>
  </template>

  <template partial="CastButton">
    <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M16.0072 0H2.0291C0.9185 0 0.0181 0.9003 0.0181 2.011V5.5009C0.357 5.5016 0.6895 5.5275 1.0181 5.5669V2.011C1.0181 1.4536 1.4716 1 2.029 1H16.0072C16.5646 1 17.0181 1.4536 17.0181 2.011V11.9891C17.0181 12.5465 16.5646 13 16.0072 13H8.4358C8.4746 13.3286 8.4999 13.6611 8.4999 13.9999H16.0071C17.1177 13.9999 18.018 13.0996 18.018 11.989V2.011C18.0181 0.9003 17.1178 0 16.0072 0ZM0 6.4999V7.4999C3.584 7.4999 6.5 10.4159 6.5 13.9999H7.5C7.5 9.8642 4.1357 6.4999 0 6.4999ZM0 8.7499V9.7499C2.3433 9.7499 4.25 11.6566 4.25 13.9999H5.25C5.25 11.1049 2.895 8.7499 0 8.7499ZM0.0181 11V14H3.0181C3.0181 12.3431 1.675 11 0.0181 11Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">
        <path
          d="M15.9891 0H2.01103C0.900434 0 3.35947e-05 0.9003 3.35947e-05 2.011V5.5009C0.338934 5.5016 0.671434 5.5275 1.00003 5.5669V2.011C1.00003 1.4536 1.45353 1 2.01093 1H15.9891C16.5465 1 17 1.4536 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H8.41773C8.45653 13.3286 8.48183 13.6611 8.48183 13.9999H15.989C17.0996 13.9999 17.9999 13.0996 17.9999 11.989V2.011C18 0.9003 17.0997 0 15.9891 0ZM-0.0180664 6.4999V7.4999C3.56593 7.4999 6.48193 10.4159 6.48193 13.9999H7.48193C7.48193 9.8642 4.11763 6.4999 -0.0180664 6.4999ZM-0.0180664 8.7499V9.7499C2.32523 9.7499 4.23193 11.6566 4.23193 13.9999H5.23193C5.23193 11.1049 2.87693 8.7499 -0.0180664 8.7499ZM3.35947e-05 11V14H3.00003C3.00003 12.3431 1.65693 11 3.35947e-05 11Z"
        />
        <path d="M2.15002 5.634C5.18352 6.4207 7.57252 8.8151 8.35282 11.8499H15.8501V2.1499H2.15002V5.634Z" />
      </svg>
    </media-cast-button>
  </template>

  <template partial="LiveButton">
    <media-live-button part="{{section ?? 'top'}} live button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <span slot="text">Live</span>
    </media-live-button>
  </template>

  <template partial="PlaybackRateMenu">
    <media-playback-rate-menu-button part="bottom playback-rate button"></media-playback-rate-menu-button>
    <media-playback-rate-menu
      hidden
      anchor="auto"
      rates="{{playbackrates}}"
      exportparts="menu-item"
      part="bottom playback-rate menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-playback-rate-menu>
  </template>

  <template partial="VolumeRange">
    <media-volume-range
      part="bottom volume range"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-volume-range>
  </template>

  <template partial="TimeDisplay">
    <media-time-display
      remaining="{{defaultshowremainingtime}}"
      showduration="{{!hideduration}}"
      part="bottom time display"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-time-display>
  </template>

  <template partial="TimeRange">
    <media-time-range part="bottom time range" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <media-preview-thumbnail slot="preview"></media-preview-thumbnail>
      <media-preview-chapter-display slot="preview"></media-preview-chapter-display>
      <media-preview-time-display slot="preview"></media-preview-time-display>
      <div slot="preview" part="arrow"></div>
    </media-time-range>
  </template>

  <template partial="AudioTrackMenu">
    <media-audio-track-menu-button part="bottom audio-track button">
      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 16">
        <path d="M9 15A7 7 0 1 1 9 1a7 7 0 0 1 0 14Zm0 1A8 8 0 1 0 9 0a8 8 0 0 0 0 16Z" />
        <path
          d="M5.2 6.3a.5.5 0 0 1 .5.5v2.4a.5.5 0 1 1-1 0V6.8a.5.5 0 0 1 .5-.5Zm2.4-2.4a.5.5 0 0 1 .5.5v7.2a.5.5 0 0 1-1 0V4.4a.5.5 0 0 1 .5-.5ZM10 5.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.4-.8a.5.5 0 0 1 .5.5v5.6a.5.5 0 0 1-1 0V5.2a.5.5 0 0 1 .5-.5Z"
        />
      </svg>
    </media-audio-track-menu-button>
    <media-audio-track-menu
      hidden
      anchor="auto"
      part="bottom audio-track menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      exportparts="menu-item"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            display: none;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg>
      </div>
    </media-audio-track-menu>
  </template>

  <template partial="RenditionMenu">
    <media-rendition-menu-button part="bottom rendition button">
      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 14">
        <path
          d="M2.25 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM9 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm6.75 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"
        />
      </svg>
    </media-rendition-menu-button>
    <media-rendition-menu
      hidden
      anchor="auto"
      part="bottom rendition menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            display: none;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg>
      </div>
    </media-rendition-menu>
  </template>

  <template partial="MuxBadge">
    <div part="mux-badge">
      <a href="https://www.mux.com/player" target="_blank">
        <span class="mux-badge-text">Powered by</span>
        <div class="mux-badge-logo">
          <svg
            viewBox="0 0 1600 500"
            style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2"
          >
            <g>
              <path
                d="M994.287,93.486c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m0,-93.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,68.943 -56.09,125.033 -125.032,125.033c-68.942,-0 -125.03,-56.09 -125.03,-125.033l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,137.853 112.149,250.003 249.999,250.003c137.851,-0 250.001,-112.15 250.001,-250.003l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486"
                style="fill-rule: nonzero"
              ></path>
              <path
                d="M1537.51,468.511c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m-275.883,-218.509l-143.33,143.329c-24.402,24.402 -24.402,63.966 0,88.368c24.402,24.402 63.967,24.402 88.369,-0l143.33,-143.329l143.328,143.329c24.402,24.4 63.967,24.402 88.369,-0c24.403,-24.402 24.403,-63.966 0.001,-88.368l-143.33,-143.329l0.001,-0.004l143.329,-143.329c24.402,-24.402 24.402,-63.965 0,-88.367c-24.402,-24.402 -63.967,-24.402 -88.369,-0l-143.329,143.328l-143.329,-143.328c-24.402,-24.401 -63.967,-24.402 -88.369,-0c-24.402,24.402 -24.402,63.965 0,88.367l143.329,143.329l0,0.004Z"
                style="fill-rule: nonzero"
              ></path>
              <path
                d="M437.511,468.521c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m23.915,-463.762c-23.348,-9.672 -50.226,-4.327 -68.096,13.544l-143.331,143.329l-143.33,-143.329c-17.871,-17.871 -44.747,-23.216 -68.096,-13.544c-23.349,9.671 -38.574,32.455 -38.574,57.729l0,375.026c0,34.51 27.977,62.486 62.487,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-224.173l80.843,80.844c24.404,24.402 63.965,24.402 88.369,-0l80.843,-80.844l0,224.173c0,34.51 27.976,62.486 62.486,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-375.026c0,-25.274 -15.224,-48.058 -38.573,-57.729"
                style="fill-rule: nonzero"
              ></path>
            </g>
          </svg>
        </div>
      </a>
    </div>
  </template>

  <media-controller
    part="controller"
    defaultstreamtype="{{defaultstreamtype ?? 'on-demand'}}"
    breakpoints="sm:470"
    gesturesdisabled="{{disabled}}"
    hotkeys="{{hotkeys}}"
    nohotkeys="{{nohotkeys}}"
    novolumepref="{{novolumepref}}"
    audio="{{audio}}"
    noautoseektolive="{{noautoseektolive}}"
    defaultsubtitles="{{defaultsubtitles}}"
    defaultduration="{{defaultduration ?? false}}"
    keyboardforwardseekoffset="{{forwardseekoffset}}"
    keyboardbackwardseekoffset="{{backwardseekoffset}}"
    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"
    style="--_pre-playback-place:{{preplaybackplace ?? 'center'}}"
  >
    <slot name="media" slot="media"></slot>
    <slot name="poster" slot="poster"></slot>

    <media-loading-indicator slot="centered-chrome" noautohide></media-loading-indicator>
    <media-error-dialog slot="dialog" noautohide></media-error-dialog>

    <template if="!audio">
      <!-- Pre-playback UI -->
      <!-- same for both on-demand and live -->
      <div slot="centered-chrome" class="center-controls pre-playback">
        <template if="!breakpointsm">{{>PlayButton section="center"}}</template>
        <template if="breakpointsm">{{>PrePlayButton section="center"}}</template>
      </div>

      <!-- Mux Badge -->
      <template if="proudlydisplaymuxbadge"> {{>MuxBadge}} </template>

      <!-- Autoplay centered unmute button -->
      <!--
        todo: figure out how show this with available state variables
        needs to show when:
        - autoplay is enabled
        - playback has been successful
        - audio is muted
        - in place / instead of the pre-plaback play button
        - not to show again after user has interacted with this button
          - OR user has interacted with the mute button in the control bar
      -->
      <!--
        There should be a >MuteButton to the left of the "Unmute" text, but a templating bug
        makes it appear even if commented out in the markup, add it back when code is un-commented
      -->
      <!-- <div slot="centered-chrome" class="autoplay-unmute">
        <div role="button" class="autoplay-unmute-btn">Unmute</div>
      </div> -->

      <template if="streamtype == 'on-demand'">
        <template if="breakpointsm">
          <media-control-bar part="control-bar top" slot="top-chrome">{{>TitleDisplay}} </media-control-bar>
        </template>
        {{>TimeRange}}
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>MuteButton}}
          {{>VolumeRange}}
          <div class="spacer"></div>
          {{>RenditionMenu}} {{>PlaybackRateMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}}
          {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <media-control-bar part="control-bar top" slot="top-chrome">
          {{>LiveButton}}
          <template if="breakpointsm"> {{>TitleDisplay}} </template>
        </media-control-bar>
        <template if="targetlivewindow > 0">{{>TimeRange}}</template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}}
          <template if="targetlivewindow > 0">{{>SeekBackwardButton}} {{>SeekForwardButton}}</template>
          {{>MuteButton}} {{>VolumeRange}}
          <div class="spacer"></div>
          {{>RenditionMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
          {{>FullscreenButton}}
        </media-control-bar>
      </template>
    </template>

    <template if="audio">
      <template if="streamtype == 'on-demand'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}}
          <template if="breakpointsm"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          {{>MuteButton}}
          <template if="breakpointsm">{{>VolumeRange}}</template>
          {{>TimeDisplay}} {{>TimeRange}}
          <template if="breakpointsm">{{>PlaybackRateMenu}}</template>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}} {{>LiveButton section="bottom"}} {{>MuteButton}}
          <template if="breakpointsm">
            {{>VolumeRange}}
            <template if="targetlivewindow > 0"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          </template>
          <template if="targetlivewindow > 0"> {{>TimeDisplay}} {{>TimeRange}} </template>
          <template if="!targetlivewindow"><div class="spacer"></div></template>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>
    </template>

    <slot></slot>
  </media-controller>
</template>
`,Tz=Te.createElement("template");"innerHTML"in Tz&&(Tz.innerHTML=Tj);var TX,TQ,TZ=class extends Et{};TZ.template=null==(TQ=null==(TX=Tz.content)?void 0:TX.children)?void 0:TQ[0],y7.customElements.get("media-theme-gerwig")||y7.customElements.define("media-theme-gerwig",TZ);var TJ={SRC:"src",POSTER:"poster"},T0={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",ACCENT_COLOR:"accent-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",DRM_TOKEN:"drm-token",STORYBOARD_SRC:"storyboard-src",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",DEFAULT_DURATION:"default-duration",TITLE:"title",VIDEO_TITLE:"video-title",PLACEHOLDER:"placeholder",THEME:"theme",DEFAULT_STREAM_TYPE:"default-stream-type",TARGET_LIVE_WINDOW:"target-live-window",EXTRA_SOURCE_PARAMS:"extra-source-params",NO_VOLUME_PREF:"no-volume-pref",CAST_RECEIVER:"cast-receiver",NO_TOOLTIPS:"no-tooltips",PROUDLY_DISPLAY_MUX_BADGE:"proudly-display-mux-badge"},T1=["audio","backwardseekoffset","defaultduration","defaultshowremainingtime","defaultsubtitles","noautoseektolive","disabled","exportparts","forwardseekoffset","hideduration","hotkeys","nohotkeys","playbackrates","defaultstreamtype","streamtype","style","targetlivewindow","template","title","videotitle","novolumepref","proudlydisplaymuxbadge"],T2=h3.formatErrorMessage;function T3(e){let t=e.videoTitle?{video_title:e.videoTitle}:{};return e.getAttributeNames().filter(e=>e.startsWith("metadata-")).reduce((t,i)=>{let r=e.getAttribute(i);return null!==r&&(t[i.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},t)}h3.formatErrorMessage=e=>{var t,i;if(e instanceof nK){let r=TW(e,!1);return`
      ${null!=r&&r.title?`<h3>${r.title}</h3>`:""}
      ${null!=r&&r.message||null!=r&&r.linkUrl?`<p>
        ${null==r?void 0:r.message}
        ${null!=r&&r.linkUrl?`<a
              href="${r.linkUrl}"
              target="_blank"
              rel="external noopener"
              aria-label="${null!=(t=r.linkText)?t:""} ${oo("(opens in a new window)")}"
              >${null!=(i=r.linkText)?i:r.linkUrl}</a
            >`:""}
      </p>`:""}
    `}return T2(e)};var T4,T5,T8,T9,T6,T7,_e,_t,_i,_r,_a,_s,_n,_o,_l,_d=Object.values(vk),_u=Object.values(TJ),_h=Object.values(T0),_c="mux-player",_m={isDialogOpen:!1},_p={redundant_streams:!0},_f=class extends TI{constructor(){super(),bg(this,_e),bg(this,T4),bg(this,T5,!1),bg(this,T8,{}),bg(this,T9,!0),bg(this,T6,new Tf(this,"hotkeys")),bg(this,T7,{..._m,onCloseErrorDialog:e=>{var t;(null==(t=e.composedPath()[0])?void 0:t.localName)==="media-error-dialog"&&bE(this,_e,_r).call(this,{isDialogOpen:!1})},onFocusInErrorDialog:e=>{var t;(null==(t=e.composedPath()[0])?void 0:t.localName)==="media-error-dialog"&&(Tl(this,Te.activeElement)||e.preventDefault())}}),bv(this,T4,ll()),this.attachShadow({mode:"open"}),bE(this,_e,_i).call(this),this.isConnected&&bE(this,_e,_t).call(this)}static get NAME(){return _c}static get VERSION(){return Tu}static get observedAttributes(){var e;return[...null!=(e=TI.observedAttributes)?e:[],..._u,..._d,..._h]}get mediaTheme(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("media-theme")}get mediaController(){var e,t;return null==(t=null==(e=this.mediaTheme)?void 0:e.shadowRoot)?void 0:t.querySelector("media-controller")}connectedCallback(){var e;let t=null==(e=this.shadowRoot)?void 0:e.querySelector("mux-video");t&&(t.metadata=T3(this))}attributeChangedCallback(e,t,i){var r;switch(bE(this,_e,_t).call(this),super.attributeChangedCallback(e,t,i),e){case T0.HOTKEYS:bf(this,T6).value=i;break;case T0.THUMBNAIL_TIME:null!=i&&this.tokens.thumbnail&&Tv(oo("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").toString());break;case T0.THUMBNAIL_TOKEN:if(i){let e=oi(i);if(e){let{aud:t}=e,i=oD.THUMBNAIL;t!==i&&Tv(oo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"thumbnail"}))}}break;case T0.STORYBOARD_TOKEN:if(i){let e=oi(i);if(e){let{aud:t}=e,i=oD.STORYBOARD;t!==i&&Tv(oo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"storyboard"}))}}break;case T0.DRM_TOKEN:if(i){let e=oi(i);if(e){let{aud:t}=e,i=oD.DRM;t!==i&&Tv(oo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"drm"}))}}break;case vk.PLAYBACK_ID:null!=i&&i.includes("?token")&&TE(oo("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:i}));break;case vk.STREAM_TYPE:i&&![nj.LIVE,nj.ON_DEMAND,nj.UNKNOWN].includes(i)?["ll-live","live:dvr","ll-live:dvr"].includes(this.streamType)?this.targetLiveWindow=i.includes("dvr")?Number.POSITIVE_INFINITY:0:Tb({file:"invalid-stream-type.md",message:oo("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand` or `live`").format({streamType:this.streamType})}):i===nj.LIVE?null==this.getAttribute(T0.TARGET_LIVE_WINDOW)&&(this.targetLiveWindow=0):this.targetLiveWindow=Number.NaN}[vk.PLAYBACK_ID,TJ.SRC,T0.PLAYBACK_TOKEN].includes(e)&&t!==i&&bv(this,T7,{...bf(this,T7),..._m}),bE(this,_e,_a).call(this,{[null!=(r=Tp[e])?r:Ti(e)]:i})}async requestFullscreen(e){var t;if(!(!this.mediaController||this.mediaController.hasAttribute(lj.MEDIA_IS_FULLSCREEN)))return null==(t=this.mediaController)||t.dispatchEvent(new y7.CustomEvent(lK.MEDIA_ENTER_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((e,t)=>{var i;null==(i=this.mediaController)||i.addEventListener(lz.MEDIA_IS_FULLSCREEN,()=>e(),{once:!0})})}async exitFullscreen(){var e;if(!(!this.mediaController||!this.mediaController.hasAttribute(lj.MEDIA_IS_FULLSCREEN)))return null==(e=this.mediaController)||e.dispatchEvent(new y7.CustomEvent(lK.MEDIA_EXIT_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((e,t)=>{var i;null==(i=this.mediaController)||i.addEventListener(lz.MEDIA_IS_FULLSCREEN,()=>e(),{once:!0})})}get preferCmcd(){var e;return null!=(e=this.getAttribute(vk.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?nQ.includes(e)?this.setAttribute(vk.PREFER_CMCD,e):Tv(`Invalid value for preferCmcd. Must be one of ${nQ.join()}`):this.removeAttribute(vk.PREFER_CMCD))}get hasPlayed(){var e,t;return null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute(lj.MEDIA_HAS_PLAYED))&&t}get inLiveWindow(){var e;return null==(e=this.mediaController)?void 0:e.hasAttribute(lj.MEDIA_TIME_IS_LIVE)}get _hls(){var e;return null==(e=this.media)?void 0:e._hls}get mux(){var e;return null==(e=this.media)?void 0:e.mux}get theme(){var e;return null!=(e=this.getAttribute(T0.THEME))?e:"gerwig"}set theme(e){this.setAttribute(T0.THEME,`${e}`)}get themeProps(){let e=this.mediaTheme;if(!e)return;let t={};for(let i of e.getAttributeNames()){if(T1.includes(i))continue;let r=e.getAttribute(i);t[Ti(i)]=""===r||r}return t}set themeProps(e){var t,i;bE(this,_e,_t).call(this);let r={...this.themeProps,...e};for(let a in r){if(T1.includes(a))continue;let r=null==e?void 0:e[a];"boolean"==typeof r||null==r?null==(t=this.mediaTheme)||t.toggleAttribute(Tt(a),!!r):null==(i=this.mediaTheme)||i.setAttribute(Tt(a),r)}}get playbackId(){var e;return null!=(e=this.getAttribute(vk.PLAYBACK_ID))?e:void 0}set playbackId(e){e?this.setAttribute(vk.PLAYBACK_ID,e):this.removeAttribute(vk.PLAYBACK_ID)}get src(){var e,t;return this.playbackId?null!=(e=_g(this,TJ.SRC))?e:void 0:null!=(t=this.getAttribute(TJ.SRC))?t:void 0}set src(e){e?this.setAttribute(TJ.SRC,e):this.removeAttribute(TJ.SRC)}get poster(){var e;let t=this.getAttribute(TJ.POSTER);if(null!=t)return t;let{tokens:i}=this;if(i.playback&&!i.thumbnail){Tv("Missing expected thumbnail token. No poster image will be shown");return}if(this.playbackId&&!this.audio)return Th(this.playbackId,{customDomain:this.customDomain,thumbnailTime:null!=(e=this.thumbnailTime)?e:this.startTime,programTime:this.programStartTime,token:i.thumbnail})}set poster(e){e||""===e?this.setAttribute(TJ.POSTER,e):this.removeAttribute(TJ.POSTER)}get storyboardSrc(){var e;return null!=(e=this.getAttribute(T0.STORYBOARD_SRC))?e:void 0}set storyboardSrc(e){e?this.setAttribute(T0.STORYBOARD_SRC,e):this.removeAttribute(T0.STORYBOARD_SRC)}get storyboard(){let{tokens:e}=this;return this.storyboardSrc&&!e.storyboard?this.storyboardSrc:this.audio||!this.playbackId||!this.streamType||[nj.LIVE,nj.UNKNOWN].includes(this.streamType)||e.playback&&!e.storyboard?void 0:Tc(this.playbackId,{customDomain:this.customDomain,token:e.storyboard,programStartTime:this.programStartTime,programEndTime:this.programEndTime})}get audio(){return this.hasAttribute(T0.AUDIO)}set audio(e){if(!e){this.removeAttribute(T0.AUDIO);return}this.setAttribute(T0.AUDIO,"")}get hotkeys(){return bf(this,T6)}get nohotkeys(){return this.hasAttribute(T0.NOHOTKEYS)}set nohotkeys(e){if(!e){this.removeAttribute(T0.NOHOTKEYS);return}this.setAttribute(T0.NOHOTKEYS,"")}get thumbnailTime(){return Tr(this.getAttribute(T0.THUMBNAIL_TIME))}set thumbnailTime(e){this.setAttribute(T0.THUMBNAIL_TIME,`${e}`)}get videoTitle(){var e,t;return null!=(t=null!=(e=this.getAttribute(T0.VIDEO_TITLE))?e:this.getAttribute(T0.TITLE))?t:""}set videoTitle(e){e!==this.videoTitle&&(e?this.setAttribute(T0.VIDEO_TITLE,e):this.removeAttribute(T0.VIDEO_TITLE))}get placeholder(){var e;return null!=(e=_g(this,T0.PLACEHOLDER))?e:""}set placeholder(e){this.setAttribute(T0.PLACEHOLDER,`${e}`)}get primaryColor(){var e,t;let i=this.getAttribute(T0.PRIMARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=y7.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_primary-color"))?void 0:t.trim()))return i}set primaryColor(e){this.setAttribute(T0.PRIMARY_COLOR,`${e}`)}get secondaryColor(){var e,t;let i=this.getAttribute(T0.SECONDARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=y7.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_secondary-color"))?void 0:t.trim()))return i}set secondaryColor(e){this.setAttribute(T0.SECONDARY_COLOR,`${e}`)}get accentColor(){var e,t;let i=this.getAttribute(T0.ACCENT_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=y7.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_accent-color"))?void 0:t.trim()))return i}set accentColor(e){this.setAttribute(T0.ACCENT_COLOR,`${e}`)}get defaultShowRemainingTime(){return this.hasAttribute(T0.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(e){e?this.setAttribute(T0.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(T0.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(this.hasAttribute(T0.PLAYBACK_RATES))return this.getAttribute(T0.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(e=>Number(e)).filter(e=>!Number.isNaN(e)).sort((e,t)=>e-t)}set playbackRates(e){if(!e){this.removeAttribute(T0.PLAYBACK_RATES);return}this.setAttribute(T0.PLAYBACK_RATES,e.join(" "))}get forwardSeekOffset(){var e;return null!=(e=Tr(this.getAttribute(T0.FORWARD_SEEK_OFFSET)))?e:10}set forwardSeekOffset(e){this.setAttribute(T0.FORWARD_SEEK_OFFSET,`${e}`)}get backwardSeekOffset(){var e;return null!=(e=Tr(this.getAttribute(T0.BACKWARD_SEEK_OFFSET)))?e:10}set backwardSeekOffset(e){this.setAttribute(T0.BACKWARD_SEEK_OFFSET,`${e}`)}get defaultHiddenCaptions(){return this.hasAttribute(T0.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(e){e?this.setAttribute(T0.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(T0.DEFAULT_HIDDEN_CAPTIONS)}get defaultDuration(){return Tr(this.getAttribute(T0.DEFAULT_DURATION))}set defaultDuration(e){null==e?this.removeAttribute(T0.DEFAULT_DURATION):this.setAttribute(T0.DEFAULT_DURATION,`${e}`)}get playerInitTime(){return this.hasAttribute(vk.PLAYER_INIT_TIME)?Tr(this.getAttribute(vk.PLAYER_INIT_TIME)):bf(this,T4)}set playerInitTime(e){e!=this.playerInitTime&&(null==e?this.removeAttribute(vk.PLAYER_INIT_TIME):this.setAttribute(vk.PLAYER_INIT_TIME,`${+e}`))}get playerSoftwareName(){var e;return null!=(e=this.getAttribute(vk.PLAYER_SOFTWARE_NAME))?e:_c}get playerSoftwareVersion(){var e;return null!=(e=this.getAttribute(vk.PLAYER_SOFTWARE_VERSION))?e:Tu}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(vk.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(vk.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(vk.BEACON_COLLECTION_DOMAIN))}get maxResolution(){var e;return null!=(e=this.getAttribute(vk.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(vk.MAX_RESOLUTION,e):this.removeAttribute(vk.MAX_RESOLUTION))}get minResolution(){var e;return null!=(e=this.getAttribute(vk.MIN_RESOLUTION))?e:void 0}set minResolution(e){e!==this.minResolution&&(e?this.setAttribute(vk.MIN_RESOLUTION,e):this.removeAttribute(vk.MIN_RESOLUTION))}get renditionOrder(){var e;return null!=(e=this.getAttribute(vk.RENDITION_ORDER))?e:void 0}set renditionOrder(e){e!==this.renditionOrder&&(e?this.setAttribute(vk.RENDITION_ORDER,e):this.removeAttribute(vk.RENDITION_ORDER))}get programStartTime(){return Tr(this.getAttribute(vk.PROGRAM_START_TIME))}set programStartTime(e){null==e?this.removeAttribute(vk.PROGRAM_START_TIME):this.setAttribute(vk.PROGRAM_START_TIME,`${e}`)}get programEndTime(){return Tr(this.getAttribute(vk.PROGRAM_END_TIME))}set programEndTime(e){null==e?this.removeAttribute(vk.PROGRAM_END_TIME):this.setAttribute(vk.PROGRAM_END_TIME,`${e}`)}get assetStartTime(){return Tr(this.getAttribute(vk.ASSET_START_TIME))}set assetStartTime(e){null==e?this.removeAttribute(vk.ASSET_START_TIME):this.setAttribute(vk.ASSET_START_TIME,`${e}`)}get assetEndTime(){return Tr(this.getAttribute(vk.ASSET_END_TIME))}set assetEndTime(e){null==e?this.removeAttribute(vk.ASSET_END_TIME):this.setAttribute(vk.ASSET_END_TIME,`${e}`)}get extraSourceParams(){return this.hasAttribute(T0.EXTRA_SOURCE_PARAMS)?[...new URLSearchParams(this.getAttribute(T0.EXTRA_SOURCE_PARAMS)).entries()].reduce((e,[t,i])=>(e[t]=i,e),{}):_p}set extraSourceParams(e){null==e?this.removeAttribute(T0.EXTRA_SOURCE_PARAMS):this.setAttribute(T0.EXTRA_SOURCE_PARAMS,new URLSearchParams(e).toString())}get customDomain(){var e;return null!=(e=this.getAttribute(vk.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(vk.CUSTOM_DOMAIN,e):this.removeAttribute(vk.CUSTOM_DOMAIN))}get envKey(){var e;return null!=(e=_g(this,vk.ENV_KEY))?e:void 0}set envKey(e){this.setAttribute(vk.ENV_KEY,`${e}`)}get noVolumePref(){return this.hasAttribute(T0.NO_VOLUME_PREF)}set noVolumePref(e){e?this.setAttribute(T0.NO_VOLUME_PREF,""):this.removeAttribute(T0.NO_VOLUME_PREF)}get debug(){return null!=_g(this,vk.DEBUG)}set debug(e){e?this.setAttribute(vk.DEBUG,""):this.removeAttribute(vk.DEBUG)}get disableTracking(){return null!=_g(this,vk.DISABLE_TRACKING)}set disableTracking(e){this.toggleAttribute(vk.DISABLE_TRACKING,!!e)}get disableCookies(){return null!=_g(this,vk.DISABLE_COOKIES)}set disableCookies(e){e?this.setAttribute(vk.DISABLE_COOKIES,""):this.removeAttribute(vk.DISABLE_COOKIES)}get streamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(vk.STREAM_TYPE))?t:null==(e=this.media)?void 0:e.streamType)?i:nj.UNKNOWN}set streamType(e){this.setAttribute(vk.STREAM_TYPE,`${e}`)}get defaultStreamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(T0.DEFAULT_STREAM_TYPE))?t:null==(e=this.mediaController)?void 0:e.getAttribute(T0.DEFAULT_STREAM_TYPE))?i:nj.ON_DEMAND}set defaultStreamType(e){e?this.setAttribute(T0.DEFAULT_STREAM_TYPE,e):this.removeAttribute(T0.DEFAULT_STREAM_TYPE)}get targetLiveWindow(){var e,t;return this.hasAttribute(T0.TARGET_LIVE_WINDOW)?+this.getAttribute(T0.TARGET_LIVE_WINDOW):null!=(t=null==(e=this.media)?void 0:e.targetLiveWindow)?t:Number.NaN}set targetLiveWindow(e){e==this.targetLiveWindow||Number.isNaN(e)&&Number.isNaN(this.targetLiveWindow)||(null==e?this.removeAttribute(T0.TARGET_LIVE_WINDOW):this.setAttribute(T0.TARGET_LIVE_WINDOW,`${+e}`))}get liveEdgeStart(){var e;return null==(e=this.media)?void 0:e.liveEdgeStart}get startTime(){return Tr(_g(this,vk.START_TIME))}set startTime(e){this.setAttribute(vk.START_TIME,`${e}`)}get preferPlayback(){let e=this.getAttribute(vk.PREFER_PLAYBACK);if(e===nz.MSE||e===nz.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===nz.MSE||e===nz.NATIVE?this.setAttribute(vk.PREFER_PLAYBACK,e):this.removeAttribute(vk.PREFER_PLAYBACK))}get metadata(){var e;return null==(e=this.media)?void 0:e.metadata}set metadata(e){if(bE(this,_e,_t).call(this),!this.media){TE("underlying media element missing when trying to set metadata. metadata will not be set.");return}this.media.metadata={...T3(this),...e}}get _hlsConfig(){var e;return null==(e=this.media)?void 0:e._hlsConfig}set _hlsConfig(e){if(bE(this,_e,_t).call(this),!this.media){TE("underlying media element missing when trying to set _hlsConfig. _hlsConfig will not be set.");return}this.media._hlsConfig=e}async addCuePoints(e){var t;if(bE(this,_e,_t).call(this),!this.media){TE("underlying media element missing when trying to addCuePoints. cuePoints will not be added.");return}return null==(t=this.media)?void 0:t.addCuePoints(e)}get activeCuePoint(){var e;return null==(e=this.media)?void 0:e.activeCuePoint}get cuePoints(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.cuePoints)?t:[]}addChapters(e){var t;if(bE(this,_e,_t).call(this),!this.media){TE("underlying media element missing when trying to addChapters. chapters will not be added.");return}return null==(t=this.media)?void 0:t.addChapters(e)}get activeChapter(){var e;return null==(e=this.media)?void 0:e.activeChapter}get chapters(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.chapters)?t:[]}getStartDate(){var e;return null==(e=this.media)?void 0:e.getStartDate()}get currentPdt(){var e;return null==(e=this.media)?void 0:e.currentPdt}get tokens(){let e=this.getAttribute(T0.PLAYBACK_TOKEN),t=this.getAttribute(T0.DRM_TOKEN),i=this.getAttribute(T0.THUMBNAIL_TOKEN),r=this.getAttribute(T0.STORYBOARD_TOKEN);return{...bf(this,T8),...null!=e?{playback:e}:{},...null!=t?{drm:t}:{},...null!=i?{thumbnail:i}:{},...null!=r?{storyboard:r}:{}}}set tokens(e){bv(this,T8,null!=e?e:{})}get playbackToken(){var e;return null!=(e=this.getAttribute(T0.PLAYBACK_TOKEN))?e:void 0}set playbackToken(e){this.setAttribute(T0.PLAYBACK_TOKEN,`${e}`)}get drmToken(){var e;return null!=(e=this.getAttribute(T0.DRM_TOKEN))?e:void 0}set drmToken(e){this.setAttribute(T0.DRM_TOKEN,`${e}`)}get thumbnailToken(){var e;return null!=(e=this.getAttribute(T0.THUMBNAIL_TOKEN))?e:void 0}set thumbnailToken(e){this.setAttribute(T0.THUMBNAIL_TOKEN,`${e}`)}get storyboardToken(){var e;return null!=(e=this.getAttribute(T0.STORYBOARD_TOKEN))?e:void 0}set storyboardToken(e){this.setAttribute(T0.STORYBOARD_TOKEN,`${e}`)}addTextTrack(e,t,i,r){var a;let s=null==(a=this.media)?void 0:a.nativeEl;if(s)return of(s,e,t,i,r)}removeTextTrack(e){var t;let i=null==(t=this.media)?void 0:t.nativeEl;if(i){let t;return void(null==(t=Array.prototype.find.call(i.querySelectorAll("track"),t=>t.track===e))||t.remove())}}get textTracks(){var e;return null==(e=this.media)?void 0:e.textTracks}get castReceiver(){var e;return null!=(e=this.getAttribute(T0.CAST_RECEIVER))?e:void 0}set castReceiver(e){e!==this.castReceiver&&(e?this.setAttribute(T0.CAST_RECEIVER,e):this.removeAttribute(T0.CAST_RECEIVER))}get castCustomData(){var e;return null==(e=this.media)?void 0:e.castCustomData}set castCustomData(e){if(!this.media){TE("underlying media element missing when trying to set castCustomData. castCustomData will not be set.");return}this.media.castCustomData=e}get noTooltips(){return this.hasAttribute(T0.NO_TOOLTIPS)}set noTooltips(e){if(!e){this.removeAttribute(T0.NO_TOOLTIPS);return}this.setAttribute(T0.NO_TOOLTIPS,"")}get proudlyDisplayMuxBadge(){return this.hasAttribute(T0.PROUDLY_DISPLAY_MUX_BADGE)}set proudlyDisplayMuxBadge(e){e?this.setAttribute(T0.PROUDLY_DISPLAY_MUX_BADGE,""):this.removeAttribute(T0.PROUDLY_DISPLAY_MUX_BADGE)}};function _g(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}T4=new WeakMap,T5=new WeakMap,T8=new WeakMap,T9=new WeakMap,T6=new WeakMap,T7=new WeakMap,_e=new WeakSet,_t=function(){var e,t,i,r;if(!bf(this,T5)){bv(this,T5,!0),bE(this,_e,_a).call(this);try{if(customElements.upgrade(this.mediaTheme),!(this.mediaTheme instanceof y7.HTMLElement))throw""}catch{TE("<media-theme> failed to upgrade!")}try{if(customElements.upgrade(this.media),!(this.media instanceof vD))throw""}catch{TE("<mux-video> failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof uq))throw""}catch{TE("<media-controller> failed to upgrade!")}this.init(),bE(this,_e,_s).call(this),bE(this,_e,_n).call(this),bE(this,_e,_o).call(this),bv(this,T9,null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute(dJ.USER_INACTIVE))||t),bE(this,_e,_l).call(this),null==(i=this.media)||i.addEventListener("streamtypechange",()=>bE(this,_e,_a).call(this)),null==(r=this.media)||r.addEventListener("loadstart",()=>bE(this,_e,_a).call(this))}},_i=function(){var e,t;try{null==(e=null==window?void 0:window.CSS)||e.registerProperty({name:"--media-primary-color",syntax:"<color>",inherits:!0}),null==(t=null==window?void 0:window.CSS)||t.registerProperty({name:"--media-secondary-color",syntax:"<color>",inherits:!0})}catch{}},_r=function(e){Object.assign(bf(this,T7),e),bE(this,_e,_a).call(this)},_a=function(e={}){var t,i,r,a,s;let n;(function(e,t){e.renderInto(t)})(TF((t={...bf(this,T7),...e},{src:!this.playbackId&&this.src,playbackId:this.playbackId,hasSrc:!!this.playbackId||!!this.src||!!this.currentSrc,poster:this.poster,storyboard:this.storyboard,storyboardSrc:this.getAttribute(T0.STORYBOARD_SRC),placeholder:this.getAttribute("placeholder"),themeTemplate:function(e){var t,i;let r=e.theme;if(r){let a=null==(i=null==(t=e.getRootNode())?void 0:t.getElementById)?void 0:i.call(t,r);if(a&&a instanceof HTMLTemplateElement)return a;r.startsWith("media-theme-")||(r=`media-theme-${r}`);let s=y7.customElements.get(r);if(null!=s&&s.template)return s.template}}(this),thumbnailTime:!this.tokens.thumbnail&&this.thumbnailTime,autoplay:this.autoplay,crossOrigin:this.crossOrigin,loop:this.loop,noHotKeys:this.hasAttribute(T0.NOHOTKEYS),hotKeys:this.getAttribute(T0.HOTKEYS),muted:this.muted,paused:this.paused,preload:this.preload,envKey:this.envKey,preferCmcd:this.preferCmcd,debug:this.debug,disableTracking:this.disableTracking,disableCookies:this.disableCookies,tokens:this.tokens,beaconCollectionDomain:this.beaconCollectionDomain,maxResolution:this.maxResolution,minResolution:this.minResolution,programStartTime:this.programStartTime,programEndTime:this.programEndTime,assetStartTime:this.assetStartTime,assetEndTime:this.assetEndTime,renditionOrder:this.renditionOrder,metadata:this.metadata,playerInitTime:this.playerInitTime,playerSoftwareName:this.playerSoftwareName,playerSoftwareVersion:this.playerSoftwareVersion,startTime:this.startTime,preferPlayback:this.preferPlayback,audio:this.audio,defaultStreamType:this.defaultStreamType,targetLiveWindow:this.getAttribute(vk.TARGET_LIVE_WINDOW),streamType:Tm(this.getAttribute(vk.STREAM_TYPE)),primaryColor:this.getAttribute(T0.PRIMARY_COLOR),secondaryColor:this.getAttribute(T0.SECONDARY_COLOR),accentColor:this.getAttribute(T0.ACCENT_COLOR),forwardSeekOffset:this.forwardSeekOffset,backwardSeekOffset:this.backwardSeekOffset,defaultHiddenCaptions:this.defaultHiddenCaptions,defaultDuration:this.defaultDuration,defaultShowRemainingTime:this.defaultShowRemainingTime,hideDuration:(a=this,(n=null==(s=a.mediaController)?void 0:s.querySelector("media-time-display"))&&"none"===getComputedStyle(n).getPropertyValue("--media-duration-display-display").trim()),playbackRates:this.getAttribute(T0.PLAYBACK_RATES),customDomain:null!=(i=this.getAttribute(vk.CUSTOM_DOMAIN))?i:void 0,title:this.getAttribute(T0.TITLE),videoTitle:null!=(r=this.getAttribute(T0.VIDEO_TITLE))?r:this.getAttribute(T0.TITLE),novolumepref:this.hasAttribute(T0.NO_VOLUME_PREF),castReceiver:this.castReceiver,proudlyDisplayMuxBadge:this.hasAttribute(T0.PROUDLY_DISPLAY_MUX_BADGE),...t,extraSourceParams:this.extraSourceParams})),this.shadowRoot)},_s=function(){let e=e=>{var t,i;if(!(null!=e&&e.startsWith("theme-")))return;let r=e.replace(/^theme-/,"");if(T1.includes(r))return;let a=this.getAttribute(e);null!=a?null==(t=this.mediaTheme)||t.setAttribute(r,a):null==(i=this.mediaTheme)||i.removeAttribute(r)};new MutationObserver(t=>{for(let{attributeName:i}of t)e(i)}).observe(this,{attributes:!0}),this.getAttributeNames().forEach(e)},_n=function(){var e;this.addEventListener("error",e=>{let{detail:t}=e;if(t instanceof nK||(t=new nK(t.message,t.code,t.fatal)),!(null!=t&&t.fatal)){Tv(t),t.data&&Tv(`${t.name} data:`,t.data);return}let i=Tq(t,!1);i.message&&Tb(i),TE(t),t.data&&TE(`${t.name} data:`,t.data),bE(this,_e,_r).call(this,{isDialogOpen:!0})}),this.media&&(this.media.errorTranslator=(e={})=>{var t,i,r;if(!((null==(t=this.media)?void 0:t.error)instanceof nK))return e;let a=Tq(null==(i=this.media)?void 0:i.error,!1);return{player_error_code:null==(r=this.media)?void 0:r.error.code,player_error_message:a.message?String(a.message):e.player_error_message,player_error_context:a.context?String(a.context):e.player_error_context}}),null==(e=this.media)||e.addEventListener("error",e=>{var t,i;let{detail:r}=e;if(!r){let{message:e,code:a}=null!=(i=null==(t=this.media)?void 0:t.error)?i:{};r=new nK(e,a)}null!=r&&r.fatal&&this.dispatchEvent(new CustomEvent("error",{detail:r}))})},_o=function(){var e,t,i,r;let a=()=>bE(this,_e,_a).call(this);null==(t=null==(e=this.media)?void 0:e.textTracks)||t.addEventListener("addtrack",a),null==(r=null==(i=this.media)?void 0:i.textTracks)||r.addEventListener("removetrack",a)},_l=function(){var e,t;if(!/Firefox/i.test(navigator.userAgent))return;let i,r=new WeakMap,a=()=>this.streamType===nj.LIVE&&!this.secondaryColor&&this.offsetWidth>=800,s=(e,t,i=!1)=>{a()||Array.from(e&&e.activeCues||[]).forEach(e=>{if(!(!e.snapToLines||e.line<-5||e.line>=0&&e.line<10)){if(!t||this.paused){let t=e.text.split(`
`).length,a=-3;this.streamType===nj.LIVE&&(a=-2);let s=a-t;(e.line!==s||i)&&(r.has(e)||r.set(e,e.line),e.line=s)}else setTimeout(()=>{e.line=r.get(e)||"auto"},500)}})},n=()=>{var e,t;s(i,null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute(dJ.USER_INACTIVE))&&t)},o=()=>{var e,t;let r=Array.from((null==(t=null==(e=this.mediaController)?void 0:e.media)?void 0:t.textTracks)||[]).filter(e=>["subtitles","captions"].includes(e.kind)&&"showing"===e.mode)[0];r!==i&&(null==i||i.removeEventListener("cuechange",n)),null==(i=r)||i.addEventListener("cuechange",n),s(i,bf(this,T9))};o(),null==(e=this.textTracks)||e.addEventListener("change",o),null==(t=this.textTracks)||t.addEventListener("addtrack",o),this.addEventListener("userinactivechange",()=>{var e,t;let r=null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute(dJ.USER_INACTIVE))||t;bf(this,T9)!==r&&(bv(this,T9,r),s(i,bf(this,T9)))})},y7.customElements.get("mux-player")||(y7.customElements.define("mux-player",_f),y7.MuxPlayerElement=_f);var _v=parseInt(l.version)>=19,_E={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox",playsInline:"playsinline",autoPlay:"autoplay",playbackRate:"playbackrate"},_b=e=>null==e,_y=(e,t)=>!_b(t)&&e in t,_T=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),__=(e,t)=>{if(!(!_v&&"boolean"==typeof t&&!t)){if(_y(e,_E))return _E[e];if(void 0!==t)return/[A-Z]/.test(e)?_T(e):e}},_A=(e,t)=>_v||"boolean"!=typeof e?e:"",_S=(e={})=>Object.entries(e).reduce((e,[t,i])=>{let r=__(t,i);if(!r)return e;let a=_A(i,t);return e[r]=a,e},{}),_k=(...e)=>{let t=(0,l.useRef)(null);return(0,l.useEffect)(()=>{e.forEach(e=>{e&&("function"==typeof e?e(t.current):e.current=t.current)})},[e]),t},_R=Object.prototype.hasOwnProperty,_I=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(Array.isArray(e))return!!Array.isArray(t)&&e.length===t.length&&e.some((e,i)=>t[i]===e);let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let r=0;r<i.length;r++)if(!_R.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0},_L=(e,t,i)=>!_I(t,e[i]),_w=(e,t,i)=>{e[i]=t},_D=(e,t,i,r=_w,a=_L)=>(0,l.useEffect)(()=>{let s=null==i?void 0:i.current;s&&a(s,t,e)&&r(s,t,e)},[null==i?void 0:i.current,t]),_C=(()=>{try{return"3.4.0"}catch{}return"UNKNOWN"})(),_x=l.forwardRef(({children:e,...t},i)=>l.createElement("mux-player",_S({...t,ref:i}),e)),_M=(e,t,i)=>(0,l.useEffect)(()=>{let r=null==t?void 0:t.current;if(!(!r||!i))return r.addEventListener(e,i),()=>{r.removeEventListener(e,i)}},[null==t?void 0:t.current,i]),_O=(e,t)=>{let{onAbort:i,onCanPlay:r,onCanPlayThrough:a,onEmptied:s,onLoadStart:n,onLoadedData:o,onLoadedMetadata:l,onProgress:d,onDurationChange:u,onVolumeChange:h,onRateChange:c,onResize:m,onWaiting:p,onPlay:f,onPlaying:g,onTimeUpdate:E,onPause:b,onSeeking:y,onSeeked:T,onStalled:_,onSuspend:A,onEnded:S,onError:k,onCuePointChange:R,onCuePointsChange:I,onChapterChange:L,metadata:w,tokens:D,paused:C,playbackId:x,playbackRates:M,currentTime:O,themeProps:N,extraSourceParams:P,castCustomData:U,_hlsConfig:F,...B}=t;return _D("playbackRates",M,e),_D("metadata",w,e),_D("extraSourceParams",P,e),_D("_hlsConfig",F,e),_D("themeProps",N,e),_D("tokens",D,e),_D("playbackId",x,e),_D("castCustomData",U,e),_D("paused",C,e,(e,t)=>{null!=t&&(t?e.pause():e.play())},(e,t,i)=>(!e.hasAttribute("autoplay")||!!e.hasPlayed)&&_L(e,t,i)),_D("currentTime",O,e,(e,t)=>{null!=t&&(e.currentTime=t)}),_M("abort",e,i),_M("canplay",e,r),_M("canplaythrough",e,a),_M("emptied",e,s),_M("loadstart",e,n),_M("loadeddata",e,o),_M("loadedmetadata",e,l),_M("progress",e,d),_M("durationchange",e,u),_M("volumechange",e,h),_M("ratechange",e,c),_M("resize",e,m),_M("waiting",e,p),_M("play",e,f),_M("playing",e,g),_M("timeupdate",e,E),_M("pause",e,b),_M("seeking",e,y),_M("seeked",e,T),_M("stalled",e,_),_M("suspend",e,A),_M("ended",e,S),_M("error",e,k),_M("cuepointchange",e,R),_M("cuepointschange",e,I),_M("chapterchange",e,L),[B]},_N=_C,_P="mux-player-react",_U=l.forwardRef((e,t)=>{var i;let r=(0,l.useRef)(null),a=_k(r,t),[s]=_O(r,e),[n]=(0,l.useState)(null!=(i=e.playerInitTime)?i:ll());return l.createElement(_x,{ref:a,defaultHiddenCaptions:e.defaultHiddenCaptions,playerSoftwareName:_P,playerSoftwareVersion:_N,playerInitTime:n,...s})})}}]);